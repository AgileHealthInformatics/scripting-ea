<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Chapter 10: MDG-Aware Scripting – Scripting Sparx Enterprise Architect: A Practical Handbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./12-System.Object[].html" rel="next">
<link href="./10-System.Object[].html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-b4ddde2c4c77ed14ccfa95278770da4f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- Google tag (gtag.js) -->

<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-B63WMQH4CK"></script>

<script>

  window.dataLayer = window.dataLayer || [];

  function gtag(){dataLayer.push(arguments);}

  gtag('js', new Date());

  gtag('config', 'G-B63WMQH4CK');

</script>



<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./11-System.Object[].html"><span class="chapter-title">Chapter 10: MDG-Aware Scripting</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Scripting Sparx Enterprise Architect: A Practical Handbook</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Scripting Sparx Enterprise Architect</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 1: Why Script EA?</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 2: Automation Landscape</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 3: Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 4: API Essentials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 5: Inside EA with JScript</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 6: External Automation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 7: Script Design Patterns</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 8: Object Details</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 9: Imports &amp; Exports</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-System.Object[].html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Chapter 10: MDG-Aware Scripting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 11: Governance Scripts</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 12: Cookbook of Examples</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 13: Why AI Helps</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 14: Prompt Engineering</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 15: AI Refactoring Partner</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 16: AI in Daily Workflow</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 17: Performance &amp; Scaling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 18: Integrating with Workflows</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 19: Add-ins vs Scripts</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 20: Troubleshooting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 21: Reference</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix A: Scripting Constraints</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix B: External Automation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix C: Glossary of Terms</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix D: Quick Reference</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix E: External Automation Setup</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#what-are-mdgs" id="toc-what-are-mdgs" class="nav-link active" data-scroll-target="#what-are-mdgs">What Are MDGs?</a></li>
  <li><a href="#why-mdgs-matter-for-scripting" id="toc-why-mdgs-matter-for-scripting" class="nav-link" data-scroll-target="#why-mdgs-matter-for-scripting">Why MDGs Matter for Scripting</a></li>
  <li><a href="#important-tips" id="toc-important-tips" class="nav-link" data-scroll-target="#important-tips">Important Tips</a>
  <ul class="collapse">
  <li><a href="#the-stereotype-vs.-stereotypeex-trap" id="toc-the-stereotype-vs.-stereotypeex-trap" class="nav-link" data-scroll-target="#the-stereotype-vs.-stereotypeex-trap">The Stereotype vs.&nbsp;StereotypeEx Trap</a></li>
  <li><a href="#tagged-value-definitions" id="toc-tagged-value-definitions" class="nav-link" data-scroll-target="#tagged-value-definitions">Tagged Value Definitions</a></li>
  <li><a href="#toolboxes-and-element-creation" id="toc-toolboxes-and-element-creation" class="nav-link" data-scroll-target="#toolboxes-and-element-creation">Toolboxes and Element Creation</a></li>
  <li><a href="#validating-mdg-usage" id="toc-validating-mdg-usage" class="nav-link" data-scroll-target="#validating-mdg-usage">Validating MDG Usage</a></li>
  <li><a href="#when-mdgs-change" id="toc-when-mdgs-change" class="nav-link" data-scroll-target="#when-mdgs-change">When MDGs Change</a></li>
  </ul></li>
  <li><a href="#mdgs-in-external-automation" id="toc-mdgs-in-external-automation" class="nav-link" data-scroll-target="#mdgs-in-external-automation">MDGs in External Automation</a></li>
  <li><a href="#safety-and-governance" id="toc-safety-and-governance" class="nav-link" data-scroll-target="#safety-and-governance">Safety and Governance</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a>
  <ul class="collapse">
  <li><a href="#stereotypes-101-mdg-aware" id="toc-stereotypes-101-mdg-aware" class="nav-link" data-scroll-target="#stereotypes-101-mdg-aware">Stereotypes 101 (MDG-aware)</a></li>
  <li><a href="#tagged-value-definitions-mdg-driven" id="toc-tagged-value-definitions-mdg-driven" class="nav-link" data-scroll-target="#tagged-value-definitions-mdg-driven">Tagged Value Definitions (MDG-driven)</a></li>
  <li><a href="#mdg-validator-report-only" id="toc-mdg-validator-report-only" class="nav-link" data-scroll-target="#mdg-validator-report-only">MDG Validator (report-only)</a></li>
  <li><a href="#mdg-repair-guided-and-safe" id="toc-mdg-repair-guided-and-safe" class="nav-link" data-scroll-target="#mdg-repair-guided-and-safe">MDG Repair (guided and safe)</a></li>
  <li><a href="#validating-toolbox-conformance-lightweight" id="toc-validating-toolbox-conformance-lightweight" class="nav-link" data-scroll-target="#validating-toolbox-conformance-lightweight">Validating toolbox conformance (lightweight)</a></li>
  <li><a href="#bulk-discovery-using-sql-fast-find-safe-check" id="toc-bulk-discovery-using-sql-fast-find-safe-check" class="nav-link" data-scroll-target="#bulk-discovery-using-sql-fast-find-safe-check">Bulk discovery using SQL (fast find, safe check)</a></li>
  </ul></li>
  <li><a href="#safety-governance-notes" id="toc-safety-governance-notes" class="nav-link" data-scroll-target="#safety-governance-notes">Safety &amp; governance notes</a></li>
  <li><a href="#what-to-use-when-cheat-sheet" id="toc-what-to-use-when-cheat-sheet" class="nav-link" data-scroll-target="#what-to-use-when-cheat-sheet">What to use when (cheat-sheet)</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-title">Chapter 10: MDG-Aware Scripting</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>By now, we’ve looked at the essentials of EA scripting, design patterns, and the mechanics of importing and exporting. But Enterprise Architect is more than just a generic UML tool. Its true power lies in <strong>MDG Technologies</strong> (Model Driven Generation). MDGs extend EA with domain-specific languages, toolboxes, and stereotypes that tailor the tool to specific contexts: ArchiMate, BPMN, SysML, TOGAF, and countless custom frameworks.</p>
<p>For script authors, MDGs present both opportunities and challenges. On one hand, they give structure — a controlled set of stereotypes, tagged values, and toolboxes. On the other hand, they introduce complexity — multiple profiles, extended stereotypes, and hidden differences between what the GUI shows and what the API actually stores.</p>
<p>This chapter explores how to make your scripts <strong>MDG-aware</strong>. It explains what MDGs are, how stereotypes and tagged values are defined, why you must use StereotypeEx instead of Stereotype, and how to validate models against MDG definitions. Without MDG awareness, your scripts may appear to work but silently misalign with the modelling framework your organisation depends on. With MDG awareness, your scripts become governance tools that reinforce standards and prevent drift.</p>
<section id="what-are-mdgs" class="level2">
<h2 class="anchored" data-anchor-id="what-are-mdgs">What Are MDGs?</h2>
<p>MDG Technologies are EA’s mechanism for packaging modelling extensions. They define:</p>
<ul>
<li><p><strong>Stereotypes</strong>: specialisations of UML element types (e.g., ArchiMate ApplicationComponent).</p></li>
<li><p><strong>Toolboxes</strong>: palettes of elements and connectors available to modellers.</p></li>
<li><p><strong>Tagged Values</strong>: metadata fields automatically attached to stereotyped elements.</p></li>
<li><p><strong>Profiles and MetaModels</strong>: rules about what elements and connectors can be created.</p></li>
</ul>
<p>An MDG is essentially a bundle that turns EA from a generic modelling tool into a domain-specific environment.</p>
</section>
<section id="why-mdgs-matter-for-scripting" class="level2">
<h2 class="anchored" data-anchor-id="why-mdgs-matter-for-scripting">Why MDGs Matter for Scripting</h2>
<p>When you script EA, you are not usually working with plain UML classes or components. You are working with <strong>stereotyped elements defined by MDGs</strong>. For example, if you are automating ArchiMate models, your script needs to distinguish ApplicationComponents from BusinessActors. If you are automating BPMN, you need to treat Tasks, Gateways, and Events differently.</p>
<p>Scripts that ignore MDGs risk breaking models. A script might rename or move elements without preserving stereotypes. Or it might overwrite a stereotype by writing to Element.Stereotype instead of Element.StereotypeEx. These mistakes create elements that look right in the Project Browser but misbehave in diagrams or reports.</p>
</section>
<section id="important-tips" class="level2">
<h2 class="anchored" data-anchor-id="important-tips">Important Tips</h2>
<section id="the-stereotype-vs.-stereotypeex-trap" class="level3">
<h3 class="anchored" data-anchor-id="the-stereotype-vs.-stereotypeex-trap">The Stereotype vs.&nbsp;StereotypeEx Trap</h3>
<p>One of the most notorious pitfalls in EA scripting is the difference between Stereotype and StereotypeEx.</p>
<ul>
<li><p><strong>Stereotype</strong> returns only the primary stereotype string, stripped of profile information.</p></li>
<li><p><strong>StereotypeEx</strong> returns the fully qualified stereotype, including the profile (profile::stereotype).</p></li>
</ul>
<p>If you rely on Stereotype, your script may confuse two stereotypes with the same name from different profiles. Worse, if you set Stereotype, you may erase MDG metadata.</p>
<p>The safe rule is: <strong>always use StereotypeEx</strong> when working with MDG stereotypes.</p>
</section>
<section id="tagged-value-definitions" class="level3">
<h3 class="anchored" data-anchor-id="tagged-value-definitions">Tagged Value Definitions</h3>
<p>MDGs often define tagged values that attach automatically to elements with a given stereotype. For example, an ArchiMate ApplicationComponent may come with tagged values like “Layer” or “Technology.”</p>
<p>Scripts must handle these tagged values carefully. You should:</p>
<ul>
<li><p>Check if the tag exists before adding a new one.</p></li>
<li><p>Use the correct tag names from the MDG definition.</p></li>
<li><p>Avoid overwriting tags with unexpected values.</p></li>
</ul>
<p>Proper handling ensures your automation works with, not against, the MDG.</p>
</section>
<section id="toolboxes-and-element-creation" class="level3">
<h3 class="anchored" data-anchor-id="toolboxes-and-element-creation">Toolboxes and Element Creation</h3>
<p>When creating elements via script, it’s important to align with MDG toolboxes. If your organisation uses a custom MDG that defines “Business Capability” as MyProfile::Capability, then your script must create elements with that stereotype. Creating a plain UML Class and renaming it “Capability” will cause confusion.</p>
<p>The safe pattern is to:</p>
<ul>
<li><p>Identify the correct stereotype from the MDG.</p></li>
<li><p>Use Elements.AddNew(name, baseType) followed by StereotypeEx = “profile::stereo”.</p></li>
<li><p>Call Update() and RefreshModelView().</p></li>
</ul>
</section>
<section id="validating-mdg-usage" class="level3">
<h3 class="anchored" data-anchor-id="validating-mdg-usage">Validating MDG Usage</h3>
<p>MDG-aware scripting isn’t only about creating elements correctly. It’s also about validating existing models. Common checks include:</p>
<ul>
<li><p>Elements of stereotype X must have certain tagged values populated.</p></li>
<li><p>Connectors of type Y may only connect specific element types.</p></li>
<li><p>Packages must only contain elements from an approved toolbox.</p></li>
</ul>
<p>By writing MDG-aware validation scripts, you can enforce compliance and prevent “model drift” where users create incorrect structures.</p>
</section>
<section id="when-mdgs-change" class="level3">
<h3 class="anchored" data-anchor-id="when-mdgs-change">When MDGs Change</h3>
<p>Another challenge is that MDGs evolve. Stereotypes may be renamed, tagged values may be added, or toolboxes reorganised. Scripts must be robust to such changes. That means:</p>
<ul>
<li><p>Avoid hardcoding stereotypes wherever possible — use configuration files or central mappings.</p></li>
<li><p>Log when unknown stereotypes are encountered.</p></li>
<li><p>Keep scripts version-controlled and updated alongside MDG changes.</p></li>
</ul>
</section>
</section>
<section id="mdgs-in-external-automation" class="level2">
<h2 class="anchored" data-anchor-id="mdgs-in-external-automation">MDGs in External Automation</h2>
<p>Everything we’ve said so far applies inside EA’s scripting engine, but it also applies in external automation. If you are pulling EA content into Python or C#, you still need to handle stereotypes correctly. That means reading StereotypeEx, exporting tagged values, and mapping them to your enterprise data models.</p>
<p>In fact, external automation often makes MDG handling easier because you can use richer libraries (YAML, JSON) to store stereotype/tag mappings.</p>
</section>
<section id="safety-and-governance" class="level2">
<h2 class="anchored" data-anchor-id="safety-and-governance">Safety and Governance</h2>
<p>MDG-aware scripting is not just a technical detail. It is a matter of governance. In large organisations, MDGs embody agreed standards: what modelling constructs are allowed, how they are tagged, and how they interrelate. Scripts that respect MDGs reinforce governance. Scripts that ignore them undermine it.</p>
<p>By making scripts MDG-aware, you align automation with enterprise architecture frameworks, regulatory requirements, and industry standards.</p>
</section>
<section id="examples" class="level2">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<section id="stereotypes-101-mdg-aware" class="level3">
<h3 class="anchored" data-anchor-id="stereotypes-101-mdg-aware">Stereotypes 101 (MDG-aware)</h3>
<ul>
<li><p><strong>Element.Stereotype</strong>: the “plain” stereotype string (often just the short name).</p></li>
<li><p><strong>Element.StereotypeEx</strong>: the <strong>fully-qualified</strong> list (may contain profile::stereotype, comma-separated).</p></li>
<li><p><strong>Multiple stereotypes</strong>: use StereotypeEx.</p></li>
<li><p><strong>Best practice</strong>: when working with MDGs, <strong>set and test against StereotypeEx</strong> with the profile::stereo form.</p></li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 10.1 - MDG_ApplyStereotype.js – JScript (ES3)</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" data-filename="Example 10.1 - MDG_ApplyStereotype.js – JScript (ES3)"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">// Example 10.1 - MDG_ApplyStereotype.js – JScript (ES3)</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">// Purpose: Ensure elements in the selected package have a specific MDG stereotype</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">// Notes:</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">//  - Uses profile::stereotype form via StereotypeEx</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co">//  - Safe by default with DRY_RUN flag</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb1-12"><a href="#cb1-12"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"MDG_ApplyStereo"</span><span class="op">;</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a>    <span class="co">// ---- Config ----</span></span>
<span id="cb1-16"><a href="#cb1-16"></a>    <span class="kw">var</span> DRY_RUN <span class="op">=</span> <span class="kw">true</span><span class="op">;</span>                        <span class="co">// switch to false to commit</span></span>
<span id="cb1-17"><a href="#cb1-17"></a>    <span class="kw">var</span> PROFILE <span class="op">=</span> <span class="st">"MyProfile"</span><span class="op">;</span>                 <span class="co">// MDG profile name</span></span>
<span id="cb1-18"><a href="#cb1-18"></a>    <span class="kw">var</span> STEREO  <span class="op">=</span> <span class="st">"BusinessCapability"</span><span class="op">;</span>        <span class="co">// Stereotype short name</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>    <span class="kw">var</span> FQ      <span class="op">=</span> PROFILE <span class="op">+</span> <span class="st">"::"</span> <span class="op">+</span> STEREO<span class="op">;</span>     <span class="co">// fully-qualified</span></span>
<span id="cb1-20"><a href="#cb1-20"></a></span>
<span id="cb1-21"><a href="#cb1-21"></a>    <span class="kw">var</span> pkg <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span>()<span class="op">;</span></span>
<span id="cb1-22"><a href="#cb1-22"></a>    <span class="cf">if</span> (<span class="op">!</span>pkg) { Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Select a target package."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a>    <span class="kw">var</span> els <span class="op">=</span> pkg<span class="op">.</span><span class="at">Elements</span><span class="op">,</span> changed <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-25"><a href="#cb1-25"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>els<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-26"><a href="#cb1-26"></a>        <span class="kw">var</span> e <span class="op">=</span> els<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb1-27"><a href="#cb1-27"></a></span>
<span id="cb1-28"><a href="#cb1-28"></a>        <span class="co">// Skip non-matching base types if you want (e.g., only Classes)</span></span>
<span id="cb1-29"><a href="#cb1-29"></a>        <span class="co">// if (e.Type != "Class") continue;</span></span>
<span id="cb1-30"><a href="#cb1-30"></a></span>
<span id="cb1-31"><a href="#cb1-31"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">hasFQStereotype</span>(e<span class="op">,</span> FQ)) {</span>
<span id="cb1-32"><a href="#cb1-32"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Apply stereotype to '"</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">"': "</span> <span class="op">+</span> FQ)<span class="op">;</span></span>
<span id="cb1-33"><a href="#cb1-33"></a>            <span class="cf">if</span> (<span class="op">!</span>DRY_RUN) {</span>
<span id="cb1-34"><a href="#cb1-34"></a>                <span class="co">// Add (or replace) StereotypeEx preserving any existing ones</span></span>
<span id="cb1-35"><a href="#cb1-35"></a>                e<span class="op">.</span><span class="at">StereotypeEx</span> <span class="op">=</span> <span class="fu">addFQStereotype</span>(e<span class="op">.</span><span class="at">StereotypeEx</span><span class="op">,</span> FQ)<span class="op">;</span></span>
<span id="cb1-36"><a href="#cb1-36"></a>                e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span></span>
<span id="cb1-37"><a href="#cb1-37"></a>            }</span>
<span id="cb1-38"><a href="#cb1-38"></a>            changed<span class="op">++;</span></span>
<span id="cb1-39"><a href="#cb1-39"></a>        }</span>
<span id="cb1-40"><a href="#cb1-40"></a>    }</span>
<span id="cb1-41"><a href="#cb1-41"></a>    <span class="cf">if</span> (<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> changed<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(pkg<span class="op">.</span><span class="at">PackageID</span>)<span class="op">;</span></span>
<span id="cb1-42"><a href="#cb1-42"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Updated "</span> <span class="op">+</span> changed <span class="op">+</span> <span class="st">" element(s). Dry-run="</span> <span class="op">+</span> DRY_RUN)<span class="op">;</span></span>
<span id="cb1-43"><a href="#cb1-43"></a>}</span>
<span id="cb1-44"><a href="#cb1-44"></a></span>
<span id="cb1-45"><a href="#cb1-45"></a><span class="kw">function</span> <span class="fu">hasFQStereotype</span>(e<span class="op">,</span> fq) {</span>
<span id="cb1-46"><a href="#cb1-46"></a>    <span class="kw">var</span> list <span class="op">=</span> <span class="bu">String</span>(e<span class="op">.</span><span class="at">StereotypeEx</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span></span>
<span id="cb1-47"><a href="#cb1-47"></a>    <span class="co">// simple token check; EA uses comma-separated list</span></span>
<span id="cb1-48"><a href="#cb1-48"></a>    <span class="kw">var</span> items <span class="op">=</span> list<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">;</span></span>
<span id="cb1-49"><a href="#cb1-49"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>items<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-50"><a href="#cb1-50"></a>        <span class="cf">if</span> (<span class="fu">equalsIgnoreCase</span>(<span class="fu">trim</span>(items[i])<span class="op">,</span> fq)) <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb1-51"><a href="#cb1-51"></a>    }</span>
<span id="cb1-52"><a href="#cb1-52"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb1-53"><a href="#cb1-53"></a>}</span>
<span id="cb1-54"><a href="#cb1-54"></a><span class="kw">function</span> <span class="fu">addFQStereotype</span>(current<span class="op">,</span> fq) {</span>
<span id="cb1-55"><a href="#cb1-55"></a>    current <span class="op">=</span> <span class="bu">String</span>(current<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb1-56"><a href="#cb1-56"></a>    <span class="cf">if</span> (current <span class="op">===</span> <span class="st">""</span>) <span class="cf">return</span> fq<span class="op">;</span></span>
<span id="cb1-57"><a href="#cb1-57"></a>    <span class="co">// Avoid dupes</span></span>
<span id="cb1-58"><a href="#cb1-58"></a>    <span class="kw">var</span> items <span class="op">=</span> current<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">,</span> i<span class="op">;</span></span>
<span id="cb1-59"><a href="#cb1-59"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>items<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-60"><a href="#cb1-60"></a>        <span class="cf">if</span> (<span class="fu">equalsIgnoreCase</span>(<span class="fu">trim</span>(items[i])<span class="op">,</span> fq)) <span class="cf">return</span> current<span class="op">;</span></span>
<span id="cb1-61"><a href="#cb1-61"></a>    }</span>
<span id="cb1-62"><a href="#cb1-62"></a>    <span class="cf">return</span> current <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> fq<span class="op">;</span></span>
<span id="cb1-63"><a href="#cb1-63"></a>}</span>
<span id="cb1-64"><a href="#cb1-64"></a></span>
<span id="cb1-65"><a href="#cb1-65"></a><span class="fu">main</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="tagged-value-definitions-mdg-driven" class="level3">
<h3 class="anchored" data-anchor-id="tagged-value-definitions-mdg-driven">Tagged Value Definitions (MDG-driven)</h3>
<p>MDGs typically define tagged value <strong>types</strong> (lists, refs, memo) and <strong>required</strong> tags per stereotype. From scripts you usually don’t read MDG metadata directly; instead you <strong>encode your project’s rules</strong> in a small configuration map and then <strong>enforce</strong> those rules.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 10.2 - MDG_Rulebook.js – JScript (ES3)</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" data-filename="Example 10.2 - MDG_Rulebook.js – JScript (ES3)"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">// Example 10.2 - MDG_Rulebook.js – JScript (ES3)</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">// Purpose: Central config for your MDG validation/repair scripts</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">// Notes: Express stereotypes fully-qualified as PROFILE::STEREO</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="kw">var</span> MDG_RULES <span class="op">=</span> {</span>
<span id="cb2-7"><a href="#cb2-7"></a>    <span class="st">"MyProfile::BusinessCapability"</span><span class="op">:</span> {</span>
<span id="cb2-8"><a href="#cb2-8"></a>        <span class="dt">baseType</span><span class="op">:</span> <span class="st">"Class"</span><span class="op">,</span>                         <span class="co">// optional; skip other base types</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>        <span class="dt">requiredTags</span><span class="op">:</span> [</span>
<span id="cb2-10"><a href="#cb2-10"></a>            { <span class="dt">name</span><span class="op">:</span> <span class="st">"Owner"</span><span class="op">,</span>       <span class="dt">defaultValue</span><span class="op">:</span> <span class="st">"ArchitectureTeam"</span> }<span class="op">,</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>            { <span class="dt">name</span><span class="op">:</span> <span class="st">"Lifecycle"</span><span class="op">,</span>   <span class="dt">defaultValue</span><span class="op">:</span> <span class="st">"Active"</span> }<span class="op">,</span></span>
<span id="cb2-12"><a href="#cb2-12"></a>            { <span class="dt">name</span><span class="op">:</span> <span class="st">"ExternalID"</span><span class="op">,</span>  <span class="dt">defaultValue</span><span class="op">:</span> <span class="st">""</span> }     <span class="co">// leave blank; must be filled by users/imports</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>        ]<span class="op">,</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>        <span class="dt">namePrefix</span><span class="op">:</span> <span class="st">"BC_"</span>                           <span class="co">// optional naming convention</span></span>
<span id="cb2-15"><a href="#cb2-15"></a>    }<span class="op">,</span></span>
<span id="cb2-16"><a href="#cb2-16"></a>    <span class="st">"MyProfile::ApplicationService"</span><span class="op">:</span> {</span>
<span id="cb2-17"><a href="#cb2-17"></a>        <span class="dt">baseType</span><span class="op">:</span> <span class="st">"Class"</span><span class="op">,</span></span>
<span id="cb2-18"><a href="#cb2-18"></a>        <span class="dt">requiredTags</span><span class="op">:</span> [</span>
<span id="cb2-19"><a href="#cb2-19"></a>            { <span class="dt">name</span><span class="op">:</span> <span class="st">"Owner"</span><span class="op">,</span>      <span class="dt">defaultValue</span><span class="op">:</span> <span class="st">"AppTeam"</span> }<span class="op">,</span></span>
<span id="cb2-20"><a href="#cb2-20"></a>            { <span class="dt">name</span><span class="op">:</span> <span class="st">"Criticality"</span><span class="op">,</span> <span class="dt">defaultValue</span><span class="op">:</span> <span class="st">"Medium"</span> }</span>
<span id="cb2-21"><a href="#cb2-21"></a>        ]<span class="op">,</span></span>
<span id="cb2-22"><a href="#cb2-22"></a>        <span class="dt">namePrefix</span><span class="op">:</span> <span class="st">"AS_"</span></span>
<span id="cb2-23"><a href="#cb2-23"></a>    }</span>
<span id="cb2-24"><a href="#cb2-24"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Keep this in one place (e.g., _Common.MDG_Rulebook) and !INC it in validator and repair scripts.</p>
</section>
<section id="mdg-validator-report-only" class="level3">
<h3 class="anchored" data-anchor-id="mdg-validator-report-only">MDG Validator (report-only)</h3>
<p>This script reports deviations: wrong/missing stereotype, missing tags, blank required values, naming violations. It <strong>never writes</strong>; use it in governance jobs and daily hygiene.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 10.3 - MDG_Lint.js – JScript (ES3)</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" data-filename="Example 10.3 - MDG_Lint.js – JScript (ES3)"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">// Example 10.3 - MDG_Lint.js – JScript (ES3)</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">// Purpose: Report MDG violations for elements in selected package (read-only)</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">// Output: Output tab + CSV (directory-only chooser)</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">MDG_Rulebook</span></span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb3-11"><a href="#cb3-11"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"MDG_Lint"</span><span class="op">;</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb3-13"><a href="#cb3-13"></a></span>
<span id="cb3-14"><a href="#cb3-14"></a>    <span class="kw">var</span> pkg <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span>()<span class="op">;</span></span>
<span id="cb3-15"><a href="#cb3-15"></a>    <span class="cf">if</span> (<span class="op">!</span>pkg) { Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Select a package to lint."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb3-16"><a href="#cb3-16"></a></span>
<span id="cb3-17"><a href="#cb3-17"></a>    <span class="kw">var</span> outDir <span class="op">=</span> <span class="fu">browseForFolder</span>(<span class="st">"Select output folder for MDG lint report"</span>)<span class="op">;</span></span>
<span id="cb3-18"><a href="#cb3-18"></a>    <span class="kw">var</span> csv <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb3-19"><a href="#cb3-19"></a>    <span class="cf">if</span> (outDir) {</span>
<span id="cb3-20"><a href="#cb3-20"></a>        <span class="kw">var</span> stamp <span class="op">=</span> (<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb3-21"><a href="#cb3-21"></a>        csv <span class="op">=</span> <span class="kw">new</span> <span class="fu">CsvWriter</span>(outDir <span class="op">+</span> <span class="st">"</span><span class="sc">\\</span><span class="st">mdg_lint_"</span> <span class="op">+</span> stamp <span class="op">+</span> <span class="st">".csv"</span>)<span class="op">;</span></span>
<span id="cb3-22"><a href="#cb3-22"></a>        csv<span class="op">.</span><span class="fu">writeHeader</span>(<span class="st">"ElementID,GUID,Name,Type,AppliedStereotypes,Issue,Details,ExpectedProfileStereo"</span>)<span class="op">;</span></span>
<span id="cb3-23"><a href="#cb3-23"></a>    }</span>
<span id="cb3-24"><a href="#cb3-24"></a></span>
<span id="cb3-25"><a href="#cb3-25"></a>    <span class="kw">var</span> els <span class="op">=</span> pkg<span class="op">.</span><span class="at">Elements</span><span class="op">,</span> issues<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-26"><a href="#cb3-26"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>els<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-27"><a href="#cb3-27"></a>        <span class="kw">var</span> e <span class="op">=</span> els<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb3-28"><a href="#cb3-28"></a>        <span class="kw">var</span> applied <span class="op">=</span> <span class="bu">String</span>(e<span class="op">.</span><span class="at">StereotypeEx</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span></span>
<span id="cb3-29"><a href="#cb3-29"></a>        <span class="kw">var</span> expectedFQ <span class="op">=</span> <span class="fu">pickRuleKey</span>(e<span class="op">,</span> applied)<span class="op">;</span>   <span class="co">// finds the rule, if any</span></span>
<span id="cb3-30"><a href="#cb3-30"></a></span>
<span id="cb3-31"><a href="#cb3-31"></a>        <span class="cf">if</span> (<span class="op">!</span>expectedFQ) <span class="cf">continue</span><span class="op">;</span> <span class="co">// element not in scope of our rulebook</span></span>
<span id="cb3-32"><a href="#cb3-32"></a></span>
<span id="cb3-33"><a href="#cb3-33"></a>        <span class="kw">var</span> rule <span class="op">=</span> MDG_RULES[expectedFQ]<span class="op">;</span></span>
<span id="cb3-34"><a href="#cb3-34"></a></span>
<span id="cb3-35"><a href="#cb3-35"></a>        <span class="co">// 1) Base type check (optional)</span></span>
<span id="cb3-36"><a href="#cb3-36"></a>        <span class="cf">if</span> (rule<span class="op">.</span><span class="at">baseType</span> <span class="op">&amp;&amp;</span> rule<span class="op">.</span><span class="at">baseType</span> <span class="op">!=</span> e<span class="op">.</span><span class="at">Type</span>) {</span>
<span id="cb3-37"><a href="#cb3-37"></a>            issues <span class="op">+=</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> applied<span class="op">,</span> <span class="st">"BaseTypeMismatch"</span><span class="op">,</span> <span class="st">"Expected base type "</span><span class="op">+</span>rule<span class="op">.</span><span class="at">baseType</span><span class="op">,</span> expectedFQ)<span class="op">;</span></span>
<span id="cb3-38"><a href="#cb3-38"></a>            <span class="cf">continue</span><span class="op">;</span> <span class="co">// don’t check tags if base type is wrong</span></span>
<span id="cb3-39"><a href="#cb3-39"></a>        }</span>
<span id="cb3-40"><a href="#cb3-40"></a></span>
<span id="cb3-41"><a href="#cb3-41"></a>        <span class="co">// 2) Stereotype check</span></span>
<span id="cb3-42"><a href="#cb3-42"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">hasFQStereo</span>(applied<span class="op">,</span> expectedFQ)) {</span>
<span id="cb3-43"><a href="#cb3-43"></a>            issues <span class="op">+=</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> applied<span class="op">,</span> <span class="st">"MissingStereotype"</span><span class="op">,</span> <span class="st">"Apply "</span><span class="op">+</span>expectedFQ<span class="op">,</span> expectedFQ)<span class="op">;</span></span>
<span id="cb3-44"><a href="#cb3-44"></a>        }</span>
<span id="cb3-45"><a href="#cb3-45"></a></span>
<span id="cb3-46"><a href="#cb3-46"></a>        <span class="co">// 3) Required tags</span></span>
<span id="cb3-47"><a href="#cb3-47"></a>        <span class="cf">for</span> (<span class="kw">var</span> t<span class="op">=</span><span class="dv">0</span><span class="op">;</span> t<span class="op">&lt;</span>rule<span class="op">.</span><span class="at">requiredTags</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> t<span class="op">++</span>) {</span>
<span id="cb3-48"><a href="#cb3-48"></a>            <span class="kw">var</span> tn <span class="op">=</span> rule<span class="op">.</span><span class="at">requiredTags</span>[t]<span class="op">.</span><span class="at">name</span><span class="op">;</span></span>
<span id="cb3-49"><a href="#cb3-49"></a>            <span class="kw">var</span> tv <span class="op">=</span> <span class="fu">readTag</span>(e<span class="op">,</span> tn)<span class="op">;</span></span>
<span id="cb3-50"><a href="#cb3-50"></a>            <span class="cf">if</span> (<span class="fu">trim</span>(tv) <span class="op">===</span> <span class="st">""</span>) {</span>
<span id="cb3-51"><a href="#cb3-51"></a>                issues <span class="op">+=</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> applied<span class="op">,</span> <span class="st">"MissingTag"</span><span class="op">,</span> <span class="st">"Tag '"</span><span class="op">+</span>tn<span class="op">+</span><span class="st">"' is required"</span><span class="op">,</span> expectedFQ)<span class="op">;</span></span>
<span id="cb3-52"><a href="#cb3-52"></a>            }</span>
<span id="cb3-53"><a href="#cb3-53"></a>        }</span>
<span id="cb3-54"><a href="#cb3-54"></a></span>
<span id="cb3-55"><a href="#cb3-55"></a>        <span class="co">// 4) Naming convention (optional)</span></span>
<span id="cb3-56"><a href="#cb3-56"></a>        <span class="cf">if</span> (rule<span class="op">.</span><span class="at">namePrefix</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu">startsWith</span>(e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> rule<span class="op">.</span><span class="at">namePrefix</span>)) {</span>
<span id="cb3-57"><a href="#cb3-57"></a>            issues <span class="op">+=</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> applied<span class="op">,</span> <span class="st">"NamePrefix"</span><span class="op">,</span> <span class="st">"Should start with '"</span><span class="op">+</span>rule<span class="op">.</span><span class="at">namePrefix</span><span class="op">+</span><span class="st">"'"</span><span class="op">,</span> expectedFQ)<span class="op">;</span></span>
<span id="cb3-58"><a href="#cb3-58"></a>        }</span>
<span id="cb3-59"><a href="#cb3-59"></a>    }</span>
<span id="cb3-60"><a href="#cb3-60"></a></span>
<span id="cb3-61"><a href="#cb3-61"></a>    <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb3-62"><a href="#cb3-62"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"MDG lint complete. Issues: "</span> <span class="op">+</span> issues)<span class="op">;</span></span>
<span id="cb3-63"><a href="#cb3-63"></a>}</span>
<span id="cb3-64"><a href="#cb3-64"></a></span>
<span id="cb3-65"><a href="#cb3-65"></a><span class="kw">function</span> <span class="fu">pickRuleKey</span>(e<span class="op">,</span> appliedList) {</span>
<span id="cb3-66"><a href="#cb3-66"></a>    <span class="co">// Strategy:</span></span>
<span id="cb3-67"><a href="#cb3-67"></a>    <span class="co">//  - If any rule key is present in StereotypeEx, prefer it.</span></span>
<span id="cb3-68"><a href="#cb3-68"></a>    <span class="co">//  - Else if base type matches exactly one rule, use that rule for “expected” check.</span></span>
<span id="cb3-69"><a href="#cb3-69"></a>    <span class="kw">var</span> keys <span class="op">=</span> <span class="fu">keysOf</span>(MDG_RULES)<span class="op">;</span></span>
<span id="cb3-70"><a href="#cb3-70"></a>    <span class="co">// prefer explicit match</span></span>
<span id="cb3-71"><a href="#cb3-71"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>keys<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-72"><a href="#cb3-72"></a>        <span class="cf">if</span> (<span class="fu">hasFQStereo</span>(appliedList<span class="op">,</span> keys[i])) <span class="cf">return</span> keys[i]<span class="op">;</span></span>
<span id="cb3-73"><a href="#cb3-73"></a>    }</span>
<span id="cb3-74"><a href="#cb3-74"></a>    <span class="co">// fallback: base type inference if unambiguous</span></span>
<span id="cb3-75"><a href="#cb3-75"></a>    <span class="kw">var</span> chosen<span class="op">=</span><span class="kw">null</span><span class="op">;</span></span>
<span id="cb3-76"><a href="#cb3-76"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>keys<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-77"><a href="#cb3-77"></a>        <span class="kw">var</span> r <span class="op">=</span> MDG_RULES[keys[i]]<span class="op">;</span></span>
<span id="cb3-78"><a href="#cb3-78"></a>        <span class="cf">if</span> (r<span class="op">.</span><span class="at">baseType</span> <span class="op">&amp;&amp;</span> r<span class="op">.</span><span class="at">baseType</span> <span class="op">==</span> e<span class="op">.</span><span class="at">Type</span>) {</span>
<span id="cb3-79"><a href="#cb3-79"></a>            <span class="cf">if</span> (chosen <span class="op">&amp;&amp;</span> chosen <span class="op">!=</span> keys[i]) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span> <span class="co">// ambiguous</span></span>
<span id="cb3-80"><a href="#cb3-80"></a>            chosen <span class="op">=</span> keys[i]<span class="op">;</span></span>
<span id="cb3-81"><a href="#cb3-81"></a>        }</span>
<span id="cb3-82"><a href="#cb3-82"></a>    }</span>
<span id="cb3-83"><a href="#cb3-83"></a>    <span class="cf">return</span> chosen<span class="op">;</span></span>
<span id="cb3-84"><a href="#cb3-84"></a>}</span>
<span id="cb3-85"><a href="#cb3-85"></a></span>
<span id="cb3-86"><a href="#cb3-86"></a><span class="kw">function</span> <span class="fu">hasFQStereo</span>(applied<span class="op">,</span> fq) {</span>
<span id="cb3-87"><a href="#cb3-87"></a>    <span class="kw">var</span> items <span class="op">=</span> <span class="bu">String</span>(applied<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">;</span></span>
<span id="cb3-88"><a href="#cb3-88"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>items<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-89"><a href="#cb3-89"></a>        <span class="cf">if</span> (<span class="fu">equalsIgnoreCase</span>(<span class="fu">trim</span>(items[i])<span class="op">,</span> fq)) <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb3-90"><a href="#cb3-90"></a>    }</span>
<span id="cb3-91"><a href="#cb3-91"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb3-92"><a href="#cb3-92"></a>}</span>
<span id="cb3-93"><a href="#cb3-93"></a><span class="kw">function</span> <span class="fu">readTag</span>(e<span class="op">,</span> name) {</span>
<span id="cb3-94"><a href="#cb3-94"></a>    <span class="kw">var</span> tvs <span class="op">=</span> e<span class="op">.</span><span class="at">TaggedValues</span><span class="op">;</span></span>
<span id="cb3-95"><a href="#cb3-95"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>tvs<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-96"><a href="#cb3-96"></a>        <span class="kw">var</span> tv <span class="op">=</span> tvs<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb3-97"><a href="#cb3-97"></a>        <span class="cf">if</span> (<span class="fu">equalsIgnoreCase</span>(tv<span class="op">.</span><span class="at">Name</span><span class="op">,</span> name)) <span class="cf">return</span> <span class="bu">String</span>(tv<span class="op">.</span><span class="at">Value</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span></span>
<span id="cb3-98"><a href="#cb3-98"></a>    }</span>
<span id="cb3-99"><a href="#cb3-99"></a>    <span class="cf">return</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb3-100"><a href="#cb3-100"></a>}</span>
<span id="cb3-101"><a href="#cb3-101"></a><span class="kw">function</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> applied<span class="op">,</span> issue<span class="op">,</span> details<span class="op">,</span> expected) {</span>
<span id="cb3-102"><a href="#cb3-102"></a>    <span class="kw">var</span> line <span class="op">=</span> e<span class="op">.</span><span class="at">ElementID</span> <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">" – "</span> <span class="op">+</span> issue <span class="op">+</span> <span class="st">": "</span> <span class="op">+</span> details<span class="op">;</span></span>
<span id="cb3-103"><a href="#cb3-103"></a>    <span class="fu">log</span>(<span class="st">"MDG_Lint"</span><span class="op">,</span> line)<span class="op">;</span></span>
<span id="cb3-104"><a href="#cb3-104"></a>    <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">writeRow</span>([e<span class="op">.</span><span class="at">ElementID</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementGUID</span><span class="op">,</span> e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> e<span class="op">.</span><span class="at">Type</span><span class="op">,</span> applied<span class="op">,</span> issue<span class="op">,</span> details<span class="op">,</span> expected<span class="op">||</span><span class="st">""</span>])<span class="op">;</span></span>
<span id="cb3-105"><a href="#cb3-105"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-106"><a href="#cb3-106"></a>}</span>
<span id="cb3-107"><a href="#cb3-107"></a><span class="kw">function</span> <span class="fu">keysOf</span>(o){ <span class="kw">var</span> r<span class="op">=</span>[]<span class="op">,</span>k<span class="op">;</span> <span class="cf">for</span>(k <span class="kw">in</span> o){ <span class="cf">if</span>(o<span class="op">.</span><span class="fu">hasOwnProperty</span>(k)) r<span class="op">.</span><span class="fu">push</span>(k)<span class="op">;</span>} <span class="cf">return</span> r<span class="op">;</span> }</span>
<span id="cb3-108"><a href="#cb3-108"></a></span>
<span id="cb3-109"><a href="#cb3-109"></a><span class="fu">main</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="mdg-repair-guided-and-safe" class="level3">
<h3 class="anchored" data-anchor-id="mdg-repair-guided-and-safe">MDG Repair (guided and safe)</h3>
<p>This companion script <strong>fixes</strong> the issues reported by the linter. It uses a <strong>dry-run</strong> flag and writes a CSV log of every attempted change.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 10.4 - MDG_Repair.js – JScript (ES3)</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4" data-filename="Example 10.4 - MDG_Repair.js – JScript (ES3)"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">// Example 10.4 - MDG_Repair.js – JScript (ES3)</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">// Purpose: Apply MDG fixes (stereotype, required tags, naming prefix)</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">// Safety: DRY_RUN=true by default; logs every change</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">MDG_Rulebook</span></span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb4-11"><a href="#cb4-11"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"MDG_Repair"</span><span class="op">;</span></span>
<span id="cb4-12"><a href="#cb4-12"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb4-13"><a href="#cb4-13"></a></span>
<span id="cb4-14"><a href="#cb4-14"></a>    <span class="co">// ---- Config ----</span></span>
<span id="cb4-15"><a href="#cb4-15"></a>    <span class="kw">var</span> DRY_RUN <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb4-16"><a href="#cb4-16"></a></span>
<span id="cb4-17"><a href="#cb4-17"></a>    <span class="kw">var</span> pkg <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span>()<span class="op">;</span></span>
<span id="cb4-18"><a href="#cb4-18"></a>    <span class="cf">if</span> (<span class="op">!</span>pkg) { Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Select a package."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb4-19"><a href="#cb4-19"></a></span>
<span id="cb4-20"><a href="#cb4-20"></a>    <span class="kw">var</span> outDir <span class="op">=</span> <span class="fu">browseForFolder</span>(<span class="st">"Select output folder for MDG repair log"</span>)<span class="op">;</span></span>
<span id="cb4-21"><a href="#cb4-21"></a>    <span class="kw">var</span> csv <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb4-22"><a href="#cb4-22"></a>    <span class="cf">if</span> (outDir) {</span>
<span id="cb4-23"><a href="#cb4-23"></a>        <span class="kw">var</span> stamp <span class="op">=</span> (<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb4-24"><a href="#cb4-24"></a>        csv <span class="op">=</span> <span class="kw">new</span> <span class="fu">CsvWriter</span>(outDir <span class="op">+</span> <span class="st">"</span><span class="sc">\\</span><span class="st">mdg_repair_"</span> <span class="op">+</span> stamp <span class="op">+</span> <span class="st">".csv"</span>)<span class="op">;</span></span>
<span id="cb4-25"><a href="#cb4-25"></a>        csv<span class="op">.</span><span class="fu">writeHeader</span>(<span class="st">"Action,ElementID,GUID,Name,Details"</span>)<span class="op">;</span></span>
<span id="cb4-26"><a href="#cb4-26"></a>    }</span>
<span id="cb4-27"><a href="#cb4-27"></a></span>
<span id="cb4-28"><a href="#cb4-28"></a>    <span class="kw">var</span> els <span class="op">=</span> pkg<span class="op">.</span><span class="at">Elements</span><span class="op">,</span> changed<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-29"><a href="#cb4-29"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>els<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb4-30"><a href="#cb4-30"></a>        <span class="kw">var</span> e <span class="op">=</span> els<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb4-31"><a href="#cb4-31"></a>        <span class="kw">var</span> expectedFQ <span class="op">=</span> <span class="fu">pickRuleKey</span>(e<span class="op">,</span> <span class="bu">String</span>(e<span class="op">.</span><span class="at">StereotypeEx</span><span class="op">||</span><span class="st">""</span>))<span class="op">;</span></span>
<span id="cb4-32"><a href="#cb4-32"></a>        <span class="cf">if</span> (<span class="op">!</span>expectedFQ) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb4-33"><a href="#cb4-33"></a></span>
<span id="cb4-34"><a href="#cb4-34"></a>        <span class="kw">var</span> rule <span class="op">=</span> MDG_RULES[expectedFQ]<span class="op">;</span></span>
<span id="cb4-35"><a href="#cb4-35"></a></span>
<span id="cb4-36"><a href="#cb4-36"></a>        <span class="co">// 1) Enforce stereotype (fully-qualified)</span></span>
<span id="cb4-37"><a href="#cb4-37"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">hasFQStereo</span>(<span class="bu">String</span>(e<span class="op">.</span><span class="at">StereotypeEx</span><span class="op">||</span><span class="st">""</span>)<span class="op">,</span> expectedFQ)) {</span>
<span id="cb4-38"><a href="#cb4-38"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Apply stereotype: "</span> <span class="op">+</span> expectedFQ <span class="op">+</span> <span class="st">" on '"</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb4-39"><a href="#cb4-39"></a>            <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">writeRow</span>([<span class="st">"ApplyStereo"</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementID</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementGUID</span><span class="op">,</span> e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> expectedFQ])<span class="op">;</span></span>
<span id="cb4-40"><a href="#cb4-40"></a>            <span class="cf">if</span> (<span class="op">!</span>DRY_RUN) { e<span class="op">.</span><span class="at">StereotypeEx</span> <span class="op">=</span> <span class="fu">addFQStereo</span>(e<span class="op">.</span><span class="at">StereotypeEx</span><span class="op">,</span> expectedFQ)<span class="op">;</span> e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> changed<span class="op">++;</span> }</span>
<span id="cb4-41"><a href="#cb4-41"></a>        }</span>
<span id="cb4-42"><a href="#cb4-42"></a></span>
<span id="cb4-43"><a href="#cb4-43"></a>        <span class="co">// 2) Ensure required tags (create if missing, fill default if blank)</span></span>
<span id="cb4-44"><a href="#cb4-44"></a>        <span class="cf">for</span> (<span class="kw">var</span> t<span class="op">=</span><span class="dv">0</span><span class="op">;</span> t<span class="op">&lt;</span>rule<span class="op">.</span><span class="at">requiredTags</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> t<span class="op">++</span>) {</span>
<span id="cb4-45"><a href="#cb4-45"></a>            <span class="kw">var</span> tn <span class="op">=</span> rule<span class="op">.</span><span class="at">requiredTags</span>[t]<span class="op">.</span><span class="at">name</span><span class="op">;</span></span>
<span id="cb4-46"><a href="#cb4-46"></a>            <span class="kw">var</span> dv <span class="op">=</span> <span class="bu">String</span>(rule<span class="op">.</span><span class="at">requiredTags</span>[t]<span class="op">.</span><span class="at">defaultValue</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span></span>
<span id="cb4-47"><a href="#cb4-47"></a>            <span class="kw">var</span> cur <span class="op">=</span> <span class="fu">readTag</span>(e<span class="op">,</span> tn)<span class="op">;</span></span>
<span id="cb4-48"><a href="#cb4-48"></a>            <span class="cf">if</span> (<span class="fu">trim</span>(cur) <span class="op">===</span> <span class="st">""</span> <span class="op">&amp;&amp;</span> dv <span class="op">!==</span> <span class="st">""</span>) {</span>
<span id="cb4-49"><a href="#cb4-49"></a>                <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Set tag '"</span> <span class="op">+</span> tn <span class="op">+</span> <span class="st">"'='"</span> <span class="op">+</span> dv <span class="op">+</span> <span class="st">"' on '"</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb4-50"><a href="#cb4-50"></a>                <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">writeRow</span>([<span class="st">"SetTag"</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementID</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementGUID</span><span class="op">,</span> e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> tn<span class="op">+</span><span class="st">"="</span><span class="op">+</span>dv])<span class="op">;</span></span>
<span id="cb4-51"><a href="#cb4-51"></a>                <span class="cf">if</span> (<span class="op">!</span>DRY_RUN) { <span class="fu">writeTag</span>(e<span class="op">,</span> tn<span class="op">,</span> dv)<span class="op">;</span> changed<span class="op">++;</span> }</span>
<span id="cb4-52"><a href="#cb4-52"></a>            } <span class="cf">else</span> <span class="cf">if</span> (cur <span class="op">===</span> <span class="st">""</span>) {</span>
<span id="cb4-53"><a href="#cb4-53"></a>                <span class="co">// missing and no default → warn only</span></span>
<span id="cb4-54"><a href="#cb4-54"></a>                <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">writeRow</span>([<span class="st">"MissingTag"</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementID</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementGUID</span><span class="op">,</span> e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> tn<span class="op">+</span><span class="st">" (no default)"</span>])<span class="op">;</span></span>
<span id="cb4-55"><a href="#cb4-55"></a>            }</span>
<span id="cb4-56"><a href="#cb4-56"></a>        }</span>
<span id="cb4-57"><a href="#cb4-57"></a></span>
<span id="cb4-58"><a href="#cb4-58"></a>        <span class="co">// 3) Naming prefix (optional)</span></span>
<span id="cb4-59"><a href="#cb4-59"></a>        <span class="cf">if</span> (rule<span class="op">.</span><span class="at">namePrefix</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu">startsWith</span>(e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> rule<span class="op">.</span><span class="at">namePrefix</span>)) {</span>
<span id="cb4-60"><a href="#cb4-60"></a>            <span class="kw">var</span> newName <span class="op">=</span> rule<span class="op">.</span><span class="at">namePrefix</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span><span class="op">;</span></span>
<span id="cb4-61"><a href="#cb4-61"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Rename '"</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">"' → '"</span> <span class="op">+</span> newName <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb4-62"><a href="#cb4-62"></a>            <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">writeRow</span>([<span class="st">"Rename"</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementID</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementGUID</span><span class="op">,</span> e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> <span class="st">"→ "</span><span class="op">+</span>newName])<span class="op">;</span></span>
<span id="cb4-63"><a href="#cb4-63"></a>            <span class="cf">if</span> (<span class="op">!</span>DRY_RUN) { e<span class="op">.</span><span class="at">Name</span> <span class="op">=</span> newName<span class="op">;</span> e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> changed<span class="op">++;</span> }</span>
<span id="cb4-64"><a href="#cb4-64"></a>        }</span>
<span id="cb4-65"><a href="#cb4-65"></a>    }</span>
<span id="cb4-66"><a href="#cb4-66"></a></span>
<span id="cb4-67"><a href="#cb4-67"></a>    <span class="cf">if</span> (<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> changed<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(pkg<span class="op">.</span><span class="at">PackageID</span>)<span class="op">;</span></span>
<span id="cb4-68"><a href="#cb4-68"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Repair complete. Changes="</span> <span class="op">+</span> changed <span class="op">+</span> <span class="st">", Dry-run="</span> <span class="op">+</span> DRY_RUN)<span class="op">;</span></span>
<span id="cb4-69"><a href="#cb4-69"></a>}</span>
<span id="cb4-70"><a href="#cb4-70"></a></span>
<span id="cb4-71"><a href="#cb4-71"></a><span class="co">// Helpers (subset specialised for this script)</span></span>
<span id="cb4-72"><a href="#cb4-72"></a><span class="kw">function</span> <span class="fu">pickRuleKey</span>(e<span class="op">,</span> applied){ <span class="kw">var</span> keys<span class="op">=</span><span class="fu">keysOf</span>(MDG_RULES)<span class="op">;</span> <span class="kw">var</span> i<span class="op">;</span></span>
<span id="cb4-73"><a href="#cb4-73"></a>    <span class="cf">for</span>(i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>keys<span class="op">.</span><span class="at">length</span><span class="op">;</span>i<span class="op">++</span>) <span class="cf">if</span>(<span class="fu">hasFQStereo</span>(applied<span class="op">,</span> keys[i])) <span class="cf">return</span> keys[i]<span class="op">;</span></span>
<span id="cb4-74"><a href="#cb4-74"></a>    <span class="co">// optional baseType inference</span></span>
<span id="cb4-75"><a href="#cb4-75"></a>    <span class="kw">var</span> chosen<span class="op">=</span><span class="kw">null</span><span class="op">;</span> <span class="cf">for</span>(i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>keys<span class="op">.</span><span class="at">length</span><span class="op">;</span>i<span class="op">++</span>){ <span class="kw">var</span> r<span class="op">=</span>MDG_RULES[keys[i]]<span class="op">;</span> <span class="cf">if</span>(r<span class="op">.</span><span class="at">baseType</span> <span class="op">&amp;&amp;</span> r<span class="op">.</span><span class="at">baseType</span><span class="op">==</span>e<span class="op">.</span><span class="at">Type</span>){ <span class="cf">if</span>(chosen <span class="op">&amp;&amp;</span> chosen<span class="op">!=</span>keys[i]) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span> chosen<span class="op">=</span>keys[i]<span class="op">;</span> } }</span>
<span id="cb4-76"><a href="#cb4-76"></a>    <span class="cf">return</span> chosen<span class="op">;</span></span>
<span id="cb4-77"><a href="#cb4-77"></a>}</span>
<span id="cb4-78"><a href="#cb4-78"></a><span class="kw">function</span> <span class="fu">hasFQStereo</span>(applied<span class="op">,</span> fq){ <span class="kw">var</span> items<span class="op">=</span><span class="bu">String</span>(applied<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">;</span> <span class="cf">for</span>(<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>items<span class="op">.</span><span class="at">length</span><span class="op">;</span>i<span class="op">++</span>){ <span class="cf">if</span>(<span class="fu">equalsIgnoreCase</span>(<span class="fu">trim</span>(items[i])<span class="op">,</span>fq)) <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span> } <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span>}</span>
<span id="cb4-79"><a href="#cb4-79"></a><span class="kw">function</span> <span class="fu">addFQStereo</span>(current<span class="op">,</span> fq){ current<span class="op">=</span><span class="bu">String</span>(current<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span> <span class="cf">if</span>(current<span class="op">===</span><span class="st">""</span>) <span class="cf">return</span> fq<span class="op">;</span> <span class="kw">var</span> items<span class="op">=</span>current<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">,</span>i<span class="op">;</span> <span class="cf">for</span>(i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>items<span class="op">.</span><span class="at">length</span><span class="op">;</span>i<span class="op">++</span>){ <span class="cf">if</span>(<span class="fu">equalsIgnoreCase</span>(<span class="fu">trim</span>(items[i])<span class="op">,</span>fq)) <span class="cf">return</span> current<span class="op">;</span> } <span class="cf">return</span> current <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> fq<span class="op">;</span>}</span>
<span id="cb4-80"><a href="#cb4-80"></a><span class="kw">function</span> <span class="fu">readTag</span>(e<span class="op">,</span> name){ <span class="kw">var</span> tvs<span class="op">=</span>e<span class="op">.</span><span class="at">TaggedValues</span><span class="op">;</span> <span class="cf">for</span>(<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>tvs<span class="op">.</span><span class="at">Count</span><span class="op">;</span>i<span class="op">++</span>){ <span class="kw">var</span> tv<span class="op">=</span>tvs<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span> <span class="cf">if</span>(<span class="fu">equalsIgnoreCase</span>(tv<span class="op">.</span><span class="at">Name</span><span class="op">,</span>name)) <span class="cf">return</span> <span class="bu">String</span>(tv<span class="op">.</span><span class="at">Value</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span> } <span class="cf">return</span> <span class="st">""</span><span class="op">;</span> }</span>
<span id="cb4-81"><a href="#cb4-81"></a><span class="kw">function</span> <span class="fu">writeTag</span>(e<span class="op">,</span> name<span class="op">,</span> value){ <span class="kw">var</span> tvs<span class="op">=</span>e<span class="op">.</span><span class="at">TaggedValues</span><span class="op">,</span> i<span class="op">;</span> <span class="cf">for</span>(i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>tvs<span class="op">.</span><span class="at">Count</span><span class="op">;</span>i<span class="op">++</span>){ <span class="kw">var</span> tv<span class="op">=</span>tvs<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span> <span class="cf">if</span>(<span class="fu">equalsIgnoreCase</span>(tv<span class="op">.</span><span class="at">Name</span><span class="op">,</span>name)){ tv<span class="op">.</span><span class="at">Value</span><span class="op">=</span><span class="bu">String</span>(value)<span class="op">;</span> tv<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> } } <span class="kw">var</span> nt<span class="op">=</span>tvs<span class="op">.</span><span class="fu">AddNew</span>(name<span class="op">,</span><span class="bu">String</span>(value))<span class="op">;</span> nt<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> }</span>
<span id="cb4-82"><a href="#cb4-82"></a><span class="kw">function</span> <span class="fu">keysOf</span>(o){ <span class="kw">var</span> r<span class="op">=</span>[]<span class="op">,</span>k<span class="op">;</span> <span class="cf">for</span>(k <span class="kw">in</span> o){ <span class="cf">if</span>(o<span class="op">.</span><span class="fu">hasOwnProperty</span>(k)) r<span class="op">.</span><span class="fu">push</span>(k)<span class="op">;</span>} <span class="cf">return</span> r<span class="op">;</span> }</span>
<span id="cb4-83"><a href="#cb4-83"></a></span>
<span id="cb4-84"><a href="#cb4-84"></a><span class="fu">main</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="validating-toolbox-conformance-lightweight" class="level3">
<h3 class="anchored" data-anchor-id="validating-toolbox-conformance-lightweight">Validating toolbox conformance (lightweight)</h3>
<p>You usually enforce toolbox usage <strong>indirectly</strong>:</p>
<ul>
<li><p><strong>Base type</strong> matches your profile expectation (e.g., Class).</p></li>
<li><p><strong>Stereotype</strong> is the one from your profile (profile::stereo).</p></li>
<li><p><strong>Required tags</strong> exist (often defined by your MDG).</p></li>
</ul>
<p>If all three pass, the modeller effectively used your toolbox.</p>
<p>For stricter checks, you can augment the rulebook with <strong>allowed connector types</strong> and <strong>required relationships</strong> per stereotype, then lint them the same way.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 10.5 - Add to MDG_RULES:</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5" data-filename="Example 10.5 - Add to MDG_RULES:"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">// Example 10.5 - Add to MDG_RULES:</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="st">"MyProfile::BusinessCapability"</span><span class="op">:</span> {</span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="dt">baseType</span><span class="op">:</span> <span class="st">"Class"</span><span class="op">,</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="dt">requiredTags</span><span class="op">:</span> [{<span class="dt">name</span><span class="op">:</span><span class="st">"Owner"</span><span class="op">,</span> <span class="dt">defaultValue</span><span class="op">:</span><span class="st">"ArchitectureTeam"</span>}]<span class="op">,</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="dt">namePrefix</span><span class="op">:</span> <span class="st">"BC_"</span><span class="op">,</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="dt">requiresOutgoing</span><span class="op">:</span> [ { <span class="dt">type</span><span class="op">:</span><span class="st">"Realization"</span><span class="op">,</span> <span class="dt">toStereo</span><span class="op">:</span><span class="st">"MyProfile::ApplicationService"</span> } ]</span>
<span id="cb5-7"><a href="#cb5-7"></a>}</span>
<span id="cb5-8"><a href="#cb5-8"></a>Then <span class="kw">in</span> your linter<span class="op">:</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">// After tag checks:</span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="cf">if</span> (rule<span class="op">.</span><span class="at">requiresOutgoing</span>) {</span>
<span id="cb5-11"><a href="#cb5-11"></a>    <span class="cf">for</span> (<span class="kw">var</span> r<span class="op">=</span><span class="dv">0</span><span class="op">;</span> r<span class="op">&lt;</span>rule<span class="op">.</span><span class="at">requiresOutgoing</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> r<span class="op">++</span>) {</span>
<span id="cb5-12"><a href="#cb5-12"></a>        <span class="kw">var</span> req <span class="op">=</span> rule<span class="op">.</span><span class="at">requiresOutgoing</span>[r]<span class="op">;</span></span>
<span id="cb5-13"><a href="#cb5-13"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">hasOutgoing</span>(e<span class="op">,</span> req<span class="op">.</span><span class="at">type</span><span class="op">,</span> req<span class="op">.</span><span class="at">toStereo</span>)) {</span>
<span id="cb5-14"><a href="#cb5-14"></a>            issues <span class="op">+=</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> applied<span class="op">,</span> <span class="st">"MissingLink"</span><span class="op">,</span></span>
<span id="cb5-15"><a href="#cb5-15"></a>                <span class="st">"Require outgoing "</span> <span class="op">+</span> req<span class="op">.</span><span class="at">type</span> <span class="op">+</span> <span class="st">" to "</span> <span class="op">+</span> req<span class="op">.</span><span class="at">toStereo</span><span class="op">,</span> expectedFQ)<span class="op">;</span></span>
<span id="cb5-16"><a href="#cb5-16"></a>        }</span>
<span id="cb5-17"><a href="#cb5-17"></a>    }</span>
<span id="cb5-18"><a href="#cb5-18"></a>}</span>
<span id="cb5-19"><a href="#cb5-19"></a><span class="kw">function</span> <span class="fu">hasOutgoing</span>(e<span class="op">,</span> connType<span class="op">,</span> toFQStereo){</span>
<span id="cb5-20"><a href="#cb5-20"></a>    <span class="kw">var</span> cons <span class="op">=</span> e<span class="op">.</span><span class="at">Connectors</span><span class="op">;</span></span>
<span id="cb5-21"><a href="#cb5-21"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>cons<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb5-22"><a href="#cb5-22"></a>        <span class="kw">var</span> c <span class="op">=</span> cons<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb5-23"><a href="#cb5-23"></a>        <span class="cf">if</span> (c<span class="op">.</span><span class="at">Type</span> <span class="op">!=</span> connType) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb5-24"><a href="#cb5-24"></a>        <span class="kw">var</span> supplier <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetElementByID</span>(c<span class="op">.</span><span class="at">SupplierID</span>)<span class="op">;</span></span>
<span id="cb5-25"><a href="#cb5-25"></a>        <span class="cf">if</span> (<span class="op">!</span>supplier) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb5-26"><a href="#cb5-26"></a>        <span class="cf">if</span> (<span class="fu">hasFQStereo</span>(<span class="bu">String</span>(supplier<span class="op">.</span><span class="at">StereotypeEx</span><span class="op">||</span><span class="st">""</span>)<span class="op">,</span> toFQStereo)) <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb5-27"><a href="#cb5-27"></a>    }</span>
<span id="cb5-28"><a href="#cb5-28"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb5-29"><a href="#cb5-29"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="bulk-discovery-using-sql-fast-find-safe-check" class="level3">
<h3 class="anchored" data-anchor-id="bulk-discovery-using-sql-fast-find-safe-check">Bulk discovery using SQL (fast find, safe check)</h3>
<p>On very large repositories, <strong>find with SQL</strong> then verify via the API.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 10.6 - MDG_SQL_FindMissingTag.js – JScript (ES3)</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6" data-filename="Example 10.6 - MDG_SQL_FindMissingTag.js – JScript (ES3)"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co">// Example 10.6 - MDG_SQL_FindMissingTag.js – JScript (ES3)</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">// Purpose: Pre-filter candidates with SQL, then verify with API</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">MDG_Rulebook</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb6-9"><a href="#cb6-9"></a>    <span class="kw">var</span> TAB<span class="op">=</span><span class="st">"MDG_SQL_Find"</span><span class="op">;</span></span>
<span id="cb6-10"><a href="#cb6-10"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb6-11"><a href="#cb6-11"></a></span>
<span id="cb6-12"><a href="#cb6-12"></a>    <span class="kw">var</span> key <span class="op">=</span> <span class="st">"MyProfile::BusinessCapability"</span><span class="op">;</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>    <span class="kw">var</span> rule <span class="op">=</span> MDG_RULES[key]<span class="op">;</span></span>
<span id="cb6-14"><a href="#cb6-14"></a>    <span class="kw">var</span> tagName <span class="op">=</span> <span class="st">"Owner"</span><span class="op">;</span></span>
<span id="cb6-15"><a href="#cb6-15"></a></span>
<span id="cb6-16"><a href="#cb6-16"></a>    <span class="co">// Fast repo-wide prefilter: base type &amp; stereotype absent or wrong (rough)</span></span>
<span id="cb6-17"><a href="#cb6-17"></a>    <span class="co">// </span><span class="al">NOTE</span><span class="co">: Stereotypes are stored in multiple places; we prefilter by type and post-check StereotypeEx via API.</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>    <span class="kw">var</span> sql <span class="op">=</span> <span class="st">"SELECT Object_ID FROM t_object WHERE Object_Type='"</span> <span class="op">+</span> rule<span class="op">.</span><span class="at">baseType</span> <span class="op">+</span> <span class="st">"'"</span><span class="op">;</span></span>
<span id="cb6-19"><a href="#cb6-19"></a>    <span class="kw">var</span> xml <span class="op">=</span> Repository<span class="op">.</span><span class="fu">SQLQuery</span>(sql)<span class="op">;</span></span>
<span id="cb6-20"><a href="#cb6-20"></a>    <span class="kw">var</span> ids <span class="op">=</span> <span class="fu">extractAll</span>(xml<span class="op">,</span> <span class="st">"&lt;Object_ID&gt;"</span><span class="op">,</span> <span class="st">"&lt;/Object_ID&gt;"</span>)<span class="op">;</span></span>
<span id="cb6-21"><a href="#cb6-21"></a>    <span class="kw">var</span> offenders <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-22"><a href="#cb6-22"></a></span>
<span id="cb6-23"><a href="#cb6-23"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>ids<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb6-24"><a href="#cb6-24"></a>        <span class="kw">var</span> el <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetElementByID</span>(<span class="pp">parseInt</span>(ids[i]<span class="op">,</span><span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb6-25"><a href="#cb6-25"></a>        <span class="cf">if</span> (<span class="op">!</span>el) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb6-26"><a href="#cb6-26"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">hasFQ</span>(<span class="bu">String</span>(el<span class="op">.</span><span class="at">StereotypeEx</span><span class="op">||</span><span class="st">""</span>)<span class="op">,</span> key)) <span class="cf">continue</span><span class="op">;</span> <span class="co">// truly in scope</span></span>
<span id="cb6-27"><a href="#cb6-27"></a>        <span class="kw">var</span> tv <span class="op">=</span> <span class="fu">readTag</span>(el<span class="op">,</span> tagName)<span class="op">;</span></span>
<span id="cb6-28"><a href="#cb6-28"></a>        <span class="cf">if</span> (<span class="fu">trim</span>(tv) <span class="op">===</span> <span class="st">""</span>) {</span>
<span id="cb6-29"><a href="#cb6-29"></a>            offenders<span class="op">++;</span></span>
<span id="cb6-30"><a href="#cb6-30"></a>            Session<span class="op">.</span><span class="fu">Output</span>(<span class="st">"Missing tag '"</span> <span class="op">+</span> tagName <span class="op">+</span> <span class="st">"': "</span> <span class="op">+</span> el<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">" ("</span> <span class="op">+</span> el<span class="op">.</span><span class="at">ElementID</span> <span class="op">+</span> <span class="st">")"</span>)<span class="op">;</span></span>
<span id="cb6-31"><a href="#cb6-31"></a>        }</span>
<span id="cb6-32"><a href="#cb6-32"></a>    }</span>
<span id="cb6-33"><a href="#cb6-33"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Offenders (missing "</span><span class="op">+</span>tagName<span class="op">+</span><span class="st">"): "</span> <span class="op">+</span> offenders)<span class="op">;</span></span>
<span id="cb6-34"><a href="#cb6-34"></a>}</span>
<span id="cb6-35"><a href="#cb6-35"></a></span>
<span id="cb6-36"><a href="#cb6-36"></a><span class="kw">function</span> <span class="fu">extractAll</span>(h<span class="op">,</span>a<span class="op">,</span>b){ <span class="kw">var</span> r<span class="op">=</span>[]<span class="op">,</span>s<span class="op">=</span><span class="dv">0</span><span class="op">;</span> <span class="cf">while</span>(<span class="kw">true</span>){ <span class="kw">var</span> i<span class="op">=</span>h<span class="op">.</span><span class="fu">indexOf</span>(a<span class="op">,</span>s)<span class="op">;</span> <span class="cf">if</span>(i<span class="op">&lt;</span><span class="dv">0</span>) <span class="cf">break</span><span class="op">;</span> <span class="kw">var</span> j<span class="op">=</span>h<span class="op">.</span><span class="fu">indexOf</span>(b<span class="op">,</span>i<span class="op">+</span>a<span class="op">.</span><span class="at">length</span>)<span class="op">;</span> <span class="cf">if</span>(j<span class="op">&lt;</span><span class="dv">0</span>) <span class="cf">break</span><span class="op">;</span> r<span class="op">.</span><span class="fu">push</span>(h<span class="op">.</span><span class="fu">substring</span>(i<span class="op">+</span>a<span class="op">.</span><span class="at">length</span><span class="op">,</span>j))<span class="op">;</span> s<span class="op">=</span>j<span class="op">+</span>b<span class="op">.</span><span class="at">length</span><span class="op">;</span> } <span class="cf">return</span> r<span class="op">;</span> }</span>
<span id="cb6-37"><a href="#cb6-37"></a><span class="kw">function</span> <span class="fu">hasFQ</span>(applied<span class="op">,</span>fq){ <span class="kw">var</span> arr<span class="op">=</span><span class="bu">String</span>(applied<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">;</span> <span class="cf">for</span>(<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>arr<span class="op">.</span><span class="at">length</span><span class="op">;</span>i<span class="op">++</span>){ <span class="cf">if</span>(<span class="fu">equalsIgnoreCase</span>(<span class="fu">trim</span>(arr[i])<span class="op">,</span>fq)) <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span> } <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span> }</span>
<span id="cb6-38"><a href="#cb6-38"></a><span class="kw">function</span> <span class="fu">readTag</span>(e<span class="op">,</span>n){ <span class="kw">var</span> tvs<span class="op">=</span>e<span class="op">.</span><span class="at">TaggedValues</span><span class="op">;</span> <span class="cf">for</span>(<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>tvs<span class="op">.</span><span class="at">Count</span><span class="op">;</span>i<span class="op">++</span>){ <span class="kw">var</span> t<span class="op">=</span>tvs<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span> <span class="cf">if</span>(<span class="fu">equalsIgnoreCase</span>(t<span class="op">.</span><span class="at">Name</span><span class="op">,</span>n)) <span class="cf">return</span> <span class="bu">String</span>(t<span class="op">.</span><span class="at">Value</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span> } <span class="cf">return</span> <span class="st">""</span><span class="op">;</span> }</span>
<span id="cb6-39"><a href="#cb6-39"></a></span>
<span id="cb6-40"><a href="#cb6-40"></a><span class="fu">main</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="safety-governance-notes" class="level2">
<h2 class="anchored" data-anchor-id="safety-governance-notes">Safety &amp; governance notes</h2>
<ul>
<li><p>Always prefer StereotypeEx for MDG accuracy.</p></li>
<li><p>Never raw-update MDG metadata in EA tables unless you absolutely must (and then only when you fully understand the schema).</p></li>
<li><p>Centralise rules in a small “rulebook” map; your linter and repairer both use it.</p></li>
<li><p>Dry-run first and log CSVs of changes for audit.</p></li>
<li><p>Use SQL to find, API to fix at scale.</p></li>
</ul>
</section>
<section id="what-to-use-when-cheat-sheet" class="level2">
<h2 class="anchored" data-anchor-id="what-to-use-when-cheat-sheet">What to use when (cheat-sheet)</h2>
<ul>
<li><p><strong>Apply a profile stereotype</strong> to many items → Example 10.1.</p></li>
<li><p><strong>Report MDG drift</strong> (tags/names/stereos) → Example 10.3 (linter).</p></li>
<li><p><strong>Fix drift</strong> with defaults and renaming → Example 10.4 (repairer).</p></li>
<li><p><strong>Enforce relationships</strong> between MDG types → 10.5 extension.</p></li>
<li><p><strong>Huge repositories</strong> → 10.6 SQL pre-filter + API verification.</p></li>
</ul>


<!-- -->

</section>

</main> <!-- /main -->
<script>

document.addEventListener('DOMContentLoaded', function () {

  // Prefer the margin sidebar if it exists; otherwise try the TOC sidebar.

  const margin = document.querySelector('#quarto-margin-sidebar, .margin-sidebar, .column-margin');

  const toc    = document.querySelector('nav#TOC');

  const sidebar = margin || (toc && toc.closest('.sidebar, .quarto-sidebar, .margin-sidebar'));



  if (!sidebar) return; // no margin column on this layout



  const holder = document.createElement('div');

  holder.className = 'cover-above-toc';

  holder.innerHTML = `

    <a href="index.html">

      <img src="images/cover.png" alt="Book cover" class="cover-above-toc__img" width="140" />

    </a>

  `;

  sidebar.prepend(holder);

});

</script>



<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./10-System.Object[].html" class="pagination-link" aria-label="Chapter 9: Imports &amp; Exports">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Chapter 9: Imports &amp; Exports</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./12-System.Object[].html" class="pagination-link" aria-label="Chapter 11: Governance Scripts">
        <span class="nav-page-text"><span class="chapter-title">Chapter 11: Governance Scripts</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu"># Chapter 10: MDG-Aware Scripting</span></span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a>By now, we’ve looked at the essentials of EA scripting, design patterns,</span>
<span id="cb7-4"><a href="#cb7-4"></a>and the mechanics of importing and exporting. But Enterprise Architect</span>
<span id="cb7-5"><a href="#cb7-5"></a>is more than just a generic UML tool. Its true power lies in **MDG</span>
<span id="cb7-6"><a href="#cb7-6"></a>Technologies** (Model Driven Generation). MDGs extend EA with</span>
<span id="cb7-7"><a href="#cb7-7"></a>domain-specific languages, toolboxes, and stereotypes that tailor the</span>
<span id="cb7-8"><a href="#cb7-8"></a>tool to specific contexts: ArchiMate, BPMN, SysML, TOGAF, and countless</span>
<span id="cb7-9"><a href="#cb7-9"></a>custom frameworks.</span>
<span id="cb7-10"><a href="#cb7-10"></a></span>
<span id="cb7-11"><a href="#cb7-11"></a>For script authors, MDGs present both opportunities and challenges. On</span>
<span id="cb7-12"><a href="#cb7-12"></a>one hand, they give structure — a controlled set of stereotypes, tagged</span>
<span id="cb7-13"><a href="#cb7-13"></a>values, and toolboxes. On the other hand, they introduce complexity —</span>
<span id="cb7-14"><a href="#cb7-14"></a>multiple profiles, extended stereotypes, and hidden differences between</span>
<span id="cb7-15"><a href="#cb7-15"></a>what the GUI shows and what the API actually stores.</span>
<span id="cb7-16"><a href="#cb7-16"></a></span>
<span id="cb7-17"><a href="#cb7-17"></a>This chapter explores how to make your scripts **MDG-aware**. It</span>
<span id="cb7-18"><a href="#cb7-18"></a>explains what MDGs are, how stereotypes and tagged values are defined,</span>
<span id="cb7-19"><a href="#cb7-19"></a>why you must use StereotypeEx instead of Stereotype, and how to validate</span>
<span id="cb7-20"><a href="#cb7-20"></a>models against MDG definitions. Without MDG awareness, your scripts may</span>
<span id="cb7-21"><a href="#cb7-21"></a>appear to work but silently misalign with the modelling framework your</span>
<span id="cb7-22"><a href="#cb7-22"></a>organisation depends on. With MDG awareness, your scripts become</span>
<span id="cb7-23"><a href="#cb7-23"></a>governance tools that reinforce standards and prevent drift.</span>
<span id="cb7-24"><a href="#cb7-24"></a></span>
<span id="cb7-25"><a href="#cb7-25"></a><span class="fu">## What Are MDGs?</span></span>
<span id="cb7-26"><a href="#cb7-26"></a></span>
<span id="cb7-27"><a href="#cb7-27"></a>MDG Technologies are EA’s mechanism for packaging modelling extensions.</span>
<span id="cb7-28"><a href="#cb7-28"></a>They define:</span>
<span id="cb7-29"><a href="#cb7-29"></a></span>
<span id="cb7-30"><a href="#cb7-30"></a><span class="ss">- </span>**Stereotypes**: specialisations of UML element types (e.g., ArchiMate</span>
<span id="cb7-31"><a href="#cb7-31"></a>  ApplicationComponent).</span>
<span id="cb7-32"><a href="#cb7-32"></a></span>
<span id="cb7-33"><a href="#cb7-33"></a><span class="ss">- </span>**Toolboxes**: palettes of elements and connectors available to</span>
<span id="cb7-34"><a href="#cb7-34"></a>  modellers.</span>
<span id="cb7-35"><a href="#cb7-35"></a></span>
<span id="cb7-36"><a href="#cb7-36"></a><span class="ss">- </span>**Tagged Values**: metadata fields automatically attached to</span>
<span id="cb7-37"><a href="#cb7-37"></a>  stereotyped elements.</span>
<span id="cb7-38"><a href="#cb7-38"></a></span>
<span id="cb7-39"><a href="#cb7-39"></a><span class="ss">- </span>**Profiles and MetaModels**: rules about what elements and connectors</span>
<span id="cb7-40"><a href="#cb7-40"></a>  can be created.</span>
<span id="cb7-41"><a href="#cb7-41"></a></span>
<span id="cb7-42"><a href="#cb7-42"></a>An MDG is essentially a bundle that turns EA from a generic modelling</span>
<span id="cb7-43"><a href="#cb7-43"></a>tool into a domain-specific environment.</span>
<span id="cb7-44"><a href="#cb7-44"></a></span>
<span id="cb7-45"><a href="#cb7-45"></a><span class="fu">## Why MDGs Matter for Scripting</span></span>
<span id="cb7-46"><a href="#cb7-46"></a></span>
<span id="cb7-47"><a href="#cb7-47"></a>When you script EA, you are not usually working with plain UML classes</span>
<span id="cb7-48"><a href="#cb7-48"></a>or components. You are working with **stereotyped elements defined by</span>
<span id="cb7-49"><a href="#cb7-49"></a>MDGs**. For example, if you are automating ArchiMate models, your script</span>
<span id="cb7-50"><a href="#cb7-50"></a>needs to distinguish ApplicationComponents from BusinessActors. If you</span>
<span id="cb7-51"><a href="#cb7-51"></a>are automating BPMN, you need to treat Tasks, Gateways, and Events</span>
<span id="cb7-52"><a href="#cb7-52"></a>differently.</span>
<span id="cb7-53"><a href="#cb7-53"></a></span>
<span id="cb7-54"><a href="#cb7-54"></a>Scripts that ignore MDGs risk breaking models. A script might rename or</span>
<span id="cb7-55"><a href="#cb7-55"></a>move elements without preserving stereotypes. Or it might overwrite a</span>
<span id="cb7-56"><a href="#cb7-56"></a>stereotype by writing to Element.Stereotype instead of</span>
<span id="cb7-57"><a href="#cb7-57"></a>Element.StereotypeEx. These mistakes create elements that look right in</span>
<span id="cb7-58"><a href="#cb7-58"></a>the Project Browser but misbehave in diagrams or reports.</span>
<span id="cb7-59"><a href="#cb7-59"></a></span>
<span id="cb7-60"><a href="#cb7-60"></a><span class="fu">## Important Tips</span></span>
<span id="cb7-61"><a href="#cb7-61"></a></span>
<span id="cb7-62"><a href="#cb7-62"></a><span class="fu">### The Stereotype vs. StereotypeEx Trap</span></span>
<span id="cb7-63"><a href="#cb7-63"></a></span>
<span id="cb7-64"><a href="#cb7-64"></a>One of the most notorious pitfalls in EA scripting is the difference</span>
<span id="cb7-65"><a href="#cb7-65"></a>between Stereotype and StereotypeEx.</span>
<span id="cb7-66"><a href="#cb7-66"></a></span>
<span id="cb7-67"><a href="#cb7-67"></a><span class="ss">- </span>**Stereotype** returns only the primary stereotype string, stripped of</span>
<span id="cb7-68"><a href="#cb7-68"></a>  profile information.</span>
<span id="cb7-69"><a href="#cb7-69"></a></span>
<span id="cb7-70"><a href="#cb7-70"></a><span class="ss">- </span>**StereotypeEx** returns the fully qualified stereotype, including the</span>
<span id="cb7-71"><a href="#cb7-71"></a>  profile (profile::stereotype).</span>
<span id="cb7-72"><a href="#cb7-72"></a></span>
<span id="cb7-73"><a href="#cb7-73"></a>If you rely on Stereotype, your script may confuse two stereotypes with</span>
<span id="cb7-74"><a href="#cb7-74"></a>the same name from different profiles. Worse, if you set Stereotype, you</span>
<span id="cb7-75"><a href="#cb7-75"></a>may erase MDG metadata.</span>
<span id="cb7-76"><a href="#cb7-76"></a></span>
<span id="cb7-77"><a href="#cb7-77"></a>The safe rule is: **always use StereotypeEx** when working with MDG</span>
<span id="cb7-78"><a href="#cb7-78"></a>stereotypes.</span>
<span id="cb7-79"><a href="#cb7-79"></a></span>
<span id="cb7-80"><a href="#cb7-80"></a><span class="fu">### Tagged Value Definitions</span></span>
<span id="cb7-81"><a href="#cb7-81"></a></span>
<span id="cb7-82"><a href="#cb7-82"></a>MDGs often define tagged values that attach automatically to elements</span>
<span id="cb7-83"><a href="#cb7-83"></a>with a given stereotype. For example, an ArchiMate ApplicationComponent</span>
<span id="cb7-84"><a href="#cb7-84"></a>may come with tagged values like “Layer” or “Technology.”</span>
<span id="cb7-85"><a href="#cb7-85"></a></span>
<span id="cb7-86"><a href="#cb7-86"></a>Scripts must handle these tagged values carefully. You should:</span>
<span id="cb7-87"><a href="#cb7-87"></a></span>
<span id="cb7-88"><a href="#cb7-88"></a><span class="ss">- </span>Check if the tag exists before adding a new one.</span>
<span id="cb7-89"><a href="#cb7-89"></a></span>
<span id="cb7-90"><a href="#cb7-90"></a><span class="ss">- </span>Use the correct tag names from the MDG definition.</span>
<span id="cb7-91"><a href="#cb7-91"></a></span>
<span id="cb7-92"><a href="#cb7-92"></a><span class="ss">- </span>Avoid overwriting tags with unexpected values.</span>
<span id="cb7-93"><a href="#cb7-93"></a></span>
<span id="cb7-94"><a href="#cb7-94"></a>Proper handling ensures your automation works with, not against, the</span>
<span id="cb7-95"><a href="#cb7-95"></a>MDG.</span>
<span id="cb7-96"><a href="#cb7-96"></a></span>
<span id="cb7-97"><a href="#cb7-97"></a><span class="fu">### Toolboxes and Element Creation</span></span>
<span id="cb7-98"><a href="#cb7-98"></a></span>
<span id="cb7-99"><a href="#cb7-99"></a>When creating elements via script, it’s important to align with MDG</span>
<span id="cb7-100"><a href="#cb7-100"></a>toolboxes. If your organisation uses a custom MDG that defines “Business</span>
<span id="cb7-101"><a href="#cb7-101"></a>Capability” as MyProfile::Capability, then your script must create</span>
<span id="cb7-102"><a href="#cb7-102"></a>elements with that stereotype. Creating a plain UML Class and renaming</span>
<span id="cb7-103"><a href="#cb7-103"></a>it “Capability” will cause confusion.</span>
<span id="cb7-104"><a href="#cb7-104"></a></span>
<span id="cb7-105"><a href="#cb7-105"></a>The safe pattern is to:</span>
<span id="cb7-106"><a href="#cb7-106"></a></span>
<span id="cb7-107"><a href="#cb7-107"></a><span class="ss">- </span>Identify the correct stereotype from the MDG.</span>
<span id="cb7-108"><a href="#cb7-108"></a></span>
<span id="cb7-109"><a href="#cb7-109"></a><span class="ss">- </span>Use Elements.AddNew(name, baseType) followed by StereotypeEx =</span>
<span id="cb7-110"><a href="#cb7-110"></a>  "profile::stereo".</span>
<span id="cb7-111"><a href="#cb7-111"></a></span>
<span id="cb7-112"><a href="#cb7-112"></a><span class="ss">- </span>Call Update() and RefreshModelView().</span>
<span id="cb7-113"><a href="#cb7-113"></a></span>
<span id="cb7-114"><a href="#cb7-114"></a><span class="fu">### Validating MDG Usage</span></span>
<span id="cb7-115"><a href="#cb7-115"></a></span>
<span id="cb7-116"><a href="#cb7-116"></a>MDG-aware scripting isn’t only about creating elements correctly. It’s</span>
<span id="cb7-117"><a href="#cb7-117"></a>also about validating existing models. Common checks include:</span>
<span id="cb7-118"><a href="#cb7-118"></a></span>
<span id="cb7-119"><a href="#cb7-119"></a><span class="ss">- </span>Elements of stereotype X must have certain tagged values populated.</span>
<span id="cb7-120"><a href="#cb7-120"></a></span>
<span id="cb7-121"><a href="#cb7-121"></a><span class="ss">- </span>Connectors of type Y may only connect specific element types.</span>
<span id="cb7-122"><a href="#cb7-122"></a></span>
<span id="cb7-123"><a href="#cb7-123"></a><span class="ss">- </span>Packages must only contain elements from an approved toolbox.</span>
<span id="cb7-124"><a href="#cb7-124"></a></span>
<span id="cb7-125"><a href="#cb7-125"></a>By writing MDG-aware validation scripts, you can enforce compliance and</span>
<span id="cb7-126"><a href="#cb7-126"></a>prevent “model drift” where users create incorrect structures.</span>
<span id="cb7-127"><a href="#cb7-127"></a></span>
<span id="cb7-128"><a href="#cb7-128"></a><span class="fu">### When MDGs Change</span></span>
<span id="cb7-129"><a href="#cb7-129"></a></span>
<span id="cb7-130"><a href="#cb7-130"></a>Another challenge is that MDGs evolve. Stereotypes may be renamed,</span>
<span id="cb7-131"><a href="#cb7-131"></a>tagged values may be added, or toolboxes reorganised. Scripts must be</span>
<span id="cb7-132"><a href="#cb7-132"></a>robust to such changes. That means:</span>
<span id="cb7-133"><a href="#cb7-133"></a></span>
<span id="cb7-134"><a href="#cb7-134"></a><span class="ss">- </span>Avoid hardcoding stereotypes wherever possible — use configuration</span>
<span id="cb7-135"><a href="#cb7-135"></a>  files or central mappings.</span>
<span id="cb7-136"><a href="#cb7-136"></a></span>
<span id="cb7-137"><a href="#cb7-137"></a><span class="ss">- </span>Log when unknown stereotypes are encountered.</span>
<span id="cb7-138"><a href="#cb7-138"></a></span>
<span id="cb7-139"><a href="#cb7-139"></a><span class="ss">- </span>Keep scripts version-controlled and updated alongside MDG changes.</span>
<span id="cb7-140"><a href="#cb7-140"></a></span>
<span id="cb7-141"><a href="#cb7-141"></a><span class="fu">## MDGs in External Automation</span></span>
<span id="cb7-142"><a href="#cb7-142"></a></span>
<span id="cb7-143"><a href="#cb7-143"></a>Everything we’ve said so far applies inside EA’s scripting engine, but</span>
<span id="cb7-144"><a href="#cb7-144"></a>it also applies in external automation. If you are pulling EA content</span>
<span id="cb7-145"><a href="#cb7-145"></a>into Python or C#, you still need to handle stereotypes correctly. That</span>
<span id="cb7-146"><a href="#cb7-146"></a>means reading StereotypeEx, exporting tagged values, and mapping them to</span>
<span id="cb7-147"><a href="#cb7-147"></a>your enterprise data models.</span>
<span id="cb7-148"><a href="#cb7-148"></a></span>
<span id="cb7-149"><a href="#cb7-149"></a>In fact, external automation often makes MDG handling easier because you</span>
<span id="cb7-150"><a href="#cb7-150"></a>can use richer libraries (YAML, JSON) to store stereotype/tag mappings.</span>
<span id="cb7-151"><a href="#cb7-151"></a></span>
<span id="cb7-152"><a href="#cb7-152"></a><span class="fu">## Safety and Governance</span></span>
<span id="cb7-153"><a href="#cb7-153"></a></span>
<span id="cb7-154"><a href="#cb7-154"></a>MDG-aware scripting is not just a technical detail. It is a matter of</span>
<span id="cb7-155"><a href="#cb7-155"></a>governance. In large organisations, MDGs embody agreed standards: what</span>
<span id="cb7-156"><a href="#cb7-156"></a>modelling constructs are allowed, how they are tagged, and how they</span>
<span id="cb7-157"><a href="#cb7-157"></a>interrelate. Scripts that respect MDGs reinforce governance. Scripts</span>
<span id="cb7-158"><a href="#cb7-158"></a>that ignore them undermine it.</span>
<span id="cb7-159"><a href="#cb7-159"></a></span>
<span id="cb7-160"><a href="#cb7-160"></a>By making scripts MDG-aware, you align automation with enterprise</span>
<span id="cb7-161"><a href="#cb7-161"></a>architecture frameworks, regulatory requirements, and industry</span>
<span id="cb7-162"><a href="#cb7-162"></a>standards.</span>
<span id="cb7-163"><a href="#cb7-163"></a></span>
<span id="cb7-164"><a href="#cb7-164"></a><span class="fu">## Examples </span></span>
<span id="cb7-165"><a href="#cb7-165"></a></span>
<span id="cb7-166"><a href="#cb7-166"></a><span class="fu">### Stereotypes 101 (MDG-aware)</span></span>
<span id="cb7-167"><a href="#cb7-167"></a></span>
<span id="cb7-168"><a href="#cb7-168"></a><span class="ss">- </span>**Element.Stereotype**: the “plain” stereotype string (often just the</span>
<span id="cb7-169"><a href="#cb7-169"></a>  short name).</span>
<span id="cb7-170"><a href="#cb7-170"></a></span>
<span id="cb7-171"><a href="#cb7-171"></a><span class="ss">- </span>**Element.StereotypeEx**: the **fully-qualified** list (may contain</span>
<span id="cb7-172"><a href="#cb7-172"></a>  profile::stereotype, comma-separated).</span>
<span id="cb7-173"><a href="#cb7-173"></a></span>
<span id="cb7-174"><a href="#cb7-174"></a><span class="ss">- </span>**Multiple stereotypes**: use StereotypeEx.</span>
<span id="cb7-175"><a href="#cb7-175"></a></span>
<span id="cb7-176"><a href="#cb7-176"></a><span class="ss">- </span>**Best practice**: when working with MDGs, **set and test against</span>
<span id="cb7-177"><a href="#cb7-177"></a>  StereotypeEx** with the profile::stereo form.</span>
<span id="cb7-178"><a href="#cb7-178"></a></span>
<span id="cb7-179"><a href="#cb7-179"></a><span class="in">```{.js filename="Example 10.1 - MDG_ApplyStereotype.js – JScript (ES3)"}</span></span>
<span id="cb7-180"><a href="#cb7-180"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb7-181"><a href="#cb7-181"></a><span class="co">// Example 10.1 - MDG_ApplyStereotype.js – JScript (ES3)</span></span>
<span id="cb7-182"><a href="#cb7-182"></a><span class="co">// Purpose: Ensure elements in the selected package have a specific MDG stereotype</span></span>
<span id="cb7-183"><a href="#cb7-183"></a><span class="co">// Notes:</span></span>
<span id="cb7-184"><a href="#cb7-184"></a><span class="co">//  - Uses profile::stereotype form via StereotypeEx</span></span>
<span id="cb7-185"><a href="#cb7-185"></a><span class="co">//  - Safe by default with DRY_RUN flag</span></span>
<span id="cb7-186"><a href="#cb7-186"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb7-187"><a href="#cb7-187"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb7-188"><a href="#cb7-188"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb7-189"><a href="#cb7-189"></a></span>
<span id="cb7-190"><a href="#cb7-190"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb7-191"><a href="#cb7-191"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"MDG_ApplyStereo"</span><span class="op">;</span></span>
<span id="cb7-192"><a href="#cb7-192"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb7-193"><a href="#cb7-193"></a></span>
<span id="cb7-194"><a href="#cb7-194"></a>    <span class="co">// ---- Config ----</span></span>
<span id="cb7-195"><a href="#cb7-195"></a>    <span class="kw">var</span> DRY_RUN <span class="op">=</span> <span class="kw">true</span><span class="op">;</span>                        <span class="co">// switch to false to commit</span></span>
<span id="cb7-196"><a href="#cb7-196"></a>    <span class="kw">var</span> PROFILE <span class="op">=</span> <span class="st">"MyProfile"</span><span class="op">;</span>                 <span class="co">// MDG profile name</span></span>
<span id="cb7-197"><a href="#cb7-197"></a>    <span class="kw">var</span> STEREO  <span class="op">=</span> <span class="st">"BusinessCapability"</span><span class="op">;</span>        <span class="co">// Stereotype short name</span></span>
<span id="cb7-198"><a href="#cb7-198"></a>    <span class="kw">var</span> FQ      <span class="op">=</span> PROFILE <span class="op">+</span> <span class="st">"::"</span> <span class="op">+</span> STEREO<span class="op">;</span>     <span class="co">// fully-qualified</span></span>
<span id="cb7-199"><a href="#cb7-199"></a></span>
<span id="cb7-200"><a href="#cb7-200"></a>    <span class="kw">var</span> pkg <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span>()<span class="op">;</span></span>
<span id="cb7-201"><a href="#cb7-201"></a>    <span class="cf">if</span> (<span class="op">!</span>pkg) { Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Select a target package."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb7-202"><a href="#cb7-202"></a></span>
<span id="cb7-203"><a href="#cb7-203"></a>    <span class="kw">var</span> els <span class="op">=</span> pkg<span class="op">.</span><span class="at">Elements</span><span class="op">,</span> changed <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-204"><a href="#cb7-204"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>els<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb7-205"><a href="#cb7-205"></a>        <span class="kw">var</span> e <span class="op">=</span> els<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb7-206"><a href="#cb7-206"></a></span>
<span id="cb7-207"><a href="#cb7-207"></a>        <span class="co">// Skip non-matching base types if you want (e.g., only Classes)</span></span>
<span id="cb7-208"><a href="#cb7-208"></a>        <span class="co">// if (e.Type != "Class") continue;</span></span>
<span id="cb7-209"><a href="#cb7-209"></a></span>
<span id="cb7-210"><a href="#cb7-210"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">hasFQStereotype</span>(e<span class="op">,</span> FQ)) {</span>
<span id="cb7-211"><a href="#cb7-211"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Apply stereotype to '"</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">"': "</span> <span class="op">+</span> FQ)<span class="op">;</span></span>
<span id="cb7-212"><a href="#cb7-212"></a>            <span class="cf">if</span> (<span class="op">!</span>DRY_RUN) {</span>
<span id="cb7-213"><a href="#cb7-213"></a>                <span class="co">// Add (or replace) StereotypeEx preserving any existing ones</span></span>
<span id="cb7-214"><a href="#cb7-214"></a>                e<span class="op">.</span><span class="at">StereotypeEx</span> <span class="op">=</span> <span class="fu">addFQStereotype</span>(e<span class="op">.</span><span class="at">StereotypeEx</span><span class="op">,</span> FQ)<span class="op">;</span></span>
<span id="cb7-215"><a href="#cb7-215"></a>                e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span></span>
<span id="cb7-216"><a href="#cb7-216"></a>            }</span>
<span id="cb7-217"><a href="#cb7-217"></a>            changed<span class="op">++;</span></span>
<span id="cb7-218"><a href="#cb7-218"></a>        }</span>
<span id="cb7-219"><a href="#cb7-219"></a>    }</span>
<span id="cb7-220"><a href="#cb7-220"></a>    <span class="cf">if</span> (<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> changed<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(pkg<span class="op">.</span><span class="at">PackageID</span>)<span class="op">;</span></span>
<span id="cb7-221"><a href="#cb7-221"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Updated "</span> <span class="op">+</span> changed <span class="op">+</span> <span class="st">" element(s). Dry-run="</span> <span class="op">+</span> DRY_RUN)<span class="op">;</span></span>
<span id="cb7-222"><a href="#cb7-222"></a>}</span>
<span id="cb7-223"><a href="#cb7-223"></a></span>
<span id="cb7-224"><a href="#cb7-224"></a><span class="kw">function</span> <span class="fu">hasFQStereotype</span>(e<span class="op">,</span> fq) {</span>
<span id="cb7-225"><a href="#cb7-225"></a>    <span class="kw">var</span> list <span class="op">=</span> <span class="bu">String</span>(e<span class="op">.</span><span class="at">StereotypeEx</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span></span>
<span id="cb7-226"><a href="#cb7-226"></a>    <span class="co">// simple token check; EA uses comma-separated list</span></span>
<span id="cb7-227"><a href="#cb7-227"></a>    <span class="kw">var</span> items <span class="op">=</span> list<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">;</span></span>
<span id="cb7-228"><a href="#cb7-228"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>items<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb7-229"><a href="#cb7-229"></a>        <span class="cf">if</span> (<span class="fu">equalsIgnoreCase</span>(<span class="fu">trim</span>(items[i])<span class="op">,</span> fq)) <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb7-230"><a href="#cb7-230"></a>    }</span>
<span id="cb7-231"><a href="#cb7-231"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb7-232"><a href="#cb7-232"></a>}</span>
<span id="cb7-233"><a href="#cb7-233"></a><span class="kw">function</span> <span class="fu">addFQStereotype</span>(current<span class="op">,</span> fq) {</span>
<span id="cb7-234"><a href="#cb7-234"></a>    current <span class="op">=</span> <span class="bu">String</span>(current<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb7-235"><a href="#cb7-235"></a>    <span class="cf">if</span> (current <span class="op">===</span> <span class="st">""</span>) <span class="cf">return</span> fq<span class="op">;</span></span>
<span id="cb7-236"><a href="#cb7-236"></a>    <span class="co">// Avoid dupes</span></span>
<span id="cb7-237"><a href="#cb7-237"></a>    <span class="kw">var</span> items <span class="op">=</span> current<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">,</span> i<span class="op">;</span></span>
<span id="cb7-238"><a href="#cb7-238"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>items<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb7-239"><a href="#cb7-239"></a>        <span class="cf">if</span> (<span class="fu">equalsIgnoreCase</span>(<span class="fu">trim</span>(items[i])<span class="op">,</span> fq)) <span class="cf">return</span> current<span class="op">;</span></span>
<span id="cb7-240"><a href="#cb7-240"></a>    }</span>
<span id="cb7-241"><a href="#cb7-241"></a>    <span class="cf">return</span> current <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> fq<span class="op">;</span></span>
<span id="cb7-242"><a href="#cb7-242"></a>}</span>
<span id="cb7-243"><a href="#cb7-243"></a></span>
<span id="cb7-244"><a href="#cb7-244"></a><span class="fu">main</span>()<span class="op">;</span></span>
<span id="cb7-245"><a href="#cb7-245"></a><span class="in">```</span></span>
<span id="cb7-246"><a href="#cb7-246"></a></span>
<span id="cb7-247"><a href="#cb7-247"></a><span class="fu">### Tagged Value Definitions (MDG-driven)</span></span>
<span id="cb7-248"><a href="#cb7-248"></a></span>
<span id="cb7-249"><a href="#cb7-249"></a>MDGs typically define tagged value **types** (lists, refs, memo) and</span>
<span id="cb7-250"><a href="#cb7-250"></a>**required** tags per stereotype. From scripts you usually don’t read</span>
<span id="cb7-251"><a href="#cb7-251"></a>MDG metadata directly; instead you **encode your project’s rules** in a</span>
<span id="cb7-252"><a href="#cb7-252"></a>small configuration map and then **enforce** those rules.</span>
<span id="cb7-253"><a href="#cb7-253"></a></span>
<span id="cb7-254"><a href="#cb7-254"></a><span class="in">```{.js filename="Example 10.2 - MDG_Rulebook.js – JScript (ES3)"}</span></span>
<span id="cb7-255"><a href="#cb7-255"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb7-256"><a href="#cb7-256"></a><span class="co">// Example 10.2 - MDG_Rulebook.js – JScript (ES3)</span></span>
<span id="cb7-257"><a href="#cb7-257"></a><span class="co">// Purpose: Central config for your MDG validation/repair scripts</span></span>
<span id="cb7-258"><a href="#cb7-258"></a><span class="co">// Notes: Express stereotypes fully-qualified as PROFILE::STEREO</span></span>
<span id="cb7-259"><a href="#cb7-259"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb7-260"><a href="#cb7-260"></a><span class="kw">var</span> MDG_RULES <span class="op">=</span> {</span>
<span id="cb7-261"><a href="#cb7-261"></a>    <span class="st">"MyProfile::BusinessCapability"</span><span class="op">:</span> {</span>
<span id="cb7-262"><a href="#cb7-262"></a>        <span class="dt">baseType</span><span class="op">:</span> <span class="st">"Class"</span><span class="op">,</span>                         <span class="co">// optional; skip other base types</span></span>
<span id="cb7-263"><a href="#cb7-263"></a>        <span class="dt">requiredTags</span><span class="op">:</span> [</span>
<span id="cb7-264"><a href="#cb7-264"></a>            { <span class="dt">name</span><span class="op">:</span> <span class="st">"Owner"</span><span class="op">,</span>       <span class="dt">defaultValue</span><span class="op">:</span> <span class="st">"ArchitectureTeam"</span> }<span class="op">,</span></span>
<span id="cb7-265"><a href="#cb7-265"></a>            { <span class="dt">name</span><span class="op">:</span> <span class="st">"Lifecycle"</span><span class="op">,</span>   <span class="dt">defaultValue</span><span class="op">:</span> <span class="st">"Active"</span> }<span class="op">,</span></span>
<span id="cb7-266"><a href="#cb7-266"></a>            { <span class="dt">name</span><span class="op">:</span> <span class="st">"ExternalID"</span><span class="op">,</span>  <span class="dt">defaultValue</span><span class="op">:</span> <span class="st">""</span> }     <span class="co">// leave blank; must be filled by users/imports</span></span>
<span id="cb7-267"><a href="#cb7-267"></a>        ]<span class="op">,</span></span>
<span id="cb7-268"><a href="#cb7-268"></a>        <span class="dt">namePrefix</span><span class="op">:</span> <span class="st">"BC_"</span>                           <span class="co">// optional naming convention</span></span>
<span id="cb7-269"><a href="#cb7-269"></a>    }<span class="op">,</span></span>
<span id="cb7-270"><a href="#cb7-270"></a>    <span class="st">"MyProfile::ApplicationService"</span><span class="op">:</span> {</span>
<span id="cb7-271"><a href="#cb7-271"></a>        <span class="dt">baseType</span><span class="op">:</span> <span class="st">"Class"</span><span class="op">,</span></span>
<span id="cb7-272"><a href="#cb7-272"></a>        <span class="dt">requiredTags</span><span class="op">:</span> [</span>
<span id="cb7-273"><a href="#cb7-273"></a>            { <span class="dt">name</span><span class="op">:</span> <span class="st">"Owner"</span><span class="op">,</span>      <span class="dt">defaultValue</span><span class="op">:</span> <span class="st">"AppTeam"</span> }<span class="op">,</span></span>
<span id="cb7-274"><a href="#cb7-274"></a>            { <span class="dt">name</span><span class="op">:</span> <span class="st">"Criticality"</span><span class="op">,</span> <span class="dt">defaultValue</span><span class="op">:</span> <span class="st">"Medium"</span> }</span>
<span id="cb7-275"><a href="#cb7-275"></a>        ]<span class="op">,</span></span>
<span id="cb7-276"><a href="#cb7-276"></a>        <span class="dt">namePrefix</span><span class="op">:</span> <span class="st">"AS_"</span></span>
<span id="cb7-277"><a href="#cb7-277"></a>    }</span>
<span id="cb7-278"><a href="#cb7-278"></a>}<span class="op">;</span></span>
<span id="cb7-279"><a href="#cb7-279"></a><span class="in">```</span></span>
<span id="cb7-280"><a href="#cb7-280"></a></span>
<span id="cb7-281"><a href="#cb7-281"></a>Keep this in one place (e.g., <span class="sc">\_</span>Common.MDG_Rulebook) and !INC it in</span>
<span id="cb7-282"><a href="#cb7-282"></a>validator and repair scripts.</span>
<span id="cb7-283"><a href="#cb7-283"></a></span>
<span id="cb7-284"><a href="#cb7-284"></a><span class="fu">### MDG Validator (report-only)</span></span>
<span id="cb7-285"><a href="#cb7-285"></a></span>
<span id="cb7-286"><a href="#cb7-286"></a>This script reports deviations: wrong/missing stereotype, missing tags,</span>
<span id="cb7-287"><a href="#cb7-287"></a>blank required values, naming violations. It **never writes**; use it in</span>
<span id="cb7-288"><a href="#cb7-288"></a>governance jobs and daily hygiene.</span>
<span id="cb7-289"><a href="#cb7-289"></a></span>
<span id="cb7-290"><a href="#cb7-290"></a><span class="in">```{.js filename="Example 10.3 - MDG_Lint.js – JScript (ES3)"}</span></span>
<span id="cb7-291"><a href="#cb7-291"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb7-292"><a href="#cb7-292"></a><span class="co">// Example 10.3 - MDG_Lint.js – JScript (ES3)</span></span>
<span id="cb7-293"><a href="#cb7-293"></a><span class="co">// Purpose: Report MDG violations for elements in selected package (read-only)</span></span>
<span id="cb7-294"><a href="#cb7-294"></a><span class="co">// Output: Output tab + CSV (directory-only chooser)</span></span>
<span id="cb7-295"><a href="#cb7-295"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb7-296"><a href="#cb7-296"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb7-297"><a href="#cb7-297"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb7-298"><a href="#cb7-298"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">MDG_Rulebook</span></span>
<span id="cb7-299"><a href="#cb7-299"></a></span>
<span id="cb7-300"><a href="#cb7-300"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb7-301"><a href="#cb7-301"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"MDG_Lint"</span><span class="op">;</span></span>
<span id="cb7-302"><a href="#cb7-302"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb7-303"><a href="#cb7-303"></a></span>
<span id="cb7-304"><a href="#cb7-304"></a>    <span class="kw">var</span> pkg <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span>()<span class="op">;</span></span>
<span id="cb7-305"><a href="#cb7-305"></a>    <span class="cf">if</span> (<span class="op">!</span>pkg) { Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Select a package to lint."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb7-306"><a href="#cb7-306"></a></span>
<span id="cb7-307"><a href="#cb7-307"></a>    <span class="kw">var</span> outDir <span class="op">=</span> <span class="fu">browseForFolder</span>(<span class="st">"Select output folder for MDG lint report"</span>)<span class="op">;</span></span>
<span id="cb7-308"><a href="#cb7-308"></a>    <span class="kw">var</span> csv <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb7-309"><a href="#cb7-309"></a>    <span class="cf">if</span> (outDir) {</span>
<span id="cb7-310"><a href="#cb7-310"></a>        <span class="kw">var</span> stamp <span class="op">=</span> (<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb7-311"><a href="#cb7-311"></a>        csv <span class="op">=</span> <span class="kw">new</span> <span class="fu">CsvWriter</span>(outDir <span class="op">+</span> <span class="st">"</span><span class="sc">\\</span><span class="st">mdg_lint_"</span> <span class="op">+</span> stamp <span class="op">+</span> <span class="st">".csv"</span>)<span class="op">;</span></span>
<span id="cb7-312"><a href="#cb7-312"></a>        csv<span class="op">.</span><span class="fu">writeHeader</span>(<span class="st">"ElementID,GUID,Name,Type,AppliedStereotypes,Issue,Details,ExpectedProfileStereo"</span>)<span class="op">;</span></span>
<span id="cb7-313"><a href="#cb7-313"></a>    }</span>
<span id="cb7-314"><a href="#cb7-314"></a></span>
<span id="cb7-315"><a href="#cb7-315"></a>    <span class="kw">var</span> els <span class="op">=</span> pkg<span class="op">.</span><span class="at">Elements</span><span class="op">,</span> issues<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-316"><a href="#cb7-316"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>els<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb7-317"><a href="#cb7-317"></a>        <span class="kw">var</span> e <span class="op">=</span> els<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb7-318"><a href="#cb7-318"></a>        <span class="kw">var</span> applied <span class="op">=</span> <span class="bu">String</span>(e<span class="op">.</span><span class="at">StereotypeEx</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span></span>
<span id="cb7-319"><a href="#cb7-319"></a>        <span class="kw">var</span> expectedFQ <span class="op">=</span> <span class="fu">pickRuleKey</span>(e<span class="op">,</span> applied)<span class="op">;</span>   <span class="co">// finds the rule, if any</span></span>
<span id="cb7-320"><a href="#cb7-320"></a></span>
<span id="cb7-321"><a href="#cb7-321"></a>        <span class="cf">if</span> (<span class="op">!</span>expectedFQ) <span class="cf">continue</span><span class="op">;</span> <span class="co">// element not in scope of our rulebook</span></span>
<span id="cb7-322"><a href="#cb7-322"></a></span>
<span id="cb7-323"><a href="#cb7-323"></a>        <span class="kw">var</span> rule <span class="op">=</span> MDG_RULES[expectedFQ]<span class="op">;</span></span>
<span id="cb7-324"><a href="#cb7-324"></a></span>
<span id="cb7-325"><a href="#cb7-325"></a>        <span class="co">// 1) Base type check (optional)</span></span>
<span id="cb7-326"><a href="#cb7-326"></a>        <span class="cf">if</span> (rule<span class="op">.</span><span class="at">baseType</span> <span class="op">&amp;&amp;</span> rule<span class="op">.</span><span class="at">baseType</span> <span class="op">!=</span> e<span class="op">.</span><span class="at">Type</span>) {</span>
<span id="cb7-327"><a href="#cb7-327"></a>            issues <span class="op">+=</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> applied<span class="op">,</span> <span class="st">"BaseTypeMismatch"</span><span class="op">,</span> <span class="st">"Expected base type "</span><span class="op">+</span>rule<span class="op">.</span><span class="at">baseType</span><span class="op">,</span> expectedFQ)<span class="op">;</span></span>
<span id="cb7-328"><a href="#cb7-328"></a>            <span class="cf">continue</span><span class="op">;</span> <span class="co">// don’t check tags if base type is wrong</span></span>
<span id="cb7-329"><a href="#cb7-329"></a>        }</span>
<span id="cb7-330"><a href="#cb7-330"></a></span>
<span id="cb7-331"><a href="#cb7-331"></a>        <span class="co">// 2) Stereotype check</span></span>
<span id="cb7-332"><a href="#cb7-332"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">hasFQStereo</span>(applied<span class="op">,</span> expectedFQ)) {</span>
<span id="cb7-333"><a href="#cb7-333"></a>            issues <span class="op">+=</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> applied<span class="op">,</span> <span class="st">"MissingStereotype"</span><span class="op">,</span> <span class="st">"Apply "</span><span class="op">+</span>expectedFQ<span class="op">,</span> expectedFQ)<span class="op">;</span></span>
<span id="cb7-334"><a href="#cb7-334"></a>        }</span>
<span id="cb7-335"><a href="#cb7-335"></a></span>
<span id="cb7-336"><a href="#cb7-336"></a>        <span class="co">// 3) Required tags</span></span>
<span id="cb7-337"><a href="#cb7-337"></a>        <span class="cf">for</span> (<span class="kw">var</span> t<span class="op">=</span><span class="dv">0</span><span class="op">;</span> t<span class="op">&lt;</span>rule<span class="op">.</span><span class="at">requiredTags</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> t<span class="op">++</span>) {</span>
<span id="cb7-338"><a href="#cb7-338"></a>            <span class="kw">var</span> tn <span class="op">=</span> rule<span class="op">.</span><span class="at">requiredTags</span>[t]<span class="op">.</span><span class="at">name</span><span class="op">;</span></span>
<span id="cb7-339"><a href="#cb7-339"></a>            <span class="kw">var</span> tv <span class="op">=</span> <span class="fu">readTag</span>(e<span class="op">,</span> tn)<span class="op">;</span></span>
<span id="cb7-340"><a href="#cb7-340"></a>            <span class="cf">if</span> (<span class="fu">trim</span>(tv) <span class="op">===</span> <span class="st">""</span>) {</span>
<span id="cb7-341"><a href="#cb7-341"></a>                issues <span class="op">+=</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> applied<span class="op">,</span> <span class="st">"MissingTag"</span><span class="op">,</span> <span class="st">"Tag '"</span><span class="op">+</span>tn<span class="op">+</span><span class="st">"' is required"</span><span class="op">,</span> expectedFQ)<span class="op">;</span></span>
<span id="cb7-342"><a href="#cb7-342"></a>            }</span>
<span id="cb7-343"><a href="#cb7-343"></a>        }</span>
<span id="cb7-344"><a href="#cb7-344"></a></span>
<span id="cb7-345"><a href="#cb7-345"></a>        <span class="co">// 4) Naming convention (optional)</span></span>
<span id="cb7-346"><a href="#cb7-346"></a>        <span class="cf">if</span> (rule<span class="op">.</span><span class="at">namePrefix</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu">startsWith</span>(e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> rule<span class="op">.</span><span class="at">namePrefix</span>)) {</span>
<span id="cb7-347"><a href="#cb7-347"></a>            issues <span class="op">+=</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> applied<span class="op">,</span> <span class="st">"NamePrefix"</span><span class="op">,</span> <span class="st">"Should start with '"</span><span class="op">+</span>rule<span class="op">.</span><span class="at">namePrefix</span><span class="op">+</span><span class="st">"'"</span><span class="op">,</span> expectedFQ)<span class="op">;</span></span>
<span id="cb7-348"><a href="#cb7-348"></a>        }</span>
<span id="cb7-349"><a href="#cb7-349"></a>    }</span>
<span id="cb7-350"><a href="#cb7-350"></a></span>
<span id="cb7-351"><a href="#cb7-351"></a>    <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb7-352"><a href="#cb7-352"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"MDG lint complete. Issues: "</span> <span class="op">+</span> issues)<span class="op">;</span></span>
<span id="cb7-353"><a href="#cb7-353"></a>}</span>
<span id="cb7-354"><a href="#cb7-354"></a></span>
<span id="cb7-355"><a href="#cb7-355"></a><span class="kw">function</span> <span class="fu">pickRuleKey</span>(e<span class="op">,</span> appliedList) {</span>
<span id="cb7-356"><a href="#cb7-356"></a>    <span class="co">// Strategy:</span></span>
<span id="cb7-357"><a href="#cb7-357"></a>    <span class="co">//  - If any rule key is present in StereotypeEx, prefer it.</span></span>
<span id="cb7-358"><a href="#cb7-358"></a>    <span class="co">//  - Else if base type matches exactly one rule, use that rule for “expected” check.</span></span>
<span id="cb7-359"><a href="#cb7-359"></a>    <span class="kw">var</span> keys <span class="op">=</span> <span class="fu">keysOf</span>(MDG_RULES)<span class="op">;</span></span>
<span id="cb7-360"><a href="#cb7-360"></a>    <span class="co">// prefer explicit match</span></span>
<span id="cb7-361"><a href="#cb7-361"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>keys<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb7-362"><a href="#cb7-362"></a>        <span class="cf">if</span> (<span class="fu">hasFQStereo</span>(appliedList<span class="op">,</span> keys[i])) <span class="cf">return</span> keys[i]<span class="op">;</span></span>
<span id="cb7-363"><a href="#cb7-363"></a>    }</span>
<span id="cb7-364"><a href="#cb7-364"></a>    <span class="co">// fallback: base type inference if unambiguous</span></span>
<span id="cb7-365"><a href="#cb7-365"></a>    <span class="kw">var</span> chosen<span class="op">=</span><span class="kw">null</span><span class="op">;</span></span>
<span id="cb7-366"><a href="#cb7-366"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>keys<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb7-367"><a href="#cb7-367"></a>        <span class="kw">var</span> r <span class="op">=</span> MDG_RULES[keys[i]]<span class="op">;</span></span>
<span id="cb7-368"><a href="#cb7-368"></a>        <span class="cf">if</span> (r<span class="op">.</span><span class="at">baseType</span> <span class="op">&amp;&amp;</span> r<span class="op">.</span><span class="at">baseType</span> <span class="op">==</span> e<span class="op">.</span><span class="at">Type</span>) {</span>
<span id="cb7-369"><a href="#cb7-369"></a>            <span class="cf">if</span> (chosen <span class="op">&amp;&amp;</span> chosen <span class="op">!=</span> keys[i]) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span> <span class="co">// ambiguous</span></span>
<span id="cb7-370"><a href="#cb7-370"></a>            chosen <span class="op">=</span> keys[i]<span class="op">;</span></span>
<span id="cb7-371"><a href="#cb7-371"></a>        }</span>
<span id="cb7-372"><a href="#cb7-372"></a>    }</span>
<span id="cb7-373"><a href="#cb7-373"></a>    <span class="cf">return</span> chosen<span class="op">;</span></span>
<span id="cb7-374"><a href="#cb7-374"></a>}</span>
<span id="cb7-375"><a href="#cb7-375"></a></span>
<span id="cb7-376"><a href="#cb7-376"></a><span class="kw">function</span> <span class="fu">hasFQStereo</span>(applied<span class="op">,</span> fq) {</span>
<span id="cb7-377"><a href="#cb7-377"></a>    <span class="kw">var</span> items <span class="op">=</span> <span class="bu">String</span>(applied<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">;</span></span>
<span id="cb7-378"><a href="#cb7-378"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>items<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb7-379"><a href="#cb7-379"></a>        <span class="cf">if</span> (<span class="fu">equalsIgnoreCase</span>(<span class="fu">trim</span>(items[i])<span class="op">,</span> fq)) <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb7-380"><a href="#cb7-380"></a>    }</span>
<span id="cb7-381"><a href="#cb7-381"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb7-382"><a href="#cb7-382"></a>}</span>
<span id="cb7-383"><a href="#cb7-383"></a><span class="kw">function</span> <span class="fu">readTag</span>(e<span class="op">,</span> name) {</span>
<span id="cb7-384"><a href="#cb7-384"></a>    <span class="kw">var</span> tvs <span class="op">=</span> e<span class="op">.</span><span class="at">TaggedValues</span><span class="op">;</span></span>
<span id="cb7-385"><a href="#cb7-385"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>tvs<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb7-386"><a href="#cb7-386"></a>        <span class="kw">var</span> tv <span class="op">=</span> tvs<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb7-387"><a href="#cb7-387"></a>        <span class="cf">if</span> (<span class="fu">equalsIgnoreCase</span>(tv<span class="op">.</span><span class="at">Name</span><span class="op">,</span> name)) <span class="cf">return</span> <span class="bu">String</span>(tv<span class="op">.</span><span class="at">Value</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span></span>
<span id="cb7-388"><a href="#cb7-388"></a>    }</span>
<span id="cb7-389"><a href="#cb7-389"></a>    <span class="cf">return</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb7-390"><a href="#cb7-390"></a>}</span>
<span id="cb7-391"><a href="#cb7-391"></a><span class="kw">function</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> applied<span class="op">,</span> issue<span class="op">,</span> details<span class="op">,</span> expected) {</span>
<span id="cb7-392"><a href="#cb7-392"></a>    <span class="kw">var</span> line <span class="op">=</span> e<span class="op">.</span><span class="at">ElementID</span> <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">" – "</span> <span class="op">+</span> issue <span class="op">+</span> <span class="st">": "</span> <span class="op">+</span> details<span class="op">;</span></span>
<span id="cb7-393"><a href="#cb7-393"></a>    <span class="fu">log</span>(<span class="st">"MDG_Lint"</span><span class="op">,</span> line)<span class="op">;</span></span>
<span id="cb7-394"><a href="#cb7-394"></a>    <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">writeRow</span>([e<span class="op">.</span><span class="at">ElementID</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementGUID</span><span class="op">,</span> e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> e<span class="op">.</span><span class="at">Type</span><span class="op">,</span> applied<span class="op">,</span> issue<span class="op">,</span> details<span class="op">,</span> expected<span class="op">||</span><span class="st">""</span>])<span class="op">;</span></span>
<span id="cb7-395"><a href="#cb7-395"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb7-396"><a href="#cb7-396"></a>}</span>
<span id="cb7-397"><a href="#cb7-397"></a><span class="kw">function</span> <span class="fu">keysOf</span>(o){ <span class="kw">var</span> r<span class="op">=</span>[]<span class="op">,</span>k<span class="op">;</span> <span class="cf">for</span>(k <span class="kw">in</span> o){ <span class="cf">if</span>(o<span class="op">.</span><span class="fu">hasOwnProperty</span>(k)) r<span class="op">.</span><span class="fu">push</span>(k)<span class="op">;</span>} <span class="cf">return</span> r<span class="op">;</span> }</span>
<span id="cb7-398"><a href="#cb7-398"></a></span>
<span id="cb7-399"><a href="#cb7-399"></a><span class="fu">main</span>()<span class="op">;</span></span>
<span id="cb7-400"><a href="#cb7-400"></a><span class="in">```</span></span>
<span id="cb7-401"><a href="#cb7-401"></a></span>
<span id="cb7-402"><a href="#cb7-402"></a><span class="fu">### MDG Repair (guided and safe)</span></span>
<span id="cb7-403"><a href="#cb7-403"></a></span>
<span id="cb7-404"><a href="#cb7-404"></a>This companion script **fixes** the issues reported by the linter. It</span>
<span id="cb7-405"><a href="#cb7-405"></a>uses a **dry-run** flag and writes a CSV log of every attempted change.</span>
<span id="cb7-406"><a href="#cb7-406"></a></span>
<span id="cb7-407"><a href="#cb7-407"></a><span class="in">```{.js filename="Example 10.4 - MDG_Repair.js – JScript (ES3)"}</span></span>
<span id="cb7-408"><a href="#cb7-408"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb7-409"><a href="#cb7-409"></a><span class="co">// Example 10.4 - MDG_Repair.js – JScript (ES3)</span></span>
<span id="cb7-410"><a href="#cb7-410"></a><span class="co">// Purpose: Apply MDG fixes (stereotype, required tags, naming prefix)</span></span>
<span id="cb7-411"><a href="#cb7-411"></a><span class="co">// Safety: DRY_RUN=true by default; logs every change</span></span>
<span id="cb7-412"><a href="#cb7-412"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb7-413"><a href="#cb7-413"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb7-414"><a href="#cb7-414"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb7-415"><a href="#cb7-415"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">MDG_Rulebook</span></span>
<span id="cb7-416"><a href="#cb7-416"></a></span>
<span id="cb7-417"><a href="#cb7-417"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb7-418"><a href="#cb7-418"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"MDG_Repair"</span><span class="op">;</span></span>
<span id="cb7-419"><a href="#cb7-419"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb7-420"><a href="#cb7-420"></a></span>
<span id="cb7-421"><a href="#cb7-421"></a>    <span class="co">// ---- Config ----</span></span>
<span id="cb7-422"><a href="#cb7-422"></a>    <span class="kw">var</span> DRY_RUN <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb7-423"><a href="#cb7-423"></a></span>
<span id="cb7-424"><a href="#cb7-424"></a>    <span class="kw">var</span> pkg <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span>()<span class="op">;</span></span>
<span id="cb7-425"><a href="#cb7-425"></a>    <span class="cf">if</span> (<span class="op">!</span>pkg) { Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Select a package."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb7-426"><a href="#cb7-426"></a></span>
<span id="cb7-427"><a href="#cb7-427"></a>    <span class="kw">var</span> outDir <span class="op">=</span> <span class="fu">browseForFolder</span>(<span class="st">"Select output folder for MDG repair log"</span>)<span class="op">;</span></span>
<span id="cb7-428"><a href="#cb7-428"></a>    <span class="kw">var</span> csv <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb7-429"><a href="#cb7-429"></a>    <span class="cf">if</span> (outDir) {</span>
<span id="cb7-430"><a href="#cb7-430"></a>        <span class="kw">var</span> stamp <span class="op">=</span> (<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb7-431"><a href="#cb7-431"></a>        csv <span class="op">=</span> <span class="kw">new</span> <span class="fu">CsvWriter</span>(outDir <span class="op">+</span> <span class="st">"</span><span class="sc">\\</span><span class="st">mdg_repair_"</span> <span class="op">+</span> stamp <span class="op">+</span> <span class="st">".csv"</span>)<span class="op">;</span></span>
<span id="cb7-432"><a href="#cb7-432"></a>        csv<span class="op">.</span><span class="fu">writeHeader</span>(<span class="st">"Action,ElementID,GUID,Name,Details"</span>)<span class="op">;</span></span>
<span id="cb7-433"><a href="#cb7-433"></a>    }</span>
<span id="cb7-434"><a href="#cb7-434"></a></span>
<span id="cb7-435"><a href="#cb7-435"></a>    <span class="kw">var</span> els <span class="op">=</span> pkg<span class="op">.</span><span class="at">Elements</span><span class="op">,</span> changed<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-436"><a href="#cb7-436"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>els<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb7-437"><a href="#cb7-437"></a>        <span class="kw">var</span> e <span class="op">=</span> els<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb7-438"><a href="#cb7-438"></a>        <span class="kw">var</span> expectedFQ <span class="op">=</span> <span class="fu">pickRuleKey</span>(e<span class="op">,</span> <span class="bu">String</span>(e<span class="op">.</span><span class="at">StereotypeEx</span><span class="op">||</span><span class="st">""</span>))<span class="op">;</span></span>
<span id="cb7-439"><a href="#cb7-439"></a>        <span class="cf">if</span> (<span class="op">!</span>expectedFQ) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb7-440"><a href="#cb7-440"></a></span>
<span id="cb7-441"><a href="#cb7-441"></a>        <span class="kw">var</span> rule <span class="op">=</span> MDG_RULES[expectedFQ]<span class="op">;</span></span>
<span id="cb7-442"><a href="#cb7-442"></a></span>
<span id="cb7-443"><a href="#cb7-443"></a>        <span class="co">// 1) Enforce stereotype (fully-qualified)</span></span>
<span id="cb7-444"><a href="#cb7-444"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">hasFQStereo</span>(<span class="bu">String</span>(e<span class="op">.</span><span class="at">StereotypeEx</span><span class="op">||</span><span class="st">""</span>)<span class="op">,</span> expectedFQ)) {</span>
<span id="cb7-445"><a href="#cb7-445"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Apply stereotype: "</span> <span class="op">+</span> expectedFQ <span class="op">+</span> <span class="st">" on '"</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb7-446"><a href="#cb7-446"></a>            <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">writeRow</span>([<span class="st">"ApplyStereo"</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementID</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementGUID</span><span class="op">,</span> e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> expectedFQ])<span class="op">;</span></span>
<span id="cb7-447"><a href="#cb7-447"></a>            <span class="cf">if</span> (<span class="op">!</span>DRY_RUN) { e<span class="op">.</span><span class="at">StereotypeEx</span> <span class="op">=</span> <span class="fu">addFQStereo</span>(e<span class="op">.</span><span class="at">StereotypeEx</span><span class="op">,</span> expectedFQ)<span class="op">;</span> e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> changed<span class="op">++;</span> }</span>
<span id="cb7-448"><a href="#cb7-448"></a>        }</span>
<span id="cb7-449"><a href="#cb7-449"></a></span>
<span id="cb7-450"><a href="#cb7-450"></a>        <span class="co">// 2) Ensure required tags (create if missing, fill default if blank)</span></span>
<span id="cb7-451"><a href="#cb7-451"></a>        <span class="cf">for</span> (<span class="kw">var</span> t<span class="op">=</span><span class="dv">0</span><span class="op">;</span> t<span class="op">&lt;</span>rule<span class="op">.</span><span class="at">requiredTags</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> t<span class="op">++</span>) {</span>
<span id="cb7-452"><a href="#cb7-452"></a>            <span class="kw">var</span> tn <span class="op">=</span> rule<span class="op">.</span><span class="at">requiredTags</span>[t]<span class="op">.</span><span class="at">name</span><span class="op">;</span></span>
<span id="cb7-453"><a href="#cb7-453"></a>            <span class="kw">var</span> dv <span class="op">=</span> <span class="bu">String</span>(rule<span class="op">.</span><span class="at">requiredTags</span>[t]<span class="op">.</span><span class="at">defaultValue</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span></span>
<span id="cb7-454"><a href="#cb7-454"></a>            <span class="kw">var</span> cur <span class="op">=</span> <span class="fu">readTag</span>(e<span class="op">,</span> tn)<span class="op">;</span></span>
<span id="cb7-455"><a href="#cb7-455"></a>            <span class="cf">if</span> (<span class="fu">trim</span>(cur) <span class="op">===</span> <span class="st">""</span> <span class="op">&amp;&amp;</span> dv <span class="op">!==</span> <span class="st">""</span>) {</span>
<span id="cb7-456"><a href="#cb7-456"></a>                <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Set tag '"</span> <span class="op">+</span> tn <span class="op">+</span> <span class="st">"'='"</span> <span class="op">+</span> dv <span class="op">+</span> <span class="st">"' on '"</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb7-457"><a href="#cb7-457"></a>                <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">writeRow</span>([<span class="st">"SetTag"</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementID</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementGUID</span><span class="op">,</span> e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> tn<span class="op">+</span><span class="st">"="</span><span class="op">+</span>dv])<span class="op">;</span></span>
<span id="cb7-458"><a href="#cb7-458"></a>                <span class="cf">if</span> (<span class="op">!</span>DRY_RUN) { <span class="fu">writeTag</span>(e<span class="op">,</span> tn<span class="op">,</span> dv)<span class="op">;</span> changed<span class="op">++;</span> }</span>
<span id="cb7-459"><a href="#cb7-459"></a>            } <span class="cf">else</span> <span class="cf">if</span> (cur <span class="op">===</span> <span class="st">""</span>) {</span>
<span id="cb7-460"><a href="#cb7-460"></a>                <span class="co">// missing and no default → warn only</span></span>
<span id="cb7-461"><a href="#cb7-461"></a>                <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">writeRow</span>([<span class="st">"MissingTag"</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementID</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementGUID</span><span class="op">,</span> e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> tn<span class="op">+</span><span class="st">" (no default)"</span>])<span class="op">;</span></span>
<span id="cb7-462"><a href="#cb7-462"></a>            }</span>
<span id="cb7-463"><a href="#cb7-463"></a>        }</span>
<span id="cb7-464"><a href="#cb7-464"></a></span>
<span id="cb7-465"><a href="#cb7-465"></a>        <span class="co">// 3) Naming prefix (optional)</span></span>
<span id="cb7-466"><a href="#cb7-466"></a>        <span class="cf">if</span> (rule<span class="op">.</span><span class="at">namePrefix</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu">startsWith</span>(e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> rule<span class="op">.</span><span class="at">namePrefix</span>)) {</span>
<span id="cb7-467"><a href="#cb7-467"></a>            <span class="kw">var</span> newName <span class="op">=</span> rule<span class="op">.</span><span class="at">namePrefix</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span><span class="op">;</span></span>
<span id="cb7-468"><a href="#cb7-468"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Rename '"</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">"' → '"</span> <span class="op">+</span> newName <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb7-469"><a href="#cb7-469"></a>            <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">writeRow</span>([<span class="st">"Rename"</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementID</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementGUID</span><span class="op">,</span> e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> <span class="st">"→ "</span><span class="op">+</span>newName])<span class="op">;</span></span>
<span id="cb7-470"><a href="#cb7-470"></a>            <span class="cf">if</span> (<span class="op">!</span>DRY_RUN) { e<span class="op">.</span><span class="at">Name</span> <span class="op">=</span> newName<span class="op">;</span> e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> changed<span class="op">++;</span> }</span>
<span id="cb7-471"><a href="#cb7-471"></a>        }</span>
<span id="cb7-472"><a href="#cb7-472"></a>    }</span>
<span id="cb7-473"><a href="#cb7-473"></a></span>
<span id="cb7-474"><a href="#cb7-474"></a>    <span class="cf">if</span> (<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> changed<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(pkg<span class="op">.</span><span class="at">PackageID</span>)<span class="op">;</span></span>
<span id="cb7-475"><a href="#cb7-475"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Repair complete. Changes="</span> <span class="op">+</span> changed <span class="op">+</span> <span class="st">", Dry-run="</span> <span class="op">+</span> DRY_RUN)<span class="op">;</span></span>
<span id="cb7-476"><a href="#cb7-476"></a>}</span>
<span id="cb7-477"><a href="#cb7-477"></a></span>
<span id="cb7-478"><a href="#cb7-478"></a><span class="co">// Helpers (subset specialised for this script)</span></span>
<span id="cb7-479"><a href="#cb7-479"></a><span class="kw">function</span> <span class="fu">pickRuleKey</span>(e<span class="op">,</span> applied){ <span class="kw">var</span> keys<span class="op">=</span><span class="fu">keysOf</span>(MDG_RULES)<span class="op">;</span> <span class="kw">var</span> i<span class="op">;</span></span>
<span id="cb7-480"><a href="#cb7-480"></a>    <span class="cf">for</span>(i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>keys<span class="op">.</span><span class="at">length</span><span class="op">;</span>i<span class="op">++</span>) <span class="cf">if</span>(<span class="fu">hasFQStereo</span>(applied<span class="op">,</span> keys[i])) <span class="cf">return</span> keys[i]<span class="op">;</span></span>
<span id="cb7-481"><a href="#cb7-481"></a>    <span class="co">// optional baseType inference</span></span>
<span id="cb7-482"><a href="#cb7-482"></a>    <span class="kw">var</span> chosen<span class="op">=</span><span class="kw">null</span><span class="op">;</span> <span class="cf">for</span>(i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>keys<span class="op">.</span><span class="at">length</span><span class="op">;</span>i<span class="op">++</span>){ <span class="kw">var</span> r<span class="op">=</span>MDG_RULES[keys[i]]<span class="op">;</span> <span class="cf">if</span>(r<span class="op">.</span><span class="at">baseType</span> <span class="op">&amp;&amp;</span> r<span class="op">.</span><span class="at">baseType</span><span class="op">==</span>e<span class="op">.</span><span class="at">Type</span>){ <span class="cf">if</span>(chosen <span class="op">&amp;&amp;</span> chosen<span class="op">!=</span>keys[i]) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span> chosen<span class="op">=</span>keys[i]<span class="op">;</span> } }</span>
<span id="cb7-483"><a href="#cb7-483"></a>    <span class="cf">return</span> chosen<span class="op">;</span></span>
<span id="cb7-484"><a href="#cb7-484"></a>}</span>
<span id="cb7-485"><a href="#cb7-485"></a><span class="kw">function</span> <span class="fu">hasFQStereo</span>(applied<span class="op">,</span> fq){ <span class="kw">var</span> items<span class="op">=</span><span class="bu">String</span>(applied<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">;</span> <span class="cf">for</span>(<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>items<span class="op">.</span><span class="at">length</span><span class="op">;</span>i<span class="op">++</span>){ <span class="cf">if</span>(<span class="fu">equalsIgnoreCase</span>(<span class="fu">trim</span>(items[i])<span class="op">,</span>fq)) <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span> } <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span>}</span>
<span id="cb7-486"><a href="#cb7-486"></a><span class="kw">function</span> <span class="fu">addFQStereo</span>(current<span class="op">,</span> fq){ current<span class="op">=</span><span class="bu">String</span>(current<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span> <span class="cf">if</span>(current<span class="op">===</span><span class="st">""</span>) <span class="cf">return</span> fq<span class="op">;</span> <span class="kw">var</span> items<span class="op">=</span>current<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">,</span>i<span class="op">;</span> <span class="cf">for</span>(i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>items<span class="op">.</span><span class="at">length</span><span class="op">;</span>i<span class="op">++</span>){ <span class="cf">if</span>(<span class="fu">equalsIgnoreCase</span>(<span class="fu">trim</span>(items[i])<span class="op">,</span>fq)) <span class="cf">return</span> current<span class="op">;</span> } <span class="cf">return</span> current <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> fq<span class="op">;</span>}</span>
<span id="cb7-487"><a href="#cb7-487"></a><span class="kw">function</span> <span class="fu">readTag</span>(e<span class="op">,</span> name){ <span class="kw">var</span> tvs<span class="op">=</span>e<span class="op">.</span><span class="at">TaggedValues</span><span class="op">;</span> <span class="cf">for</span>(<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>tvs<span class="op">.</span><span class="at">Count</span><span class="op">;</span>i<span class="op">++</span>){ <span class="kw">var</span> tv<span class="op">=</span>tvs<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span> <span class="cf">if</span>(<span class="fu">equalsIgnoreCase</span>(tv<span class="op">.</span><span class="at">Name</span><span class="op">,</span>name)) <span class="cf">return</span> <span class="bu">String</span>(tv<span class="op">.</span><span class="at">Value</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span> } <span class="cf">return</span> <span class="st">""</span><span class="op">;</span> }</span>
<span id="cb7-488"><a href="#cb7-488"></a><span class="kw">function</span> <span class="fu">writeTag</span>(e<span class="op">,</span> name<span class="op">,</span> value){ <span class="kw">var</span> tvs<span class="op">=</span>e<span class="op">.</span><span class="at">TaggedValues</span><span class="op">,</span> i<span class="op">;</span> <span class="cf">for</span>(i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>tvs<span class="op">.</span><span class="at">Count</span><span class="op">;</span>i<span class="op">++</span>){ <span class="kw">var</span> tv<span class="op">=</span>tvs<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span> <span class="cf">if</span>(<span class="fu">equalsIgnoreCase</span>(tv<span class="op">.</span><span class="at">Name</span><span class="op">,</span>name)){ tv<span class="op">.</span><span class="at">Value</span><span class="op">=</span><span class="bu">String</span>(value)<span class="op">;</span> tv<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> } } <span class="kw">var</span> nt<span class="op">=</span>tvs<span class="op">.</span><span class="fu">AddNew</span>(name<span class="op">,</span><span class="bu">String</span>(value))<span class="op">;</span> nt<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> }</span>
<span id="cb7-489"><a href="#cb7-489"></a><span class="kw">function</span> <span class="fu">keysOf</span>(o){ <span class="kw">var</span> r<span class="op">=</span>[]<span class="op">,</span>k<span class="op">;</span> <span class="cf">for</span>(k <span class="kw">in</span> o){ <span class="cf">if</span>(o<span class="op">.</span><span class="fu">hasOwnProperty</span>(k)) r<span class="op">.</span><span class="fu">push</span>(k)<span class="op">;</span>} <span class="cf">return</span> r<span class="op">;</span> }</span>
<span id="cb7-490"><a href="#cb7-490"></a></span>
<span id="cb7-491"><a href="#cb7-491"></a><span class="fu">main</span>()<span class="op">;</span></span>
<span id="cb7-492"><a href="#cb7-492"></a><span class="in">```</span></span>
<span id="cb7-493"><a href="#cb7-493"></a></span>
<span id="cb7-494"><a href="#cb7-494"></a><span class="fu">### Validating toolbox conformance (lightweight)</span></span>
<span id="cb7-495"><a href="#cb7-495"></a></span>
<span id="cb7-496"><a href="#cb7-496"></a>You usually enforce toolbox usage **indirectly**:</span>
<span id="cb7-497"><a href="#cb7-497"></a></span>
<span id="cb7-498"><a href="#cb7-498"></a><span class="ss">- </span>**Base type** matches your profile expectation (e.g., Class).</span>
<span id="cb7-499"><a href="#cb7-499"></a></span>
<span id="cb7-500"><a href="#cb7-500"></a><span class="ss">- </span>**Stereotype** is the one from your profile (profile::stereo).</span>
<span id="cb7-501"><a href="#cb7-501"></a></span>
<span id="cb7-502"><a href="#cb7-502"></a><span class="ss">- </span>**Required tags** exist (often defined by your MDG).</span>
<span id="cb7-503"><a href="#cb7-503"></a></span>
<span id="cb7-504"><a href="#cb7-504"></a>If all three pass, the modeller effectively used your toolbox.</span>
<span id="cb7-505"><a href="#cb7-505"></a></span>
<span id="cb7-506"><a href="#cb7-506"></a>For stricter checks, you can augment the rulebook with **allowed</span>
<span id="cb7-507"><a href="#cb7-507"></a>connector types** and **required relationships** per stereotype, then</span>
<span id="cb7-508"><a href="#cb7-508"></a>lint them the same way.</span>
<span id="cb7-509"><a href="#cb7-509"></a></span>
<span id="cb7-510"><a href="#cb7-510"></a><span class="in">```{.js filename="Example 10.5 - Add to MDG_RULES:"}</span></span>
<span id="cb7-511"><a href="#cb7-511"></a><span class="co">// Example 10.5 - Add to MDG_RULES:</span></span>
<span id="cb7-512"><a href="#cb7-512"></a><span class="st">"MyProfile::BusinessCapability"</span><span class="op">:</span> {</span>
<span id="cb7-513"><a href="#cb7-513"></a>  <span class="dt">baseType</span><span class="op">:</span> <span class="st">"Class"</span><span class="op">,</span></span>
<span id="cb7-514"><a href="#cb7-514"></a>  <span class="dt">requiredTags</span><span class="op">:</span> [{<span class="dt">name</span><span class="op">:</span><span class="st">"Owner"</span><span class="op">,</span> <span class="dt">defaultValue</span><span class="op">:</span><span class="st">"ArchitectureTeam"</span>}]<span class="op">,</span></span>
<span id="cb7-515"><a href="#cb7-515"></a>  <span class="dt">namePrefix</span><span class="op">:</span> <span class="st">"BC_"</span><span class="op">,</span></span>
<span id="cb7-516"><a href="#cb7-516"></a>  <span class="dt">requiresOutgoing</span><span class="op">:</span> [ { <span class="dt">type</span><span class="op">:</span><span class="st">"Realization"</span><span class="op">,</span> <span class="dt">toStereo</span><span class="op">:</span><span class="st">"MyProfile::ApplicationService"</span> } ]</span>
<span id="cb7-517"><a href="#cb7-517"></a>}</span>
<span id="cb7-518"><a href="#cb7-518"></a>Then <span class="kw">in</span> your linter<span class="op">:</span></span>
<span id="cb7-519"><a href="#cb7-519"></a><span class="co">// After tag checks:</span></span>
<span id="cb7-520"><a href="#cb7-520"></a><span class="cf">if</span> (rule<span class="op">.</span><span class="at">requiresOutgoing</span>) {</span>
<span id="cb7-521"><a href="#cb7-521"></a>    <span class="cf">for</span> (<span class="kw">var</span> r<span class="op">=</span><span class="dv">0</span><span class="op">;</span> r<span class="op">&lt;</span>rule<span class="op">.</span><span class="at">requiresOutgoing</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> r<span class="op">++</span>) {</span>
<span id="cb7-522"><a href="#cb7-522"></a>        <span class="kw">var</span> req <span class="op">=</span> rule<span class="op">.</span><span class="at">requiresOutgoing</span>[r]<span class="op">;</span></span>
<span id="cb7-523"><a href="#cb7-523"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">hasOutgoing</span>(e<span class="op">,</span> req<span class="op">.</span><span class="at">type</span><span class="op">,</span> req<span class="op">.</span><span class="at">toStereo</span>)) {</span>
<span id="cb7-524"><a href="#cb7-524"></a>            issues <span class="op">+=</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> applied<span class="op">,</span> <span class="st">"MissingLink"</span><span class="op">,</span></span>
<span id="cb7-525"><a href="#cb7-525"></a>                <span class="st">"Require outgoing "</span> <span class="op">+</span> req<span class="op">.</span><span class="at">type</span> <span class="op">+</span> <span class="st">" to "</span> <span class="op">+</span> req<span class="op">.</span><span class="at">toStereo</span><span class="op">,</span> expectedFQ)<span class="op">;</span></span>
<span id="cb7-526"><a href="#cb7-526"></a>        }</span>
<span id="cb7-527"><a href="#cb7-527"></a>    }</span>
<span id="cb7-528"><a href="#cb7-528"></a>}</span>
<span id="cb7-529"><a href="#cb7-529"></a><span class="kw">function</span> <span class="fu">hasOutgoing</span>(e<span class="op">,</span> connType<span class="op">,</span> toFQStereo){</span>
<span id="cb7-530"><a href="#cb7-530"></a>    <span class="kw">var</span> cons <span class="op">=</span> e<span class="op">.</span><span class="at">Connectors</span><span class="op">;</span></span>
<span id="cb7-531"><a href="#cb7-531"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>cons<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb7-532"><a href="#cb7-532"></a>        <span class="kw">var</span> c <span class="op">=</span> cons<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb7-533"><a href="#cb7-533"></a>        <span class="cf">if</span> (c<span class="op">.</span><span class="at">Type</span> <span class="op">!=</span> connType) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb7-534"><a href="#cb7-534"></a>        <span class="kw">var</span> supplier <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetElementByID</span>(c<span class="op">.</span><span class="at">SupplierID</span>)<span class="op">;</span></span>
<span id="cb7-535"><a href="#cb7-535"></a>        <span class="cf">if</span> (<span class="op">!</span>supplier) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb7-536"><a href="#cb7-536"></a>        <span class="cf">if</span> (<span class="fu">hasFQStereo</span>(<span class="bu">String</span>(supplier<span class="op">.</span><span class="at">StereotypeEx</span><span class="op">||</span><span class="st">""</span>)<span class="op">,</span> toFQStereo)) <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb7-537"><a href="#cb7-537"></a>    }</span>
<span id="cb7-538"><a href="#cb7-538"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb7-539"><a href="#cb7-539"></a>}</span>
<span id="cb7-540"><a href="#cb7-540"></a><span class="in">```</span></span>
<span id="cb7-541"><a href="#cb7-541"></a></span>
<span id="cb7-542"><a href="#cb7-542"></a><span class="fu">### Bulk discovery using SQL (fast find, safe check)</span></span>
<span id="cb7-543"><a href="#cb7-543"></a></span>
<span id="cb7-544"><a href="#cb7-544"></a>On very large repositories, **find with SQL** then verify via the API.</span>
<span id="cb7-545"><a href="#cb7-545"></a></span>
<span id="cb7-546"><a href="#cb7-546"></a><span class="in">```{.js filename="Example 10.6 - MDG_SQL_FindMissingTag.js – JScript (ES3)"}</span></span>
<span id="cb7-547"><a href="#cb7-547"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb7-548"><a href="#cb7-548"></a><span class="co">// Example 10.6 - MDG_SQL_FindMissingTag.js – JScript (ES3)</span></span>
<span id="cb7-549"><a href="#cb7-549"></a><span class="co">// Purpose: Pre-filter candidates with SQL, then verify with API</span></span>
<span id="cb7-550"><a href="#cb7-550"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb7-551"><a href="#cb7-551"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb7-552"><a href="#cb7-552"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb7-553"><a href="#cb7-553"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">MDG_Rulebook</span></span>
<span id="cb7-554"><a href="#cb7-554"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb7-555"><a href="#cb7-555"></a>    <span class="kw">var</span> TAB<span class="op">=</span><span class="st">"MDG_SQL_Find"</span><span class="op">;</span></span>
<span id="cb7-556"><a href="#cb7-556"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb7-557"><a href="#cb7-557"></a></span>
<span id="cb7-558"><a href="#cb7-558"></a>    <span class="kw">var</span> key <span class="op">=</span> <span class="st">"MyProfile::BusinessCapability"</span><span class="op">;</span></span>
<span id="cb7-559"><a href="#cb7-559"></a>    <span class="kw">var</span> rule <span class="op">=</span> MDG_RULES[key]<span class="op">;</span></span>
<span id="cb7-560"><a href="#cb7-560"></a>    <span class="kw">var</span> tagName <span class="op">=</span> <span class="st">"Owner"</span><span class="op">;</span></span>
<span id="cb7-561"><a href="#cb7-561"></a></span>
<span id="cb7-562"><a href="#cb7-562"></a>    <span class="co">// Fast repo-wide prefilter: base type &amp; stereotype absent or wrong (rough)</span></span>
<span id="cb7-563"><a href="#cb7-563"></a>    <span class="co">// </span><span class="al">NOTE</span><span class="co">: Stereotypes are stored in multiple places; we prefilter by type and post-check StereotypeEx via API.</span></span>
<span id="cb7-564"><a href="#cb7-564"></a>    <span class="kw">var</span> sql <span class="op">=</span> <span class="st">"SELECT Object_ID FROM t_object WHERE Object_Type='"</span> <span class="op">+</span> rule<span class="op">.</span><span class="at">baseType</span> <span class="op">+</span> <span class="st">"'"</span><span class="op">;</span></span>
<span id="cb7-565"><a href="#cb7-565"></a>    <span class="kw">var</span> xml <span class="op">=</span> Repository<span class="op">.</span><span class="fu">SQLQuery</span>(sql)<span class="op">;</span></span>
<span id="cb7-566"><a href="#cb7-566"></a>    <span class="kw">var</span> ids <span class="op">=</span> <span class="fu">extractAll</span>(xml<span class="op">,</span> <span class="st">"&lt;Object_ID&gt;"</span><span class="op">,</span> <span class="st">"&lt;/Object_ID&gt;"</span>)<span class="op">;</span></span>
<span id="cb7-567"><a href="#cb7-567"></a>    <span class="kw">var</span> offenders <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-568"><a href="#cb7-568"></a></span>
<span id="cb7-569"><a href="#cb7-569"></a>    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>ids<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb7-570"><a href="#cb7-570"></a>        <span class="kw">var</span> el <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetElementByID</span>(<span class="pp">parseInt</span>(ids[i]<span class="op">,</span><span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb7-571"><a href="#cb7-571"></a>        <span class="cf">if</span> (<span class="op">!</span>el) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb7-572"><a href="#cb7-572"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">hasFQ</span>(<span class="bu">String</span>(el<span class="op">.</span><span class="at">StereotypeEx</span><span class="op">||</span><span class="st">""</span>)<span class="op">,</span> key)) <span class="cf">continue</span><span class="op">;</span> <span class="co">// truly in scope</span></span>
<span id="cb7-573"><a href="#cb7-573"></a>        <span class="kw">var</span> tv <span class="op">=</span> <span class="fu">readTag</span>(el<span class="op">,</span> tagName)<span class="op">;</span></span>
<span id="cb7-574"><a href="#cb7-574"></a>        <span class="cf">if</span> (<span class="fu">trim</span>(tv) <span class="op">===</span> <span class="st">""</span>) {</span>
<span id="cb7-575"><a href="#cb7-575"></a>            offenders<span class="op">++;</span></span>
<span id="cb7-576"><a href="#cb7-576"></a>            Session<span class="op">.</span><span class="fu">Output</span>(<span class="st">"Missing tag '"</span> <span class="op">+</span> tagName <span class="op">+</span> <span class="st">"': "</span> <span class="op">+</span> el<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">" ("</span> <span class="op">+</span> el<span class="op">.</span><span class="at">ElementID</span> <span class="op">+</span> <span class="st">")"</span>)<span class="op">;</span></span>
<span id="cb7-577"><a href="#cb7-577"></a>        }</span>
<span id="cb7-578"><a href="#cb7-578"></a>    }</span>
<span id="cb7-579"><a href="#cb7-579"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Offenders (missing "</span><span class="op">+</span>tagName<span class="op">+</span><span class="st">"): "</span> <span class="op">+</span> offenders)<span class="op">;</span></span>
<span id="cb7-580"><a href="#cb7-580"></a>}</span>
<span id="cb7-581"><a href="#cb7-581"></a></span>
<span id="cb7-582"><a href="#cb7-582"></a><span class="kw">function</span> <span class="fu">extractAll</span>(h<span class="op">,</span>a<span class="op">,</span>b){ <span class="kw">var</span> r<span class="op">=</span>[]<span class="op">,</span>s<span class="op">=</span><span class="dv">0</span><span class="op">;</span> <span class="cf">while</span>(<span class="kw">true</span>){ <span class="kw">var</span> i<span class="op">=</span>h<span class="op">.</span><span class="fu">indexOf</span>(a<span class="op">,</span>s)<span class="op">;</span> <span class="cf">if</span>(i<span class="op">&lt;</span><span class="dv">0</span>) <span class="cf">break</span><span class="op">;</span> <span class="kw">var</span> j<span class="op">=</span>h<span class="op">.</span><span class="fu">indexOf</span>(b<span class="op">,</span>i<span class="op">+</span>a<span class="op">.</span><span class="at">length</span>)<span class="op">;</span> <span class="cf">if</span>(j<span class="op">&lt;</span><span class="dv">0</span>) <span class="cf">break</span><span class="op">;</span> r<span class="op">.</span><span class="fu">push</span>(h<span class="op">.</span><span class="fu">substring</span>(i<span class="op">+</span>a<span class="op">.</span><span class="at">length</span><span class="op">,</span>j))<span class="op">;</span> s<span class="op">=</span>j<span class="op">+</span>b<span class="op">.</span><span class="at">length</span><span class="op">;</span> } <span class="cf">return</span> r<span class="op">;</span> }</span>
<span id="cb7-583"><a href="#cb7-583"></a><span class="kw">function</span> <span class="fu">hasFQ</span>(applied<span class="op">,</span>fq){ <span class="kw">var</span> arr<span class="op">=</span><span class="bu">String</span>(applied<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">;</span> <span class="cf">for</span>(<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>arr<span class="op">.</span><span class="at">length</span><span class="op">;</span>i<span class="op">++</span>){ <span class="cf">if</span>(<span class="fu">equalsIgnoreCase</span>(<span class="fu">trim</span>(arr[i])<span class="op">,</span>fq)) <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span> } <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span> }</span>
<span id="cb7-584"><a href="#cb7-584"></a><span class="kw">function</span> <span class="fu">readTag</span>(e<span class="op">,</span>n){ <span class="kw">var</span> tvs<span class="op">=</span>e<span class="op">.</span><span class="at">TaggedValues</span><span class="op">;</span> <span class="cf">for</span>(<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>tvs<span class="op">.</span><span class="at">Count</span><span class="op">;</span>i<span class="op">++</span>){ <span class="kw">var</span> t<span class="op">=</span>tvs<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span> <span class="cf">if</span>(<span class="fu">equalsIgnoreCase</span>(t<span class="op">.</span><span class="at">Name</span><span class="op">,</span>n)) <span class="cf">return</span> <span class="bu">String</span>(t<span class="op">.</span><span class="at">Value</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span> } <span class="cf">return</span> <span class="st">""</span><span class="op">;</span> }</span>
<span id="cb7-585"><a href="#cb7-585"></a></span>
<span id="cb7-586"><a href="#cb7-586"></a><span class="fu">main</span>()<span class="op">;</span></span>
<span id="cb7-587"><a href="#cb7-587"></a><span class="in">```</span></span>
<span id="cb7-588"><a href="#cb7-588"></a></span>
<span id="cb7-589"><a href="#cb7-589"></a><span class="fu">## Safety &amp; governance notes</span></span>
<span id="cb7-590"><a href="#cb7-590"></a></span>
<span id="cb7-591"><a href="#cb7-591"></a><span class="ss">- </span>Always prefer StereotypeEx for MDG accuracy.</span>
<span id="cb7-592"><a href="#cb7-592"></a></span>
<span id="cb7-593"><a href="#cb7-593"></a><span class="ss">- </span>Never raw-update MDG metadata in EA tables unless you absolutely must</span>
<span id="cb7-594"><a href="#cb7-594"></a>  (and then only when you fully understand the schema).</span>
<span id="cb7-595"><a href="#cb7-595"></a></span>
<span id="cb7-596"><a href="#cb7-596"></a><span class="ss">- </span>Centralise rules in a small “rulebook” map; your linter and repairer</span>
<span id="cb7-597"><a href="#cb7-597"></a>  both use it.</span>
<span id="cb7-598"><a href="#cb7-598"></a></span>
<span id="cb7-599"><a href="#cb7-599"></a><span class="ss">- </span>Dry-run first and log CSVs of changes for audit.</span>
<span id="cb7-600"><a href="#cb7-600"></a></span>
<span id="cb7-601"><a href="#cb7-601"></a><span class="ss">- </span>Use SQL to find, API to fix at scale.</span>
<span id="cb7-602"><a href="#cb7-602"></a></span>
<span id="cb7-603"><a href="#cb7-603"></a><span class="fu">## What to use when (cheat-sheet)</span></span>
<span id="cb7-604"><a href="#cb7-604"></a></span>
<span id="cb7-605"><a href="#cb7-605"></a><span class="ss">- </span>**Apply a profile stereotype** to many items → Example 10.1.</span>
<span id="cb7-606"><a href="#cb7-606"></a></span>
<span id="cb7-607"><a href="#cb7-607"></a><span class="ss">- </span>**Report MDG drift** (tags/names/stereos) → Example 10.3 (linter).</span>
<span id="cb7-608"><a href="#cb7-608"></a></span>
<span id="cb7-609"><a href="#cb7-609"></a><span class="ss">- </span>**Fix drift** with defaults and renaming → Example 10.4 (repairer).</span>
<span id="cb7-610"><a href="#cb7-610"></a></span>
<span id="cb7-611"><a href="#cb7-611"></a><span class="ss">- </span>**Enforce relationships** between MDG types → 10.5 extension.</span>
<span id="cb7-612"><a href="#cb7-612"></a></span>
<span id="cb7-613"><a href="#cb7-613"></a><span class="ss">- </span>**Huge repositories** → 10.6 SQL pre-filter + API verification.</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>