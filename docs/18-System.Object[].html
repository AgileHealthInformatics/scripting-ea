<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>18&nbsp; Chapter 17: Performance &amp; Scaling – Scripting Sparx Enterprise Architect: A Practical Handbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./19-System.Object[].html" rel="next">
<link href="./17-System.Object[].html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-b4ddde2c4c77ed14ccfa95278770da4f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./18-System.Object[].html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Chapter 17: Performance &amp; Scaling</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Scripting Sparx Enterprise Architect: A Practical Handbook</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Scripting Sparx Enterprise Architect</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Chapter 1: Why Script EA?</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Chapter 2: Automation Landscape</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Chapter 3: Getting Started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Chapter 4: API Essentials</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Chapter 5: Inside EA with JScript</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Chapter 6: External Automation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Chapter 7: Script Design Patterns</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Chapter 8: Object Details</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Chapter 9: Imports &amp; Exports</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Chapter 10: MDG-Aware Scripting</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Chapter 11: Governance Scripts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Chapter 12: Cookbook of Examples</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Chapter 13: Why AI Helps</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Chapter 14: Prompt Engineering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Chapter 15: AI Refactoring Partner</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Chapter 16: AI in Daily Workflow</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-System.Object[].html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Chapter 17: Performance &amp; Scaling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Chapter 18: Integrating with Workflows</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Chapter 19: Add-ins vs Scripts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Chapter 20: Troubleshooting</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Chapter 21: Reference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Appendix A: Scripting Constraints</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Appendix B: External Automation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Appendix C: Glossary of Terms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Appendix D: Quick Reference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Appendix E: External Automation Setup</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#why-performance-matters" id="toc-why-performance-matters" class="nav-link active" data-scroll-target="#why-performance-matters"><span class="header-section-number">18.1</span> Why Performance Matters</a></li>
  <li><a href="#sources-of-slowness" id="toc-sources-of-slowness" class="nav-link" data-scroll-target="#sources-of-slowness"><span class="header-section-number">18.2</span> Sources of Slowness</a></li>
  <li><a href="#measure-first" id="toc-measure-first" class="nav-link" data-scroll-target="#measure-first"><span class="header-section-number">18.3</span> Measure First</a></li>
  <li><a href="#tips" id="toc-tips" class="nav-link" data-scroll-target="#tips"><span class="header-section-number">18.4</span> Tips</a>
  <ul class="collapse">
  <li><a href="#sql-for-find-api-for-write" id="toc-sql-for-find-api-for-write" class="nav-link" data-scroll-target="#sql-for-find-api-for-write"><span class="header-section-number">18.4.1</span> SQL for Find, API for Write</a></li>
  <li><a href="#chunking-updates" id="toc-chunking-updates" class="nav-link" data-scroll-target="#chunking-updates"><span class="header-section-number">18.4.2</span> Chunking Updates</a></li>
  <li><a href="#iterative-traversal" id="toc-iterative-traversal" class="nav-link" data-scroll-target="#iterative-traversal"><span class="header-section-number">18.4.3</span> Iterative Traversal</a></li>
  <li><a href="#idempotence-and-skipping" id="toc-idempotence-and-skipping" class="nav-link" data-scroll-target="#idempotence-and-skipping"><span class="header-section-number">18.4.4</span> Idempotence and Skipping</a></li>
  <li><a href="#logging-without-flooding" id="toc-logging-without-flooding" class="nav-link" data-scroll-target="#logging-without-flooding"><span class="header-section-number">18.4.5</span> Logging Without Flooding</a></li>
  <li><a href="#external-automation-for-heavy-jobs" id="toc-external-automation-for-heavy-jobs" class="nav-link" data-scroll-target="#external-automation-for-heavy-jobs"><span class="header-section-number">18.4.6</span> External Automation for Heavy Jobs</a></li>
  </ul></li>
  <li><a href="#principles" id="toc-principles" class="nav-link" data-scroll-target="#principles"><span class="header-section-number">18.5</span> Principles</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="header-section-number">18.6</span> Examples</a>
  <ul class="collapse">
  <li><a href="#micro-helpers-copypaste-as-needed" id="toc-micro-helpers-copypaste-as-needed" class="nav-link" data-scroll-target="#micro-helpers-copypaste-as-needed"><span class="header-section-number">18.6.1</span> Micro-helpers (copy/paste as needed)</a></li>
  <li><a href="#pattern-c-iterative-package-traversal-no-recursion" id="toc-pattern-c-iterative-package-traversal-no-recursion" class="nav-link" data-scroll-target="#pattern-c-iterative-package-traversal-no-recursion"><span class="header-section-number">18.6.2</span> Pattern C — Iterative Package Traversal (no recursion)</a></li>
  <li><a href="#pattern-d-large-csv-apply-streaming-batching" id="toc-pattern-d-large-csv-apply-streaming-batching" class="nav-link" data-scroll-target="#pattern-d-large-csv-apply-streaming-batching"><span class="header-section-number">18.6.3</span> Pattern D — Large CSV Apply (streaming + batching)</a></li>
  <li><a href="#pattern-e-repository-wide-exists-checks-via-sql" id="toc-pattern-e-repository-wide-exists-checks-via-sql" class="nav-link" data-scroll-target="#pattern-e-repository-wide-exists-checks-via-sql"><span class="header-section-number">18.6.4</span> Pattern E — Repository-wide “Exists?” checks via SQL</a></li>
  <li><a href="#pattern-f-external-python-for-heavy-lifting" id="toc-pattern-f-external-python-for-heavy-lifting" class="nav-link" data-scroll-target="#pattern-f-external-python-for-heavy-lifting"><span class="header-section-number">18.6.5</span> Pattern F — External Python for Heavy Lifting</a></li>
  </ul></li>
  <li><a href="#dos-donts-cheat-sheet" id="toc-dos-donts-cheat-sheet" class="nav-link" data-scroll-target="#dos-donts-cheat-sheet"><span class="header-section-number">18.7</span> Dos &amp; Don’ts (cheat-sheet)</a></li>
  <li><a href="#putting-it-together" id="toc-putting-it-together" class="nav-link" data-scroll-target="#putting-it-together"><span class="header-section-number">18.8</span> Putting It Together</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Chapter 17: Performance &amp; Scaling</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Enterprise Architect is used in contexts that range from small projects to national architectures. In small repositories with a few hundred elements, scripting feels instant and forgiving. But as repositories grow to tens of thousands or even hundreds of thousands of elements, performance becomes a real concern. A script that works perfectly in a sandbox may take hours, or even crash EA, when run against an enterprise-scale repository.</p>
<p>This chapter explores the principles of performance and scaling in EA scripting. It explains why large repositories behave differently, why naive loops and excessive logging cause problems, and how to design scripts that handle scale safely. The goal is not to turn you into a performance engineer, but to provide practical strategies that let your scripts run efficiently on real-world repositories.</p>
<section id="why-performance-matters" class="level2" data-number="18.1">
<h2 data-number="18.1" class="anchored" data-anchor-id="why-performance-matters"><span class="header-section-number">18.1</span> Why Performance Matters</h2>
<p>At first glance, performance might seem secondary. After all, scripts are automation — even if they take a few minutes, they still save hours of manual effort. But in practice, performance is about more than speed. Poorly written scripts can:</p>
<ul>
<li><p><strong>Lock up EA’s UI</strong>, frustrating other users.</p></li>
<li><p><strong>Generate incomplete results</strong>, skipping elements when loops break.</p></li>
<li><p><strong>Produce overwhelming logs</strong>, flooding the Output tab and crashing EA.</p></li>
<li><p><strong>Time out in enterprise workflows</strong>, failing integration pipelines.</p></li>
</ul>
<p>Performance is therefore about reliability as well as speed. Scripts that scale are scripts that can be trusted.</p>
</section>
<section id="sources-of-slowness" class="level2" data-number="18.2">
<h2 data-number="18.2" class="anchored" data-anchor-id="sources-of-slowness"><span class="header-section-number">18.2</span> Sources of Slowness</h2>
<p>There are a few common culprits for slow scripts:</p>
<ul>
<li><p><strong>UI logging</strong>: Session.Output is surprisingly expensive when called thousands of times.</p></li>
<li><p><strong>Inefficient traversal</strong>: deep recursion or redundant queries slow scripts down.</p></li>
<li><p><strong>Excessive updates</strong>: calling .Update() unnecessarily adds overhead.</p></li>
<li><p><strong>Unfiltered loops</strong>: traversing everything when only a subset is needed.</p></li>
<li><p><strong>SQL misuse</strong>: failing to use SQL for large reads, or misusing SQL for writes.</p></li>
</ul>
<p>Understanding these bottlenecks is the first step to avoiding them.</p>
</section>
<section id="measure-first" class="level2" data-number="18.3">
<h2 data-number="18.3" class="anchored" data-anchor-id="measure-first"><span class="header-section-number">18.3</span> Measure First</h2>
<p>The golden rule of performance is: <strong>measure before you optimise</strong>. In scripting, this means timing your loops and logging throughput. For example, processing 10,000 elements in 5 seconds is healthy; in 50 minutes, it is not. By measuring, you can identify where the script spends most of its time.</p>
<p>In practice, you can use simple timers (Date().getTime() in JScript) to record how long operations take. Always include performance metrics in your logs.</p>
</section>
<section id="tips" class="level2" data-number="18.4">
<h2 data-number="18.4" class="anchored" data-anchor-id="tips"><span class="header-section-number">18.4</span> Tips</h2>
<section id="sql-for-find-api-for-write" class="level3" data-number="18.4.1">
<h3 data-number="18.4.1" class="anchored" data-anchor-id="sql-for-find-api-for-write"><span class="header-section-number">18.4.1</span> SQL for Find, API for Write</h3>
<p>One of the most effective performance strategies is:</p>
<ul>
<li><p><strong>Find with SQL</strong>: use Repository.SQLQuery to locate candidates quickly.</p></li>
<li><p><strong>Write with API</strong>: use EA’s object model for updates, ensuring integrity.</p></li>
</ul>
<p>SQL queries are far faster than traversing the entire package tree with .Count/.GetAt(). But writing directly via SQL risks corruption. The combination of SQL reads and API writes gives the best of both worlds.</p>
</section>
<section id="chunking-updates" class="level3" data-number="18.4.2">
<h3 data-number="18.4.2" class="anchored" data-anchor-id="chunking-updates"><span class="header-section-number">18.4.2</span> Chunking Updates</h3>
<p>Large updates should be chunked. Updating thousands of elements in one continuous loop can overwhelm EA’s UI and lock it up. Instead, process in batches — for example, 250 elements at a time — and refresh the model view between batches.</p>
<p>This chunking approach improves responsiveness and reduces the risk of EA appearing frozen. It also makes logs easier to review.</p>
</section>
<section id="iterative-traversal" class="level3" data-number="18.4.3">
<h3 data-number="18.4.3" class="anchored" data-anchor-id="iterative-traversal"><span class="header-section-number">18.4.3</span> Iterative Traversal</h3>
<p>Recursion is elegant but risky in large models. Deep package trees can hit recursion limits or create excessive stack usage. Iterative traversal using a queue (breadth-first) is safer and more scalable. It avoids call-stack overflows and makes the traversal logic clearer.</p>
</section>
<section id="idempotence-and-skipping" class="level3" data-number="18.4.4">
<h3 data-number="18.4.4" class="anchored" data-anchor-id="idempotence-and-skipping"><span class="header-section-number">18.4.4</span> Idempotence and Skipping</h3>
<p>Performance is not only about speed but also about avoiding unnecessary work. If an element already has the correct stereotype or tag, there is no need to update it. Idempotent scripts — those that skip items already in the correct state — run faster and reduce risk.</p>
</section>
<section id="logging-without-flooding" class="level3" data-number="18.4.5">
<h3 data-number="18.4.5" class="anchored" data-anchor-id="logging-without-flooding"><span class="header-section-number">18.4.5</span> Logging Without Flooding</h3>
<p>Logging is vital for safety, but excessive logging kills performance. Writing 50,000 lines to EA’s Output tab can freeze the tool. The safe practice is to log <strong>summary to Output</strong> and <strong>details to CSV</strong>. This gives you transparency without choking the UI.</p>
</section>
<section id="external-automation-for-heavy-jobs" class="level3" data-number="18.4.6">
<h3 data-number="18.4.6" class="anchored" data-anchor-id="external-automation-for-heavy-jobs"><span class="header-section-number">18.4.6</span> External Automation for Heavy Jobs</h3>
<p>Sometimes the best way to scale is to move heavy jobs outside EA. External automation in Python or C# can handle large CSVs, JSON, or analytics, leaving EA to focus on updates. Splitting work this way makes scripts leaner and safer.</p>
</section>
</section>
<section id="principles" class="level2" data-number="18.5">
<h2 data-number="18.5" class="anchored" data-anchor-id="principles"><span class="header-section-number">18.5</span> Principles</h2>
<ol type="1">
<li><p><strong>Measure</strong>: time the script and log throughput (items/sec).</p></li>
<li><p><strong>Reduce UI overhead</strong>: write to a file (CSV) instead of spamming Output; refresh UI only once at the end or per large batch.</p></li>
<li><p><strong>Find with SQL, write with API</strong>: SQL is fast for locating candidates; API is safe for updates.</p></li>
<li><p><strong>Chunk</strong>: commit changes in batches (e.g., 250); between batches, give EA a chance to breathe (optional UI refresh).</p></li>
<li><p><strong>Iterative traversal</strong>: avoid deep recursion; use a queue/stack to walk package trees.</p></li>
<li><p><strong>Be idempotent</strong>: skip items already in the desired state.</p></li>
<li><p><strong>No parallelism</strong>: EA’s COM server is single-threaded STA—concurrency won’t help.</p></li>
</ol>
<p>All examples below are <strong>ES3</strong> and assume no shared helper file; each script includes its own minimal helpers.</p>
</section>
<section id="examples" class="level2" data-number="18.6">
<h2 data-number="18.6" class="anchored" data-anchor-id="examples"><span class="header-section-number">18.6</span> Examples</h2>
<section id="micro-helpers-copypaste-as-needed" class="level3" data-number="18.6.1">
<h3 data-number="18.6.1" class="anchored" data-anchor-id="micro-helpers-copypaste-as-needed"><span class="header-section-number">18.6.1</span> Micro-helpers (copy/paste as needed)</h3>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 17.1 - perf_helpers.js (inline for each example)</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" data-filename="Example 17.1 - perf_helpers.js (inline for each example)"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">// Example 17.1 - perf_helpers.js (inline for each example)</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">function</span> <span class="fu">nowMs</span>(){ <span class="cf">return</span> (<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span> }</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">function</span> <span class="fu">trim</span>(s){ <span class="cf">return</span> s<span class="op">==</span><span class="kw">null</span><span class="op">?</span><span class="st">""</span><span class="op">:</span><span class="bu">String</span>(s)<span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">^\s+|\s+$</span><span class="ss">/g</span><span class="op">,</span><span class="st">""</span>)<span class="op">;</span> }</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">function</span> <span class="fu">equalsIgnoreCase</span>(a<span class="op">,</span>b){ <span class="cf">return</span> <span class="bu">String</span>(a<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">==</span><span class="bu">String</span>(b<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">;</span> }</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">function</span> <span class="fu">startsWith</span>(s<span class="op">,</span>p){ <span class="cf">return</span> <span class="bu">String</span>(s<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">indexOf</span>(p)<span class="op">===</span><span class="dv">0</span><span class="op">;</span> }</span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">// Directory chooser (directory only; no filenames)</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="kw">function</span> <span class="fu">pickFolder</span>(promptText){</span>
<span id="cb1-11"><a href="#cb1-11"></a>  <span class="kw">var</span> sh <span class="op">=</span> <span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Shell.Application"</span>)<span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>  <span class="kw">var</span> f <span class="op">=</span> sh<span class="op">.</span><span class="fu">BrowseForFolder</span>(<span class="dv">0</span><span class="op">,</span> promptText<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="cf">return</span> f <span class="op">?</span> f<span class="op">.</span><span class="at">Self</span><span class="op">.</span><span class="at">Path</span> <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb1-14"><a href="#cb1-14"></a>}</span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co">// CSV writer (lightweight)</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="kw">function</span> <span class="fu">Csv</span>(path){</span>
<span id="cb1-18"><a href="#cb1-18"></a>  <span class="kw">var</span> fso <span class="op">=</span> <span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Scripting.FileSystemObject"</span>)<span class="op">;</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>  <span class="kw">var</span> file <span class="op">=</span> fso<span class="op">.</span><span class="fu">OpenTextFile</span>(path<span class="op">,</span> <span class="dv">8</span> <span class="co">/*Append*/</span><span class="op">,</span> <span class="kw">true</span> <span class="co">/*Create*/</span>)<span class="op">;</span></span>
<span id="cb1-20"><a href="#cb1-20"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">w</span> <span class="op">=</span> <span class="kw">function</span>(line){ file<span class="op">.</span><span class="fu">WriteLine</span>(line)<span class="op">;</span> }<span class="op">;</span></span>
<span id="cb1-21"><a href="#cb1-21"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">close</span> <span class="op">=</span> <span class="kw">function</span>(){ file<span class="op">.</span><span class="fu">Close</span>()<span class="op">;</span> }<span class="op">;</span></span>
<span id="cb1-22"><a href="#cb1-22"></a>}</span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a></span>
<span id="cb1-25"><a href="#cb1-25"></a>### Pattern A —Timing Harness <span class="op">&amp;</span> Low<span class="op">-</span>noise Logging</span>
<span id="cb1-26"><a href="#cb1-26"></a></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="op">**</span>Goal<span class="op">:**</span> measure total time<span class="op">,</span> throughput<span class="op">,</span> and avoid slow Session<span class="op">.</span><span class="at">Output</span></span>
<span id="cb1-28"><a href="#cb1-28"></a>loops<span class="op">.</span></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="vs">```{.js filename="Example 17.2 - Perf_TimingHarness.js – JScript (ES3)"}</span></span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="vs">// Example 17.2 - Perf_TimingHarness.js – JScript (ES3)</span></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="vs">// Purpose: Run any loop with minimal UI logging + CSV metrics</span></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="vs">// Usage: Select any package (context not required for the demo)</span></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="vs">// -------------------------------------------------------</span></span>
<span id="cb1-34"><a href="#cb1-34"></a><span class="vs">!INC Local Scripts.EAConstants-JScript</span></span>
<span id="cb1-35"><a href="#cb1-35"></a></span>
<span id="cb1-36"><a href="#cb1-36"></a><span class="vs">function nowMs(){ return (new Date()).getTime(); }</span></span>
<span id="cb1-37"><a href="#cb1-37"></a><span class="vs">function pickFolder(t){ var sh=new ActiveXObject("Shell.Application"); var f=sh.BrowseForFolder(0,t,0,0); return f?f.Self.Path:null; }</span></span>
<span id="cb1-38"><a href="#cb1-38"></a><span class="vs">function Csv(path){ var fso=new ActiveXObject("Scripting.FileSystemObject"); var f=fso.OpenTextFile(path,8,true); this.w=function(l){f.WriteLine(l);}; this.close=function(){f.Close();}; }</span></span>
<span id="cb1-39"><a href="#cb1-39"></a></span>
<span id="cb1-40"><a href="#cb1-40"></a><span class="vs">function main(){</span></span>
<span id="cb1-41"><a href="#cb1-41"></a><span class="vs">  var outDir = pickFolder("Select output folder for perf log");</span></span>
<span id="cb1-42"><a href="#cb1-42"></a><span class="vs">  if(!outDir){ Session.Prompt("Cancelled.", promptOK); return; }</span></span>
<span id="cb1-43"><a href="#cb1-43"></a></span>
<span id="cb1-44"><a href="#cb1-44"></a><span class="vs">  var stamp = (new Date()).getTime();</span></span>
<span id="cb1-45"><a href="#cb1-45"></a><span class="vs">  var csv = new Csv(outDir+"</span><span class="sc">\\</span><span class="vs">perf_metrics_"+stamp+".csv");</span></span>
<span id="cb1-46"><a href="#cb1-46"></a><span class="vs">  csv.w("Metric,Value");</span></span>
<span id="cb1-47"><a href="#cb1-47"></a></span>
<span id="cb1-48"><a href="#cb1-48"></a><span class="vs">  var T0 = nowMs();</span></span>
<span id="cb1-49"><a href="#cb1-49"></a><span class="vs">  var N  = 20000; // simulate 20k lightweight ops (replace with real loop)</span></span>
<span id="cb1-50"><a href="#cb1-50"></a><span class="vs">  var i;</span></span>
<span id="cb1-51"><a href="#cb1-51"></a><span class="vs">  for(i=0;i&lt;N;i++){</span></span>
<span id="cb1-52"><a href="#cb1-52"></a><span class="vs">    // do nothing (placeholder for your per-item work)</span></span>
<span id="cb1-53"><a href="#cb1-53"></a><span class="vs">    // avoid Session.Output inside hot loops</span></span>
<span id="cb1-54"><a href="#cb1-54"></a><span class="vs">  }</span></span>
<span id="cb1-55"><a href="#cb1-55"></a><span class="vs">  var dt = nowMs()-T0;</span></span>
<span id="cb1-56"><a href="#cb1-56"></a><span class="vs">  var perSec = (N&gt;0)? Math.round((N*1000.0)/dt) : 0;</span></span>
<span id="cb1-57"><a href="#cb1-57"></a></span>
<span id="cb1-58"><a href="#cb1-58"></a><span class="vs">  csv.w("Items,"+N);</span></span>
<span id="cb1-59"><a href="#cb1-59"></a><span class="vs">  csv.w("Millis,"+dt);</span></span>
<span id="cb1-60"><a href="#cb1-60"></a><span class="vs">  csv.w("Throughput_items_per_sec,"+perSec);</span></span>
<span id="cb1-61"><a href="#cb1-61"></a><span class="vs">  csv.close();</span></span>
<span id="cb1-62"><a href="#cb1-62"></a></span>
<span id="cb1-63"><a href="#cb1-63"></a><span class="vs">  Session.Output("Done. Items="+N+" Time(ms)="+dt+" Throughput="+perSec+"/s");</span></span>
<span id="cb1-64"><a href="#cb1-64"></a><span class="vs">}</span></span>
<span id="cb1-65"><a href="#cb1-65"></a><span class="vs">main();</span></span>
<span id="cb1-66"><a href="#cb1-66"></a></span>
<span id="cb1-67"><a href="#cb1-67"></a></span>
<span id="cb1-68"><a href="#cb1-68"></a><span class="vs">Adapt: wrap your actual processing loop and keep Output to a few lines.</span></span>
<span id="cb1-69"><a href="#cb1-69"></a><span class="vs">For detailed logs, write to CSV instead.</span></span>
<span id="cb1-70"><a href="#cb1-70"></a></span>
<span id="cb1-71"><a href="#cb1-71"></a><span class="vs">### Pattern B — SQL-Accelerated Find, API-Safe Write (with chunking)</span></span>
<span id="cb1-72"><a href="#cb1-72"></a></span>
<span id="cb1-73"><a href="#cb1-73"></a><span class="vs">**Use case:** set a stereotype on all **Class** elements missing one,</span></span>
<span id="cb1-74"><a href="#cb1-74"></a><span class="vs">across the repository.  </span></span>
<span id="cb1-75"><a href="#cb1-75"></a><span class="vs">**Approach:**</span></span>
<span id="cb1-76"><a href="#cb1-76"></a></span>
<span id="cb1-77"><a href="#cb1-77"></a><span class="vs">1.  **SQLQuery** all candidate IDs (fast).</span></span>
<span id="cb1-78"><a href="#cb1-78"></a></span>
<span id="cb1-79"><a href="#cb1-79"></a><span class="vs">2.  Process in **chunks of 250**; call Update() per element, refresh UI</span></span>
<span id="cb1-80"><a href="#cb1-80"></a><span class="vs">    only per chunk or once at the end.</span></span>
<span id="cb1-81"><a href="#cb1-81"></a></span>
<span id="cb1-82"><a href="#cb1-82"></a><span class="vs">3.  **DRY_RUN** for safety.</span></span>
<span id="cb1-83"><a href="#cb1-83"></a><span class="vs">```</span>{<span class="op">.</span><span class="at">js</span> filename<span class="op">=</span><span class="st">"Example 17.3 - Perf_SqlFind_ApiWrite_Chunked.js – JScript (ES3)"</span>}</span>
<span id="cb1-84"><a href="#cb1-84"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb1-85"><a href="#cb1-85"></a><span class="co">// Example 17.3 - Perf_SqlFind_ApiWrite_Chunked.js – JScript (ES3)</span></span>
<span id="cb1-86"><a href="#cb1-86"></a><span class="co">// Purpose: Fast find via SQL, chunked updates via API</span></span>
<span id="cb1-87"><a href="#cb1-87"></a><span class="co">// Safety: DRY_RUN = true by default</span></span>
<span id="cb1-88"><a href="#cb1-88"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb1-89"><a href="#cb1-89"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb1-90"><a href="#cb1-90"></a></span>
<span id="cb1-91"><a href="#cb1-91"></a><span class="kw">function</span> <span class="fu">nowMs</span>(){ <span class="cf">return</span> (<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span> }</span>
<span id="cb1-92"><a href="#cb1-92"></a><span class="kw">function</span> <span class="fu">pickFolder</span>(t){ <span class="kw">var</span> sh<span class="op">=</span><span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Shell.Application"</span>)<span class="op">;</span> <span class="kw">var</span> f<span class="op">=</span>sh<span class="op">.</span><span class="fu">BrowseForFolder</span>(<span class="dv">0</span><span class="op">,</span>t<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span>)<span class="op">;</span> <span class="cf">return</span> f<span class="op">?</span>f<span class="op">.</span><span class="at">Self</span><span class="op">.</span><span class="at">Path</span><span class="op">:</span><span class="kw">null</span><span class="op">;</span> }</span>
<span id="cb1-93"><a href="#cb1-93"></a><span class="kw">function</span> <span class="fu">Csv</span>(path){ <span class="kw">var</span> fso<span class="op">=</span><span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Scripting.FileSystemObject"</span>)<span class="op">;</span> <span class="kw">var</span> f<span class="op">=</span>fso<span class="op">.</span><span class="fu">OpenTextFile</span>(path<span class="op">,</span><span class="dv">8</span><span class="op">,</span><span class="kw">true</span>)<span class="op">;</span> <span class="kw">this</span><span class="op">.</span><span class="at">w</span><span class="op">=</span><span class="kw">function</span>(l){f<span class="op">.</span><span class="fu">WriteLine</span>(l)<span class="op">;</span>}<span class="op">;</span> <span class="kw">this</span><span class="op">.</span><span class="at">close</span><span class="op">=</span><span class="kw">function</span>(){f<span class="op">.</span><span class="fu">Close</span>()<span class="op">;</span>}<span class="op">;</span> }</span>
<span id="cb1-94"><a href="#cb1-94"></a></span>
<span id="cb1-95"><a href="#cb1-95"></a><span class="kw">function</span> <span class="fu">extractAll</span>(h<span class="op">,</span>openTag<span class="op">,</span>closeTag){</span>
<span id="cb1-96"><a href="#cb1-96"></a>  <span class="kw">var</span> res<span class="op">=</span>[]<span class="op">,</span> start<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-97"><a href="#cb1-97"></a>  <span class="cf">while</span>(<span class="kw">true</span>){</span>
<span id="cb1-98"><a href="#cb1-98"></a>    <span class="kw">var</span> i<span class="op">=</span>h<span class="op">.</span><span class="fu">indexOf</span>(openTag<span class="op">,</span>start)<span class="op">;</span> <span class="cf">if</span>(i<span class="op">&lt;</span><span class="dv">0</span>) <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-99"><a href="#cb1-99"></a>    <span class="kw">var</span> j<span class="op">=</span>h<span class="op">.</span><span class="fu">indexOf</span>(closeTag<span class="op">,</span>i<span class="op">+</span>openTag<span class="op">.</span><span class="at">length</span>)<span class="op">;</span> <span class="cf">if</span>(j<span class="op">&lt;</span><span class="dv">0</span>) <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-100"><a href="#cb1-100"></a>    res<span class="op">.</span><span class="fu">push</span>(h<span class="op">.</span><span class="fu">substring</span>(i<span class="op">+</span>openTag<span class="op">.</span><span class="at">length</span><span class="op">,</span>j))<span class="op">;</span></span>
<span id="cb1-101"><a href="#cb1-101"></a>    start<span class="op">=</span>j<span class="op">+</span>closeTag<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb1-102"><a href="#cb1-102"></a>  }</span>
<span id="cb1-103"><a href="#cb1-103"></a>  <span class="cf">return</span> res<span class="op">;</span></span>
<span id="cb1-104"><a href="#cb1-104"></a>}</span>
<span id="cb1-105"><a href="#cb1-105"></a></span>
<span id="cb1-106"><a href="#cb1-106"></a><span class="kw">function</span> <span class="fu">main</span>(){</span>
<span id="cb1-107"><a href="#cb1-107"></a>  <span class="kw">var</span> DRY_RUN <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb1-108"><a href="#cb1-108"></a>  <span class="kw">var</span> TYPE_FILTER <span class="op">=</span> <span class="st">"Class"</span><span class="op">;</span></span>
<span id="cb1-109"><a href="#cb1-109"></a>  <span class="kw">var</span> TARGET_STEREO <span class="op">=</span> <span class="st">"DomainObject"</span><span class="op">;</span></span>
<span id="cb1-110"><a href="#cb1-110"></a>  <span class="kw">var</span> CHUNK <span class="op">=</span> <span class="dv">250</span><span class="op">;</span></span>
<span id="cb1-111"><a href="#cb1-111"></a></span>
<span id="cb1-112"><a href="#cb1-112"></a>  <span class="kw">var</span> outDir <span class="op">=</span> <span class="fu">pickFolder</span>(<span class="st">"Select output folder for change log"</span>)<span class="op">;</span></span>
<span id="cb1-113"><a href="#cb1-113"></a>  <span class="cf">if</span>(<span class="op">!</span>outDir){ Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Cancelled."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb1-114"><a href="#cb1-114"></a>  <span class="kw">var</span> stamp<span class="op">=</span>(<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb1-115"><a href="#cb1-115"></a>  <span class="kw">var</span> csv<span class="op">=</span><span class="kw">new</span> <span class="fu">Csv</span>(outDir<span class="op">+</span><span class="st">"</span><span class="sc">\\</span><span class="st">chunked_changes_"</span><span class="op">+</span>stamp<span class="op">+</span><span class="st">".csv"</span>)<span class="op">;</span></span>
<span id="cb1-116"><a href="#cb1-116"></a>  csv<span class="op">.</span><span class="fu">w</span>(<span class="st">"Action,ElementID,Name,OldStereo,NewStereo"</span>)<span class="op">;</span></span>
<span id="cb1-117"><a href="#cb1-117"></a></span>
<span id="cb1-118"><a href="#cb1-118"></a>  <span class="kw">var</span> t0<span class="op">=</span><span class="fu">nowMs</span>()<span class="op">;</span></span>
<span id="cb1-119"><a href="#cb1-119"></a>  <span class="co">// 1) fast find: candidates with empty stereotype (rough pre-filter)</span></span>
<span id="cb1-120"><a href="#cb1-120"></a>  <span class="kw">var</span> sql<span class="op">=</span><span class="st">"SELECT Object_ID, Name, Stereotype FROM t_object WHERE Object_Type='"</span><span class="op">+</span>TYPE_FILTER<span class="op">+</span><span class="st">"' AND (Stereotype IS NULL OR Stereotype='')"</span><span class="op">;</span></span>
<span id="cb1-121"><a href="#cb1-121"></a>  <span class="kw">var</span> xml<span class="op">=</span>Repository<span class="op">.</span><span class="fu">SQLQuery</span>(sql)<span class="op">;</span></span>
<span id="cb1-122"><a href="#cb1-122"></a>  <span class="kw">var</span> ids<span class="op">=</span><span class="fu">extractAll</span>(xml<span class="op">,</span><span class="st">"&lt;Object_ID&gt;"</span><span class="op">,</span><span class="st">"&lt;/Object_ID&gt;"</span>)<span class="op">;</span></span>
<span id="cb1-123"><a href="#cb1-123"></a>  <span class="kw">var</span> count<span class="op">=</span>ids<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb1-124"><a href="#cb1-124"></a>  Session<span class="op">.</span><span class="fu">Output</span>(<span class="st">"Candidates: "</span><span class="op">+</span>count)<span class="op">;</span></span>
<span id="cb1-125"><a href="#cb1-125"></a></span>
<span id="cb1-126"><a href="#cb1-126"></a>  <span class="kw">var</span> applied<span class="op">=</span><span class="dv">0</span><span class="op">,</span> batch<span class="op">=</span><span class="dv">0</span><span class="op">,</span> processed<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-127"><a href="#cb1-127"></a>  <span class="kw">var</span> i<span class="op">;</span></span>
<span id="cb1-128"><a href="#cb1-128"></a>  <span class="cf">for</span>(i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>count<span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb1-129"><a href="#cb1-129"></a>    <span class="kw">var</span> id<span class="op">=</span><span class="pp">parseInt</span>(ids[i]<span class="op">,</span><span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb1-130"><a href="#cb1-130"></a>    <span class="kw">var</span> e<span class="op">=</span>Repository<span class="op">.</span><span class="fu">GetElementByID</span>(id)<span class="op">;</span></span>
<span id="cb1-131"><a href="#cb1-131"></a>    <span class="cf">if</span>(<span class="op">!</span>e) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb1-132"><a href="#cb1-132"></a></span>
<span id="cb1-133"><a href="#cb1-133"></a>    <span class="co">// double-check to avoid redundant writes</span></span>
<span id="cb1-134"><a href="#cb1-134"></a>    <span class="kw">var</span> oldStereo<span class="op">=</span><span class="bu">String</span>(e<span class="op">.</span><span class="at">Stereotype</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span></span>
<span id="cb1-135"><a href="#cb1-135"></a>    <span class="cf">if</span>(oldStereo<span class="op">===</span><span class="st">""</span>){</span>
<span id="cb1-136"><a href="#cb1-136"></a>      csv<span class="op">.</span><span class="fu">w</span>((DRY_RUN<span class="op">?</span><span class="st">"DRY_RUN"</span><span class="op">:</span><span class="st">"SET"</span>) <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> e<span class="op">.</span><span class="at">ElementID</span> <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> oldStereo <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> TARGET_STEREO)<span class="op">;</span></span>
<span id="cb1-137"><a href="#cb1-137"></a>      <span class="cf">if</span>(<span class="op">!</span>DRY_RUN){ e<span class="op">.</span><span class="at">Stereotype</span> <span class="op">=</span> TARGET_STEREO<span class="op">;</span> e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> applied<span class="op">++;</span> }</span>
<span id="cb1-138"><a href="#cb1-138"></a>      batch<span class="op">++;</span></span>
<span id="cb1-139"><a href="#cb1-139"></a>    }</span>
<span id="cb1-140"><a href="#cb1-140"></a></span>
<span id="cb1-141"><a href="#cb1-141"></a>    processed<span class="op">++;</span></span>
<span id="cb1-142"><a href="#cb1-142"></a></span>
<span id="cb1-143"><a href="#cb1-143"></a>    <span class="co">// chunk boundary</span></span>
<span id="cb1-144"><a href="#cb1-144"></a>    <span class="cf">if</span>(batch<span class="op">&gt;=</span>CHUNK){</span>
<span id="cb1-145"><a href="#cb1-145"></a>      <span class="co">// optional: rare refresh so the UI doesn't feel stale</span></span>
<span id="cb1-146"><a href="#cb1-146"></a>      <span class="cf">if</span>(<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> applied<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-147"><a href="#cb1-147"></a>      batch<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-148"><a href="#cb1-148"></a>    }</span>
<span id="cb1-149"><a href="#cb1-149"></a>  }</span>
<span id="cb1-150"><a href="#cb1-150"></a></span>
<span id="cb1-151"><a href="#cb1-151"></a>  <span class="cf">if</span>(<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> applied<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-152"><a href="#cb1-152"></a>  csv<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb1-153"><a href="#cb1-153"></a></span>
<span id="cb1-154"><a href="#cb1-154"></a>  <span class="kw">var</span> dt<span class="op">=</span><span class="fu">nowMs</span>()<span class="op">-</span>t0<span class="op">;</span></span>
<span id="cb1-155"><a href="#cb1-155"></a>  <span class="kw">var</span> rps <span class="op">=</span> processed<span class="op">&gt;</span><span class="dv">0</span> <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(<span class="fl">1000.0</span><span class="op">*</span>processed<span class="op">/</span>dt) <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-156"><a href="#cb1-156"></a>  Session<span class="op">.</span><span class="fu">Output</span>(<span class="st">"Processed="</span><span class="op">+</span>processed<span class="op">+</span><span class="st">" Applied="</span><span class="op">+</span>applied<span class="op">+</span><span class="st">" Time(ms)="</span><span class="op">+</span>dt<span class="op">+</span><span class="st">" Throughput="</span><span class="op">+</span>rps<span class="op">+</span><span class="st">"/s DRY_RUN="</span><span class="op">+</span>DRY_RUN)<span class="op">;</span></span>
<span id="cb1-157"><a href="#cb1-157"></a>}</span>
<span id="cb1-158"><a href="#cb1-158"></a><span class="fu">main</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Why it’s fast:</strong> the <em>find</em> phase is one SQL call. The <em>write</em> phase avoids extra lookups and refreshes only in large intervals.</p>
</section>
<section id="pattern-c-iterative-package-traversal-no-recursion" class="level3" data-number="18.6.2">
<h3 data-number="18.6.2" class="anchored" data-anchor-id="pattern-c-iterative-package-traversal-no-recursion"><span class="header-section-number">18.6.2</span> Pattern C — Iterative Package Traversal (no recursion)</h3>
<p>Recursive tree walks can hit call-stack limits and are slower than a simple queue. This <strong>breadth-first</strong> traversal scales better.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 17.4 - Perf_PackageWalk_Iterative.js – JScript (ES3)</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" data-filename="Example 17.4 - Perf_PackageWalk_Iterative.js – JScript (ES3)"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">// Example 17.4 - Perf_PackageWalk_Iterative.js – JScript (ES3)</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">// Purpose: Walk an entire package tree without recursion</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">// Action: Count elements by type (as an example)</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="kw">function</span> <span class="fu">main</span>(){</span>
<span id="cb2-9"><a href="#cb2-9"></a>  <span class="kw">var</span> pkg <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span>()<span class="op">;</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="cf">if</span>(<span class="op">!</span>pkg){ Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Select a root package."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb2-11"><a href="#cb2-11"></a></span>
<span id="cb2-12"><a href="#cb2-12"></a>  <span class="kw">var</span> queue<span class="op">=</span>[pkg]<span class="op">;</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>  <span class="kw">var</span> typeCount <span class="op">=</span> {}<span class="op">;</span> <span class="co">// map type -&gt; number</span></span>
<span id="cb2-14"><a href="#cb2-14"></a></span>
<span id="cb2-15"><a href="#cb2-15"></a>  <span class="cf">while</span>(queue<span class="op">.</span><span class="at">length</span><span class="op">&gt;</span><span class="dv">0</span>){</span>
<span id="cb2-16"><a href="#cb2-16"></a>    <span class="kw">var</span> p <span class="op">=</span> queue<span class="op">.</span><span class="fu">shift</span>()<span class="op">;</span></span>
<span id="cb2-17"><a href="#cb2-17"></a></span>
<span id="cb2-18"><a href="#cb2-18"></a>    <span class="co">// enqueue children</span></span>
<span id="cb2-19"><a href="#cb2-19"></a>    <span class="kw">var</span> kids <span class="op">=</span> p<span class="op">.</span><span class="at">Packages</span><span class="op">;</span></span>
<span id="cb2-20"><a href="#cb2-20"></a>    <span class="cf">for</span>(<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>kids<span class="op">.</span><span class="at">Count</span><span class="op">;</span>i<span class="op">++</span>){ queue<span class="op">.</span><span class="fu">push</span>(kids<span class="op">.</span><span class="fu">GetAt</span>(i))<span class="op">;</span> }</span>
<span id="cb2-21"><a href="#cb2-21"></a></span>
<span id="cb2-22"><a href="#cb2-22"></a>    <span class="co">// tally elements</span></span>
<span id="cb2-23"><a href="#cb2-23"></a>    <span class="kw">var</span> els <span class="op">=</span> p<span class="op">.</span><span class="at">Elements</span><span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24"></a>    <span class="cf">for</span>(<span class="kw">var</span> j<span class="op">=</span><span class="dv">0</span><span class="op">;</span>j<span class="op">&lt;</span>els<span class="op">.</span><span class="at">Count</span><span class="op">;</span>j<span class="op">++</span>){</span>
<span id="cb2-25"><a href="#cb2-25"></a>      <span class="kw">var</span> e <span class="op">=</span> els<span class="op">.</span><span class="fu">GetAt</span>(j)<span class="op">;</span></span>
<span id="cb2-26"><a href="#cb2-26"></a>      <span class="kw">var</span> t <span class="op">=</span> e<span class="op">.</span><span class="at">Type</span><span class="op">;</span></span>
<span id="cb2-27"><a href="#cb2-27"></a>      typeCount[t] <span class="op">=</span> (typeCount[t]<span class="op">||</span><span class="dv">0</span>)<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-28"><a href="#cb2-28"></a>    }</span>
<span id="cb2-29"><a href="#cb2-29"></a>  }</span>
<span id="cb2-30"><a href="#cb2-30"></a></span>
<span id="cb2-31"><a href="#cb2-31"></a>  <span class="co">// low-noise summary output</span></span>
<span id="cb2-32"><a href="#cb2-32"></a>  Session<span class="op">.</span><span class="fu">Output</span>(<span class="st">"Element counts by Type:"</span>)<span class="op">;</span></span>
<span id="cb2-33"><a href="#cb2-33"></a>  <span class="kw">var</span> k<span class="op">;</span> <span class="cf">for</span>(k <span class="kw">in</span> typeCount){ <span class="cf">if</span>(typeCount<span class="op">.</span><span class="fu">hasOwnProperty</span>(k)){ Session<span class="op">.</span><span class="fu">Output</span>(<span class="st">"  "</span><span class="op">+</span>k<span class="op">+</span><span class="st">": "</span><span class="op">+</span>typeCount[k])<span class="op">;</span> } }</span>
<span id="cb2-34"><a href="#cb2-34"></a>}</span>
<span id="cb2-35"><a href="#cb2-35"></a><span class="fu">main</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Why it’s scalable:</strong> avoids deep call stacks and allocates a tiny queue instead of many temporary stacks frames.</p>
</section>
<section id="pattern-d-large-csv-apply-streaming-batching" class="level3" data-number="18.6.3">
<h3 data-number="18.6.3" class="anchored" data-anchor-id="pattern-d-large-csv-apply-streaming-batching"><span class="header-section-number">18.6.3</span> Pattern D — Large CSV Apply (streaming + batching)</h3>
<p>Reading a giant CSV and applying changes? Keep parsing <strong>simple</strong>, skip unchanged rows, and batch writes.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 17.5 - Perf_CsvApply_Batched.js – JScript (ES3)</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" data-filename="Example 17.5 - Perf_CsvApply_Batched.js – JScript (ES3)"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">// Example 17.5 - Perf_CsvApply_Batched.js – JScript (ES3)</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">// Purpose: Apply safe updates from a curated CSV with batching</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">// CSV columns (example): Apply,ElementID,NewStatus</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">// Safety: Only Apply=YES rows execute; chunk writes; minimal UI refresh</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb3-8"><a href="#cb3-8"></a></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="kw">function</span> <span class="fu">trim</span>(s){ <span class="cf">return</span> s<span class="op">==</span><span class="kw">null</span><span class="op">?</span><span class="st">""</span><span class="op">:</span><span class="bu">String</span>(s)<span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">^\s+|\s+$</span><span class="ss">/g</span><span class="op">,</span><span class="st">""</span>)<span class="op">;</span> }</span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="kw">function</span> <span class="fu">pickFolder</span>(t){ <span class="kw">var</span> sh<span class="op">=</span><span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Shell.Application"</span>)<span class="op">;</span> <span class="kw">var</span> f<span class="op">=</span>sh<span class="op">.</span><span class="fu">BrowseForFolder</span>(<span class="dv">0</span><span class="op">,</span>t<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span>)<span class="op">;</span> <span class="cf">return</span> f<span class="op">?</span>f<span class="op">.</span><span class="at">Self</span><span class="op">.</span><span class="at">Path</span><span class="op">:</span><span class="kw">null</span><span class="op">;</span> }</span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="kw">function</span> <span class="fu">endsWith</span>(s<span class="op">,</span>suf){ s<span class="op">=</span><span class="bu">String</span>(s<span class="op">||</span><span class="st">""</span>)<span class="op">;</span> <span class="kw">var</span> i<span class="op">=</span>s<span class="op">.</span><span class="fu">lastIndexOf</span>(suf)<span class="op">;</span> <span class="cf">return</span> i<span class="op">&gt;=</span><span class="dv">0</span> <span class="op">&amp;&amp;</span> i<span class="op">+</span>suf<span class="op">.</span><span class="at">length</span><span class="op">==</span>s<span class="op">.</span><span class="at">length</span><span class="op">;</span> }</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="kw">function</span> <span class="fu">main</span>(){</span>
<span id="cb3-14"><a href="#cb3-14"></a>  <span class="kw">var</span> DRY_RUN <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb3-15"><a href="#cb3-15"></a>  <span class="kw">var</span> CHUNK <span class="op">=</span> <span class="dv">250</span><span class="op">;</span></span>
<span id="cb3-16"><a href="#cb3-16"></a></span>
<span id="cb3-17"><a href="#cb3-17"></a>  <span class="kw">var</span> dir <span class="op">=</span> <span class="fu">pickFolder</span>(<span class="st">"Select folder containing curated CSV"</span>)<span class="op">;</span></span>
<span id="cb3-18"><a href="#cb3-18"></a>  <span class="cf">if</span>(<span class="op">!</span>dir){ Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Cancelled."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb3-19"><a href="#cb3-19"></a></span>
<span id="cb3-20"><a href="#cb3-20"></a>  <span class="co">// Pick the newest CSV in the folder by a known prefix (customize if needed)</span></span>
<span id="cb3-21"><a href="#cb3-21"></a>  <span class="kw">var</span> fso<span class="op">=</span><span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Scripting.FileSystemObject"</span>)<span class="op">;</span></span>
<span id="cb3-22"><a href="#cb3-22"></a>  <span class="kw">var</span> folder<span class="op">=</span>fso<span class="op">.</span><span class="fu">GetFolder</span>(dir)<span class="op">;</span></span>
<span id="cb3-23"><a href="#cb3-23"></a>  <span class="kw">var</span> en<span class="op">=</span><span class="kw">new</span> <span class="fu">Enumerator</span>(folder<span class="op">.</span><span class="at">Files</span>)<span class="op">;</span></span>
<span id="cb3-24"><a href="#cb3-24"></a>  <span class="kw">var</span> newest<span class="op">=</span><span class="kw">null</span><span class="op">,</span> t<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-25"><a href="#cb3-25"></a>  <span class="cf">for</span>(<span class="op">;!</span>en<span class="op">.</span><span class="fu">atEnd</span>()<span class="op">;</span> en<span class="op">.</span><span class="fu">moveNext</span>()){</span>
<span id="cb3-26"><a href="#cb3-26"></a>    <span class="kw">var</span> f<span class="op">=</span>en<span class="op">.</span><span class="fu">item</span>()<span class="op">;</span></span>
<span id="cb3-27"><a href="#cb3-27"></a>    <span class="cf">if</span>(<span class="fu">endsWith</span>(f<span class="op">.</span><span class="at">Name</span><span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">,</span> <span class="st">".csv"</span>)){</span>
<span id="cb3-28"><a href="#cb3-28"></a>      <span class="kw">var</span> m<span class="op">=</span>f<span class="op">.</span><span class="at">DateLastModified</span><span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb3-29"><a href="#cb3-29"></a>      <span class="cf">if</span>(m<span class="op">&gt;</span>t){ newest<span class="op">=</span>f<span class="op">;</span> t<span class="op">=</span>m<span class="op">;</span> }</span>
<span id="cb3-30"><a href="#cb3-30"></a>    }</span>
<span id="cb3-31"><a href="#cb3-31"></a>  }</span>
<span id="cb3-32"><a href="#cb3-32"></a>  <span class="cf">if</span>(<span class="op">!</span>newest){ Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"No CSV found."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb3-33"><a href="#cb3-33"></a></span>
<span id="cb3-34"><a href="#cb3-34"></a>  <span class="kw">var</span> ts<span class="op">=</span>fso<span class="op">.</span><span class="fu">OpenTextFile</span>(newest<span class="op">.</span><span class="at">Path</span><span class="op">,</span><span class="dv">1</span>)<span class="op">;</span> <span class="co">// ForReading</span></span>
<span id="cb3-35"><a href="#cb3-35"></a>  <span class="co">// header</span></span>
<span id="cb3-36"><a href="#cb3-36"></a>  <span class="cf">if</span>(<span class="op">!</span>ts<span class="op">.</span><span class="at">AtEndOfStream</span>) ts<span class="op">.</span><span class="fu">ReadLine</span>()<span class="op">;</span></span>
<span id="cb3-37"><a href="#cb3-37"></a></span>
<span id="cb3-38"><a href="#cb3-38"></a>  <span class="kw">var</span> applied<span class="op">=</span><span class="dv">0</span><span class="op">,</span> considered<span class="op">=</span><span class="dv">0</span><span class="op">,</span> batch<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-39"><a href="#cb3-39"></a>  <span class="cf">while</span>(<span class="op">!</span>ts<span class="op">.</span><span class="at">AtEndOfStream</span>){</span>
<span id="cb3-40"><a href="#cb3-40"></a>    <span class="kw">var</span> line<span class="op">=</span>ts<span class="op">.</span><span class="fu">ReadLine</span>()<span class="op">;</span></span>
<span id="cb3-41"><a href="#cb3-41"></a>    <span class="cf">if</span>(<span class="fu">trim</span>(line)<span class="op">===</span><span class="st">""</span>) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb3-42"><a href="#cb3-42"></a>    <span class="co">// naive split (keep curation fields simple—avoid commas in cells)</span></span>
<span id="cb3-43"><a href="#cb3-43"></a>    <span class="kw">var</span> cells<span class="op">=</span>line<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">;</span></span>
<span id="cb3-44"><a href="#cb3-44"></a>    <span class="cf">if</span>(cells<span class="op">.</span><span class="at">length</span><span class="op">&lt;</span><span class="dv">3</span>) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb3-45"><a href="#cb3-45"></a></span>
<span id="cb3-46"><a href="#cb3-46"></a>    <span class="kw">var</span> apply<span class="op">=</span><span class="fu">trim</span>(cells[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-47"><a href="#cb3-47"></a>    <span class="kw">var</span> eid <span class="op">=</span> <span class="pp">parseInt</span>(cells[<span class="dv">1</span>]<span class="op">,</span><span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb3-48"><a href="#cb3-48"></a>    <span class="kw">var</span> newStatus <span class="op">=</span> <span class="fu">trim</span>(cells[<span class="dv">2</span>])<span class="op">;</span></span>
<span id="cb3-49"><a href="#cb3-49"></a></span>
<span id="cb3-50"><a href="#cb3-50"></a>    considered<span class="op">++;</span></span>
<span id="cb3-51"><a href="#cb3-51"></a></span>
<span id="cb3-52"><a href="#cb3-52"></a>    <span class="cf">if</span>(<span class="fu">equalsIgnoreCase</span>(apply<span class="op">,</span><span class="st">"YES"</span>) <span class="op">&amp;&amp;</span> eid<span class="op">&gt;</span><span class="dv">0</span>){</span>
<span id="cb3-53"><a href="#cb3-53"></a>      <span class="kw">var</span> e <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetElementByID</span>(eid)<span class="op">;</span></span>
<span id="cb3-54"><a href="#cb3-54"></a>      <span class="cf">if</span>(e <span class="op">&amp;&amp;</span> <span class="bu">String</span>(e<span class="op">.</span><span class="at">Status</span><span class="op">||</span><span class="st">""</span>) <span class="op">!=</span> newStatus){</span>
<span id="cb3-55"><a href="#cb3-55"></a>        <span class="cf">if</span>(<span class="op">!</span>DRY_RUN){ e<span class="op">.</span><span class="at">Status</span><span class="op">=</span>newStatus<span class="op">;</span> e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> applied<span class="op">++;</span> }</span>
<span id="cb3-56"><a href="#cb3-56"></a>        batch<span class="op">++;</span></span>
<span id="cb3-57"><a href="#cb3-57"></a>      }</span>
<span id="cb3-58"><a href="#cb3-58"></a>    }</span>
<span id="cb3-59"><a href="#cb3-59"></a></span>
<span id="cb3-60"><a href="#cb3-60"></a>    <span class="cf">if</span>(batch<span class="op">&gt;=</span>CHUNK){</span>
<span id="cb3-61"><a href="#cb3-61"></a>      <span class="cf">if</span>(<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> applied<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-62"><a href="#cb3-62"></a>      batch<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-63"><a href="#cb3-63"></a>    }</span>
<span id="cb3-64"><a href="#cb3-64"></a>  }</span>
<span id="cb3-65"><a href="#cb3-65"></a>  ts<span class="op">.</span><span class="fu">Close</span>()<span class="op">;</span></span>
<span id="cb3-66"><a href="#cb3-66"></a></span>
<span id="cb3-67"><a href="#cb3-67"></a>  <span class="cf">if</span>(<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> applied<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-68"><a href="#cb3-68"></a>  Session<span class="op">.</span><span class="fu">Output</span>(<span class="st">"CSV apply complete. Considered="</span><span class="op">+</span>considered<span class="op">+</span><span class="st">" Applied="</span><span class="op">+</span>applied<span class="op">+</span><span class="st">" DRY_RUN="</span><span class="op">+</span>DRY_RUN)<span class="op">;</span></span>
<span id="cb3-69"><a href="#cb3-69"></a>}</span>
<span id="cb3-70"><a href="#cb3-70"></a><span class="fu">main</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Why it scales:</strong> minimal parsing, batched writes, rare refreshes, and no per-row UI logs.</p>
</section>
<section id="pattern-e-repository-wide-exists-checks-via-sql" class="level3" data-number="18.6.4">
<h3 data-number="18.6.4" class="anchored" data-anchor-id="pattern-e-repository-wide-exists-checks-via-sql"><span class="header-section-number">18.6.4</span> Pattern E — Repository-wide “Exists?” checks via SQL</h3>
<p>Before creating a new element (or relationship), <strong>prove it doesn’t already exist</strong>—using a quick SQL existence test.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 17.6 - Perf_ExistsCheck_SQL.js – JScript (ES3)</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4" data-filename="Example 17.6 - Perf_ExistsCheck_SQL.js – JScript (ES3)"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">// Example 17.6 - Perf_ExistsCheck_SQL.js – JScript (ES3)</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">// Purpose: Quick existence test for (Name,Type)</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">// Note: Adjust SQL for your DB if needed; this is generic enough for most back-ends</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="kw">function</span> <span class="fu">esc</span>(s){ <span class="cf">return</span> <span class="bu">String</span>(s<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">replace</span>(<span class="ss">/'/g</span><span class="op">,</span> <span class="st">"''"</span>)<span class="op">;</span> }</span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="kw">function</span> <span class="fu">between</span>(h<span class="op">,</span>a<span class="op">,</span>b){ <span class="kw">var</span> i<span class="op">=</span>h<span class="op">.</span><span class="fu">indexOf</span>(a)<span class="op">;</span> <span class="cf">if</span>(i<span class="op">&lt;</span><span class="dv">0</span>)return<span class="st">""</span><span class="op">;</span> <span class="kw">var</span> j<span class="op">=</span>h<span class="op">.</span><span class="fu">indexOf</span>(b<span class="op">,</span>i<span class="op">+</span>a<span class="op">.</span><span class="at">length</span>)<span class="op">;</span> <span class="cf">return</span> j<span class="op">&lt;</span><span class="dv">0</span><span class="op">?</span><span class="st">""</span><span class="op">:</span>h<span class="op">.</span><span class="fu">substring</span>(i<span class="op">+</span>a<span class="op">.</span><span class="at">length</span><span class="op">,</span>j)<span class="op">;</span> }</span>
<span id="cb4-10"><a href="#cb4-10"></a></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="kw">function</span> <span class="fu">existsByNameType</span>(name<span class="op">,</span> type){</span>
<span id="cb4-12"><a href="#cb4-12"></a>  <span class="kw">var</span> sql<span class="op">=</span><span class="st">"SELECT TOP 1 Object_ID FROM t_object WHERE Name='"</span><span class="op">+</span><span class="fu">esc</span>(name)<span class="op">+</span><span class="st">"' AND Object_Type='"</span><span class="op">+</span><span class="fu">esc</span>(type)<span class="op">+</span><span class="st">"'"</span><span class="op">;</span></span>
<span id="cb4-13"><a href="#cb4-13"></a>  <span class="kw">var</span> xml<span class="op">=</span>Repository<span class="op">.</span><span class="fu">SQLQuery</span>(sql)<span class="op">;</span></span>
<span id="cb4-14"><a href="#cb4-14"></a>  <span class="kw">var</span> id<span class="op">=</span><span class="fu">between</span>(xml<span class="op">,</span><span class="st">"&lt;Object_ID&gt;"</span><span class="op">,</span><span class="st">"&lt;/Object_ID&gt;"</span>)<span class="op">;</span></span>
<span id="cb4-15"><a href="#cb4-15"></a>  <span class="cf">return</span> id<span class="op">!==</span><span class="st">""</span><span class="op">;</span></span>
<span id="cb4-16"><a href="#cb4-16"></a>}</span>
<span id="cb4-17"><a href="#cb4-17"></a></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="kw">function</span> <span class="fu">main</span>(){</span>
<span id="cb4-19"><a href="#cb4-19"></a>  <span class="kw">var</span> found <span class="op">=</span> <span class="fu">existsByNameType</span>(<span class="st">"Customer"</span><span class="op">,</span><span class="st">"Class"</span>)<span class="op">;</span></span>
<span id="cb4-20"><a href="#cb4-20"></a>  Session<span class="op">.</span><span class="fu">Output</span>(<span class="st">"Customer/Class exists? "</span><span class="op">+</span>(found<span class="op">?</span><span class="st">"YES"</span><span class="op">:</span><span class="st">"NO"</span>))<span class="op">;</span></span>
<span id="cb4-21"><a href="#cb4-21"></a>}</span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="fu">main</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Performance tip:</strong> do this <strong>before</strong> expensive creation logic, especially inside large importers.</p>
</section>
<section id="pattern-f-external-python-for-heavy-lifting" class="level3" data-number="18.6.5">
<h3 data-number="18.6.5" class="anchored" data-anchor-id="pattern-f-external-python-for-heavy-lifting"><span class="header-section-number">18.6.5</span> Pattern F — External Python for Heavy Lifting</h3>
<p>When processing <strong>very large</strong> updates with lots of text/CSV/JSON parsing, use Python for the parsing, then EA’s API for the write boundary. (Bitness note from earlier chapters: use 32-bit Python to match EA.)</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 17.6 - Perf_ExistsCheck_SQL.js – JScript (ES3)</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5" data-filename="Example 17.6 - Perf_ExistsCheck_SQL.js – JScript (ES3)"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># Example 17.7 - perf_apply_large_external.py – Python 3 (pywin32)</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co"># Purpose: Chunked status updates from a big CSV, with guards</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># Usage: python perf_apply_large_external.py input.csv</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="im">import</span> sys, csv, win32com.client</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a>CHUNK <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb5-9"><a href="#cb5-9"></a></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="kw">def</span> main(path):</span>
<span id="cb5-11"><a href="#cb5-11"></a>    ea <span class="op">=</span> win32com.client.Dispatch(<span class="st">"EA.App"</span>)</span>
<span id="cb5-12"><a href="#cb5-12"></a>    repo <span class="op">=</span> ea.Repository</span>
<span id="cb5-13"><a href="#cb5-13"></a></span>
<span id="cb5-14"><a href="#cb5-14"></a>    applied <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-15"><a href="#cb5-15"></a>    batch <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-16"><a href="#cb5-16"></a></span>
<span id="cb5-17"><a href="#cb5-17"></a>    <span class="cf">with</span> <span class="bu">open</span>(path, newline<span class="op">=</span><span class="st">""</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> f:</span>
<span id="cb5-18"><a href="#cb5-18"></a>        rdr <span class="op">=</span> csv.DictReader(f)</span>
<span id="cb5-19"><a href="#cb5-19"></a>        <span class="cf">for</span> row <span class="kw">in</span> rdr:</span>
<span id="cb5-20"><a href="#cb5-20"></a>            <span class="cf">if</span> <span class="bu">str</span>(row.get(<span class="st">"Apply"</span>,<span class="st">""</span>)).strip().lower() <span class="op">!=</span> <span class="st">"yes"</span>:</span>
<span id="cb5-21"><a href="#cb5-21"></a>                <span class="cf">continue</span></span>
<span id="cb5-22"><a href="#cb5-22"></a>            eid <span class="op">=</span> <span class="bu">int</span>(row[<span class="st">"ElementID"</span>])</span>
<span id="cb5-23"><a href="#cb5-23"></a>            status <span class="op">=</span> row.get(<span class="st">"NewStatus"</span>,<span class="st">""</span>).strip()</span>
<span id="cb5-24"><a href="#cb5-24"></a>            <span class="cf">if</span> <span class="kw">not</span> status:</span>
<span id="cb5-25"><a href="#cb5-25"></a>                <span class="cf">continue</span></span>
<span id="cb5-26"><a href="#cb5-26"></a></span>
<span id="cb5-27"><a href="#cb5-27"></a>            e <span class="op">=</span> repo.GetElementByID(eid)</span>
<span id="cb5-28"><a href="#cb5-28"></a>            <span class="cf">if</span> e <span class="kw">and</span> <span class="bu">str</span>(e.Status <span class="kw">or</span> <span class="st">""</span>) <span class="op">!=</span> status:</span>
<span id="cb5-29"><a href="#cb5-29"></a>                e.Status <span class="op">=</span> status</span>
<span id="cb5-30"><a href="#cb5-30"></a>                e.Update()</span>
<span id="cb5-31"><a href="#cb5-31"></a>                applied <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb5-32"><a href="#cb5-32"></a>                batch  <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb5-33"><a href="#cb5-33"></a></span>
<span id="cb5-34"><a href="#cb5-34"></a>            <span class="cf">if</span> batch <span class="op">&gt;=</span> CHUNK:</span>
<span id="cb5-35"><a href="#cb5-35"></a>                repo.RefreshModelView(<span class="dv">0</span>)</span>
<span id="cb5-36"><a href="#cb5-36"></a>                batch <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-37"><a href="#cb5-37"></a></span>
<span id="cb5-38"><a href="#cb5-38"></a>    <span class="cf">if</span> applied:</span>
<span id="cb5-39"><a href="#cb5-39"></a>        repo.RefreshModelView(<span class="dv">0</span>)</span>
<span id="cb5-40"><a href="#cb5-40"></a>    <span class="bu">print</span>(<span class="ss">f"Applied=</span><span class="sc">{</span>applied<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-41"><a href="#cb5-41"></a></span>
<span id="cb5-42"><a href="#cb5-42"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb5-43"><a href="#cb5-43"></a>    <span class="cf">if</span> <span class="bu">len</span>(sys.argv)<span class="op">&lt;</span><span class="dv">2</span>:</span>
<span id="cb5-44"><a href="#cb5-44"></a>        <span class="bu">print</span>(<span class="st">"Usage: perf_apply_large_external.py &lt;input.csv&gt;"</span>)</span>
<span id="cb5-45"><a href="#cb5-45"></a>    <span class="cf">else</span>:</span>
<span id="cb5-46"><a href="#cb5-46"></a>        main(sys.argv[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Why it’s fast:</strong> Python’s CSV is robust; you perform only the necessary EA updates, chunked with rare refreshes.</p>
</section>
</section>
<section id="dos-donts-cheat-sheet" class="level2" data-number="18.7">
<h2 data-number="18.7" class="anchored" data-anchor-id="dos-donts-cheat-sheet"><span class="header-section-number">18.7</span> Dos &amp; Don’ts (cheat-sheet)</h2>
<ul>
<li><p><strong>Do</strong>: SQL for <em>find</em>, API for <em>write</em>.</p></li>
<li><p><strong>Do</strong>: Log to file instead of spamming Output.</p></li>
<li><p><strong>Do</strong>: Refresh UI once (or per big batch).</p></li>
<li><p><strong>Do</strong>: Short-circuit when the target state is already correct.</p></li>
<li><p><strong>Don’t</strong>: Recursively walk deep trees—prefer an iterative queue.</p></li>
<li><p><strong>Don’t</strong>: Multi-thread COM calls to EA—stick to single-threaded.</p></li>
<li><p><strong>Don’t</strong>: Write via SQL unless you fully understand EA’s schema (read-only SQL is fine; writes are risky).</p></li>
</ul>
</section>
<section id="putting-it-together" class="level2" data-number="18.8">
<h2 data-number="18.8" class="anchored" data-anchor-id="putting-it-together"><span class="header-section-number">18.8</span> Putting It Together</h2>
<p>For a <strong>large governance fix</strong> (e.g., add missing stereotype on 40k classes):</p>
<ol type="1">
<li><p><strong>Timing Harness</strong>: wrap the whole run and log metrics.</p></li>
<li><p><strong>SQL Find</strong>: one query for candidate IDs.</p></li>
<li><p><strong>Chunked Apply</strong>: update in batches of ~250–500.</p></li>
<li><p><strong>Low-noise logging</strong>: a single CSV with “what changed.”</p></li>
<li><p><strong>One refresh</strong> at the end (or per batch).</p></li>
</ol>
<p>Following these steps keeps your scripts fast enough for enterprise-scale repositories and safe enough for governance.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script>

document.addEventListener('DOMContentLoaded', function () {

  // Prefer the margin sidebar if it exists; otherwise try the TOC sidebar.

  const margin = document.querySelector('#quarto-margin-sidebar, .margin-sidebar, .column-margin');

  const toc    = document.querySelector('nav#TOC');

  const sidebar = margin || (toc && toc.closest('.sidebar, .quarto-sidebar, .margin-sidebar'));



  if (!sidebar) return; // no margin column on this layout



  const holder = document.createElement('div');

  holder.className = 'cover-above-toc';

  holder.innerHTML = `

    <a href="index.html">

      <img src="images/cover.png" alt="Book cover" class="cover-above-toc__img" width="140" />

    </a>

  `;

  sidebar.prepend(holder);

});

</script>



<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./17-System.Object[].html" class="pagination-link" aria-label="Chapter 16: AI in Daily Workflow">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Chapter 16: AI in Daily Workflow</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./19-System.Object[].html" class="pagination-link" aria-label="Chapter 18: Integrating with Workflows">
        <span class="nav-page-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Chapter 18: Integrating with Workflows</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu"># Chapter 17: Performance &amp; Scaling</span></span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a>Enterprise Architect is used in contexts that range from small projects</span>
<span id="cb6-4"><a href="#cb6-4"></a>to national architectures. In small repositories with a few hundred</span>
<span id="cb6-5"><a href="#cb6-5"></a>elements, scripting feels instant and forgiving. But as repositories</span>
<span id="cb6-6"><a href="#cb6-6"></a>grow to tens of thousands or even hundreds of thousands of elements,</span>
<span id="cb6-7"><a href="#cb6-7"></a>performance becomes a real concern. A script that works perfectly in a</span>
<span id="cb6-8"><a href="#cb6-8"></a>sandbox may take hours, or even crash EA, when run against an</span>
<span id="cb6-9"><a href="#cb6-9"></a>enterprise-scale repository.</span>
<span id="cb6-10"><a href="#cb6-10"></a></span>
<span id="cb6-11"><a href="#cb6-11"></a>This chapter explores the principles of performance and scaling in EA</span>
<span id="cb6-12"><a href="#cb6-12"></a>scripting. It explains why large repositories behave differently, why</span>
<span id="cb6-13"><a href="#cb6-13"></a>naive loops and excessive logging cause problems, and how to design</span>
<span id="cb6-14"><a href="#cb6-14"></a>scripts that handle scale safely. The goal is not to turn you into a</span>
<span id="cb6-15"><a href="#cb6-15"></a>performance engineer, but to provide practical strategies that let your</span>
<span id="cb6-16"><a href="#cb6-16"></a>scripts run efficiently on real-world repositories.</span>
<span id="cb6-17"><a href="#cb6-17"></a></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="fu">## Why Performance Matters</span></span>
<span id="cb6-19"><a href="#cb6-19"></a></span>
<span id="cb6-20"><a href="#cb6-20"></a>At first glance, performance might seem secondary. After all, scripts</span>
<span id="cb6-21"><a href="#cb6-21"></a>are automation — even if they take a few minutes, they still save hours</span>
<span id="cb6-22"><a href="#cb6-22"></a>of manual effort. But in practice, performance is about more than speed.</span>
<span id="cb6-23"><a href="#cb6-23"></a>Poorly written scripts can:</span>
<span id="cb6-24"><a href="#cb6-24"></a></span>
<span id="cb6-25"><a href="#cb6-25"></a><span class="ss">- </span>**Lock up EA’s UI**, frustrating other users.</span>
<span id="cb6-26"><a href="#cb6-26"></a></span>
<span id="cb6-27"><a href="#cb6-27"></a><span class="ss">- </span>**Generate incomplete results**, skipping elements when loops break.</span>
<span id="cb6-28"><a href="#cb6-28"></a></span>
<span id="cb6-29"><a href="#cb6-29"></a><span class="ss">- </span>**Produce overwhelming logs**, flooding the Output tab and crashing</span>
<span id="cb6-30"><a href="#cb6-30"></a>  EA.</span>
<span id="cb6-31"><a href="#cb6-31"></a></span>
<span id="cb6-32"><a href="#cb6-32"></a><span class="ss">- </span>**Time out in enterprise workflows**, failing integration pipelines.</span>
<span id="cb6-33"><a href="#cb6-33"></a></span>
<span id="cb6-34"><a href="#cb6-34"></a>Performance is therefore about reliability as well as speed. Scripts</span>
<span id="cb6-35"><a href="#cb6-35"></a>that scale are scripts that can be trusted.</span>
<span id="cb6-36"><a href="#cb6-36"></a></span>
<span id="cb6-37"><a href="#cb6-37"></a><span class="fu">## Sources of Slowness</span></span>
<span id="cb6-38"><a href="#cb6-38"></a></span>
<span id="cb6-39"><a href="#cb6-39"></a>There are a few common culprits for slow scripts:</span>
<span id="cb6-40"><a href="#cb6-40"></a></span>
<span id="cb6-41"><a href="#cb6-41"></a><span class="ss">- </span>**UI logging**: Session.Output is surprisingly expensive when called</span>
<span id="cb6-42"><a href="#cb6-42"></a>  thousands of times.</span>
<span id="cb6-43"><a href="#cb6-43"></a></span>
<span id="cb6-44"><a href="#cb6-44"></a><span class="ss">- </span>**Inefficient traversal**: deep recursion or redundant queries slow</span>
<span id="cb6-45"><a href="#cb6-45"></a>  scripts down.</span>
<span id="cb6-46"><a href="#cb6-46"></a></span>
<span id="cb6-47"><a href="#cb6-47"></a><span class="ss">- </span>**Excessive updates**: calling .Update() unnecessarily adds overhead.</span>
<span id="cb6-48"><a href="#cb6-48"></a></span>
<span id="cb6-49"><a href="#cb6-49"></a><span class="ss">- </span>**Unfiltered loops**: traversing everything when only a subset is</span>
<span id="cb6-50"><a href="#cb6-50"></a>  needed.</span>
<span id="cb6-51"><a href="#cb6-51"></a></span>
<span id="cb6-52"><a href="#cb6-52"></a><span class="ss">- </span>**SQL misuse**: failing to use SQL for large reads, or misusing SQL</span>
<span id="cb6-53"><a href="#cb6-53"></a>  for writes.</span>
<span id="cb6-54"><a href="#cb6-54"></a></span>
<span id="cb6-55"><a href="#cb6-55"></a>Understanding these bottlenecks is the first step to avoiding them.</span>
<span id="cb6-56"><a href="#cb6-56"></a></span>
<span id="cb6-57"><a href="#cb6-57"></a><span class="fu">## Measure First</span></span>
<span id="cb6-58"><a href="#cb6-58"></a></span>
<span id="cb6-59"><a href="#cb6-59"></a>The golden rule of performance is: **measure before you optimise**. In</span>
<span id="cb6-60"><a href="#cb6-60"></a>scripting, this means timing your loops and logging throughput. For</span>
<span id="cb6-61"><a href="#cb6-61"></a>example, processing 10,000 elements in 5 seconds is healthy; in 50</span>
<span id="cb6-62"><a href="#cb6-62"></a>minutes, it is not. By measuring, you can identify where the script</span>
<span id="cb6-63"><a href="#cb6-63"></a>spends most of its time.</span>
<span id="cb6-64"><a href="#cb6-64"></a></span>
<span id="cb6-65"><a href="#cb6-65"></a>In practice, you can use simple timers (Date().getTime() in JScript) to</span>
<span id="cb6-66"><a href="#cb6-66"></a>record how long operations take. Always include performance metrics in</span>
<span id="cb6-67"><a href="#cb6-67"></a>your logs.</span>
<span id="cb6-68"><a href="#cb6-68"></a></span>
<span id="cb6-69"><a href="#cb6-69"></a><span class="fu">## Tips</span></span>
<span id="cb6-70"><a href="#cb6-70"></a></span>
<span id="cb6-71"><a href="#cb6-71"></a><span class="fu">### SQL for Find, API for Write</span></span>
<span id="cb6-72"><a href="#cb6-72"></a></span>
<span id="cb6-73"><a href="#cb6-73"></a>One of the most effective performance strategies is:</span>
<span id="cb6-74"><a href="#cb6-74"></a></span>
<span id="cb6-75"><a href="#cb6-75"></a><span class="ss">- </span>**Find with SQL**: use Repository.SQLQuery to locate candidates</span>
<span id="cb6-76"><a href="#cb6-76"></a>  quickly.</span>
<span id="cb6-77"><a href="#cb6-77"></a></span>
<span id="cb6-78"><a href="#cb6-78"></a><span class="ss">- </span>**Write with API**: use EA’s object model for updates, ensuring</span>
<span id="cb6-79"><a href="#cb6-79"></a>  integrity.</span>
<span id="cb6-80"><a href="#cb6-80"></a></span>
<span id="cb6-81"><a href="#cb6-81"></a>SQL queries are far faster than traversing the entire package tree with</span>
<span id="cb6-82"><a href="#cb6-82"></a>.Count/.GetAt(). But writing directly via SQL risks corruption. The</span>
<span id="cb6-83"><a href="#cb6-83"></a>combination of SQL reads and API writes gives the best of both worlds.</span>
<span id="cb6-84"><a href="#cb6-84"></a></span>
<span id="cb6-85"><a href="#cb6-85"></a><span class="fu">### Chunking Updates</span></span>
<span id="cb6-86"><a href="#cb6-86"></a></span>
<span id="cb6-87"><a href="#cb6-87"></a>Large updates should be chunked. Updating thousands of elements in one</span>
<span id="cb6-88"><a href="#cb6-88"></a>continuous loop can overwhelm EA’s UI and lock it up. Instead, process</span>
<span id="cb6-89"><a href="#cb6-89"></a>in batches — for example, 250 elements at a time — and refresh the model</span>
<span id="cb6-90"><a href="#cb6-90"></a>view between batches.</span>
<span id="cb6-91"><a href="#cb6-91"></a></span>
<span id="cb6-92"><a href="#cb6-92"></a>This chunking approach improves responsiveness and reduces the risk of</span>
<span id="cb6-93"><a href="#cb6-93"></a>EA appearing frozen. It also makes logs easier to review.</span>
<span id="cb6-94"><a href="#cb6-94"></a></span>
<span id="cb6-95"><a href="#cb6-95"></a><span class="fu">### Iterative Traversal</span></span>
<span id="cb6-96"><a href="#cb6-96"></a></span>
<span id="cb6-97"><a href="#cb6-97"></a>Recursion is elegant but risky in large models. Deep package trees can</span>
<span id="cb6-98"><a href="#cb6-98"></a>hit recursion limits or create excessive stack usage. Iterative</span>
<span id="cb6-99"><a href="#cb6-99"></a>traversal using a queue (breadth-first) is safer and more scalable. It</span>
<span id="cb6-100"><a href="#cb6-100"></a>avoids call-stack overflows and makes the traversal logic clearer.</span>
<span id="cb6-101"><a href="#cb6-101"></a></span>
<span id="cb6-102"><a href="#cb6-102"></a><span class="fu">### Idempotence and Skipping</span></span>
<span id="cb6-103"><a href="#cb6-103"></a></span>
<span id="cb6-104"><a href="#cb6-104"></a>Performance is not only about speed but also about avoiding unnecessary</span>
<span id="cb6-105"><a href="#cb6-105"></a>work. If an element already has the correct stereotype or tag, there is</span>
<span id="cb6-106"><a href="#cb6-106"></a>no need to update it. Idempotent scripts — those that skip items already</span>
<span id="cb6-107"><a href="#cb6-107"></a>in the correct state — run faster and reduce risk.</span>
<span id="cb6-108"><a href="#cb6-108"></a></span>
<span id="cb6-109"><a href="#cb6-109"></a><span class="fu">### Logging Without Flooding</span></span>
<span id="cb6-110"><a href="#cb6-110"></a></span>
<span id="cb6-111"><a href="#cb6-111"></a>Logging is vital for safety, but excessive logging kills performance.</span>
<span id="cb6-112"><a href="#cb6-112"></a>Writing 50,000 lines to EA’s Output tab can freeze the tool. The safe</span>
<span id="cb6-113"><a href="#cb6-113"></a>practice is to log **summary to Output** and **details to CSV**. This</span>
<span id="cb6-114"><a href="#cb6-114"></a>gives you transparency without choking the UI.</span>
<span id="cb6-115"><a href="#cb6-115"></a></span>
<span id="cb6-116"><a href="#cb6-116"></a><span class="fu">### External Automation for Heavy Jobs</span></span>
<span id="cb6-117"><a href="#cb6-117"></a></span>
<span id="cb6-118"><a href="#cb6-118"></a>Sometimes the best way to scale is to move heavy jobs outside EA.</span>
<span id="cb6-119"><a href="#cb6-119"></a>External automation in Python or C# can handle large CSVs, JSON, or</span>
<span id="cb6-120"><a href="#cb6-120"></a>analytics, leaving EA to focus on updates. Splitting work this way makes</span>
<span id="cb6-121"><a href="#cb6-121"></a>scripts leaner and safer.</span>
<span id="cb6-122"><a href="#cb6-122"></a></span>
<span id="cb6-123"><a href="#cb6-123"></a><span class="fu">## Principles</span></span>
<span id="cb6-124"><a href="#cb6-124"></a></span>
<span id="cb6-125"><a href="#cb6-125"></a><span class="ss">1.  </span>**Measure**: time the script and log throughput (items/sec).</span>
<span id="cb6-126"><a href="#cb6-126"></a></span>
<span id="cb6-127"><a href="#cb6-127"></a><span class="ss">2.  </span>**Reduce UI overhead**: write to a file (CSV) instead of spamming</span>
<span id="cb6-128"><a href="#cb6-128"></a>    Output; refresh UI only once at the end or per large batch.</span>
<span id="cb6-129"><a href="#cb6-129"></a></span>
<span id="cb6-130"><a href="#cb6-130"></a><span class="ss">3.  </span>**Find with SQL, write with API**: SQL is fast for locating</span>
<span id="cb6-131"><a href="#cb6-131"></a>    candidates; API is safe for updates.</span>
<span id="cb6-132"><a href="#cb6-132"></a></span>
<span id="cb6-133"><a href="#cb6-133"></a><span class="ss">4.  </span>**Chunk**: commit changes in batches (e.g., 250); between batches,</span>
<span id="cb6-134"><a href="#cb6-134"></a>    give EA a chance to breathe (optional UI refresh).</span>
<span id="cb6-135"><a href="#cb6-135"></a></span>
<span id="cb6-136"><a href="#cb6-136"></a><span class="ss">5.  </span>**Iterative traversal**: avoid deep recursion; use a queue/stack to</span>
<span id="cb6-137"><a href="#cb6-137"></a>    walk package trees.</span>
<span id="cb6-138"><a href="#cb6-138"></a></span>
<span id="cb6-139"><a href="#cb6-139"></a><span class="ss">6.  </span>**Be idempotent**: skip items already in the desired state.</span>
<span id="cb6-140"><a href="#cb6-140"></a></span>
<span id="cb6-141"><a href="#cb6-141"></a><span class="ss">7.  </span>**No parallelism**: EA’s COM server is single-threaded</span>
<span id="cb6-142"><a href="#cb6-142"></a>    STA—concurrency won’t help.</span>
<span id="cb6-143"><a href="#cb6-143"></a></span>
<span id="cb6-144"><a href="#cb6-144"></a>All examples below are **ES3** and assume no shared helper file; each</span>
<span id="cb6-145"><a href="#cb6-145"></a>script includes its own minimal helpers.</span>
<span id="cb6-146"><a href="#cb6-146"></a></span>
<span id="cb6-147"><a href="#cb6-147"></a><span class="fu">## Examples</span></span>
<span id="cb6-148"><a href="#cb6-148"></a></span>
<span id="cb6-149"><a href="#cb6-149"></a><span class="fu">### Micro-helpers (copy/paste as needed)</span></span>
<span id="cb6-150"><a href="#cb6-150"></a><span class="in">```{.js filename="Example 17.1 - perf_helpers.js (inline for each example)"}</span></span>
<span id="cb6-151"><a href="#cb6-151"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb6-152"><a href="#cb6-152"></a><span class="co">// Example 17.1 - perf_helpers.js (inline for each example)</span></span>
<span id="cb6-153"><a href="#cb6-153"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb6-154"><a href="#cb6-154"></a><span class="kw">function</span> <span class="fu">nowMs</span>(){ <span class="cf">return</span> (<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span> }</span>
<span id="cb6-155"><a href="#cb6-155"></a><span class="kw">function</span> <span class="fu">trim</span>(s){ <span class="cf">return</span> s<span class="op">==</span><span class="kw">null</span><span class="op">?</span><span class="st">""</span><span class="op">:</span><span class="bu">String</span>(s)<span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">^\s+|\s+$</span><span class="ss">/g</span><span class="op">,</span><span class="st">""</span>)<span class="op">;</span> }</span>
<span id="cb6-156"><a href="#cb6-156"></a><span class="kw">function</span> <span class="fu">equalsIgnoreCase</span>(a<span class="op">,</span>b){ <span class="cf">return</span> <span class="bu">String</span>(a<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">==</span><span class="bu">String</span>(b<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">;</span> }</span>
<span id="cb6-157"><a href="#cb6-157"></a><span class="kw">function</span> <span class="fu">startsWith</span>(s<span class="op">,</span>p){ <span class="cf">return</span> <span class="bu">String</span>(s<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">indexOf</span>(p)<span class="op">===</span><span class="dv">0</span><span class="op">;</span> }</span>
<span id="cb6-158"><a href="#cb6-158"></a></span>
<span id="cb6-159"><a href="#cb6-159"></a><span class="co">// Directory chooser (directory only; no filenames)</span></span>
<span id="cb6-160"><a href="#cb6-160"></a><span class="kw">function</span> <span class="fu">pickFolder</span>(promptText){</span>
<span id="cb6-161"><a href="#cb6-161"></a>  <span class="kw">var</span> sh <span class="op">=</span> <span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Shell.Application"</span>)<span class="op">;</span></span>
<span id="cb6-162"><a href="#cb6-162"></a>  <span class="kw">var</span> f <span class="op">=</span> sh<span class="op">.</span><span class="fu">BrowseForFolder</span>(<span class="dv">0</span><span class="op">,</span> promptText<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb6-163"><a href="#cb6-163"></a>  <span class="cf">return</span> f <span class="op">?</span> f<span class="op">.</span><span class="at">Self</span><span class="op">.</span><span class="at">Path</span> <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb6-164"><a href="#cb6-164"></a>}</span>
<span id="cb6-165"><a href="#cb6-165"></a></span>
<span id="cb6-166"><a href="#cb6-166"></a><span class="co">// CSV writer (lightweight)</span></span>
<span id="cb6-167"><a href="#cb6-167"></a><span class="kw">function</span> <span class="fu">Csv</span>(path){</span>
<span id="cb6-168"><a href="#cb6-168"></a>  <span class="kw">var</span> fso <span class="op">=</span> <span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Scripting.FileSystemObject"</span>)<span class="op">;</span></span>
<span id="cb6-169"><a href="#cb6-169"></a>  <span class="kw">var</span> file <span class="op">=</span> fso<span class="op">.</span><span class="fu">OpenTextFile</span>(path<span class="op">,</span> <span class="dv">8</span> <span class="co">/*Append*/</span><span class="op">,</span> <span class="kw">true</span> <span class="co">/*Create*/</span>)<span class="op">;</span></span>
<span id="cb6-170"><a href="#cb6-170"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">w</span> <span class="op">=</span> <span class="kw">function</span>(line){ file<span class="op">.</span><span class="fu">WriteLine</span>(line)<span class="op">;</span> }<span class="op">;</span></span>
<span id="cb6-171"><a href="#cb6-171"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">close</span> <span class="op">=</span> <span class="kw">function</span>(){ file<span class="op">.</span><span class="fu">Close</span>()<span class="op">;</span> }<span class="op">;</span></span>
<span id="cb6-172"><a href="#cb6-172"></a>}</span>
<span id="cb6-173"><a href="#cb6-173"></a></span>
<span id="cb6-174"><a href="#cb6-174"></a></span>
<span id="cb6-175"><a href="#cb6-175"></a>### Pattern A —Timing Harness <span class="op">&amp;</span> Low<span class="op">-</span>noise Logging</span>
<span id="cb6-176"><a href="#cb6-176"></a></span>
<span id="cb6-177"><a href="#cb6-177"></a><span class="op">**</span>Goal<span class="op">:**</span> measure total time<span class="op">,</span> throughput<span class="op">,</span> and avoid slow Session<span class="op">.</span><span class="at">Output</span></span>
<span id="cb6-178"><a href="#cb6-178"></a>loops<span class="op">.</span></span>
<span id="cb6-179"><a href="#cb6-179"></a><span class="vs">```{.js filename="Example 17.2 - Perf_TimingHarness.js – JScript (ES3)"}</span></span>
<span id="cb6-180"><a href="#cb6-180"></a><span class="vs">// Example 17.2 - Perf_TimingHarness.js – JScript (ES3)</span></span>
<span id="cb6-181"><a href="#cb6-181"></a><span class="vs">// Purpose: Run any loop with minimal UI logging + CSV metrics</span></span>
<span id="cb6-182"><a href="#cb6-182"></a><span class="vs">// Usage: Select any package (context not required for the demo)</span></span>
<span id="cb6-183"><a href="#cb6-183"></a><span class="vs">// -------------------------------------------------------</span></span>
<span id="cb6-184"><a href="#cb6-184"></a><span class="vs">!INC Local Scripts.EAConstants-JScript</span></span>
<span id="cb6-185"><a href="#cb6-185"></a></span>
<span id="cb6-186"><a href="#cb6-186"></a><span class="vs">function nowMs(){ return (new Date()).getTime(); }</span></span>
<span id="cb6-187"><a href="#cb6-187"></a><span class="vs">function pickFolder(t){ var sh=new ActiveXObject("Shell.Application"); var f=sh.BrowseForFolder(0,t,0,0); return f?f.Self.Path:null; }</span></span>
<span id="cb6-188"><a href="#cb6-188"></a><span class="vs">function Csv(path){ var fso=new ActiveXObject("Scripting.FileSystemObject"); var f=fso.OpenTextFile(path,8,true); this.w=function(l){f.WriteLine(l);}; this.close=function(){f.Close();}; }</span></span>
<span id="cb6-189"><a href="#cb6-189"></a></span>
<span id="cb6-190"><a href="#cb6-190"></a><span class="vs">function main(){</span></span>
<span id="cb6-191"><a href="#cb6-191"></a><span class="vs">  var outDir = pickFolder("Select output folder for perf log");</span></span>
<span id="cb6-192"><a href="#cb6-192"></a><span class="vs">  if(!outDir){ Session.Prompt("Cancelled.", promptOK); return; }</span></span>
<span id="cb6-193"><a href="#cb6-193"></a></span>
<span id="cb6-194"><a href="#cb6-194"></a><span class="vs">  var stamp = (new Date()).getTime();</span></span>
<span id="cb6-195"><a href="#cb6-195"></a><span class="vs">  var csv = new Csv(outDir+"</span><span class="sc">\\</span><span class="vs">perf_metrics_"+stamp+".csv");</span></span>
<span id="cb6-196"><a href="#cb6-196"></a><span class="vs">  csv.w("Metric,Value");</span></span>
<span id="cb6-197"><a href="#cb6-197"></a></span>
<span id="cb6-198"><a href="#cb6-198"></a><span class="vs">  var T0 = nowMs();</span></span>
<span id="cb6-199"><a href="#cb6-199"></a><span class="vs">  var N  = 20000; // simulate 20k lightweight ops (replace with real loop)</span></span>
<span id="cb6-200"><a href="#cb6-200"></a><span class="vs">  var i;</span></span>
<span id="cb6-201"><a href="#cb6-201"></a><span class="vs">  for(i=0;i&lt;N;i++){</span></span>
<span id="cb6-202"><a href="#cb6-202"></a><span class="vs">    // do nothing (placeholder for your per-item work)</span></span>
<span id="cb6-203"><a href="#cb6-203"></a><span class="vs">    // avoid Session.Output inside hot loops</span></span>
<span id="cb6-204"><a href="#cb6-204"></a><span class="vs">  }</span></span>
<span id="cb6-205"><a href="#cb6-205"></a><span class="vs">  var dt = nowMs()-T0;</span></span>
<span id="cb6-206"><a href="#cb6-206"></a><span class="vs">  var perSec = (N&gt;0)? Math.round((N*1000.0)/dt) : 0;</span></span>
<span id="cb6-207"><a href="#cb6-207"></a></span>
<span id="cb6-208"><a href="#cb6-208"></a><span class="vs">  csv.w("Items,"+N);</span></span>
<span id="cb6-209"><a href="#cb6-209"></a><span class="vs">  csv.w("Millis,"+dt);</span></span>
<span id="cb6-210"><a href="#cb6-210"></a><span class="vs">  csv.w("Throughput_items_per_sec,"+perSec);</span></span>
<span id="cb6-211"><a href="#cb6-211"></a><span class="vs">  csv.close();</span></span>
<span id="cb6-212"><a href="#cb6-212"></a></span>
<span id="cb6-213"><a href="#cb6-213"></a><span class="vs">  Session.Output("Done. Items="+N+" Time(ms)="+dt+" Throughput="+perSec+"/s");</span></span>
<span id="cb6-214"><a href="#cb6-214"></a><span class="vs">}</span></span>
<span id="cb6-215"><a href="#cb6-215"></a><span class="vs">main();</span></span>
<span id="cb6-216"><a href="#cb6-216"></a></span>
<span id="cb6-217"><a href="#cb6-217"></a></span>
<span id="cb6-218"><a href="#cb6-218"></a><span class="vs">Adapt: wrap your actual processing loop and keep Output to a few lines.</span></span>
<span id="cb6-219"><a href="#cb6-219"></a><span class="vs">For detailed logs, write to CSV instead.</span></span>
<span id="cb6-220"><a href="#cb6-220"></a></span>
<span id="cb6-221"><a href="#cb6-221"></a><span class="vs">### Pattern B — SQL-Accelerated Find, API-Safe Write (with chunking)</span></span>
<span id="cb6-222"><a href="#cb6-222"></a></span>
<span id="cb6-223"><a href="#cb6-223"></a><span class="vs">**Use case:** set a stereotype on all **Class** elements missing one,</span></span>
<span id="cb6-224"><a href="#cb6-224"></a><span class="vs">across the repository.  </span></span>
<span id="cb6-225"><a href="#cb6-225"></a><span class="vs">**Approach:**</span></span>
<span id="cb6-226"><a href="#cb6-226"></a></span>
<span id="cb6-227"><a href="#cb6-227"></a><span class="vs">1.  **SQLQuery** all candidate IDs (fast).</span></span>
<span id="cb6-228"><a href="#cb6-228"></a></span>
<span id="cb6-229"><a href="#cb6-229"></a><span class="vs">2.  Process in **chunks of 250**; call Update() per element, refresh UI</span></span>
<span id="cb6-230"><a href="#cb6-230"></a><span class="vs">    only per chunk or once at the end.</span></span>
<span id="cb6-231"><a href="#cb6-231"></a></span>
<span id="cb6-232"><a href="#cb6-232"></a><span class="vs">3.  **DRY_RUN** for safety.</span></span>
<span id="cb6-233"><a href="#cb6-233"></a><span class="vs">```</span>{<span class="op">.</span><span class="at">js</span> filename<span class="op">=</span><span class="st">"Example 17.3 - Perf_SqlFind_ApiWrite_Chunked.js – JScript (ES3)"</span>}</span>
<span id="cb6-234"><a href="#cb6-234"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb6-235"><a href="#cb6-235"></a><span class="co">// Example 17.3 - Perf_SqlFind_ApiWrite_Chunked.js – JScript (ES3)</span></span>
<span id="cb6-236"><a href="#cb6-236"></a><span class="co">// Purpose: Fast find via SQL, chunked updates via API</span></span>
<span id="cb6-237"><a href="#cb6-237"></a><span class="co">// Safety: DRY_RUN = true by default</span></span>
<span id="cb6-238"><a href="#cb6-238"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb6-239"><a href="#cb6-239"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb6-240"><a href="#cb6-240"></a></span>
<span id="cb6-241"><a href="#cb6-241"></a><span class="kw">function</span> <span class="fu">nowMs</span>(){ <span class="cf">return</span> (<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span> }</span>
<span id="cb6-242"><a href="#cb6-242"></a><span class="kw">function</span> <span class="fu">pickFolder</span>(t){ <span class="kw">var</span> sh<span class="op">=</span><span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Shell.Application"</span>)<span class="op">;</span> <span class="kw">var</span> f<span class="op">=</span>sh<span class="op">.</span><span class="fu">BrowseForFolder</span>(<span class="dv">0</span><span class="op">,</span>t<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span>)<span class="op">;</span> <span class="cf">return</span> f<span class="op">?</span>f<span class="op">.</span><span class="at">Self</span><span class="op">.</span><span class="at">Path</span><span class="op">:</span><span class="kw">null</span><span class="op">;</span> }</span>
<span id="cb6-243"><a href="#cb6-243"></a><span class="kw">function</span> <span class="fu">Csv</span>(path){ <span class="kw">var</span> fso<span class="op">=</span><span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Scripting.FileSystemObject"</span>)<span class="op">;</span> <span class="kw">var</span> f<span class="op">=</span>fso<span class="op">.</span><span class="fu">OpenTextFile</span>(path<span class="op">,</span><span class="dv">8</span><span class="op">,</span><span class="kw">true</span>)<span class="op">;</span> <span class="kw">this</span><span class="op">.</span><span class="at">w</span><span class="op">=</span><span class="kw">function</span>(l){f<span class="op">.</span><span class="fu">WriteLine</span>(l)<span class="op">;</span>}<span class="op">;</span> <span class="kw">this</span><span class="op">.</span><span class="at">close</span><span class="op">=</span><span class="kw">function</span>(){f<span class="op">.</span><span class="fu">Close</span>()<span class="op">;</span>}<span class="op">;</span> }</span>
<span id="cb6-244"><a href="#cb6-244"></a></span>
<span id="cb6-245"><a href="#cb6-245"></a><span class="kw">function</span> <span class="fu">extractAll</span>(h<span class="op">,</span>openTag<span class="op">,</span>closeTag){</span>
<span id="cb6-246"><a href="#cb6-246"></a>  <span class="kw">var</span> res<span class="op">=</span>[]<span class="op">,</span> start<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-247"><a href="#cb6-247"></a>  <span class="cf">while</span>(<span class="kw">true</span>){</span>
<span id="cb6-248"><a href="#cb6-248"></a>    <span class="kw">var</span> i<span class="op">=</span>h<span class="op">.</span><span class="fu">indexOf</span>(openTag<span class="op">,</span>start)<span class="op">;</span> <span class="cf">if</span>(i<span class="op">&lt;</span><span class="dv">0</span>) <span class="cf">break</span><span class="op">;</span></span>
<span id="cb6-249"><a href="#cb6-249"></a>    <span class="kw">var</span> j<span class="op">=</span>h<span class="op">.</span><span class="fu">indexOf</span>(closeTag<span class="op">,</span>i<span class="op">+</span>openTag<span class="op">.</span><span class="at">length</span>)<span class="op">;</span> <span class="cf">if</span>(j<span class="op">&lt;</span><span class="dv">0</span>) <span class="cf">break</span><span class="op">;</span></span>
<span id="cb6-250"><a href="#cb6-250"></a>    res<span class="op">.</span><span class="fu">push</span>(h<span class="op">.</span><span class="fu">substring</span>(i<span class="op">+</span>openTag<span class="op">.</span><span class="at">length</span><span class="op">,</span>j))<span class="op">;</span></span>
<span id="cb6-251"><a href="#cb6-251"></a>    start<span class="op">=</span>j<span class="op">+</span>closeTag<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb6-252"><a href="#cb6-252"></a>  }</span>
<span id="cb6-253"><a href="#cb6-253"></a>  <span class="cf">return</span> res<span class="op">;</span></span>
<span id="cb6-254"><a href="#cb6-254"></a>}</span>
<span id="cb6-255"><a href="#cb6-255"></a></span>
<span id="cb6-256"><a href="#cb6-256"></a><span class="kw">function</span> <span class="fu">main</span>(){</span>
<span id="cb6-257"><a href="#cb6-257"></a>  <span class="kw">var</span> DRY_RUN <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb6-258"><a href="#cb6-258"></a>  <span class="kw">var</span> TYPE_FILTER <span class="op">=</span> <span class="st">"Class"</span><span class="op">;</span></span>
<span id="cb6-259"><a href="#cb6-259"></a>  <span class="kw">var</span> TARGET_STEREO <span class="op">=</span> <span class="st">"DomainObject"</span><span class="op">;</span></span>
<span id="cb6-260"><a href="#cb6-260"></a>  <span class="kw">var</span> CHUNK <span class="op">=</span> <span class="dv">250</span><span class="op">;</span></span>
<span id="cb6-261"><a href="#cb6-261"></a></span>
<span id="cb6-262"><a href="#cb6-262"></a>  <span class="kw">var</span> outDir <span class="op">=</span> <span class="fu">pickFolder</span>(<span class="st">"Select output folder for change log"</span>)<span class="op">;</span></span>
<span id="cb6-263"><a href="#cb6-263"></a>  <span class="cf">if</span>(<span class="op">!</span>outDir){ Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Cancelled."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb6-264"><a href="#cb6-264"></a>  <span class="kw">var</span> stamp<span class="op">=</span>(<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb6-265"><a href="#cb6-265"></a>  <span class="kw">var</span> csv<span class="op">=</span><span class="kw">new</span> <span class="fu">Csv</span>(outDir<span class="op">+</span><span class="st">"</span><span class="sc">\\</span><span class="st">chunked_changes_"</span><span class="op">+</span>stamp<span class="op">+</span><span class="st">".csv"</span>)<span class="op">;</span></span>
<span id="cb6-266"><a href="#cb6-266"></a>  csv<span class="op">.</span><span class="fu">w</span>(<span class="st">"Action,ElementID,Name,OldStereo,NewStereo"</span>)<span class="op">;</span></span>
<span id="cb6-267"><a href="#cb6-267"></a></span>
<span id="cb6-268"><a href="#cb6-268"></a>  <span class="kw">var</span> t0<span class="op">=</span><span class="fu">nowMs</span>()<span class="op">;</span></span>
<span id="cb6-269"><a href="#cb6-269"></a>  <span class="co">// 1) fast find: candidates with empty stereotype (rough pre-filter)</span></span>
<span id="cb6-270"><a href="#cb6-270"></a>  <span class="kw">var</span> sql<span class="op">=</span><span class="st">"SELECT Object_ID, Name, Stereotype FROM t_object WHERE Object_Type='"</span><span class="op">+</span>TYPE_FILTER<span class="op">+</span><span class="st">"' AND (Stereotype IS NULL OR Stereotype='')"</span><span class="op">;</span></span>
<span id="cb6-271"><a href="#cb6-271"></a>  <span class="kw">var</span> xml<span class="op">=</span>Repository<span class="op">.</span><span class="fu">SQLQuery</span>(sql)<span class="op">;</span></span>
<span id="cb6-272"><a href="#cb6-272"></a>  <span class="kw">var</span> ids<span class="op">=</span><span class="fu">extractAll</span>(xml<span class="op">,</span><span class="st">"&lt;Object_ID&gt;"</span><span class="op">,</span><span class="st">"&lt;/Object_ID&gt;"</span>)<span class="op">;</span></span>
<span id="cb6-273"><a href="#cb6-273"></a>  <span class="kw">var</span> count<span class="op">=</span>ids<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb6-274"><a href="#cb6-274"></a>  Session<span class="op">.</span><span class="fu">Output</span>(<span class="st">"Candidates: "</span><span class="op">+</span>count)<span class="op">;</span></span>
<span id="cb6-275"><a href="#cb6-275"></a></span>
<span id="cb6-276"><a href="#cb6-276"></a>  <span class="kw">var</span> applied<span class="op">=</span><span class="dv">0</span><span class="op">,</span> batch<span class="op">=</span><span class="dv">0</span><span class="op">,</span> processed<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-277"><a href="#cb6-277"></a>  <span class="kw">var</span> i<span class="op">;</span></span>
<span id="cb6-278"><a href="#cb6-278"></a>  <span class="cf">for</span>(i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>count<span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb6-279"><a href="#cb6-279"></a>    <span class="kw">var</span> id<span class="op">=</span><span class="pp">parseInt</span>(ids[i]<span class="op">,</span><span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb6-280"><a href="#cb6-280"></a>    <span class="kw">var</span> e<span class="op">=</span>Repository<span class="op">.</span><span class="fu">GetElementByID</span>(id)<span class="op">;</span></span>
<span id="cb6-281"><a href="#cb6-281"></a>    <span class="cf">if</span>(<span class="op">!</span>e) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb6-282"><a href="#cb6-282"></a></span>
<span id="cb6-283"><a href="#cb6-283"></a>    <span class="co">// double-check to avoid redundant writes</span></span>
<span id="cb6-284"><a href="#cb6-284"></a>    <span class="kw">var</span> oldStereo<span class="op">=</span><span class="bu">String</span>(e<span class="op">.</span><span class="at">Stereotype</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span></span>
<span id="cb6-285"><a href="#cb6-285"></a>    <span class="cf">if</span>(oldStereo<span class="op">===</span><span class="st">""</span>){</span>
<span id="cb6-286"><a href="#cb6-286"></a>      csv<span class="op">.</span><span class="fu">w</span>((DRY_RUN<span class="op">?</span><span class="st">"DRY_RUN"</span><span class="op">:</span><span class="st">"SET"</span>) <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> e<span class="op">.</span><span class="at">ElementID</span> <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> oldStereo <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> TARGET_STEREO)<span class="op">;</span></span>
<span id="cb6-287"><a href="#cb6-287"></a>      <span class="cf">if</span>(<span class="op">!</span>DRY_RUN){ e<span class="op">.</span><span class="at">Stereotype</span> <span class="op">=</span> TARGET_STEREO<span class="op">;</span> e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> applied<span class="op">++;</span> }</span>
<span id="cb6-288"><a href="#cb6-288"></a>      batch<span class="op">++;</span></span>
<span id="cb6-289"><a href="#cb6-289"></a>    }</span>
<span id="cb6-290"><a href="#cb6-290"></a></span>
<span id="cb6-291"><a href="#cb6-291"></a>    processed<span class="op">++;</span></span>
<span id="cb6-292"><a href="#cb6-292"></a></span>
<span id="cb6-293"><a href="#cb6-293"></a>    <span class="co">// chunk boundary</span></span>
<span id="cb6-294"><a href="#cb6-294"></a>    <span class="cf">if</span>(batch<span class="op">&gt;=</span>CHUNK){</span>
<span id="cb6-295"><a href="#cb6-295"></a>      <span class="co">// optional: rare refresh so the UI doesn't feel stale</span></span>
<span id="cb6-296"><a href="#cb6-296"></a>      <span class="cf">if</span>(<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> applied<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb6-297"><a href="#cb6-297"></a>      batch<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-298"><a href="#cb6-298"></a>    }</span>
<span id="cb6-299"><a href="#cb6-299"></a>  }</span>
<span id="cb6-300"><a href="#cb6-300"></a></span>
<span id="cb6-301"><a href="#cb6-301"></a>  <span class="cf">if</span>(<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> applied<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb6-302"><a href="#cb6-302"></a>  csv<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb6-303"><a href="#cb6-303"></a></span>
<span id="cb6-304"><a href="#cb6-304"></a>  <span class="kw">var</span> dt<span class="op">=</span><span class="fu">nowMs</span>()<span class="op">-</span>t0<span class="op">;</span></span>
<span id="cb6-305"><a href="#cb6-305"></a>  <span class="kw">var</span> rps <span class="op">=</span> processed<span class="op">&gt;</span><span class="dv">0</span> <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(<span class="fl">1000.0</span><span class="op">*</span>processed<span class="op">/</span>dt) <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-306"><a href="#cb6-306"></a>  Session<span class="op">.</span><span class="fu">Output</span>(<span class="st">"Processed="</span><span class="op">+</span>processed<span class="op">+</span><span class="st">" Applied="</span><span class="op">+</span>applied<span class="op">+</span><span class="st">" Time(ms)="</span><span class="op">+</span>dt<span class="op">+</span><span class="st">" Throughput="</span><span class="op">+</span>rps<span class="op">+</span><span class="st">"/s DRY_RUN="</span><span class="op">+</span>DRY_RUN)<span class="op">;</span></span>
<span id="cb6-307"><a href="#cb6-307"></a>}</span>
<span id="cb6-308"><a href="#cb6-308"></a><span class="fu">main</span>()<span class="op">;</span></span>
<span id="cb6-309"><a href="#cb6-309"></a><span class="in">```</span></span>
<span id="cb6-310"><a href="#cb6-310"></a></span>
<span id="cb6-311"><a href="#cb6-311"></a>**Why it’s fast:** the *find* phase is one SQL call. The *write* phase</span>
<span id="cb6-312"><a href="#cb6-312"></a>avoids extra lookups and refreshes only in large intervals.</span>
<span id="cb6-313"><a href="#cb6-313"></a></span>
<span id="cb6-314"><a href="#cb6-314"></a><span class="fu">### Pattern C — Iterative Package Traversal (no recursion)</span></span>
<span id="cb6-315"><a href="#cb6-315"></a></span>
<span id="cb6-316"><a href="#cb6-316"></a>Recursive tree walks can hit call-stack limits and are slower than a</span>
<span id="cb6-317"><a href="#cb6-317"></a>simple queue. This **breadth-first** traversal scales better.</span>
<span id="cb6-318"><a href="#cb6-318"></a><span class="in">```{.js filename="Example 17.4 - Perf_PackageWalk_Iterative.js – JScript (ES3)"}</span></span>
<span id="cb6-319"><a href="#cb6-319"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb6-320"><a href="#cb6-320"></a><span class="co">// Example 17.4 - Perf_PackageWalk_Iterative.js – JScript (ES3)</span></span>
<span id="cb6-321"><a href="#cb6-321"></a><span class="co">// Purpose: Walk an entire package tree without recursion</span></span>
<span id="cb6-322"><a href="#cb6-322"></a><span class="co">// Action: Count elements by type (as an example)</span></span>
<span id="cb6-323"><a href="#cb6-323"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb6-324"><a href="#cb6-324"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb6-325"><a href="#cb6-325"></a></span>
<span id="cb6-326"><a href="#cb6-326"></a><span class="kw">function</span> <span class="fu">main</span>(){</span>
<span id="cb6-327"><a href="#cb6-327"></a>  <span class="kw">var</span> pkg <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span>()<span class="op">;</span></span>
<span id="cb6-328"><a href="#cb6-328"></a>  <span class="cf">if</span>(<span class="op">!</span>pkg){ Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Select a root package."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb6-329"><a href="#cb6-329"></a></span>
<span id="cb6-330"><a href="#cb6-330"></a>  <span class="kw">var</span> queue<span class="op">=</span>[pkg]<span class="op">;</span></span>
<span id="cb6-331"><a href="#cb6-331"></a>  <span class="kw">var</span> typeCount <span class="op">=</span> {}<span class="op">;</span> <span class="co">// map type -&gt; number</span></span>
<span id="cb6-332"><a href="#cb6-332"></a></span>
<span id="cb6-333"><a href="#cb6-333"></a>  <span class="cf">while</span>(queue<span class="op">.</span><span class="at">length</span><span class="op">&gt;</span><span class="dv">0</span>){</span>
<span id="cb6-334"><a href="#cb6-334"></a>    <span class="kw">var</span> p <span class="op">=</span> queue<span class="op">.</span><span class="fu">shift</span>()<span class="op">;</span></span>
<span id="cb6-335"><a href="#cb6-335"></a></span>
<span id="cb6-336"><a href="#cb6-336"></a>    <span class="co">// enqueue children</span></span>
<span id="cb6-337"><a href="#cb6-337"></a>    <span class="kw">var</span> kids <span class="op">=</span> p<span class="op">.</span><span class="at">Packages</span><span class="op">;</span></span>
<span id="cb6-338"><a href="#cb6-338"></a>    <span class="cf">for</span>(<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>kids<span class="op">.</span><span class="at">Count</span><span class="op">;</span>i<span class="op">++</span>){ queue<span class="op">.</span><span class="fu">push</span>(kids<span class="op">.</span><span class="fu">GetAt</span>(i))<span class="op">;</span> }</span>
<span id="cb6-339"><a href="#cb6-339"></a></span>
<span id="cb6-340"><a href="#cb6-340"></a>    <span class="co">// tally elements</span></span>
<span id="cb6-341"><a href="#cb6-341"></a>    <span class="kw">var</span> els <span class="op">=</span> p<span class="op">.</span><span class="at">Elements</span><span class="op">;</span></span>
<span id="cb6-342"><a href="#cb6-342"></a>    <span class="cf">for</span>(<span class="kw">var</span> j<span class="op">=</span><span class="dv">0</span><span class="op">;</span>j<span class="op">&lt;</span>els<span class="op">.</span><span class="at">Count</span><span class="op">;</span>j<span class="op">++</span>){</span>
<span id="cb6-343"><a href="#cb6-343"></a>      <span class="kw">var</span> e <span class="op">=</span> els<span class="op">.</span><span class="fu">GetAt</span>(j)<span class="op">;</span></span>
<span id="cb6-344"><a href="#cb6-344"></a>      <span class="kw">var</span> t <span class="op">=</span> e<span class="op">.</span><span class="at">Type</span><span class="op">;</span></span>
<span id="cb6-345"><a href="#cb6-345"></a>      typeCount[t] <span class="op">=</span> (typeCount[t]<span class="op">||</span><span class="dv">0</span>)<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb6-346"><a href="#cb6-346"></a>    }</span>
<span id="cb6-347"><a href="#cb6-347"></a>  }</span>
<span id="cb6-348"><a href="#cb6-348"></a></span>
<span id="cb6-349"><a href="#cb6-349"></a>  <span class="co">// low-noise summary output</span></span>
<span id="cb6-350"><a href="#cb6-350"></a>  Session<span class="op">.</span><span class="fu">Output</span>(<span class="st">"Element counts by Type:"</span>)<span class="op">;</span></span>
<span id="cb6-351"><a href="#cb6-351"></a>  <span class="kw">var</span> k<span class="op">;</span> <span class="cf">for</span>(k <span class="kw">in</span> typeCount){ <span class="cf">if</span>(typeCount<span class="op">.</span><span class="fu">hasOwnProperty</span>(k)){ Session<span class="op">.</span><span class="fu">Output</span>(<span class="st">"  "</span><span class="op">+</span>k<span class="op">+</span><span class="st">": "</span><span class="op">+</span>typeCount[k])<span class="op">;</span> } }</span>
<span id="cb6-352"><a href="#cb6-352"></a>}</span>
<span id="cb6-353"><a href="#cb6-353"></a><span class="fu">main</span>()<span class="op">;</span></span>
<span id="cb6-354"><a href="#cb6-354"></a><span class="in">```</span></span>
<span id="cb6-355"><a href="#cb6-355"></a></span>
<span id="cb6-356"><a href="#cb6-356"></a>**Why it’s scalable:** avoids deep call stacks and allocates a tiny</span>
<span id="cb6-357"><a href="#cb6-357"></a>queue instead of many temporary stacks frames.</span>
<span id="cb6-358"><a href="#cb6-358"></a></span>
<span id="cb6-359"><a href="#cb6-359"></a><span class="fu">### Pattern D — Large CSV Apply (streaming + batching)</span></span>
<span id="cb6-360"><a href="#cb6-360"></a></span>
<span id="cb6-361"><a href="#cb6-361"></a>Reading a giant CSV and applying changes? Keep parsing **simple**, skip</span>
<span id="cb6-362"><a href="#cb6-362"></a>unchanged rows, and batch writes.</span>
<span id="cb6-363"><a href="#cb6-363"></a><span class="in">```{.js filename="Example 17.5 - Perf_CsvApply_Batched.js – JScript (ES3)"}</span></span>
<span id="cb6-364"><a href="#cb6-364"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb6-365"><a href="#cb6-365"></a><span class="co">// Example 17.5 - Perf_CsvApply_Batched.js – JScript (ES3)</span></span>
<span id="cb6-366"><a href="#cb6-366"></a><span class="co">// Purpose: Apply safe updates from a curated CSV with batching</span></span>
<span id="cb6-367"><a href="#cb6-367"></a><span class="co">// CSV columns (example): Apply,ElementID,NewStatus</span></span>
<span id="cb6-368"><a href="#cb6-368"></a><span class="co">// Safety: Only Apply=YES rows execute; chunk writes; minimal UI refresh</span></span>
<span id="cb6-369"><a href="#cb6-369"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb6-370"><a href="#cb6-370"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb6-371"><a href="#cb6-371"></a></span>
<span id="cb6-372"><a href="#cb6-372"></a><span class="kw">function</span> <span class="fu">trim</span>(s){ <span class="cf">return</span> s<span class="op">==</span><span class="kw">null</span><span class="op">?</span><span class="st">""</span><span class="op">:</span><span class="bu">String</span>(s)<span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">^\s+|\s+$</span><span class="ss">/g</span><span class="op">,</span><span class="st">""</span>)<span class="op">;</span> }</span>
<span id="cb6-373"><a href="#cb6-373"></a><span class="kw">function</span> <span class="fu">pickFolder</span>(t){ <span class="kw">var</span> sh<span class="op">=</span><span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Shell.Application"</span>)<span class="op">;</span> <span class="kw">var</span> f<span class="op">=</span>sh<span class="op">.</span><span class="fu">BrowseForFolder</span>(<span class="dv">0</span><span class="op">,</span>t<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span>)<span class="op">;</span> <span class="cf">return</span> f<span class="op">?</span>f<span class="op">.</span><span class="at">Self</span><span class="op">.</span><span class="at">Path</span><span class="op">:</span><span class="kw">null</span><span class="op">;</span> }</span>
<span id="cb6-374"><a href="#cb6-374"></a><span class="kw">function</span> <span class="fu">endsWith</span>(s<span class="op">,</span>suf){ s<span class="op">=</span><span class="bu">String</span>(s<span class="op">||</span><span class="st">""</span>)<span class="op">;</span> <span class="kw">var</span> i<span class="op">=</span>s<span class="op">.</span><span class="fu">lastIndexOf</span>(suf)<span class="op">;</span> <span class="cf">return</span> i<span class="op">&gt;=</span><span class="dv">0</span> <span class="op">&amp;&amp;</span> i<span class="op">+</span>suf<span class="op">.</span><span class="at">length</span><span class="op">==</span>s<span class="op">.</span><span class="at">length</span><span class="op">;</span> }</span>
<span id="cb6-375"><a href="#cb6-375"></a></span>
<span id="cb6-376"><a href="#cb6-376"></a><span class="kw">function</span> <span class="fu">main</span>(){</span>
<span id="cb6-377"><a href="#cb6-377"></a>  <span class="kw">var</span> DRY_RUN <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb6-378"><a href="#cb6-378"></a>  <span class="kw">var</span> CHUNK <span class="op">=</span> <span class="dv">250</span><span class="op">;</span></span>
<span id="cb6-379"><a href="#cb6-379"></a></span>
<span id="cb6-380"><a href="#cb6-380"></a>  <span class="kw">var</span> dir <span class="op">=</span> <span class="fu">pickFolder</span>(<span class="st">"Select folder containing curated CSV"</span>)<span class="op">;</span></span>
<span id="cb6-381"><a href="#cb6-381"></a>  <span class="cf">if</span>(<span class="op">!</span>dir){ Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Cancelled."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb6-382"><a href="#cb6-382"></a></span>
<span id="cb6-383"><a href="#cb6-383"></a>  <span class="co">// Pick the newest CSV in the folder by a known prefix (customize if needed)</span></span>
<span id="cb6-384"><a href="#cb6-384"></a>  <span class="kw">var</span> fso<span class="op">=</span><span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Scripting.FileSystemObject"</span>)<span class="op">;</span></span>
<span id="cb6-385"><a href="#cb6-385"></a>  <span class="kw">var</span> folder<span class="op">=</span>fso<span class="op">.</span><span class="fu">GetFolder</span>(dir)<span class="op">;</span></span>
<span id="cb6-386"><a href="#cb6-386"></a>  <span class="kw">var</span> en<span class="op">=</span><span class="kw">new</span> <span class="fu">Enumerator</span>(folder<span class="op">.</span><span class="at">Files</span>)<span class="op">;</span></span>
<span id="cb6-387"><a href="#cb6-387"></a>  <span class="kw">var</span> newest<span class="op">=</span><span class="kw">null</span><span class="op">,</span> t<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-388"><a href="#cb6-388"></a>  <span class="cf">for</span>(<span class="op">;!</span>en<span class="op">.</span><span class="fu">atEnd</span>()<span class="op">;</span> en<span class="op">.</span><span class="fu">moveNext</span>()){</span>
<span id="cb6-389"><a href="#cb6-389"></a>    <span class="kw">var</span> f<span class="op">=</span>en<span class="op">.</span><span class="fu">item</span>()<span class="op">;</span></span>
<span id="cb6-390"><a href="#cb6-390"></a>    <span class="cf">if</span>(<span class="fu">endsWith</span>(f<span class="op">.</span><span class="at">Name</span><span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">,</span> <span class="st">".csv"</span>)){</span>
<span id="cb6-391"><a href="#cb6-391"></a>      <span class="kw">var</span> m<span class="op">=</span>f<span class="op">.</span><span class="at">DateLastModified</span><span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb6-392"><a href="#cb6-392"></a>      <span class="cf">if</span>(m<span class="op">&gt;</span>t){ newest<span class="op">=</span>f<span class="op">;</span> t<span class="op">=</span>m<span class="op">;</span> }</span>
<span id="cb6-393"><a href="#cb6-393"></a>    }</span>
<span id="cb6-394"><a href="#cb6-394"></a>  }</span>
<span id="cb6-395"><a href="#cb6-395"></a>  <span class="cf">if</span>(<span class="op">!</span>newest){ Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"No CSV found."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb6-396"><a href="#cb6-396"></a></span>
<span id="cb6-397"><a href="#cb6-397"></a>  <span class="kw">var</span> ts<span class="op">=</span>fso<span class="op">.</span><span class="fu">OpenTextFile</span>(newest<span class="op">.</span><span class="at">Path</span><span class="op">,</span><span class="dv">1</span>)<span class="op">;</span> <span class="co">// ForReading</span></span>
<span id="cb6-398"><a href="#cb6-398"></a>  <span class="co">// header</span></span>
<span id="cb6-399"><a href="#cb6-399"></a>  <span class="cf">if</span>(<span class="op">!</span>ts<span class="op">.</span><span class="at">AtEndOfStream</span>) ts<span class="op">.</span><span class="fu">ReadLine</span>()<span class="op">;</span></span>
<span id="cb6-400"><a href="#cb6-400"></a></span>
<span id="cb6-401"><a href="#cb6-401"></a>  <span class="kw">var</span> applied<span class="op">=</span><span class="dv">0</span><span class="op">,</span> considered<span class="op">=</span><span class="dv">0</span><span class="op">,</span> batch<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-402"><a href="#cb6-402"></a>  <span class="cf">while</span>(<span class="op">!</span>ts<span class="op">.</span><span class="at">AtEndOfStream</span>){</span>
<span id="cb6-403"><a href="#cb6-403"></a>    <span class="kw">var</span> line<span class="op">=</span>ts<span class="op">.</span><span class="fu">ReadLine</span>()<span class="op">;</span></span>
<span id="cb6-404"><a href="#cb6-404"></a>    <span class="cf">if</span>(<span class="fu">trim</span>(line)<span class="op">===</span><span class="st">""</span>) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb6-405"><a href="#cb6-405"></a>    <span class="co">// naive split (keep curation fields simple—avoid commas in cells)</span></span>
<span id="cb6-406"><a href="#cb6-406"></a>    <span class="kw">var</span> cells<span class="op">=</span>line<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">;</span></span>
<span id="cb6-407"><a href="#cb6-407"></a>    <span class="cf">if</span>(cells<span class="op">.</span><span class="at">length</span><span class="op">&lt;</span><span class="dv">3</span>) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb6-408"><a href="#cb6-408"></a></span>
<span id="cb6-409"><a href="#cb6-409"></a>    <span class="kw">var</span> apply<span class="op">=</span><span class="fu">trim</span>(cells[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb6-410"><a href="#cb6-410"></a>    <span class="kw">var</span> eid <span class="op">=</span> <span class="pp">parseInt</span>(cells[<span class="dv">1</span>]<span class="op">,</span><span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb6-411"><a href="#cb6-411"></a>    <span class="kw">var</span> newStatus <span class="op">=</span> <span class="fu">trim</span>(cells[<span class="dv">2</span>])<span class="op">;</span></span>
<span id="cb6-412"><a href="#cb6-412"></a></span>
<span id="cb6-413"><a href="#cb6-413"></a>    considered<span class="op">++;</span></span>
<span id="cb6-414"><a href="#cb6-414"></a></span>
<span id="cb6-415"><a href="#cb6-415"></a>    <span class="cf">if</span>(<span class="fu">equalsIgnoreCase</span>(apply<span class="op">,</span><span class="st">"YES"</span>) <span class="op">&amp;&amp;</span> eid<span class="op">&gt;</span><span class="dv">0</span>){</span>
<span id="cb6-416"><a href="#cb6-416"></a>      <span class="kw">var</span> e <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetElementByID</span>(eid)<span class="op">;</span></span>
<span id="cb6-417"><a href="#cb6-417"></a>      <span class="cf">if</span>(e <span class="op">&amp;&amp;</span> <span class="bu">String</span>(e<span class="op">.</span><span class="at">Status</span><span class="op">||</span><span class="st">""</span>) <span class="op">!=</span> newStatus){</span>
<span id="cb6-418"><a href="#cb6-418"></a>        <span class="cf">if</span>(<span class="op">!</span>DRY_RUN){ e<span class="op">.</span><span class="at">Status</span><span class="op">=</span>newStatus<span class="op">;</span> e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> applied<span class="op">++;</span> }</span>
<span id="cb6-419"><a href="#cb6-419"></a>        batch<span class="op">++;</span></span>
<span id="cb6-420"><a href="#cb6-420"></a>      }</span>
<span id="cb6-421"><a href="#cb6-421"></a>    }</span>
<span id="cb6-422"><a href="#cb6-422"></a></span>
<span id="cb6-423"><a href="#cb6-423"></a>    <span class="cf">if</span>(batch<span class="op">&gt;=</span>CHUNK){</span>
<span id="cb6-424"><a href="#cb6-424"></a>      <span class="cf">if</span>(<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> applied<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb6-425"><a href="#cb6-425"></a>      batch<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-426"><a href="#cb6-426"></a>    }</span>
<span id="cb6-427"><a href="#cb6-427"></a>  }</span>
<span id="cb6-428"><a href="#cb6-428"></a>  ts<span class="op">.</span><span class="fu">Close</span>()<span class="op">;</span></span>
<span id="cb6-429"><a href="#cb6-429"></a></span>
<span id="cb6-430"><a href="#cb6-430"></a>  <span class="cf">if</span>(<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> applied<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb6-431"><a href="#cb6-431"></a>  Session<span class="op">.</span><span class="fu">Output</span>(<span class="st">"CSV apply complete. Considered="</span><span class="op">+</span>considered<span class="op">+</span><span class="st">" Applied="</span><span class="op">+</span>applied<span class="op">+</span><span class="st">" DRY_RUN="</span><span class="op">+</span>DRY_RUN)<span class="op">;</span></span>
<span id="cb6-432"><a href="#cb6-432"></a>}</span>
<span id="cb6-433"><a href="#cb6-433"></a><span class="fu">main</span>()<span class="op">;</span></span>
<span id="cb6-434"><a href="#cb6-434"></a><span class="in">```</span></span>
<span id="cb6-435"><a href="#cb6-435"></a></span>
<span id="cb6-436"><a href="#cb6-436"></a>**Why it scales:** minimal parsing, batched writes, rare refreshes, and</span>
<span id="cb6-437"><a href="#cb6-437"></a>no per-row UI logs.</span>
<span id="cb6-438"><a href="#cb6-438"></a></span>
<span id="cb6-439"><a href="#cb6-439"></a><span class="fu">### Pattern E — Repository-wide “Exists?” checks via SQL</span></span>
<span id="cb6-440"><a href="#cb6-440"></a></span>
<span id="cb6-441"><a href="#cb6-441"></a>Before creating a new element (or relationship), **prove it doesn’t</span>
<span id="cb6-442"><a href="#cb6-442"></a>already exist**—using a quick SQL existence test.</span>
<span id="cb6-443"><a href="#cb6-443"></a></span>
<span id="cb6-444"><a href="#cb6-444"></a><span class="in">```{.js filename="Example 17.6 - Perf_ExistsCheck_SQL.js – JScript (ES3)"}</span></span>
<span id="cb6-445"><a href="#cb6-445"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb6-446"><a href="#cb6-446"></a><span class="co">// Example 17.6 - Perf_ExistsCheck_SQL.js – JScript (ES3)</span></span>
<span id="cb6-447"><a href="#cb6-447"></a><span class="co">// Purpose: Quick existence test for (Name,Type)</span></span>
<span id="cb6-448"><a href="#cb6-448"></a><span class="co">// Note: Adjust SQL for your DB if needed; this is generic enough for most back-ends</span></span>
<span id="cb6-449"><a href="#cb6-449"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb6-450"><a href="#cb6-450"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb6-451"><a href="#cb6-451"></a></span>
<span id="cb6-452"><a href="#cb6-452"></a><span class="kw">function</span> <span class="fu">esc</span>(s){ <span class="cf">return</span> <span class="bu">String</span>(s<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">replace</span>(<span class="ss">/'/g</span><span class="op">,</span> <span class="st">"''"</span>)<span class="op">;</span> }</span>
<span id="cb6-453"><a href="#cb6-453"></a><span class="kw">function</span> <span class="fu">between</span>(h<span class="op">,</span>a<span class="op">,</span>b){ <span class="kw">var</span> i<span class="op">=</span>h<span class="op">.</span><span class="fu">indexOf</span>(a)<span class="op">;</span> <span class="cf">if</span>(i<span class="op">&lt;</span><span class="dv">0</span>)return<span class="st">""</span><span class="op">;</span> <span class="kw">var</span> j<span class="op">=</span>h<span class="op">.</span><span class="fu">indexOf</span>(b<span class="op">,</span>i<span class="op">+</span>a<span class="op">.</span><span class="at">length</span>)<span class="op">;</span> <span class="cf">return</span> j<span class="op">&lt;</span><span class="dv">0</span><span class="op">?</span><span class="st">""</span><span class="op">:</span>h<span class="op">.</span><span class="fu">substring</span>(i<span class="op">+</span>a<span class="op">.</span><span class="at">length</span><span class="op">,</span>j)<span class="op">;</span> }</span>
<span id="cb6-454"><a href="#cb6-454"></a></span>
<span id="cb6-455"><a href="#cb6-455"></a><span class="kw">function</span> <span class="fu">existsByNameType</span>(name<span class="op">,</span> type){</span>
<span id="cb6-456"><a href="#cb6-456"></a>  <span class="kw">var</span> sql<span class="op">=</span><span class="st">"SELECT TOP 1 Object_ID FROM t_object WHERE Name='"</span><span class="op">+</span><span class="fu">esc</span>(name)<span class="op">+</span><span class="st">"' AND Object_Type='"</span><span class="op">+</span><span class="fu">esc</span>(type)<span class="op">+</span><span class="st">"'"</span><span class="op">;</span></span>
<span id="cb6-457"><a href="#cb6-457"></a>  <span class="kw">var</span> xml<span class="op">=</span>Repository<span class="op">.</span><span class="fu">SQLQuery</span>(sql)<span class="op">;</span></span>
<span id="cb6-458"><a href="#cb6-458"></a>  <span class="kw">var</span> id<span class="op">=</span><span class="fu">between</span>(xml<span class="op">,</span><span class="st">"&lt;Object_ID&gt;"</span><span class="op">,</span><span class="st">"&lt;/Object_ID&gt;"</span>)<span class="op">;</span></span>
<span id="cb6-459"><a href="#cb6-459"></a>  <span class="cf">return</span> id<span class="op">!==</span><span class="st">""</span><span class="op">;</span></span>
<span id="cb6-460"><a href="#cb6-460"></a>}</span>
<span id="cb6-461"><a href="#cb6-461"></a></span>
<span id="cb6-462"><a href="#cb6-462"></a><span class="kw">function</span> <span class="fu">main</span>(){</span>
<span id="cb6-463"><a href="#cb6-463"></a>  <span class="kw">var</span> found <span class="op">=</span> <span class="fu">existsByNameType</span>(<span class="st">"Customer"</span><span class="op">,</span><span class="st">"Class"</span>)<span class="op">;</span></span>
<span id="cb6-464"><a href="#cb6-464"></a>  Session<span class="op">.</span><span class="fu">Output</span>(<span class="st">"Customer/Class exists? "</span><span class="op">+</span>(found<span class="op">?</span><span class="st">"YES"</span><span class="op">:</span><span class="st">"NO"</span>))<span class="op">;</span></span>
<span id="cb6-465"><a href="#cb6-465"></a>}</span>
<span id="cb6-466"><a href="#cb6-466"></a><span class="fu">main</span>()<span class="op">;</span></span>
<span id="cb6-467"><a href="#cb6-467"></a><span class="in">```</span></span>
<span id="cb6-468"><a href="#cb6-468"></a></span>
<span id="cb6-469"><a href="#cb6-469"></a>**Performance tip:** do this **before** expensive creation logic,</span>
<span id="cb6-470"><a href="#cb6-470"></a>especially inside large importers.</span>
<span id="cb6-471"><a href="#cb6-471"></a></span>
<span id="cb6-472"><a href="#cb6-472"></a><span class="fu">### Pattern F — External Python for Heavy Lifting</span></span>
<span id="cb6-473"><a href="#cb6-473"></a></span>
<span id="cb6-474"><a href="#cb6-474"></a>When processing **very large** updates with lots of text/CSV/JSON</span>
<span id="cb6-475"><a href="#cb6-475"></a>parsing, use Python for the parsing, then EA’s API for the write</span>
<span id="cb6-476"><a href="#cb6-476"></a>boundary. (Bitness note from earlier chapters: use 32-bit Python to</span>
<span id="cb6-477"><a href="#cb6-477"></a>match EA.)</span>
<span id="cb6-478"><a href="#cb6-478"></a></span>
<span id="cb6-479"><a href="#cb6-479"></a><span class="in">```{.py filename="Example 17.6 - Perf_ExistsCheck_SQL.js – JScript (ES3)"}</span></span>
<span id="cb6-480"><a href="#cb6-480"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb6-481"><a href="#cb6-481"></a><span class="co"># Example 17.7 - perf_apply_large_external.py – Python 3 (pywin32)</span></span>
<span id="cb6-482"><a href="#cb6-482"></a><span class="co"># Purpose: Chunked status updates from a big CSV, with guards</span></span>
<span id="cb6-483"><a href="#cb6-483"></a><span class="co"># Usage: python perf_apply_large_external.py input.csv</span></span>
<span id="cb6-484"><a href="#cb6-484"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb6-485"><a href="#cb6-485"></a><span class="im">import</span> sys, csv, win32com.client</span>
<span id="cb6-486"><a href="#cb6-486"></a></span>
<span id="cb6-487"><a href="#cb6-487"></a>CHUNK <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb6-488"><a href="#cb6-488"></a></span>
<span id="cb6-489"><a href="#cb6-489"></a><span class="kw">def</span> main(path):</span>
<span id="cb6-490"><a href="#cb6-490"></a>    ea <span class="op">=</span> win32com.client.Dispatch(<span class="st">"EA.App"</span>)</span>
<span id="cb6-491"><a href="#cb6-491"></a>    repo <span class="op">=</span> ea.Repository</span>
<span id="cb6-492"><a href="#cb6-492"></a></span>
<span id="cb6-493"><a href="#cb6-493"></a>    applied <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-494"><a href="#cb6-494"></a>    batch <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-495"><a href="#cb6-495"></a></span>
<span id="cb6-496"><a href="#cb6-496"></a>    <span class="cf">with</span> <span class="bu">open</span>(path, newline<span class="op">=</span><span class="st">""</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> f:</span>
<span id="cb6-497"><a href="#cb6-497"></a>        rdr <span class="op">=</span> csv.DictReader(f)</span>
<span id="cb6-498"><a href="#cb6-498"></a>        <span class="cf">for</span> row <span class="kw">in</span> rdr:</span>
<span id="cb6-499"><a href="#cb6-499"></a>            <span class="cf">if</span> <span class="bu">str</span>(row.get(<span class="st">"Apply"</span>,<span class="st">""</span>)).strip().lower() <span class="op">!=</span> <span class="st">"yes"</span>:</span>
<span id="cb6-500"><a href="#cb6-500"></a>                <span class="cf">continue</span></span>
<span id="cb6-501"><a href="#cb6-501"></a>            eid <span class="op">=</span> <span class="bu">int</span>(row[<span class="st">"ElementID"</span>])</span>
<span id="cb6-502"><a href="#cb6-502"></a>            status <span class="op">=</span> row.get(<span class="st">"NewStatus"</span>,<span class="st">""</span>).strip()</span>
<span id="cb6-503"><a href="#cb6-503"></a>            <span class="cf">if</span> <span class="kw">not</span> status:</span>
<span id="cb6-504"><a href="#cb6-504"></a>                <span class="cf">continue</span></span>
<span id="cb6-505"><a href="#cb6-505"></a></span>
<span id="cb6-506"><a href="#cb6-506"></a>            e <span class="op">=</span> repo.GetElementByID(eid)</span>
<span id="cb6-507"><a href="#cb6-507"></a>            <span class="cf">if</span> e <span class="kw">and</span> <span class="bu">str</span>(e.Status <span class="kw">or</span> <span class="st">""</span>) <span class="op">!=</span> status:</span>
<span id="cb6-508"><a href="#cb6-508"></a>                e.Status <span class="op">=</span> status</span>
<span id="cb6-509"><a href="#cb6-509"></a>                e.Update()</span>
<span id="cb6-510"><a href="#cb6-510"></a>                applied <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-511"><a href="#cb6-511"></a>                batch  <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-512"><a href="#cb6-512"></a></span>
<span id="cb6-513"><a href="#cb6-513"></a>            <span class="cf">if</span> batch <span class="op">&gt;=</span> CHUNK:</span>
<span id="cb6-514"><a href="#cb6-514"></a>                repo.RefreshModelView(<span class="dv">0</span>)</span>
<span id="cb6-515"><a href="#cb6-515"></a>                batch <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-516"><a href="#cb6-516"></a></span>
<span id="cb6-517"><a href="#cb6-517"></a>    <span class="cf">if</span> applied:</span>
<span id="cb6-518"><a href="#cb6-518"></a>        repo.RefreshModelView(<span class="dv">0</span>)</span>
<span id="cb6-519"><a href="#cb6-519"></a>    <span class="bu">print</span>(<span class="ss">f"Applied=</span><span class="sc">{</span>applied<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-520"><a href="#cb6-520"></a></span>
<span id="cb6-521"><a href="#cb6-521"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb6-522"><a href="#cb6-522"></a>    <span class="cf">if</span> <span class="bu">len</span>(sys.argv)<span class="op">&lt;</span><span class="dv">2</span>:</span>
<span id="cb6-523"><a href="#cb6-523"></a>        <span class="bu">print</span>(<span class="st">"Usage: perf_apply_large_external.py &lt;input.csv&gt;"</span>)</span>
<span id="cb6-524"><a href="#cb6-524"></a>    <span class="cf">else</span>:</span>
<span id="cb6-525"><a href="#cb6-525"></a>        main(sys.argv[<span class="dv">1</span>])</span>
<span id="cb6-526"><a href="#cb6-526"></a><span class="in">```</span></span>
<span id="cb6-527"><a href="#cb6-527"></a></span>
<span id="cb6-528"><a href="#cb6-528"></a>**Why it’s fast:** Python’s CSV is robust; you perform only the</span>
<span id="cb6-529"><a href="#cb6-529"></a>necessary EA updates, chunked with rare refreshes.</span>
<span id="cb6-530"><a href="#cb6-530"></a></span>
<span id="cb6-531"><a href="#cb6-531"></a><span class="fu">## Dos &amp; Don’ts (cheat-sheet)</span></span>
<span id="cb6-532"><a href="#cb6-532"></a></span>
<span id="cb6-533"><a href="#cb6-533"></a><span class="ss">- </span>**Do**: SQL for *find*, API for *write*.</span>
<span id="cb6-534"><a href="#cb6-534"></a></span>
<span id="cb6-535"><a href="#cb6-535"></a><span class="ss">- </span>**Do**: Log to file instead of spamming Output.</span>
<span id="cb6-536"><a href="#cb6-536"></a></span>
<span id="cb6-537"><a href="#cb6-537"></a><span class="ss">- </span>**Do**: Refresh UI once (or per big batch).</span>
<span id="cb6-538"><a href="#cb6-538"></a></span>
<span id="cb6-539"><a href="#cb6-539"></a><span class="ss">- </span>**Do**: Short-circuit when the target state is already correct.</span>
<span id="cb6-540"><a href="#cb6-540"></a></span>
<span id="cb6-541"><a href="#cb6-541"></a><span class="ss">- </span>**Don’t**: Recursively walk deep trees—prefer an iterative queue.</span>
<span id="cb6-542"><a href="#cb6-542"></a></span>
<span id="cb6-543"><a href="#cb6-543"></a><span class="ss">- </span>**Don’t**: Multi-thread COM calls to EA—stick to single-threaded.</span>
<span id="cb6-544"><a href="#cb6-544"></a></span>
<span id="cb6-545"><a href="#cb6-545"></a><span class="ss">- </span>**Don’t**: Write via SQL unless you fully understand EA’s schema</span>
<span id="cb6-546"><a href="#cb6-546"></a>  (read-only SQL is fine; writes are risky).</span>
<span id="cb6-547"><a href="#cb6-547"></a></span>
<span id="cb6-548"><a href="#cb6-548"></a><span class="fu">## Putting It Together</span></span>
<span id="cb6-549"><a href="#cb6-549"></a></span>
<span id="cb6-550"><a href="#cb6-550"></a>For a **large governance fix** (e.g., add missing stereotype on 40k</span>
<span id="cb6-551"><a href="#cb6-551"></a>classes):</span>
<span id="cb6-552"><a href="#cb6-552"></a></span>
<span id="cb6-553"><a href="#cb6-553"></a><span class="ss">1.  </span>**Timing Harness**: wrap the whole run and log metrics.</span>
<span id="cb6-554"><a href="#cb6-554"></a></span>
<span id="cb6-555"><a href="#cb6-555"></a><span class="ss">2.  </span>**SQL Find**: one query for candidate IDs.</span>
<span id="cb6-556"><a href="#cb6-556"></a></span>
<span id="cb6-557"><a href="#cb6-557"></a><span class="ss">3.  </span>**Chunked Apply**: update in batches of ~250–500.</span>
<span id="cb6-558"><a href="#cb6-558"></a></span>
<span id="cb6-559"><a href="#cb6-559"></a><span class="ss">4.  </span>**Low-noise logging**: a single CSV with “what changed.”</span>
<span id="cb6-560"><a href="#cb6-560"></a></span>
<span id="cb6-561"><a href="#cb6-561"></a><span class="ss">5.  </span>**One refresh** at the end (or per batch).</span>
<span id="cb6-562"><a href="#cb6-562"></a></span>
<span id="cb6-563"><a href="#cb6-563"></a>Following these steps keeps your scripts fast enough for</span>
<span id="cb6-564"><a href="#cb6-564"></a>enterprise-scale repositories and safe enough for governance.</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>