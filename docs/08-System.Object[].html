<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Chapter 7: Script Design Patterns – Scripting Sparx Enterprise Architect: A Practical Handbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./09-System.Object[].html" rel="next">
<link href="./07-System.Object[].html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-b4ddde2c4c77ed14ccfa95278770da4f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./08-System.Object[].html"><span class="chapter-title">Chapter 7: Script Design Patterns</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Scripting Sparx Enterprise Architect: A Practical Handbook</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Scripting Sparx Enterprise Architect</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 1: Why Script EA?</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 2: Automation Landscape</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 3: Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 4: API Essentials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 5: Inside EA with JScript</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 6: External Automation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-System.Object[].html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Chapter 7: Script Design Patterns</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 8: Object Details</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 9: Imports &amp; Exports</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 10: MDG-Aware Scripting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 11: Governance Scripts</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 12: Cookbook of Examples</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 13: Why AI Helps</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 14: Prompt Engineering</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 15: AI Refactoring Partner</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 16: AI in Daily Workflow</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 17: Performance &amp; Scaling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 18: Integrating with Workflows</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 19: Add-ins vs Scripts</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 20: Troubleshooting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 21: Reference</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix A: Scripting Constraints</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix B: External Automation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix C: Glossary of Terms</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix D: Quick Reference</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix E: External Automation Setup</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#why-patterns-matter" id="toc-why-patterns-matter" class="nav-link active" data-scroll-target="#why-patterns-matter">Why Patterns Matter</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a>
  <ul class="collapse">
  <li><a href="#shared-helper" id="toc-shared-helper" class="nav-link" data-scroll-target="#shared-helper">Shared Helper</a></li>
  <li><a href="#pattern-1-find-filter-apply" id="toc-pattern-1-find-filter-apply" class="nav-link" data-scroll-target="#pattern-1-find-filter-apply">Pattern 1 – Find / Filter / Apply</a></li>
  <li><a href="#pattern-2-curate-then-write-2-phase-updates" id="toc-pattern-2-curate-then-write-2-phase-updates" class="nav-link" data-scroll-target="#pattern-2-curate-then-write-2-phase-updates">Pattern 2 – Curate-then-Write (2-Phase Updates)</a></li>
  <li><a href="#pattern-3-tag-propagation-parent-children" id="toc-pattern-3-tag-propagation-parent-children" class="nav-link" data-scroll-target="#pattern-3-tag-propagation-parent-children">Pattern 3 – Tag Propagation (Parent → Children)</a></li>
  <li><a href="#pattern-4-linting-quality-gates-report-only-by-default" id="toc-pattern-4-linting-quality-gates-report-only-by-default" class="nav-link" data-scroll-target="#pattern-4-linting-quality-gates-report-only-by-default">Pattern 4 – Linting &amp; Quality Gates (Report-Only by Default)</a></li>
  <li><a href="#pattern-5-sql-accelerated-find-api-safe-write-hybrid" id="toc-pattern-5-sql-accelerated-find-api-safe-write-hybrid" class="nav-link" data-scroll-target="#pattern-5-sql-accelerated-find-api-safe-write-hybrid">Pattern 5 – SQL-Accelerated Find, API-Safe Write (Hybrid)</a></li>
  </ul></li>
  <li><a href="#pattern-handling" id="toc-pattern-handling" class="nav-link" data-scroll-target="#pattern-handling">Pattern Handling</a>
  <ul class="collapse">
  <li><a href="#patterns-as-a-library" id="toc-patterns-as-a-library" class="nav-link" data-scroll-target="#patterns-as-a-library">Patterns as a Library</a></li>
  <li><a href="#patterns-and-governance" id="toc-patterns-and-governance" class="nav-link" data-scroll-target="#patterns-and-governance">Patterns and Governance</a></li>
  <li><a href="#patterns-across-languages" id="toc-patterns-across-languages" class="nav-link" data-scroll-target="#patterns-across-languages">Patterns Across Languages</a></li>
  <li><a href="#the-safety-net-of-patterns" id="toc-the-safety-net-of-patterns" class="nav-link" data-scroll-target="#the-safety-net-of-patterns">The Safety Net of Patterns</a></li>
  </ul></li>
  <li><a href="#performance-safety-notes" id="toc-performance-safety-notes" class="nav-link" data-scroll-target="#performance-safety-notes">Performance &amp; Safety Notes</a></li>
  <li><a href="#bonus-python-curate-apply-pipeline" id="toc-bonus-python-curate-apply-pipeline" class="nav-link" data-scroll-target="#bonus-python-curate-apply-pipeline">Bonus: Python “Curate → Apply” Pipeline</a></li>
  <li><a href="#what-to-use-when-cheat-sheet" id="toc-what-to-use-when-cheat-sheet" class="nav-link" data-scroll-target="#what-to-use-when-cheat-sheet">What to Use When (cheat-sheet)</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-title">Chapter 7: Script Design Patterns</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>When you first begin scripting in Enterprise Architect, the process feels like a series of one-off solutions. You need to rename a batch of elements, so you write a loop. You want to add a tagged value everywhere, so you copy and tweak the loop. You need to enforce a naming convention, so you adjust the loop again. Each script solves the immediate problem but looks and feels slightly different from the last. After a while, you realise you are writing the same structural code over and over, just with small changes in logic.</p>
<p>This is not accidental. EA scripting tasks fall into recurring shapes. Recognising these shapes and naming them as <strong>design patterns</strong> gives you a powerful advantage. Instead of starting from scratch each time, you select the right pattern and plug in your task-specific logic. Patterns make scripts <strong>shorter, safer, and more consistent</strong>. They also make it easier to share code with colleagues, because everyone recognises the pattern being used.</p>
<p>This chapter introduces a handful of design patterns that cover the majority of practical EA scripting needs. They are not patterns in the object-oriented sense of Singleton or Observer, but scripting patterns tuned to the EA environment. Each one addresses a class of problems — traversing and filtering elements, applying changes in two phases, propagating metadata, checking quality. Once you master them, scripting EA becomes less about inventing and more about assembling known patterns into solutions.</p>
<section id="why-patterns-matter" class="level2">
<h2 class="anchored" data-anchor-id="why-patterns-matter">Why Patterns Matter</h2>
<p>The first reason to adopt patterns is <strong>safety</strong>. Many script errors arise because someone hand-coded a loop in haste, forgot to check ObjectType, or failed to include Update(). A pattern encapsulates safe practices — dry-run flags, logging, backwards deletion, UI refreshes — so you don’t have to remember them each time.</p>
<p>The second reason is <strong>productivity</strong>. A good pattern reduces boilerplate. You can focus on what the script should <em>do</em>, rather than how to set up the loop. For example, the Find/Filter/Apply pattern sets up traversal for you; you just provide the filter condition and the apply logic.</p>
<p>The third reason is <strong>communication</strong>. When you share a script with a colleague and they see it follows a known pattern, they can understand it quickly. It creates a shared vocabulary: “oh, this is a Curate-then-Write script” means more than “this is some code that loops twice.”</p>
</section>
<section id="examples" class="level2">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<section id="shared-helper" class="level3">
<h3 class="anchored" data-anchor-id="shared-helper">Shared Helper</h3>
<p>Drop this small helper library in your script group (e.g., “\_Common\Helpers.js”) and !INC it from each script.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 7.1 - Helpers.js (JScript ES3) – Common utility helpers</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" data-filename="Example 7.1 - Helpers.js (JScript ES3) – Common utility helpers"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">// Example 7.1 - Helpers.js (JScript ES3) – Common utility helpers</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">// Purpose: Logging, safety utilities, folder picker, CSV writer</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">// ---- Safety &amp; string helpers (ES3) ----</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="kw">function</span> <span class="fu">isNil</span>(x) { <span class="cf">return</span> x <span class="op">===</span> <span class="kw">null</span> <span class="op">||</span> x <span class="op">===</span> <span class="kw">undefined</span><span class="op">;</span> }</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="kw">function</span> <span class="fu">trim</span>(s) { <span class="cf">return</span> <span class="fu">isNil</span>(s) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> <span class="bu">String</span>(s)<span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">^\s+|\s+$</span><span class="ss">/g</span><span class="op">,</span> <span class="st">""</span>)<span class="op">;</span> }</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="kw">function</span> <span class="fu">equalsIgnoreCase</span>(a<span class="op">,</span> b) { <span class="cf">return</span> <span class="bu">String</span>(a<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">toLowerCase</span>() <span class="op">==</span> <span class="bu">String</span>(b<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">;</span> }</span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="kw">function</span> <span class="fu">startsWith</span>(s<span class="op">,</span> p) { <span class="cf">return</span> <span class="bu">String</span>(s<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">indexOf</span>(p) <span class="op">===</span> <span class="dv">0</span><span class="op">;</span> }</span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="kw">function</span> <span class="fu">contains</span>(s<span class="op">,</span> sub) { <span class="cf">return</span> <span class="bu">String</span>(s<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">indexOf</span>(sub) <span class="op">!==</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span> }</span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co">// ---- Output tab management ----</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="kw">function</span> <span class="fu">ensureOutputTab</span>(name) {</span>
<span id="cb1-17"><a href="#cb1-17"></a>    <span class="cf">try</span> { Repository<span class="op">.</span><span class="fu">CreateOutputTab</span>(name)<span class="op">;</span> } <span class="cf">catch</span>(e) {}</span>
<span id="cb1-18"><a href="#cb1-18"></a>    <span class="cf">try</span> { Repository<span class="op">.</span><span class="fu">ClearOutput</span>(name)<span class="op">;</span> } <span class="cf">catch</span>(e) {}</span>
<span id="cb1-19"><a href="#cb1-19"></a>    <span class="cf">try</span> { Repository<span class="op">.</span><span class="fu">EnsureOutputVisible</span>(name)<span class="op">;</span> } <span class="cf">catch</span>(e) {}</span>
<span id="cb1-20"><a href="#cb1-20"></a>}</span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="kw">function</span> <span class="fu">log</span>(tab<span class="op">,</span> msg) { Session<span class="op">.</span><span class="fu">Output</span>(<span class="st">"["</span> <span class="op">+</span> tab <span class="op">+</span> <span class="st">"] "</span> <span class="op">+</span> msg)<span class="op">;</span> }</span>
<span id="cb1-22"><a href="#cb1-22"></a></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="co">// ---- Folder picker (directory only; no file names) ----</span></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="kw">function</span> <span class="fu">browseForFolder</span>(promptText) {</span>
<span id="cb1-25"><a href="#cb1-25"></a>    <span class="co">// Shell.BrowseForFolder is reliable and does *directory only*</span></span>
<span id="cb1-26"><a href="#cb1-26"></a>    <span class="kw">var</span> shell <span class="op">=</span> <span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Shell.Application"</span>)<span class="op">;</span></span>
<span id="cb1-27"><a href="#cb1-27"></a>    <span class="kw">var</span> folder <span class="op">=</span> shell<span class="op">.</span><span class="fu">BrowseForFolder</span>(<span class="dv">0</span><span class="op">,</span> promptText<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-28"><a href="#cb1-28"></a>    <span class="cf">if</span> (<span class="op">!</span>folder) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb1-29"><a href="#cb1-29"></a>    <span class="co">// Ensure plain path (Self.Path)</span></span>
<span id="cb1-30"><a href="#cb1-30"></a>    <span class="cf">return</span> folder<span class="op">.</span><span class="at">Self</span><span class="op">.</span><span class="at">Path</span><span class="op">;</span></span>
<span id="cb1-31"><a href="#cb1-31"></a>}</span>
<span id="cb1-32"><a href="#cb1-32"></a></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="co">// ---- CSV writer (append; creates file on first write) ----</span></span>
<span id="cb1-34"><a href="#cb1-34"></a><span class="kw">function</span> <span class="fu">CsvWriter</span>(path) {</span>
<span id="cb1-35"><a href="#cb1-35"></a>    <span class="kw">var</span> fso <span class="op">=</span> <span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Scripting.FileSystemObject"</span>)<span class="op">;</span></span>
<span id="cb1-36"><a href="#cb1-36"></a>    <span class="kw">var</span> file <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb1-37"><a href="#cb1-37"></a>    <span class="kw">function</span> <span class="fu">openAppend</span>() {</span>
<span id="cb1-38"><a href="#cb1-38"></a><span class="co">// 8 = ForAppending, 2 = TristateTrue (Unicode); EA often prefers ANSI, so use default</span></span>
<span id="cb1-39"><a href="#cb1-39"></a><span class="co">// (TristateFalse=0)</span></span>
<span id="cb1-40"><a href="#cb1-40"></a><span class="co">// We'll stick with default encoding for broader compatibility.</span></span>
<span id="cb1-41"><a href="#cb1-41"></a>        file <span class="op">=</span> fso<span class="op">.</span><span class="fu">OpenTextFile</span>(path<span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb1-42"><a href="#cb1-42"></a>    }</span>
<span id="cb1-43"><a href="#cb1-43"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">writeHeader</span> <span class="op">=</span> <span class="kw">function</span>(headerLine) {</span>
<span id="cb1-44"><a href="#cb1-44"></a>        <span class="cf">if</span> (<span class="op">!</span>file) <span class="fu">openAppend</span>()<span class="op">;</span></span>
<span id="cb1-45"><a href="#cb1-45"></a>        file<span class="op">.</span><span class="fu">WriteLine</span>(headerLine)<span class="op">;</span></span>
<span id="cb1-46"><a href="#cb1-46"></a>    }<span class="op">;</span></span>
<span id="cb1-47"><a href="#cb1-47"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">writeRow</span> <span class="op">=</span> <span class="kw">function</span>(arr) {</span>
<span id="cb1-48"><a href="#cb1-48"></a>        <span class="cf">if</span> (<span class="op">!</span>file) <span class="fu">openAppend</span>()<span class="op">;</span></span>
<span id="cb1-49"><a href="#cb1-49"></a>        <span class="kw">var</span> i<span class="op">,</span> out <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb1-50"><a href="#cb1-50"></a>        <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>arr<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-51"><a href="#cb1-51"></a>            <span class="kw">var</span> cell <span class="op">=</span> <span class="bu">String</span>(arr[i])<span class="op">.</span><span class="fu">replace</span>(<span class="ss">/"/g</span><span class="op">,</span> <span class="st">'""'</span>)<span class="op">;</span>   <span class="co">// escape quotes</span></span>
<span id="cb1-52"><a href="#cb1-52"></a>            <span class="cf">if</span> (<span class="fu">contains</span>(cell<span class="op">,</span> <span class="st">","</span>) <span class="op">||</span> <span class="fu">contains</span>(cell<span class="op">,</span> <span class="st">"</span><span class="sc">\"</span><span class="st">"</span>) ) {</span>
<span id="cb1-53"><a href="#cb1-53"></a>                out <span class="op">+=</span> <span class="st">"</span><span class="sc">\"</span><span class="st">"</span> <span class="op">+</span> cell <span class="op">+</span> <span class="st">"</span><span class="sc">\"</span><span class="st">"</span><span class="op">;</span></span>
<span id="cb1-54"><a href="#cb1-54"></a>            } <span class="cf">else</span> {</span>
<span id="cb1-55"><a href="#cb1-55"></a>                out <span class="op">+=</span> cell<span class="op">;</span></span>
<span id="cb1-56"><a href="#cb1-56"></a>            }</span>
<span id="cb1-57"><a href="#cb1-57"></a>            <span class="cf">if</span> (i <span class="op">&lt;</span> arr<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>) out <span class="op">+=</span> <span class="st">","</span><span class="op">;</span></span>
<span id="cb1-58"><a href="#cb1-58"></a>        }</span>
<span id="cb1-59"><a href="#cb1-59"></a>        file<span class="op">.</span><span class="fu">WriteLine</span>(out)<span class="op">;</span></span>
<span id="cb1-60"><a href="#cb1-60"></a>    }<span class="op">;</span></span>
<span id="cb1-61"><a href="#cb1-61"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">close</span> <span class="op">=</span> <span class="kw">function</span>() { <span class="cf">if</span> (file) file<span class="op">.</span><span class="fu">Close</span>()<span class="op">;</span> }<span class="op">;</span></span>
<span id="cb1-62"><a href="#cb1-62"></a>}</span>
<span id="cb1-63"><a href="#cb1-63"></a></span>
<span id="cb1-64"><a href="#cb1-64"></a><span class="co">// ---- Timing helper ----</span></span>
<span id="cb1-65"><a href="#cb1-65"></a><span class="kw">function</span> <span class="fu">nowMs</span>() { </span>
<span id="cb1-66"><a href="#cb1-66"></a>  <span class="cf">return</span> (<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span> </span>
<span id="cb1-67"><a href="#cb1-67"></a>  }</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="pattern-1-find-filter-apply" class="level3">
<h3 class="anchored" data-anchor-id="pattern-1-find-filter-apply">Pattern 1 – Find / Filter / Apply</h3>
<p>The most common pattern in EA scripting is:</p>
<ol type="1">
<li><p><strong>Find</strong> a collection of items (elements, connectors, diagrams).</p></li>
<li><p><strong>Filter</strong> them based on conditions (type, stereotype, missing tag).</p></li>
<li><p><strong>Apply</strong> an action (rename, add tag, log).</p></li>
</ol>
<p>This pattern underlies most governance checks and batch updates. It is safe, scalable, and easy to extend. You will see many examples in this chapter where the Find/Filter/Apply loop is the skeleton on which the logic hangs.</p>
<p><strong>When to use:</strong> bulk changes with clear criteria (e.g.&nbsp;rename, retag, stereotype changes).<br>
Why: separates selection from action; an easy, safe mental model.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 7.2 - Pattern1_FindFilterApply.js – JScript (ES3)</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" data-filename="Example 7.2 - Pattern1_FindFilterApply.js – JScript (ES3)"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">// Example 7.2 - Pattern1_FindFilterApply.js – JScript (ES3)</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">// Purpose: Demonstrates Find/Filter/Apply on elements in a selected package</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">// Usage: Select a package → run script. Uses dry-run by default.</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">// Assumptions:</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">// - ES3 only; EA collections require Count/GetAt(i)</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">// - No modern JS features</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">// Parameters: adjust TYPE_FILTER / NAME_PREFIX to your needs</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">// Dependencies: Helpers.js (browseForFolder, CsvWriter, logging)</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">// Update history: 1.0 initial</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb2-12"><a href="#cb2-12"></a></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb2-15"><a href="#cb2-15"></a></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb2-17"><a href="#cb2-17"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"FindFilterApply"</span><span class="op">;</span></span>
<span id="cb2-18"><a href="#cb2-18"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb2-19"><a href="#cb2-19"></a></span>
<span id="cb2-20"><a href="#cb2-20"></a>    <span class="co">// ---- Config ----</span></span>
<span id="cb2-21"><a href="#cb2-21"></a>    <span class="kw">var</span> DRY_RUN <span class="op">=</span> <span class="kw">true</span><span class="op">;</span>                 <span class="co">// switch to false to commit</span></span>
<span id="cb2-22"><a href="#cb2-22"></a>    <span class="kw">var</span> TYPE_FILTER <span class="op">=</span> <span class="st">"Class"</span><span class="op">;</span>          <span class="co">// only operate on these element types (e.g., "Requirement", "Capability")</span></span>
<span id="cb2-23"><a href="#cb2-23"></a>    <span class="kw">var</span> NAME_PREFIX <span class="op">=</span> <span class="st">"ARCH_"</span><span class="op">;</span>          <span class="co">// example change: ensure name has this prefix</span></span>
<span id="cb2-24"><a href="#cb2-24"></a>    <span class="kw">var</span> WRITE_CSV <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb2-25"><a href="#cb2-25"></a></span>
<span id="cb2-26"><a href="#cb2-26"></a>    <span class="co">// ---- Context ----</span></span>
<span id="cb2-27"><a href="#cb2-27"></a>    <span class="kw">var</span> pkg <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span>()<span class="op">;</span></span>
<span id="cb2-28"><a href="#cb2-28"></a>    <span class="cf">if</span> (<span class="op">!</span>pkg) { Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Please select a package."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb2-29"><a href="#cb2-29"></a></span>
<span id="cb2-30"><a href="#cb2-30"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Selected package: "</span> <span class="op">+</span> pkg<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">" (ID "</span> <span class="op">+</span> pkg<span class="op">.</span><span class="at">PackageID</span> <span class="op">+</span> <span class="st">")"</span>)<span class="op">;</span></span>
<span id="cb2-31"><a href="#cb2-31"></a>    <span class="kw">var</span> t0 <span class="op">=</span> <span class="fu">nowMs</span>()<span class="op">;</span></span>
<span id="cb2-32"><a href="#cb2-32"></a></span>
<span id="cb2-33"><a href="#cb2-33"></a>    <span class="co">// ---- CSV setup (directory-only; no filename prompts) ----</span></span>
<span id="cb2-34"><a href="#cb2-34"></a>    <span class="kw">var</span> csv <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb2-35"><a href="#cb2-35"></a>    <span class="cf">if</span> (WRITE_CSV) {</span>
<span id="cb2-36"><a href="#cb2-36"></a>        <span class="kw">var</span> dir <span class="op">=</span> <span class="fu">browseForFolder</span>(<span class="st">"Select output folder for log CSV (directory only):"</span>)<span class="op">;</span></span>
<span id="cb2-37"><a href="#cb2-37"></a>        <span class="cf">if</span> (dir) {</span>
<span id="cb2-38"><a href="#cb2-38"></a>            <span class="kw">var</span> stamp <span class="op">=</span> (<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb2-39"><a href="#cb2-39"></a>            <span class="kw">var</span> outPath <span class="op">=</span> dir <span class="op">+</span> <span class="st">"</span><span class="sc">\\</span><span class="st">pattern1_find_filter_apply_"</span> <span class="op">+</span> stamp <span class="op">+</span> <span class="st">".csv"</span><span class="op">;</span></span>
<span id="cb2-40"><a href="#cb2-40"></a>            csv <span class="op">=</span> <span class="kw">new</span> <span class="fu">CsvWriter</span>(outPath)<span class="op">;</span></span>
<span id="cb2-41"><a href="#cb2-41"></a>            csv<span class="op">.</span><span class="fu">writeHeader</span>(<span class="st">"ElementID,GUID,OldName,NewName,Type,Action"</span>)<span class="op">;</span></span>
<span id="cb2-42"><a href="#cb2-42"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Logging to: "</span> <span class="op">+</span> outPath)<span class="op">;</span></span>
<span id="cb2-43"><a href="#cb2-43"></a>        } <span class="cf">else</span> {</span>
<span id="cb2-44"><a href="#cb2-44"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"No folder selected; CSV logging disabled."</span>)<span class="op">;</span></span>
<span id="cb2-45"><a href="#cb2-45"></a>        }</span>
<span id="cb2-46"><a href="#cb2-46"></a>    }</span>
<span id="cb2-47"><a href="#cb2-47"></a></span>
<span id="cb2-48"><a href="#cb2-48"></a>    <span class="co">// ---- Find &amp; filter ----</span></span>
<span id="cb2-49"><a href="#cb2-49"></a>    <span class="kw">var</span> targets <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-50"><a href="#cb2-50"></a>    <span class="kw">var</span> elements <span class="op">=</span> pkg<span class="op">.</span><span class="at">Elements</span><span class="op">;</span></span>
<span id="cb2-51"><a href="#cb2-51"></a>    <span class="kw">var</span> i<span class="op">;</span></span>
<span id="cb2-52"><a href="#cb2-52"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>elements<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-53"><a href="#cb2-53"></a>        <span class="kw">var</span> el <span class="op">=</span> elements<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb2-54"><a href="#cb2-54"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">equalsIgnoreCase</span>(el<span class="op">.</span><span class="at">Type</span><span class="op">,</span> TYPE_FILTER)) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb2-55"><a href="#cb2-55"></a></span>
<span id="cb2-56"><a href="#cb2-56"></a>        <span class="co">// Filter condition: name missing prefix</span></span>
<span id="cb2-57"><a href="#cb2-57"></a>        <span class="kw">var</span> hasPrefix <span class="op">=</span> <span class="fu">startsWith</span>(el<span class="op">.</span><span class="at">Name</span><span class="op">,</span> NAME_PREFIX)<span class="op">;</span></span>
<span id="cb2-58"><a href="#cb2-58"></a>        <span class="cf">if</span> (<span class="op">!</span>hasPrefix) targets<span class="op">.</span><span class="fu">push</span>(el)<span class="op">;</span></span>
<span id="cb2-59"><a href="#cb2-59"></a>    }</span>
<span id="cb2-60"><a href="#cb2-60"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Found "</span> <span class="op">+</span> targets<span class="op">.</span><span class="at">length</span> <span class="op">+</span> <span class="st">" target(s)."</span>)<span class="op">;</span></span>
<span id="cb2-61"><a href="#cb2-61"></a></span>
<span id="cb2-62"><a href="#cb2-62"></a>    <span class="co">// ---- Apply ----</span></span>
<span id="cb2-63"><a href="#cb2-63"></a>    <span class="kw">var</span> changed <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-64"><a href="#cb2-64"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>targets<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-65"><a href="#cb2-65"></a>        <span class="kw">var</span> e <span class="op">=</span> targets[i]<span class="op">;</span></span>
<span id="cb2-66"><a href="#cb2-66"></a>        <span class="kw">var</span> oldName <span class="op">=</span> e<span class="op">.</span><span class="at">Name</span><span class="op">;</span></span>
<span id="cb2-67"><a href="#cb2-67"></a>        <span class="kw">var</span> newName <span class="op">=</span> NAME_PREFIX <span class="op">+</span> oldName<span class="op">;</span></span>
<span id="cb2-68"><a href="#cb2-68"></a></span>
<span id="cb2-69"><a href="#cb2-69"></a>        <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">writeRow</span>([e<span class="op">.</span><span class="at">ElementID</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementGUID</span><span class="op">,</span> oldName<span class="op">,</span> newName<span class="op">,</span> e<span class="op">.</span><span class="at">Type</span><span class="op">,</span> (DRY_RUN<span class="op">?</span> <span class="st">"DRY-RUN"</span> <span class="op">:</span> <span class="st">"RENAME"</span>)])<span class="op">;</span></span>
<span id="cb2-70"><a href="#cb2-70"></a></span>
<span id="cb2-71"><a href="#cb2-71"></a>        <span class="cf">if</span> (<span class="op">!</span>DRY_RUN) {</span>
<span id="cb2-72"><a href="#cb2-72"></a>            e<span class="op">.</span><span class="at">Name</span> <span class="op">=</span> newName<span class="op">;</span></span>
<span id="cb2-73"><a href="#cb2-73"></a>            e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> <span class="co">// persist</span></span>
<span id="cb2-74"><a href="#cb2-74"></a>        }</span>
<span id="cb2-75"><a href="#cb2-75"></a>        changed<span class="op">++;</span></span>
<span id="cb2-76"><a href="#cb2-76"></a>    }</span>
<span id="cb2-77"><a href="#cb2-77"></a></span>
<span id="cb2-78"><a href="#cb2-78"></a>    <span class="co">// Refresh UI if we wrote changes</span></span>
<span id="cb2-79"><a href="#cb2-79"></a>    <span class="cf">if</span> (<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> changed<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(pkg<span class="op">.</span><span class="at">PackageID</span>)<span class="op">;</span></span>
<span id="cb2-80"><a href="#cb2-80"></a></span>
<span id="cb2-81"><a href="#cb2-81"></a>    <span class="kw">var</span> dt <span class="op">=</span> <span class="fu">nowMs</span>() <span class="op">-</span> t0<span class="op">;</span></span>
<span id="cb2-82"><a href="#cb2-82"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Changed "</span> <span class="op">+</span> changed <span class="op">+</span> <span class="st">" / "</span> <span class="op">+</span> targets<span class="op">.</span><span class="at">length</span> <span class="op">+</span> <span class="st">" target(s). Dry-run="</span> <span class="op">+</span> DRY_RUN <span class="op">+</span> <span class="st">". Time="</span> <span class="op">+</span> dt <span class="op">+</span> <span class="st">"ms"</span>)<span class="op">;</span></span>
<span id="cb2-83"><a href="#cb2-83"></a></span>
<span id="cb2-84"><a href="#cb2-84"></a>    <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb2-85"><a href="#cb2-85"></a>}</span>
<span id="cb2-86"><a href="#cb2-86"></a></span>
<span id="cb2-87"><a href="#cb2-87"></a><span class="fu">main</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="pattern-2-curate-then-write-2-phase-updates" class="level3">
<h3 class="anchored" data-anchor-id="pattern-2-curate-then-write-2-phase-updates">Pattern 2 – Curate-then-Write (2-Phase Updates)</h3>
<p>Sometimes you cannot safely update as you go. Perhaps you want to check what will change before actually changing it. Perhaps you want to let a governance board review the list before updates are applied.</p>
<p>The <strong>Curate-then-Write</strong> pattern solves this by splitting the process into two phases:</p>
<ol type="1">
<li><p><strong>Curate</strong> — gather and log the items that <em>would</em> be changed (always with DRY_RUN).</p></li>
<li><p><strong>Write</strong> — only later, with approval, run the script again with changes applied.</p></li>
</ol>
<p>This pattern reduces risk and increases confidence. It mirrors the dry-run principle, but formalises it into a workflow.</p>
<p><strong>When to use:</strong> risky or large updates. First produce a <strong>reviewable CSV</strong>, then run again to apply.<br>
<strong>Why:</strong> EA has no transactions; curate first to avoid irreversible bulk mistakes.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 7.3 - Pattern1_FindFilterApply.js – JScript (ES3)</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" data-filename="Example 7.3 - Pattern1_FindFilterApply.js – JScript (ES3)"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">// Example 7.3 - Pattern2_CurateThenWrite.js – JScript (ES3)</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">// Purpose: Phase 1 = produce CSV for review; Phase 2 = read curated CSV and apply</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">// Usage:</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">//  - Phase 1: set MODE="export" → generates CSV with proposed changes</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">//  - Review/edit the CSV (approve rows by setting Apply=YES)</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">//  - Phase 2: set MODE="apply"  → reads CSV and applies only approved rows</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">// Assumptions:</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">//  - ES3 only; CSV written in ANSI for broad compatibility</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">//  - Directory chooser only (no filename prompts)</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">// Dependencies: Helpers.js</span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb3-13"><a href="#cb3-13"></a></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb3-16"><a href="#cb3-16"></a></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb3-18"><a href="#cb3-18"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"CurateThenWrite"</span><span class="op">;</span></span>
<span id="cb3-19"><a href="#cb3-19"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb3-20"><a href="#cb3-20"></a></span>
<span id="cb3-21"><a href="#cb3-21"></a>    <span class="co">// ---- Config ----</span></span>
<span id="cb3-22"><a href="#cb3-22"></a>    <span class="kw">var</span> MODE <span class="op">=</span> <span class="st">"export"</span><span class="op">;</span>          <span class="co">// "export" or "apply"</span></span>
<span id="cb3-23"><a href="#cb3-23"></a>    <span class="kw">var</span> TYPE_FILTER <span class="op">=</span> <span class="st">"Requirement"</span><span class="op">;</span></span>
<span id="cb3-24"><a href="#cb3-24"></a>    <span class="kw">var</span> PROPOSED_STATUS <span class="op">=</span> <span class="st">"Approved"</span><span class="op">;</span></span>
<span id="cb3-25"><a href="#cb3-25"></a></span>
<span id="cb3-26"><a href="#cb3-26"></a>    <span class="cf">if</span> (MODE <span class="op">==</span> <span class="st">"export"</span>) <span class="cf">return</span> <span class="fu">exportPhase</span>(TAB<span class="op">,</span> TYPE_FILTER<span class="op">,</span> PROPOSED_STATUS)<span class="op">;</span></span>
<span id="cb3-27"><a href="#cb3-27"></a>    <span class="cf">if</span> (MODE <span class="op">==</span> <span class="st">"apply"</span>)  <span class="cf">return</span> <span class="fu">applyPhase</span>(TAB)<span class="op">;</span></span>
<span id="cb3-28"><a href="#cb3-28"></a>    Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Unknown MODE. Use 'export' or 'apply'."</span><span class="op">,</span> promptOK)<span class="op">;</span></span>
<span id="cb3-29"><a href="#cb3-29"></a>}</span>
<span id="cb3-30"><a href="#cb3-30"></a></span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="kw">function</span> <span class="fu">exportPhase</span>(TAB<span class="op">,</span> TYPE_FILTER<span class="op">,</span> PROPOSED_STATUS) {</span>
<span id="cb3-32"><a href="#cb3-32"></a>    <span class="kw">var</span> pkg <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span>()<span class="op">;</span></span>
<span id="cb3-33"><a href="#cb3-33"></a>    <span class="cf">if</span> (<span class="op">!</span>pkg) { Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Select a package."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb3-34"><a href="#cb3-34"></a></span>
<span id="cb3-35"><a href="#cb3-35"></a>    <span class="kw">var</span> dir <span class="op">=</span> <span class="fu">browseForFolder</span>(<span class="st">"Select output folder for curation CSV:"</span>)<span class="op">;</span></span>
<span id="cb3-36"><a href="#cb3-36"></a>    <span class="cf">if</span> (<span class="op">!</span>dir) { <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Cancelled."</span>)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb3-37"><a href="#cb3-37"></a></span>
<span id="cb3-38"><a href="#cb3-38"></a>    <span class="kw">var</span> stamp <span class="op">=</span> (<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb3-39"><a href="#cb3-39"></a>    <span class="kw">var</span> path <span class="op">=</span> dir <span class="op">+</span> <span class="st">"</span><span class="sc">\\</span><span class="st">pattern2_curate_export_"</span> <span class="op">+</span> stamp <span class="op">+</span> <span class="st">".csv"</span><span class="op">;</span></span>
<span id="cb3-40"><a href="#cb3-40"></a>    <span class="kw">var</span> csv <span class="op">=</span> <span class="kw">new</span> <span class="fu">CsvWriter</span>(path)<span class="op">;</span></span>
<span id="cb3-41"><a href="#cb3-41"></a>    csv<span class="op">.</span><span class="fu">writeHeader</span>(<span class="st">"Apply,ElementID,GUID,Name,Type,CurrentStatus,ProposedStatus,Notes"</span>)<span class="op">;</span></span>
<span id="cb3-42"><a href="#cb3-42"></a></span>
<span id="cb3-43"><a href="#cb3-43"></a>    <span class="kw">var</span> i<span class="op">,</span> elements <span class="op">=</span> pkg<span class="op">.</span><span class="at">Elements</span><span class="op">;</span></span>
<span id="cb3-44"><a href="#cb3-44"></a>    <span class="kw">var</span> exported <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-45"><a href="#cb3-45"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>elements<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-46"><a href="#cb3-46"></a>        <span class="kw">var</span> e <span class="op">=</span> elements<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb3-47"><a href="#cb3-47"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">equalsIgnoreCase</span>(e<span class="op">.</span><span class="at">Type</span><span class="op">,</span> TYPE_FILTER)) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb3-48"><a href="#cb3-48"></a>        <span class="co">// Propose: set Status to PROPOSED_STATUS</span></span>
<span id="cb3-49"><a href="#cb3-49"></a>        csv<span class="op">.</span><span class="fu">writeRow</span>([<span class="st">"NO"</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementID</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementGUID</span><span class="op">,</span> e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> e<span class="op">.</span><span class="at">Type</span><span class="op">,</span> e<span class="op">.</span><span class="at">Status</span><span class="op">,</span> PROPOSED_STATUS<span class="op">,</span> <span class="st">"Set to Approved if meets criteria X"</span>])<span class="op">;</span></span>
<span id="cb3-50"><a href="#cb3-50"></a>        exported<span class="op">++;</span></span>
<span id="cb3-51"><a href="#cb3-51"></a>    }</span>
<span id="cb3-52"><a href="#cb3-52"></a>    csv<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb3-53"><a href="#cb3-53"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Wrote "</span> <span class="op">+</span> exported <span class="op">+</span> <span class="st">" row(s) to "</span> <span class="op">+</span> path <span class="op">+</span> <span class="st">". Review and change 'Apply' to YES where appropriate."</span>)<span class="op">;</span></span>
<span id="cb3-54"><a href="#cb3-54"></a>}</span>
<span id="cb3-55"><a href="#cb3-55"></a></span>
<span id="cb3-56"><a href="#cb3-56"></a><span class="kw">function</span> <span class="fu">applyPhase</span>(TAB) {</span>
<span id="cb3-57"><a href="#cb3-57"></a>    <span class="co">// Directory-only input: we’ll look for a single CSV file in the chosen folder by pattern.</span></span>
<span id="cb3-58"><a href="#cb3-58"></a>    <span class="kw">var</span> dir <span class="op">=</span> <span class="fu">browseForFolder</span>(<span class="st">"Select folder that contains curated CSV (pattern2_curate_export_*.csv):"</span>)<span class="op">;</span></span>
<span id="cb3-59"><a href="#cb3-59"></a>    <span class="cf">if</span> (<span class="op">!</span>dir) { <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Cancelled."</span>)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb3-60"><a href="#cb3-60"></a></span>
<span id="cb3-61"><a href="#cb3-61"></a>    <span class="co">// Very simple scan for the newest curated CSV file</span></span>
<span id="cb3-62"><a href="#cb3-62"></a>    <span class="kw">var</span> fso <span class="op">=</span> <span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Scripting.FileSystemObject"</span>)<span class="op">;</span></span>
<span id="cb3-63"><a href="#cb3-63"></a>    <span class="kw">var</span> folder <span class="op">=</span> fso<span class="op">.</span><span class="fu">GetFolder</span>(dir)<span class="op">;</span></span>
<span id="cb3-64"><a href="#cb3-64"></a>    <span class="kw">var</span> en <span class="op">=</span> <span class="kw">new</span> <span class="fu">Enumerator</span>(folder<span class="op">.</span><span class="at">Files</span>)<span class="op">;</span></span>
<span id="cb3-65"><a href="#cb3-65"></a>    <span class="kw">var</span> newest <span class="op">=</span> <span class="kw">null</span><span class="op">,</span> newestTime <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-66"><a href="#cb3-66"></a>    <span class="cf">for</span> (<span class="op">;</span> <span class="op">!</span>en<span class="op">.</span><span class="fu">atEnd</span>()<span class="op">;</span> en<span class="op">.</span><span class="fu">moveNext</span>()) {</span>
<span id="cb3-67"><a href="#cb3-67"></a>        <span class="kw">var</span> file <span class="op">=</span> en<span class="op">.</span><span class="fu">item</span>()<span class="op">;</span></span>
<span id="cb3-68"><a href="#cb3-68"></a>        <span class="cf">if</span> (<span class="fu">contains</span>(file<span class="op">.</span><span class="at">Name</span><span class="op">,</span> <span class="st">"pattern2_curate_export_"</span>) <span class="op">&amp;&amp;</span> <span class="fu">endsWith</span>(file<span class="op">.</span><span class="at">Name</span><span class="op">,</span> <span class="st">".csv"</span>)) {</span>
<span id="cb3-69"><a href="#cb3-69"></a>            <span class="cf">if</span> (file<span class="op">.</span><span class="at">DateLastModified</span><span class="op">.</span><span class="fu">getTime</span>() <span class="op">&gt;</span> newestTime) {</span>
<span id="cb3-70"><a href="#cb3-70"></a>                newest <span class="op">=</span> file<span class="op">;</span> newestTime <span class="op">=</span> file<span class="op">.</span><span class="at">DateLastModified</span><span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb3-71"><a href="#cb3-71"></a>            }</span>
<span id="cb3-72"><a href="#cb3-72"></a>        }</span>
<span id="cb3-73"><a href="#cb3-73"></a>    }</span>
<span id="cb3-74"><a href="#cb3-74"></a>    <span class="cf">if</span> (<span class="op">!</span>newest) { <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"No curated CSV found."</span>)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb3-75"><a href="#cb3-75"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Applying from: "</span> <span class="op">+</span> newest<span class="op">.</span><span class="at">Path</span>)<span class="op">;</span></span>
<span id="cb3-76"><a href="#cb3-76"></a></span>
<span id="cb3-77"><a href="#cb3-77"></a>    <span class="co">// Read CSV line by line (very simple parser; assumes no commas in unquoted cells)</span></span>
<span id="cb3-78"><a href="#cb3-78"></a>    <span class="kw">var</span> ts <span class="op">=</span> fso<span class="op">.</span><span class="fu">OpenTextFile</span>(newest<span class="op">.</span><span class="at">Path</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span> <span class="co">// ForReading</span></span>
<span id="cb3-79"><a href="#cb3-79"></a>    <span class="co">// Skip header</span></span>
<span id="cb3-80"><a href="#cb3-80"></a>    <span class="cf">if</span> (<span class="op">!</span>ts<span class="op">.</span><span class="at">AtEndOfStream</span>) ts<span class="op">.</span><span class="fu">ReadLine</span>()<span class="op">;</span></span>
<span id="cb3-81"><a href="#cb3-81"></a></span>
<span id="cb3-82"><a href="#cb3-82"></a>    <span class="kw">var</span> applied <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> considered <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-83"><a href="#cb3-83"></a>    <span class="cf">while</span> (<span class="op">!</span>ts<span class="op">.</span><span class="at">AtEndOfStream</span>) {</span>
<span id="cb3-84"><a href="#cb3-84"></a>        <span class="kw">var</span> line <span class="op">=</span> ts<span class="op">.</span><span class="fu">ReadLine</span>()<span class="op">;</span></span>
<span id="cb3-85"><a href="#cb3-85"></a>        <span class="kw">var</span> cells <span class="op">=</span> line<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">;</span></span>
<span id="cb3-86"><a href="#cb3-86"></a>        <span class="cf">if</span> (cells<span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> <span class="dv">8</span>) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb3-87"><a href="#cb3-87"></a>        <span class="kw">var</span> apply <span class="op">=</span> <span class="fu">trim</span>(cells[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-88"><a href="#cb3-88"></a>        <span class="kw">var</span> elementID <span class="op">=</span> <span class="pp">parseInt</span>(cells[<span class="dv">1</span>]<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb3-89"><a href="#cb3-89"></a>        <span class="kw">var</span> proposedStatus <span class="op">=</span> <span class="fu">trim</span>(cells[<span class="dv">6</span>])<span class="op">;</span></span>
<span id="cb3-90"><a href="#cb3-90"></a></span>
<span id="cb3-91"><a href="#cb3-91"></a>        considered<span class="op">++;</span></span>
<span id="cb3-92"><a href="#cb3-92"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">equalsIgnoreCase</span>(apply<span class="op">,</span> <span class="st">"YES"</span>)) <span class="cf">continue</span><span class="op">;</span> <span class="co">// only approved rows</span></span>
<span id="cb3-93"><a href="#cb3-93"></a></span>
<span id="cb3-94"><a href="#cb3-94"></a>        <span class="kw">var</span> e <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetElementByID</span>(elementID)<span class="op">;</span></span>
<span id="cb3-95"><a href="#cb3-95"></a>        <span class="cf">if</span> (<span class="op">!</span>e) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb3-96"><a href="#cb3-96"></a>        e<span class="op">.</span><span class="at">Status</span> <span class="op">=</span> proposedStatus<span class="op">;</span></span>
<span id="cb3-97"><a href="#cb3-97"></a>        e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span></span>
<span id="cb3-98"><a href="#cb3-98"></a>        applied<span class="op">++;</span></span>
<span id="cb3-99"><a href="#cb3-99"></a>    }</span>
<span id="cb3-100"><a href="#cb3-100"></a>    ts<span class="op">.</span><span class="fu">Close</span>()<span class="op">;</span></span>
<span id="cb3-101"><a href="#cb3-101"></a></span>
<span id="cb3-102"><a href="#cb3-102"></a>    <span class="cf">if</span> (applied<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-103"><a href="#cb3-103"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Applied "</span> <span class="op">+</span> applied <span class="op">+</span> <span class="st">" change(s) out of "</span> <span class="op">+</span> considered <span class="op">+</span> <span class="st">" curated row(s)."</span>)<span class="op">;</span></span>
<span id="cb3-104"><a href="#cb3-104"></a>}</span>
<span id="cb3-105"><a href="#cb3-105"></a></span>
<span id="cb3-106"><a href="#cb3-106"></a><span class="co">// ES3 helper – endsWith (not natively available)</span></span>
<span id="cb3-107"><a href="#cb3-107"></a><span class="kw">function</span> <span class="fu">endsWith</span>(s<span class="op">,</span> suffix) {</span>
<span id="cb3-108"><a href="#cb3-108"></a>    s <span class="op">=</span> <span class="bu">String</span>(s<span class="op">||</span><span class="st">""</span>)<span class="op">;</span></span>
<span id="cb3-109"><a href="#cb3-109"></a>    <span class="kw">var</span> idx <span class="op">=</span> s<span class="op">.</span><span class="fu">lastIndexOf</span>(suffix)<span class="op">;</span></span>
<span id="cb3-110"><a href="#cb3-110"></a>    <span class="cf">return</span> idx <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> (idx <span class="op">+</span> suffix<span class="op">.</span><span class="at">length</span> <span class="op">===</span> s<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb3-111"><a href="#cb3-111"></a>}</span>
<span id="cb3-112"><a href="#cb3-112"></a></span>
<span id="cb3-113"><a href="#cb3-113"></a><span class="fu">main</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="pattern-3-tag-propagation-parent-children" class="level3">
<h3 class="anchored" data-anchor-id="pattern-3-tag-propagation-parent-children">Pattern 3 – Tag Propagation (Parent → Children)</h3>
<p>Another frequent need is to ensure that metadata flows correctly between related elements. For example, if a Capability has an Owner tag, then all its linked Requirements should inherit that Owner. Or if a System has a Criticality tag, then its Interfaces should carry the same.</p>
<p>The <strong>Tag Propagation</strong> pattern handles this: traverse a relationship, read a tag from one element, apply it to another, log the change. It enforces consistency and helps maintain traceability.</p>
<p><strong>When to use:</strong> enforce a tagged value from a parent element or package onto all contained elements (e.g., Domain=Diabetes).<br>
<strong>Options:</strong> set only if missing, or overwrite.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 7.4 - Pattern3_TagPropagation.js – JScript (ES3)</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4" data-filename="Example 7.4 - Pattern3_TagPropagation.js – JScript (ES3)"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">// Example 7.4 - Pattern3_TagPropagation.js – JScript (ES3)</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">// Purpose: Copy a tagged value from a selected *source element*</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">//          to all elements in a selected *target package*</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">// Usage: Select source element → run; then select target package → run</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">// Assumptions: source has TagName present; target elements may or may not</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">// Safety: DRY_RUN = true by default</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">// Dependencies: Helpers.js</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb4-10"><a href="#cb4-10"></a></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb4-13"><a href="#cb4-13"></a></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb4-15"><a href="#cb4-15"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"TagPropagation"</span><span class="op">;</span></span>
<span id="cb4-16"><a href="#cb4-16"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb4-17"><a href="#cb4-17"></a></span>
<span id="cb4-18"><a href="#cb4-18"></a>    <span class="co">// ---- Config ----</span></span>
<span id="cb4-19"><a href="#cb4-19"></a>    <span class="kw">var</span> DRY_RUN <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb4-20"><a href="#cb4-20"></a>    <span class="kw">var</span> TAG_NAME <span class="op">=</span> <span class="st">"Domain"</span><span class="op">;</span></span>
<span id="cb4-21"><a href="#cb4-21"></a>    <span class="kw">var</span> OVERWRITE <span class="op">=</span> <span class="kw">false</span><span class="op">;</span>  <span class="co">// false = set only if missing</span></span>
<span id="cb4-22"><a href="#cb4-22"></a></span>
<span id="cb4-23"><a href="#cb4-23"></a>    <span class="co">// ---- Step 1: obtain source tag from selected element ----</span></span>
<span id="cb4-24"><a href="#cb4-24"></a>    <span class="kw">var</span> src <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedObject</span>()<span class="op">;</span></span>
<span id="cb4-25"><a href="#cb4-25"></a>    <span class="cf">if</span> (<span class="op">!</span>src <span class="op">||</span> src<span class="op">.</span><span class="at">ObjectType</span> <span class="op">!=</span> otElement) {</span>
<span id="cb4-26"><a href="#cb4-26"></a>        Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Select the *source element* that contains the tag '"</span> <span class="op">+</span> TAG_NAME <span class="op">+</span> <span class="st">"'."</span><span class="op">,</span> promptOK)<span class="op">;</span></span>
<span id="cb4-27"><a href="#cb4-27"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb4-28"><a href="#cb4-28"></a>    }</span>
<span id="cb4-29"><a href="#cb4-29"></a>    <span class="kw">var</span> srcVal <span class="op">=</span> <span class="fu">readTag</span>(src<span class="op">,</span> TAG_NAME)<span class="op">;</span></span>
<span id="cb4-30"><a href="#cb4-30"></a>    <span class="cf">if</span> (<span class="fu">trim</span>(srcVal) <span class="op">===</span> <span class="st">""</span>) {</span>
<span id="cb4-31"><a href="#cb4-31"></a>        Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Source element does not have tag '"</span> <span class="op">+</span> TAG_NAME <span class="op">+</span> <span class="st">"'."</span><span class="op">,</span> promptOK)<span class="op">;</span></span>
<span id="cb4-32"><a href="#cb4-32"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb4-33"><a href="#cb4-33"></a>    }</span>
<span id="cb4-34"><a href="#cb4-34"></a></span>
<span id="cb4-35"><a href="#cb4-35"></a>    <span class="co">// ---- Step 2: ask user to select target *package* ----</span></span>
<span id="cb4-36"><a href="#cb4-36"></a>    Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Now select the *target package* and run the script again to apply propagation."</span><span class="op">,</span> promptOK)<span class="op">;</span></span>
<span id="cb4-37"><a href="#cb4-37"></a></span>
<span id="cb4-38"><a href="#cb4-38"></a>    <span class="co">// If you prefer one-run UX: comment out the prompt above and use GetTreeSelectedPackage()</span></span>
<span id="cb4-39"><a href="#cb4-39"></a>    <span class="co">// directly</span></span>
<span id="cb4-40"><a href="#cb4-40"></a>}</span>
<span id="cb4-41"><a href="#cb4-41"></a></span>
<span id="cb4-42"><a href="#cb4-42"></a><span class="kw">function</span> <span class="fu">applyToTarget</span>() {</span>
<span id="cb4-43"><a href="#cb4-43"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"TagPropagation"</span><span class="op">;</span></span>
<span id="cb4-44"><a href="#cb4-44"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb4-45"><a href="#cb4-45"></a></span>
<span id="cb4-46"><a href="#cb4-46"></a>    <span class="kw">var</span> DRY_RUN <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb4-47"><a href="#cb4-47"></a>    <span class="kw">var</span> TAG_NAME <span class="op">=</span> <span class="st">"Domain"</span><span class="op">;</span></span>
<span id="cb4-48"><a href="#cb4-48"></a>    <span class="kw">var</span> OVERWRITE <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb4-49"><a href="#cb4-49"></a></span>
<span id="cb4-50"><a href="#cb4-50"></a>    <span class="co">// Re-get source from memory? For simplicity here we re-read it from user:</span></span>
<span id="cb4-51"><a href="#cb4-51"></a>    <span class="co">// In practice you might stash it in a temp file or ask user for the value via InputBox.</span></span>
<span id="cb4-52"><a href="#cb4-52"></a>    <span class="kw">var</span> val <span class="op">=</span> Session<span class="op">.</span><span class="fu">Input</span>(<span class="st">"Enter value to propagate for tag '"</span> <span class="op">+</span> TAG_NAME <span class="op">+</span> <span class="st">"':"</span><span class="op">,</span> <span class="st">""</span>)<span class="op">;</span></span>
<span id="cb4-53"><a href="#cb4-53"></a>    <span class="cf">if</span> (<span class="fu">trim</span>(val) <span class="op">===</span> <span class="st">""</span>) { <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"No value provided; aborting."</span>)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb4-54"><a href="#cb4-54"></a></span>
<span id="cb4-55"><a href="#cb4-55"></a>    <span class="kw">var</span> pkg <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span>()<span class="op">;</span></span>
<span id="cb4-56"><a href="#cb4-56"></a>    <span class="cf">if</span> (<span class="op">!</span>pkg) { Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Select a *target package*."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb4-57"><a href="#cb4-57"></a></span>
<span id="cb4-58"><a href="#cb4-58"></a>    <span class="kw">var</span> i<span class="op">,</span> changed<span class="op">=</span><span class="dv">0</span><span class="op">,</span> elements <span class="op">=</span> pkg<span class="op">.</span><span class="at">Elements</span><span class="op">;</span></span>
<span id="cb4-59"><a href="#cb4-59"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>elements<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb4-60"><a href="#cb4-60"></a>        <span class="kw">var</span> e <span class="op">=</span> elements<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb4-61"><a href="#cb4-61"></a>        <span class="kw">var</span> cur <span class="op">=</span> <span class="fu">readTag</span>(e<span class="op">,</span> TAG_NAME)<span class="op">;</span></span>
<span id="cb4-62"><a href="#cb4-62"></a></span>
<span id="cb4-63"><a href="#cb4-63"></a>        <span class="cf">if</span> (<span class="fu">trim</span>(cur) <span class="op">===</span> <span class="st">""</span>) {</span>
<span id="cb4-64"><a href="#cb4-64"></a>            <span class="co">// tag missing → set</span></span>
<span id="cb4-65"><a href="#cb4-65"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Set "</span> <span class="op">+</span> TAG_NAME <span class="op">+</span> <span class="st">" on "</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">" → "</span> <span class="op">+</span> val)<span class="op">;</span></span>
<span id="cb4-66"><a href="#cb4-66"></a>            <span class="cf">if</span> (<span class="op">!</span>DRY_RUN) { <span class="fu">writeTag</span>(e<span class="op">,</span> TAG_NAME<span class="op">,</span> val)<span class="op">;</span> }</span>
<span id="cb4-67"><a href="#cb4-67"></a>            changed<span class="op">++;</span></span>
<span id="cb4-68"><a href="#cb4-68"></a>        } <span class="cf">else</span> <span class="cf">if</span> (OVERWRITE <span class="op">&amp;&amp;</span> cur <span class="op">!=</span> val) {</span>
<span id="cb4-69"><a href="#cb4-69"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Overwrite "</span> <span class="op">+</span> TAG_NAME <span class="op">+</span> <span class="st">" on "</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">" : "</span> <span class="op">+</span> cur <span class="op">+</span> <span class="st">" → "</span> <span class="op">+</span> val)<span class="op">;</span></span>
<span id="cb4-70"><a href="#cb4-70"></a>            <span class="cf">if</span> (<span class="op">!</span>DRY_RUN) { <span class="fu">writeTag</span>(e<span class="op">,</span> TAG_NAME<span class="op">,</span> val)<span class="op">;</span> }</span>
<span id="cb4-71"><a href="#cb4-71"></a>            changed<span class="op">++;</span></span>
<span id="cb4-72"><a href="#cb4-72"></a>        }</span>
<span id="cb4-73"><a href="#cb4-73"></a>    }</span>
<span id="cb4-74"><a href="#cb4-74"></a>    <span class="cf">if</span> (<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> changed<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(pkg<span class="op">.</span><span class="at">PackageID</span>)<span class="op">;</span></span>
<span id="cb4-75"><a href="#cb4-75"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Updated "</span> <span class="op">+</span> changed <span class="op">+</span> <span class="st">" element(s). Dry-run="</span> <span class="op">+</span> DRY_RUN)<span class="op">;</span></span>
<span id="cb4-76"><a href="#cb4-76"></a>}</span>
<span id="cb4-77"><a href="#cb4-77"></a></span>
<span id="cb4-78"><a href="#cb4-78"></a><span class="co">// ---- Tag helpers ----</span></span>
<span id="cb4-79"><a href="#cb4-79"></a><span class="kw">function</span> <span class="fu">readTag</span>(e<span class="op">,</span> name) {</span>
<span id="cb4-80"><a href="#cb4-80"></a>    <span class="kw">var</span> i<span class="op">,</span> tvs <span class="op">=</span> e<span class="op">.</span><span class="at">TaggedValues</span><span class="op">;</span></span>
<span id="cb4-81"><a href="#cb4-81"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>tvs<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb4-82"><a href="#cb4-82"></a>        <span class="kw">var</span> tv <span class="op">=</span> tvs<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb4-83"><a href="#cb4-83"></a>        <span class="cf">if</span> (<span class="fu">equalsIgnoreCase</span>(tv<span class="op">.</span><span class="at">Name</span><span class="op">,</span> name)) <span class="cf">return</span> <span class="bu">String</span>(tv<span class="op">.</span><span class="at">Value</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span></span>
<span id="cb4-84"><a href="#cb4-84"></a>    }</span>
<span id="cb4-85"><a href="#cb4-85"></a>    <span class="cf">return</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb4-86"><a href="#cb4-86"></a>}</span>
<span id="cb4-87"><a href="#cb4-87"></a><span class="kw">function</span> <span class="fu">writeTag</span>(e<span class="op">,</span> name<span class="op">,</span> value) {</span>
<span id="cb4-88"><a href="#cb4-88"></a>    <span class="kw">var</span> i<span class="op">,</span> tvs <span class="op">=</span> e<span class="op">.</span><span class="at">TaggedValues</span><span class="op">;</span></span>
<span id="cb4-89"><a href="#cb4-89"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>tvs<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb4-90"><a href="#cb4-90"></a>        <span class="kw">var</span> tv <span class="op">=</span> tvs<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb4-91"><a href="#cb4-91"></a>        <span class="cf">if</span> (<span class="fu">equalsIgnoreCase</span>(tv<span class="op">.</span><span class="at">Name</span><span class="op">,</span> name)) {</span>
<span id="cb4-92"><a href="#cb4-92"></a>            tv<span class="op">.</span><span class="at">Value</span> <span class="op">=</span> value<span class="op">;</span> tv<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb4-93"><a href="#cb4-93"></a>        }</span>
<span id="cb4-94"><a href="#cb4-94"></a>    }</span>
<span id="cb4-95"><a href="#cb4-95"></a>    <span class="co">// add new if not found</span></span>
<span id="cb4-96"><a href="#cb4-96"></a>    <span class="kw">var</span> ntv <span class="op">=</span> tvs<span class="op">.</span><span class="fu">AddNew</span>(name<span class="op">,</span> <span class="bu">String</span>(value))<span class="op">;</span></span>
<span id="cb4-97"><a href="#cb4-97"></a>    ntv<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span></span>
<span id="cb4-98"><a href="#cb4-98"></a>}</span>
<span id="cb4-99"><a href="#cb4-99"></a></span>
<span id="cb4-100"><a href="#cb4-100"></a><span class="co">// Choose which entry point to bind in EA’s Scripts window:</span></span>
<span id="cb4-101"><a href="#cb4-101"></a><span class="co">// main() for step-by-step or applyToTarget() for one-shot after prompting</span></span>
<span id="cb4-102"><a href="#cb4-102"></a><span class="co">// main();</span></span>
<span id="cb4-103"><a href="#cb4-103"></a><span class="fu">applyToTarget</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="pattern-4-linting-quality-gates-report-only-by-default" class="level3">
<h3 class="anchored" data-anchor-id="pattern-4-linting-quality-gates-report-only-by-default">Pattern 4 – Linting &amp; Quality Gates (Report-Only by Default)</h3>
<p>Just as programmers use “linters” to check code quality, modellers can use scripts to check model quality. The <strong>Linting</strong> pattern is about scanning the repository for “smells”: missing notes, duplicate names, orphaned elements, inconsistent stereotypes.</p>
<p>The script doesn’t necessarily fix the issues. It logs them, creates a report, and highlights what needs attention. This is especially powerful in enterprise settings where governance requires objective evidence of model quality.</p>
<p><strong>When to use:</strong> continuous hygiene checks (naming, required tags, required relationships).<br>
<strong>Why:</strong> consistent, repeatable, fast feedback before governance reviews.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 7.5 - Pattern4_LintQuality.js – JScript (ES3)</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5" data-filename="Example 7.5 - Pattern4_LintQuality.js – JScript (ES3)"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co">// Example 7.5 - Pattern4_LintQuality.js – JScript (ES3)</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">// Purpose: Report model "smells" in selected package (no writes by default)</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">// Checks:</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">//   - Name not empty</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">//   - Required tag exists (e.g., "Owner")</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">//   - Name matches regex prefix (e.g., "REQ_")</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">// Output: CSV + Output tab; dry-run concept not needed (read-only)</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">// Dependencies: Helpers.js</span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb5-11"><a href="#cb5-11"></a></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb5-14"><a href="#cb5-14"></a></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb5-16"><a href="#cb5-16"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"Lint"</span><span class="op">;</span></span>
<span id="cb5-17"><a href="#cb5-17"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb5-18"><a href="#cb5-18"></a></span>
<span id="cb5-19"><a href="#cb5-19"></a>    <span class="co">// ---- Config ----</span></span>
<span id="cb5-20"><a href="#cb5-20"></a>    <span class="kw">var</span> REQUIRED_TAG <span class="op">=</span> <span class="st">"Owner"</span><span class="op">;</span></span>
<span id="cb5-21"><a href="#cb5-21"></a>    <span class="kw">var</span> NAME_PREFIX   <span class="op">=</span> <span class="st">"REQ_"</span><span class="op">;</span></span>
<span id="cb5-22"><a href="#cb5-22"></a>    <span class="kw">var</span> WRITE_CSV     <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb5-23"><a href="#cb5-23"></a></span>
<span id="cb5-24"><a href="#cb5-24"></a>    <span class="kw">var</span> pkg <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span>()<span class="op">;</span></span>
<span id="cb5-25"><a href="#cb5-25"></a>    <span class="cf">if</span> (<span class="op">!</span>pkg) { Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Select a package to lint."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb5-26"><a href="#cb5-26"></a></span>
<span id="cb5-27"><a href="#cb5-27"></a>    <span class="kw">var</span> dir<span class="op">=</span><span class="kw">null</span><span class="op">,</span> csv<span class="op">=</span><span class="kw">null</span><span class="op">;</span></span>
<span id="cb5-28"><a href="#cb5-28"></a>    <span class="cf">if</span> (WRITE_CSV) {</span>
<span id="cb5-29"><a href="#cb5-29"></a>        dir <span class="op">=</span> <span class="fu">browseForFolder</span>(<span class="st">"Select output folder for lint report:"</span>)<span class="op">;</span></span>
<span id="cb5-30"><a href="#cb5-30"></a>        <span class="cf">if</span> (dir) {</span>
<span id="cb5-31"><a href="#cb5-31"></a>            <span class="kw">var</span> stamp <span class="op">=</span> (<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb5-32"><a href="#cb5-32"></a>            <span class="kw">var</span> path <span class="op">=</span> dir <span class="op">+</span> <span class="st">"</span><span class="sc">\\</span><span class="st">pattern4_lint_report_"</span> <span class="op">+</span> stamp <span class="op">+</span> <span class="st">".csv"</span><span class="op">;</span></span>
<span id="cb5-33"><a href="#cb5-33"></a>            csv <span class="op">=</span> <span class="kw">new</span> <span class="fu">CsvWriter</span>(path)<span class="op">;</span></span>
<span id="cb5-34"><a href="#cb5-34"></a>            csv<span class="op">.</span><span class="fu">writeHeader</span>(<span class="st">"ElementID,GUID,Name,Type,Issue,Details"</span>)<span class="op">;</span></span>
<span id="cb5-35"><a href="#cb5-35"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Logging to: "</span> <span class="op">+</span> path)<span class="op">;</span></span>
<span id="cb5-36"><a href="#cb5-36"></a>        }</span>
<span id="cb5-37"><a href="#cb5-37"></a>    }</span>
<span id="cb5-38"><a href="#cb5-38"></a></span>
<span id="cb5-39"><a href="#cb5-39"></a>    <span class="kw">var</span> i<span class="op">,</span> issues<span class="op">=</span><span class="dv">0</span><span class="op">,</span> elements <span class="op">=</span> pkg<span class="op">.</span><span class="at">Elements</span><span class="op">;</span></span>
<span id="cb5-40"><a href="#cb5-40"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>elements<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb5-41"><a href="#cb5-41"></a>        <span class="kw">var</span> e <span class="op">=</span> elements<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb5-42"><a href="#cb5-42"></a></span>
<span id="cb5-43"><a href="#cb5-43"></a>        <span class="co">// Check 1: name present</span></span>
<span id="cb5-44"><a href="#cb5-44"></a>        <span class="cf">if</span> (<span class="fu">trim</span>(e<span class="op">.</span><span class="at">Name</span>) <span class="op">===</span> <span class="st">""</span>) {</span>
<span id="cb5-45"><a href="#cb5-45"></a>            issues <span class="op">+=</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> <span class="st">"MissingName"</span><span class="op">,</span> <span class="st">"Element has no name"</span>)<span class="op">;</span></span>
<span id="cb5-46"><a href="#cb5-46"></a>        }</span>
<span id="cb5-47"><a href="#cb5-47"></a></span>
<span id="cb5-48"><a href="#cb5-48"></a>        <span class="co">// Check 2: required tag exists</span></span>
<span id="cb5-49"><a href="#cb5-49"></a>        <span class="cf">if</span> (<span class="fu">trim</span>(<span class="fu">readTag</span>(e<span class="op">,</span> REQUIRED_TAG)) <span class="op">===</span> <span class="st">""</span>) {</span>
<span id="cb5-50"><a href="#cb5-50"></a>            issues <span class="op">+=</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> <span class="st">"MissingTag"</span><span class="op">,</span> <span class="st">"Required tag '"</span><span class="op">+</span>REQUIRED_TAG<span class="op">+</span><span class="st">"' is missing or empty"</span>)<span class="op">;</span></span>
<span id="cb5-51"><a href="#cb5-51"></a>        }</span>
<span id="cb5-52"><a href="#cb5-52"></a></span>
<span id="cb5-53"><a href="#cb5-53"></a>        <span class="co">// Check 3: naming convention</span></span>
<span id="cb5-54"><a href="#cb5-54"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">startsWith</span>(e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> NAME_PREFIX)) {</span>
<span id="cb5-55"><a href="#cb5-55"></a>            issues <span class="op">+=</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> <span class="st">"NamePrefix"</span><span class="op">,</span> <span class="st">"Expected prefix '"</span> <span class="op">+</span> NAME_PREFIX <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb5-56"><a href="#cb5-56"></a>        }</span>
<span id="cb5-57"><a href="#cb5-57"></a>    }</span>
<span id="cb5-58"><a href="#cb5-58"></a></span>
<span id="cb5-59"><a href="#cb5-59"></a>    <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb5-60"><a href="#cb5-60"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Lint finished. Issues found: "</span> <span class="op">+</span> issues)<span class="op">;</span></span>
<span id="cb5-61"><a href="#cb5-61"></a>}</span>
<span id="cb5-62"><a href="#cb5-62"></a></span>
<span id="cb5-63"><a href="#cb5-63"></a><span class="kw">function</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> issue<span class="op">,</span> details) {</span>
<span id="cb5-64"><a href="#cb5-64"></a>    <span class="kw">var</span> line <span class="op">=</span> e<span class="op">.</span><span class="at">ElementID</span> <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">" – "</span> <span class="op">+</span> issue <span class="op">+</span> <span class="st">" : "</span> <span class="op">+</span> details<span class="op">;</span></span>
<span id="cb5-65"><a href="#cb5-65"></a>    <span class="fu">log</span>(<span class="st">"Lint"</span><span class="op">,</span> line)<span class="op">;</span></span>
<span id="cb5-66"><a href="#cb5-66"></a>    <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">writeRow</span>([e<span class="op">.</span><span class="at">ElementID</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementGUID</span><span class="op">,</span> e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> e<span class="op">.</span><span class="at">Type</span><span class="op">,</span> issue<span class="op">,</span> details])<span class="op">;</span></span>
<span id="cb5-67"><a href="#cb5-67"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-68"><a href="#cb5-68"></a>}</span>
<span id="cb5-69"><a href="#cb5-69"></a></span>
<span id="cb5-70"><a href="#cb5-70"></a><span class="kw">function</span> <span class="fu">readTag</span>(e<span class="op">,</span> name) {</span>
<span id="cb5-71"><a href="#cb5-71"></a>    <span class="kw">var</span> i<span class="op">,</span> tvs <span class="op">=</span> e<span class="op">.</span><span class="at">TaggedValues</span><span class="op">;</span></span>
<span id="cb5-72"><a href="#cb5-72"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>tvs<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb5-73"><a href="#cb5-73"></a>        <span class="kw">var</span> tv <span class="op">=</span> tvs<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb5-74"><a href="#cb5-74"></a>        <span class="cf">if</span> (<span class="fu">equalsIgnoreCase</span>(tv<span class="op">.</span><span class="at">Name</span><span class="op">,</span> name)) <span class="cf">return</span> <span class="bu">String</span>(tv<span class="op">.</span><span class="at">Value</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span></span>
<span id="cb5-75"><a href="#cb5-75"></a>    }</span>
<span id="cb5-76"><a href="#cb5-76"></a>    <span class="cf">return</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb5-77"><a href="#cb5-77"></a>}</span>
<span id="cb5-78"><a href="#cb5-78"></a></span>
<span id="cb5-79"><a href="#cb5-79"></a><span class="fu">main</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="pattern-5-sql-accelerated-find-api-safe-write-hybrid" class="level3">
<h3 class="anchored" data-anchor-id="pattern-5-sql-accelerated-find-api-safe-write-hybrid">Pattern 5 – SQL-Accelerated Find, API-Safe Write (Hybrid)</h3>
<p>One of the most effective ways to balance speed with safety in EA scripting is the <strong>hybrid pattern</strong>: use SQL to locate candidates, but rely on the API to perform updates.</p>
<ul>
<li><p><strong>When to use</strong>: this approach shines when you need to identify thousands of elements quickly — for example, all Requirements missing an Owner tag, or all Components in a given layer. Traversing entire package trees with .Count and .GetAt() can be slow; SQL queries are much faster.</p></li>
<li><p><strong>Why not just update with SQL?</strong> Because direct database updates bypass EA’s business rules and can corrupt the repository. That’s why writes must still go through the API.</p></li>
</ul>
<p><strong>The idea</strong> is simple:</p>
<ol type="1">
<li><p>Use Repository.SQLQuery() with a SELECT statement to pull back the candidate IDs.</p></li>
<li><p>Parse the XML result to extract element IDs or GUIDs.</p></li>
<li><p>Loop over those IDs, load each object via the API, and apply updates safely (Update() + RefreshModelView()).</p></li>
</ol>
<p>This hybrid approach gives you the best of both worlds:</p>
<ul>
<li><p><strong>Fast selection</strong> (SQL can scan tens of thousands of rows in seconds).</p></li>
<li><p><strong>Safe updates</strong> (API ensures model integrity).</p></li>
</ul>
<p>It is one of the most important performance patterns for large repositories.</p>
<p><strong>When to use:</strong> you need to <em>find</em> thousands of items quickly, but still want <strong>safe updates</strong> via the API (not raw SQL writes).</p>
<p><strong>Idea:</strong> use Repository.SQLQuery() to <em>select</em> candidates (fast), parse the XML result to get IDs, then loop via API for writes (safe).</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 7.6 - Pattern5_SqlFind_ApiWrite.js – JScript (ES3)</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6" data-filename="Example 7.6 - Pattern5_SqlFind_ApiWrite.js – JScript (ES3)"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co">// Example 7.6. - Pattern5_SqlFind_ApiWrite.js – JScript (ES3)</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">// Purpose: Fast "find" via SQLQuery, then safe writes via API</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">// Usage: Select any package (context not required for SQL); DRY_RUN=true by default</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">// Dependencies: Helpers.js</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb6-9"><a href="#cb6-9"></a></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb6-11"><a href="#cb6-11"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"SqlFindApiWrite"</span><span class="op">;</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb6-13"><a href="#cb6-13"></a></span>
<span id="cb6-14"><a href="#cb6-14"></a>    <span class="kw">var</span> DRY_RUN <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb6-15"><a href="#cb6-15"></a>    <span class="kw">var</span> TYPE_FILTER <span class="op">=</span> <span class="st">"Class"</span><span class="op">;</span></span>
<span id="cb6-16"><a href="#cb6-16"></a>    <span class="kw">var</span> STEREOTYPE_TO_SET <span class="op">=</span> <span class="st">"DomainObject"</span><span class="op">;</span></span>
<span id="cb6-17"><a href="#cb6-17"></a></span>
<span id="cb6-18"><a href="#cb6-18"></a>    <span class="co">// 1) SQL find (XML result)</span></span>
<span id="cb6-19"><a href="#cb6-19"></a>    <span class="kw">var</span> sql <span class="op">=</span> <span class="st">"SELECT Object_ID, ea_guid, Name FROM t_object WHERE Object_Type='"</span> <span class="op">+</span> TYPE_FILTER <span class="op">+</span> <span class="st">"' AND Stereotype IS NULL"</span><span class="op">;</span></span>
<span id="cb6-20"><a href="#cb6-20"></a>    <span class="kw">var</span> xml <span class="op">=</span> Repository<span class="op">.</span><span class="fu">SQLQuery</span>(sql)<span class="op">;</span></span>
<span id="cb6-21"><a href="#cb6-21"></a></span>
<span id="cb6-22"><a href="#cb6-22"></a>    <span class="co">// 2) Parse minimal XML (very simple string parsing; robust XML parser not available in ES3)</span></span>
<span id="cb6-23"><a href="#cb6-23"></a>    <span class="co">//    Expect rows like: &lt;Row&gt;&lt;Object_ID&gt;123&lt;/Object_ID&gt;&lt;ea_guid&gt;{...}&lt;/ea_guid&gt;&lt;Name&gt;Foo&lt;/Name&gt;&lt;/Row&gt;</span></span>
<span id="cb6-24"><a href="#cb6-24"></a>    <span class="kw">var</span> ids <span class="op">=</span> <span class="fu">extractAll</span>(xml<span class="op">,</span> <span class="st">"&lt;Object_ID&gt;"</span><span class="op">,</span> <span class="st">"&lt;/Object_ID&gt;"</span>)<span class="op">;</span></span>
<span id="cb6-25"><a href="#cb6-25"></a></span>
<span id="cb6-26"><a href="#cb6-26"></a>    <span class="kw">var</span> i<span class="op">,</span> changed<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-27"><a href="#cb6-27"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Candidates: "</span> <span class="op">+</span> ids<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb6-28"><a href="#cb6-28"></a></span>
<span id="cb6-29"><a href="#cb6-29"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>ids<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb6-30"><a href="#cb6-30"></a>        <span class="kw">var</span> id <span class="op">=</span> <span class="pp">parseInt</span>(<span class="fu">trim</span>(ids[i])<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb6-31"><a href="#cb6-31"></a>        <span class="kw">var</span> e <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetElementByID</span>(id)<span class="op">;</span></span>
<span id="cb6-32"><a href="#cb6-32"></a>        <span class="cf">if</span> (<span class="op">!</span>e) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb6-33"><a href="#cb6-33"></a></span>
<span id="cb6-34"><a href="#cb6-34"></a>        <span class="co">// Only set stereotype if empty (defensive sanity)</span></span>
<span id="cb6-35"><a href="#cb6-35"></a>        <span class="cf">if</span> (<span class="fu">trim</span>(e<span class="op">.</span><span class="at">Stereotype</span>) <span class="op">===</span> <span class="st">""</span>) {</span>
<span id="cb6-36"><a href="#cb6-36"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Set stereotype on "</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">" → "</span> <span class="op">+</span> STEREOTYPE_TO_SET)<span class="op">;</span></span>
<span id="cb6-37"><a href="#cb6-37"></a>            <span class="cf">if</span> (<span class="op">!</span>DRY_RUN) {</span>
<span id="cb6-38"><a href="#cb6-38"></a>                e<span class="op">.</span><span class="at">Stereotype</span> <span class="op">=</span> STEREOTYPE_TO_SET<span class="op">;</span></span>
<span id="cb6-39"><a href="#cb6-39"></a>                e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span></span>
<span id="cb6-40"><a href="#cb6-40"></a>            }</span>
<span id="cb6-41"><a href="#cb6-41"></a>            changed<span class="op">++;</span></span>
<span id="cb6-42"><a href="#cb6-42"></a>        }</span>
<span id="cb6-43"><a href="#cb6-43"></a>    }</span>
<span id="cb6-44"><a href="#cb6-44"></a>    <span class="cf">if</span> (<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> changed<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb6-45"><a href="#cb6-45"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Changed "</span> <span class="op">+</span> changed <span class="op">+</span> <span class="st">" element(s). Dry-run="</span> <span class="op">+</span> DRY_RUN)<span class="op">;</span></span>
<span id="cb6-46"><a href="#cb6-46"></a>}</span>
<span id="cb6-47"><a href="#cb6-47"></a></span>
<span id="cb6-48"><a href="#cb6-48"></a><span class="co">// Minimal XML extraction helpers (no DOM available in ES3)</span></span>
<span id="cb6-49"><a href="#cb6-49"></a><span class="kw">function</span> <span class="fu">extractAll</span>(hay<span class="op">,</span> openTag<span class="op">,</span> closeTag) {</span>
<span id="cb6-50"><a href="#cb6-50"></a>    <span class="kw">var</span> res <span class="op">=</span> []<span class="op">,</span> start<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-51"><a href="#cb6-51"></a>    <span class="cf">while</span> (<span class="kw">true</span>) {</span>
<span id="cb6-52"><a href="#cb6-52"></a>        <span class="kw">var</span> i <span class="op">=</span> hay<span class="op">.</span><span class="fu">indexOf</span>(openTag<span class="op">,</span> start)<span class="op">;</span></span>
<span id="cb6-53"><a href="#cb6-53"></a>        <span class="cf">if</span> (i <span class="op">&lt;</span> <span class="dv">0</span>) <span class="cf">break</span><span class="op">;</span></span>
<span id="cb6-54"><a href="#cb6-54"></a>        <span class="kw">var</span> j <span class="op">=</span> hay<span class="op">.</span><span class="fu">indexOf</span>(closeTag<span class="op">,</span> i <span class="op">+</span> openTag<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb6-55"><a href="#cb6-55"></a>        <span class="cf">if</span> (j <span class="op">&lt;</span> <span class="dv">0</span>) <span class="cf">break</span><span class="op">;</span></span>
<span id="cb6-56"><a href="#cb6-56"></a>        <span class="kw">var</span> val <span class="op">=</span> hay<span class="op">.</span><span class="fu">substring</span>(i <span class="op">+</span> openTag<span class="op">.</span><span class="at">length</span><span class="op">,</span> j)<span class="op">;</span></span>
<span id="cb6-57"><a href="#cb6-57"></a>        res<span class="op">.</span><span class="fu">push</span>(val)<span class="op">;</span></span>
<span id="cb6-58"><a href="#cb6-58"></a>        start <span class="op">=</span> j <span class="op">+</span> closeTag<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb6-59"><a href="#cb6-59"></a>    }</span>
<span id="cb6-60"><a href="#cb6-60"></a>    <span class="cf">return</span> res<span class="op">;</span></span>
<span id="cb6-61"><a href="#cb6-61"></a>}</span>
<span id="cb6-62"><a href="#cb6-62"></a></span>
<span id="cb6-63"><a href="#cb6-63"></a><span class="fu">main</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="pattern-handling" class="level2">
<h2 class="anchored" data-anchor-id="pattern-handling">Pattern Handling</h2>
<section id="patterns-as-a-library" class="level3">
<h3 class="anchored" data-anchor-id="patterns-as-a-library">Patterns as a Library</h3>
<p>The beauty of patterns is that they can be turned into a <strong>script library</strong>. Instead of writing bespoke code, you start from a template:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 7.7 - findFilteredApply</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7" data-filename="Example 7.7 - findFilteredApply"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">// -------------------------------------------------------------------------------------------</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co">// Example 7.7 - findFilteredApply</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co">// -------------------------------------------------------------------------------------------</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="kw">function</span> <span class="fu">findFilterApply</span>(pkg<span class="op">,</span> filterFn<span class="op">,</span> applyFn) {</span>
<span id="cb7-5"><a href="#cb7-5"></a>    <span class="kw">var</span> els <span class="op">=</span> pkg<span class="op">.</span><span class="at">Elements</span><span class="op">;</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> els<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb7-7"><a href="#cb7-7"></a>        <span class="kw">var</span> e <span class="op">=</span> els<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>        <span class="cf">if</span> (<span class="fu">filterFn</span>(e)) {</span>
<span id="cb7-9"><a href="#cb7-9"></a>            <span class="fu">applyFn</span>(e)<span class="op">;</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>        }</span>
<span id="cb7-11"><a href="#cb7-11"></a>    }</span>
<span id="cb7-12"><a href="#cb7-12"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>With such a template, your script becomes simply the filter and apply functions. The boilerplate is taken care of. Even within EA’s limited JScript environment, this approach saves effort and reduces bugs.</p>
</section>
<section id="patterns-and-governance" class="level3">
<h3 class="anchored" data-anchor-id="patterns-and-governance">Patterns and Governance</h3>
<p>One of the most important applications of patterns is governance. Large organisations rely on consistent models for reporting, compliance, and decision-making. Manual governance is too slow. Patterns like Find/Filter/Apply and Linting turn governance into a repeatable, automated process.</p>
<p>For example, you can script a governance check that every Requirement must have an Owner tag. The script follows the Find/Filter/Apply pattern, filters Requirements, checks tags, and logs violations. By running it regularly, you maintain model hygiene.</p>
</section>
<section id="patterns-across-languages" class="level3">
<h3 class="anchored" data-anchor-id="patterns-across-languages">Patterns Across Languages</h3>
<p>Although the examples in this chapter are in JScript, the patterns themselves are language-agnostic. If you later write external automation in Python or C#, the same patterns apply. A Find/Filter/Apply loop in Python looks slightly different, but the structure is identical. This makes patterns a great way to transfer knowledge across teams and technologies.</p>
</section>
<section id="the-safety-net-of-patterns" class="level3">
<h3 class="anchored" data-anchor-id="the-safety-net-of-patterns">The Safety Net of Patterns</h3>
<p>Patterns also act as a safety net against AI hallucinations. As we saw earlier, AI can generate starter scripts but often introduces unsupported syntax. If you know the underlying pattern, you can spot and correct mistakes quickly. For example, if AI gives you a forEach, you know the pattern requires a .Count/.GetAt() loop, and you can adjust accordingly.</p>
</section>
</section>
<section id="performance-safety-notes" class="level2">
<h2 class="anchored" data-anchor-id="performance-safety-notes">Performance &amp; Safety Notes</h2>
<ul>
<li><p>Prefer <strong>Find/Filter/Apply</strong> for clarity; switch to <strong>SQL-accelerated find</strong> when scale demands it.</p></li>
<li><p>Keep <strong>DRY_RUN = true</strong> until you’ve inspected CSV logs.</p></li>
<li><p>Call <strong>Update()</strong> after modifications, then <strong>RefreshModelView()</strong> for UI.</p></li>
<li><p>For very large sets, consider chunking (operate in batches of, say, 250 items) and pausing UI updates:</p></li>
<li><p>// Pseudocode – EA may ignore UI flag in some contexts; rely on batching regardless</p></li>
<li><p>// Repository.EnableUIUpdates = false; // not always honoured</p></li>
<li><p>// …do batches…</p></li>
<li><p>// Repository.EnableUIUpdates = true;</p></li>
<li><p>// Repository.RefreshModelView(0);</p></li>
</ul>
</section>
<section id="bonus-python-curate-apply-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="bonus-python-curate-apply-pipeline">Bonus: Python “Curate → Apply” Pipeline</h2>
<p>Use this when CSV shaping, validation or integration (e.g., SharePoint, Jira) is easier outside EA.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Example 7.8 - pattern6_curate_apply_external.py – Python 3 (pywin32)</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8" data-filename="Example 7.8 - pattern6_curate_apply_external.py – Python 3 (pywin32)"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co"># Example 7.8 - pattern6_curate_apply_external.py – Python 3 (pywin32)</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co"># Purpose: Read a curated CSV of element updates and apply via EA API</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co"># Safety: Only rows with Apply=YES are executed</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="im">import</span> csv, win32com.client</span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="kw">def</span> main(csv_path):</span>
<span id="cb8-9"><a href="#cb8-9"></a>    ea <span class="op">=</span> win32com.client.Dispatch(<span class="st">"EA.App"</span>)</span>
<span id="cb8-10"><a href="#cb8-10"></a>    repo <span class="op">=</span> ea.Repository</span>
<span id="cb8-11"><a href="#cb8-11"></a></span>
<span id="cb8-12"><a href="#cb8-12"></a>    changes <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>    <span class="cf">with</span> <span class="bu">open</span>(csv_path, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb8-14"><a href="#cb8-14"></a>        rdr <span class="op">=</span> csv.DictReader(f)</span>
<span id="cb8-15"><a href="#cb8-15"></a>        <span class="cf">for</span> row <span class="kw">in</span> rdr:</span>
<span id="cb8-16"><a href="#cb8-16"></a>            <span class="cf">if</span> <span class="bu">str</span>(row.get(<span class="st">"Apply"</span>,<span class="st">""</span>)).strip().lower() <span class="op">!=</span> <span class="st">"yes"</span>:</span>
<span id="cb8-17"><a href="#cb8-17"></a>                <span class="cf">continue</span></span>
<span id="cb8-18"><a href="#cb8-18"></a>            eid <span class="op">=</span> <span class="bu">int</span>(row[<span class="st">"ElementID"</span>])</span>
<span id="cb8-19"><a href="#cb8-19"></a>            new_status <span class="op">=</span> row[<span class="st">"ProposedStatus"</span>]</span>
<span id="cb8-20"><a href="#cb8-20"></a></span>
<span id="cb8-21"><a href="#cb8-21"></a>            e <span class="op">=</span> repo.GetElementByID(eid)</span>
<span id="cb8-22"><a href="#cb8-22"></a>            <span class="cf">if</span> e:</span>
<span id="cb8-23"><a href="#cb8-23"></a>                e.Status <span class="op">=</span> new_status</span>
<span id="cb8-24"><a href="#cb8-24"></a>                e.Update()</span>
<span id="cb8-25"><a href="#cb8-25"></a>                changes <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-26"><a href="#cb8-26"></a></span>
<span id="cb8-27"><a href="#cb8-27"></a>    <span class="cf">if</span> changes:</span>
<span id="cb8-28"><a href="#cb8-28"></a>        repo.RefreshModelView(<span class="dv">0</span>)</span>
<span id="cb8-29"><a href="#cb8-29"></a>    <span class="bu">print</span>(<span class="ss">f"Applied </span><span class="sc">{</span>changes<span class="sc">}</span><span class="ss"> curated change(s)."</span>)</span>
<span id="cb8-30"><a href="#cb8-30"></a></span>
<span id="cb8-31"><a href="#cb8-31"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb8-32"><a href="#cb8-32"></a>    main(<span class="vs">r"C:</span><span class="er">\</span><span class="vs">path</span><span class="ch">\t</span><span class="vs">o</span><span class="er">\</span><span class="vs">pattern2_curate_export_123</span><span class="dv">.</span><span class="vs">csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="what-to-use-when-cheat-sheet" class="level2">
<h2 class="anchored" data-anchor-id="what-to-use-when-cheat-sheet">What to Use When (cheat-sheet)</h2>
<ul>
<li><p><strong>Small, safe rename/retag</strong> → Pattern 1 (Find/Filter/Apply).</p></li>
<li><p><strong>Risky/wide updates</strong> → Pattern 2 (Curate-then-Write).</p></li>
<li><p><strong>Set common metadata</strong> → Pattern 3 (Tag Propagation).</p></li>
<li><p><strong>Governance checks</strong> → Pattern 4 (Linting &amp; Quality Gates).</p></li>
<li><p><strong>Huge models</strong> → Pattern 5 (SQL-find, API-write).</p></li>
<li><p><strong>Pipelines &amp; integrations</strong> → Python external bonus.</p></li>
</ul>


<!-- -->

</section>

</main> <!-- /main -->
<script>

document.addEventListener('DOMContentLoaded', function () {

  // Prefer the margin sidebar if it exists; otherwise try the TOC sidebar.

  const margin = document.querySelector('#quarto-margin-sidebar, .margin-sidebar, .column-margin');

  const toc    = document.querySelector('nav#TOC');

  const sidebar = margin || (toc && toc.closest('.sidebar, .quarto-sidebar, .margin-sidebar'));



  if (!sidebar) return; // no margin column on this layout



  const holder = document.createElement('div');

  holder.className = 'cover-above-toc';

  holder.innerHTML = `

    <a href="index.html">

      <img src="images/cover.png" alt="Book cover" class="cover-above-toc__img" width="140" />

    </a>

  `;

  sidebar.prepend(holder);

});

</script>



<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./07-System.Object[].html" class="pagination-link" aria-label="Chapter 6: External Automation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Chapter 6: External Automation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./09-System.Object[].html" class="pagination-link" aria-label="Chapter 8: Object Details">
        <span class="nav-page-text"><span class="chapter-title">Chapter 8: Object Details</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu"># Chapter 7: Script Design Patterns</span></span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a>When you first begin scripting in Enterprise Architect, the process</span>
<span id="cb9-4"><a href="#cb9-4"></a>feels like a series of one-off solutions. You need to rename a batch of</span>
<span id="cb9-5"><a href="#cb9-5"></a>elements, so you write a loop. You want to add a tagged value</span>
<span id="cb9-6"><a href="#cb9-6"></a>everywhere, so you copy and tweak the loop. You need to enforce a naming</span>
<span id="cb9-7"><a href="#cb9-7"></a>convention, so you adjust the loop again. Each script solves the</span>
<span id="cb9-8"><a href="#cb9-8"></a>immediate problem but looks and feels slightly different from the last.</span>
<span id="cb9-9"><a href="#cb9-9"></a>After a while, you realise you are writing the same structural code over</span>
<span id="cb9-10"><a href="#cb9-10"></a>and over, just with small changes in logic.</span>
<span id="cb9-11"><a href="#cb9-11"></a></span>
<span id="cb9-12"><a href="#cb9-12"></a>This is not accidental. EA scripting tasks fall into recurring shapes.</span>
<span id="cb9-13"><a href="#cb9-13"></a>Recognising these shapes and naming them as **design patterns** gives</span>
<span id="cb9-14"><a href="#cb9-14"></a>you a powerful advantage. Instead of starting from scratch each time,</span>
<span id="cb9-15"><a href="#cb9-15"></a>you select the right pattern and plug in your task-specific logic.</span>
<span id="cb9-16"><a href="#cb9-16"></a>Patterns make scripts **shorter, safer, and more consistent**. They also</span>
<span id="cb9-17"><a href="#cb9-17"></a>make it easier to share code with colleagues, because everyone</span>
<span id="cb9-18"><a href="#cb9-18"></a>recognises the pattern being used.</span>
<span id="cb9-19"><a href="#cb9-19"></a></span>
<span id="cb9-20"><a href="#cb9-20"></a>This chapter introduces a handful of design patterns that cover the</span>
<span id="cb9-21"><a href="#cb9-21"></a>majority of practical EA scripting needs. They are not patterns in the</span>
<span id="cb9-22"><a href="#cb9-22"></a>object-oriented sense of Singleton or Observer, but scripting patterns</span>
<span id="cb9-23"><a href="#cb9-23"></a>tuned to the EA environment. Each one addresses a class of problems —</span>
<span id="cb9-24"><a href="#cb9-24"></a>traversing and filtering elements, applying changes in two phases,</span>
<span id="cb9-25"><a href="#cb9-25"></a>propagating metadata, checking quality. Once you master them, scripting</span>
<span id="cb9-26"><a href="#cb9-26"></a>EA becomes less about inventing and more about assembling known patterns</span>
<span id="cb9-27"><a href="#cb9-27"></a>into solutions.</span>
<span id="cb9-28"><a href="#cb9-28"></a></span>
<span id="cb9-29"><a href="#cb9-29"></a><span class="fu">## Why Patterns Matter</span></span>
<span id="cb9-30"><a href="#cb9-30"></a></span>
<span id="cb9-31"><a href="#cb9-31"></a>The first reason to adopt patterns is **safety**. Many script errors</span>
<span id="cb9-32"><a href="#cb9-32"></a>arise because someone hand-coded a loop in haste, forgot to check</span>
<span id="cb9-33"><a href="#cb9-33"></a>ObjectType, or failed to include Update(). A pattern encapsulates safe</span>
<span id="cb9-34"><a href="#cb9-34"></a>practices — dry-run flags, logging, backwards deletion, UI refreshes —</span>
<span id="cb9-35"><a href="#cb9-35"></a>so you don’t have to remember them each time.</span>
<span id="cb9-36"><a href="#cb9-36"></a></span>
<span id="cb9-37"><a href="#cb9-37"></a>The second reason is **productivity**. A good pattern reduces</span>
<span id="cb9-38"><a href="#cb9-38"></a>boilerplate. You can focus on what the script should *do*, rather than</span>
<span id="cb9-39"><a href="#cb9-39"></a>how to set up the loop. For example, the Find/Filter/Apply pattern sets</span>
<span id="cb9-40"><a href="#cb9-40"></a>up traversal for you; you just provide the filter condition and the</span>
<span id="cb9-41"><a href="#cb9-41"></a>apply logic.</span>
<span id="cb9-42"><a href="#cb9-42"></a></span>
<span id="cb9-43"><a href="#cb9-43"></a>The third reason is **communication**. When you share a script with a</span>
<span id="cb9-44"><a href="#cb9-44"></a>colleague and they see it follows a known pattern, they can understand</span>
<span id="cb9-45"><a href="#cb9-45"></a>it quickly. It creates a shared vocabulary: “oh, this is a</span>
<span id="cb9-46"><a href="#cb9-46"></a>Curate-then-Write script” means more than “this is some code that loops</span>
<span id="cb9-47"><a href="#cb9-47"></a>twice.”</span>
<span id="cb9-48"><a href="#cb9-48"></a></span>
<span id="cb9-49"><a href="#cb9-49"></a><span class="fu">## Examples</span></span>
<span id="cb9-50"><a href="#cb9-50"></a></span>
<span id="cb9-51"><a href="#cb9-51"></a><span class="fu">### Shared Helper</span></span>
<span id="cb9-52"><a href="#cb9-52"></a></span>
<span id="cb9-53"><a href="#cb9-53"></a>Drop this small helper library in your script group (e.g.,</span>
<span id="cb9-54"><a href="#cb9-54"></a>“<span class="sc">\\</span>_Common<span class="sc">\\</span>Helpers.js”) and !INC it from each script.</span>
<span id="cb9-55"><a href="#cb9-55"></a></span>
<span id="cb9-56"><a href="#cb9-56"></a><span class="in">```{.js filename="Example 7.1 - Helpers.js (JScript ES3) – Common utility helpers"}</span></span>
<span id="cb9-57"><a href="#cb9-57"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb9-58"><a href="#cb9-58"></a><span class="co">// Example 7.1 - Helpers.js (JScript ES3) – Common utility helpers</span></span>
<span id="cb9-59"><a href="#cb9-59"></a><span class="co">// Purpose: Logging, safety utilities, folder picker, CSV writer</span></span>
<span id="cb9-60"><a href="#cb9-60"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb9-61"><a href="#cb9-61"></a></span>
<span id="cb9-62"><a href="#cb9-62"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb9-63"><a href="#cb9-63"></a></span>
<span id="cb9-64"><a href="#cb9-64"></a><span class="co">// ---- Safety &amp; string helpers (ES3) ----</span></span>
<span id="cb9-65"><a href="#cb9-65"></a><span class="kw">function</span> <span class="fu">isNil</span>(x) { <span class="cf">return</span> x <span class="op">===</span> <span class="kw">null</span> <span class="op">||</span> x <span class="op">===</span> <span class="kw">undefined</span><span class="op">;</span> }</span>
<span id="cb9-66"><a href="#cb9-66"></a><span class="kw">function</span> <span class="fu">trim</span>(s) { <span class="cf">return</span> <span class="fu">isNil</span>(s) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> <span class="bu">String</span>(s)<span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">^\s+|\s+$</span><span class="ss">/g</span><span class="op">,</span> <span class="st">""</span>)<span class="op">;</span> }</span>
<span id="cb9-67"><a href="#cb9-67"></a><span class="kw">function</span> <span class="fu">equalsIgnoreCase</span>(a<span class="op">,</span> b) { <span class="cf">return</span> <span class="bu">String</span>(a<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">toLowerCase</span>() <span class="op">==</span> <span class="bu">String</span>(b<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">;</span> }</span>
<span id="cb9-68"><a href="#cb9-68"></a><span class="kw">function</span> <span class="fu">startsWith</span>(s<span class="op">,</span> p) { <span class="cf">return</span> <span class="bu">String</span>(s<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">indexOf</span>(p) <span class="op">===</span> <span class="dv">0</span><span class="op">;</span> }</span>
<span id="cb9-69"><a href="#cb9-69"></a><span class="kw">function</span> <span class="fu">contains</span>(s<span class="op">,</span> sub) { <span class="cf">return</span> <span class="bu">String</span>(s<span class="op">||</span><span class="st">""</span>)<span class="op">.</span><span class="fu">indexOf</span>(sub) <span class="op">!==</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span> }</span>
<span id="cb9-70"><a href="#cb9-70"></a></span>
<span id="cb9-71"><a href="#cb9-71"></a><span class="co">// ---- Output tab management ----</span></span>
<span id="cb9-72"><a href="#cb9-72"></a><span class="kw">function</span> <span class="fu">ensureOutputTab</span>(name) {</span>
<span id="cb9-73"><a href="#cb9-73"></a>    <span class="cf">try</span> { Repository<span class="op">.</span><span class="fu">CreateOutputTab</span>(name)<span class="op">;</span> } <span class="cf">catch</span>(e) {}</span>
<span id="cb9-74"><a href="#cb9-74"></a>    <span class="cf">try</span> { Repository<span class="op">.</span><span class="fu">ClearOutput</span>(name)<span class="op">;</span> } <span class="cf">catch</span>(e) {}</span>
<span id="cb9-75"><a href="#cb9-75"></a>    <span class="cf">try</span> { Repository<span class="op">.</span><span class="fu">EnsureOutputVisible</span>(name)<span class="op">;</span> } <span class="cf">catch</span>(e) {}</span>
<span id="cb9-76"><a href="#cb9-76"></a>}</span>
<span id="cb9-77"><a href="#cb9-77"></a><span class="kw">function</span> <span class="fu">log</span>(tab<span class="op">,</span> msg) { Session<span class="op">.</span><span class="fu">Output</span>(<span class="st">"["</span> <span class="op">+</span> tab <span class="op">+</span> <span class="st">"] "</span> <span class="op">+</span> msg)<span class="op">;</span> }</span>
<span id="cb9-78"><a href="#cb9-78"></a></span>
<span id="cb9-79"><a href="#cb9-79"></a><span class="co">// ---- Folder picker (directory only; no file names) ----</span></span>
<span id="cb9-80"><a href="#cb9-80"></a><span class="kw">function</span> <span class="fu">browseForFolder</span>(promptText) {</span>
<span id="cb9-81"><a href="#cb9-81"></a>    <span class="co">// Shell.BrowseForFolder is reliable and does *directory only*</span></span>
<span id="cb9-82"><a href="#cb9-82"></a>    <span class="kw">var</span> shell <span class="op">=</span> <span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Shell.Application"</span>)<span class="op">;</span></span>
<span id="cb9-83"><a href="#cb9-83"></a>    <span class="kw">var</span> folder <span class="op">=</span> shell<span class="op">.</span><span class="fu">BrowseForFolder</span>(<span class="dv">0</span><span class="op">,</span> promptText<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb9-84"><a href="#cb9-84"></a>    <span class="cf">if</span> (<span class="op">!</span>folder) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb9-85"><a href="#cb9-85"></a>    <span class="co">// Ensure plain path (Self.Path)</span></span>
<span id="cb9-86"><a href="#cb9-86"></a>    <span class="cf">return</span> folder<span class="op">.</span><span class="at">Self</span><span class="op">.</span><span class="at">Path</span><span class="op">;</span></span>
<span id="cb9-87"><a href="#cb9-87"></a>}</span>
<span id="cb9-88"><a href="#cb9-88"></a></span>
<span id="cb9-89"><a href="#cb9-89"></a><span class="co">// ---- CSV writer (append; creates file on first write) ----</span></span>
<span id="cb9-90"><a href="#cb9-90"></a><span class="kw">function</span> <span class="fu">CsvWriter</span>(path) {</span>
<span id="cb9-91"><a href="#cb9-91"></a>    <span class="kw">var</span> fso <span class="op">=</span> <span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Scripting.FileSystemObject"</span>)<span class="op">;</span></span>
<span id="cb9-92"><a href="#cb9-92"></a>    <span class="kw">var</span> file <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb9-93"><a href="#cb9-93"></a>    <span class="kw">function</span> <span class="fu">openAppend</span>() {</span>
<span id="cb9-94"><a href="#cb9-94"></a><span class="co">// 8 = ForAppending, 2 = TristateTrue (Unicode); EA often prefers ANSI, so use default</span></span>
<span id="cb9-95"><a href="#cb9-95"></a><span class="co">// (TristateFalse=0)</span></span>
<span id="cb9-96"><a href="#cb9-96"></a><span class="co">// We'll stick with default encoding for broader compatibility.</span></span>
<span id="cb9-97"><a href="#cb9-97"></a>        file <span class="op">=</span> fso<span class="op">.</span><span class="fu">OpenTextFile</span>(path<span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb9-98"><a href="#cb9-98"></a>    }</span>
<span id="cb9-99"><a href="#cb9-99"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">writeHeader</span> <span class="op">=</span> <span class="kw">function</span>(headerLine) {</span>
<span id="cb9-100"><a href="#cb9-100"></a>        <span class="cf">if</span> (<span class="op">!</span>file) <span class="fu">openAppend</span>()<span class="op">;</span></span>
<span id="cb9-101"><a href="#cb9-101"></a>        file<span class="op">.</span><span class="fu">WriteLine</span>(headerLine)<span class="op">;</span></span>
<span id="cb9-102"><a href="#cb9-102"></a>    }<span class="op">;</span></span>
<span id="cb9-103"><a href="#cb9-103"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">writeRow</span> <span class="op">=</span> <span class="kw">function</span>(arr) {</span>
<span id="cb9-104"><a href="#cb9-104"></a>        <span class="cf">if</span> (<span class="op">!</span>file) <span class="fu">openAppend</span>()<span class="op">;</span></span>
<span id="cb9-105"><a href="#cb9-105"></a>        <span class="kw">var</span> i<span class="op">,</span> out <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb9-106"><a href="#cb9-106"></a>        <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>arr<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb9-107"><a href="#cb9-107"></a>            <span class="kw">var</span> cell <span class="op">=</span> <span class="bu">String</span>(arr[i])<span class="op">.</span><span class="fu">replace</span>(<span class="ss">/"/g</span><span class="op">,</span> <span class="st">'""'</span>)<span class="op">;</span>   <span class="co">// escape quotes</span></span>
<span id="cb9-108"><a href="#cb9-108"></a>            <span class="cf">if</span> (<span class="fu">contains</span>(cell<span class="op">,</span> <span class="st">","</span>) <span class="op">||</span> <span class="fu">contains</span>(cell<span class="op">,</span> <span class="st">"</span><span class="sc">\"</span><span class="st">"</span>) ) {</span>
<span id="cb9-109"><a href="#cb9-109"></a>                out <span class="op">+=</span> <span class="st">"</span><span class="sc">\"</span><span class="st">"</span> <span class="op">+</span> cell <span class="op">+</span> <span class="st">"</span><span class="sc">\"</span><span class="st">"</span><span class="op">;</span></span>
<span id="cb9-110"><a href="#cb9-110"></a>            } <span class="cf">else</span> {</span>
<span id="cb9-111"><a href="#cb9-111"></a>                out <span class="op">+=</span> cell<span class="op">;</span></span>
<span id="cb9-112"><a href="#cb9-112"></a>            }</span>
<span id="cb9-113"><a href="#cb9-113"></a>            <span class="cf">if</span> (i <span class="op">&lt;</span> arr<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>) out <span class="op">+=</span> <span class="st">","</span><span class="op">;</span></span>
<span id="cb9-114"><a href="#cb9-114"></a>        }</span>
<span id="cb9-115"><a href="#cb9-115"></a>        file<span class="op">.</span><span class="fu">WriteLine</span>(out)<span class="op">;</span></span>
<span id="cb9-116"><a href="#cb9-116"></a>    }<span class="op">;</span></span>
<span id="cb9-117"><a href="#cb9-117"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">close</span> <span class="op">=</span> <span class="kw">function</span>() { <span class="cf">if</span> (file) file<span class="op">.</span><span class="fu">Close</span>()<span class="op">;</span> }<span class="op">;</span></span>
<span id="cb9-118"><a href="#cb9-118"></a>}</span>
<span id="cb9-119"><a href="#cb9-119"></a></span>
<span id="cb9-120"><a href="#cb9-120"></a><span class="co">// ---- Timing helper ----</span></span>
<span id="cb9-121"><a href="#cb9-121"></a><span class="kw">function</span> <span class="fu">nowMs</span>() { </span>
<span id="cb9-122"><a href="#cb9-122"></a>  <span class="cf">return</span> (<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span> </span>
<span id="cb9-123"><a href="#cb9-123"></a>  }</span>
<span id="cb9-124"><a href="#cb9-124"></a><span class="in">```</span></span>
<span id="cb9-125"><a href="#cb9-125"></a></span>
<span id="cb9-126"><a href="#cb9-126"></a></span>
<span id="cb9-127"><a href="#cb9-127"></a><span class="fu">### Pattern 1 – Find / Filter / Apply</span></span>
<span id="cb9-128"><a href="#cb9-128"></a></span>
<span id="cb9-129"><a href="#cb9-129"></a>The most common pattern in EA scripting is:</span>
<span id="cb9-130"><a href="#cb9-130"></a></span>
<span id="cb9-131"><a href="#cb9-131"></a><span class="ss">1.  </span>**Find** a collection of items (elements, connectors, diagrams).</span>
<span id="cb9-132"><a href="#cb9-132"></a></span>
<span id="cb9-133"><a href="#cb9-133"></a><span class="ss">2.  </span>**Filter** them based on conditions (type, stereotype, missing tag).</span>
<span id="cb9-134"><a href="#cb9-134"></a></span>
<span id="cb9-135"><a href="#cb9-135"></a><span class="ss">3.  </span>**Apply** an action (rename, add tag, log).</span>
<span id="cb9-136"><a href="#cb9-136"></a></span>
<span id="cb9-137"><a href="#cb9-137"></a>This pattern underlies most governance checks and batch updates. It is</span>
<span id="cb9-138"><a href="#cb9-138"></a>safe, scalable, and easy to extend. You will see many examples in this</span>
<span id="cb9-139"><a href="#cb9-139"></a>chapter where the Find/Filter/Apply loop is the skeleton on which the</span>
<span id="cb9-140"><a href="#cb9-140"></a>logic hangs.</span>
<span id="cb9-141"><a href="#cb9-141"></a></span>
<span id="cb9-142"><a href="#cb9-142"></a>**When to use:** bulk changes with clear criteria (e.g. rename, retag,</span>
<span id="cb9-143"><a href="#cb9-143"></a>stereotype changes).  </span>
<span id="cb9-144"><a href="#cb9-144"></a>Why: separates selection from action; an easy, safe mental model.</span>
<span id="cb9-145"><a href="#cb9-145"></a></span>
<span id="cb9-146"><a href="#cb9-146"></a><span class="in">```{.js filename="Example 7.2 - Pattern1_FindFilterApply.js – JScript (ES3)"}</span></span>
<span id="cb9-147"><a href="#cb9-147"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb9-148"><a href="#cb9-148"></a><span class="co">// Example 7.2 - Pattern1_FindFilterApply.js – JScript (ES3)</span></span>
<span id="cb9-149"><a href="#cb9-149"></a><span class="co">// Purpose: Demonstrates Find/Filter/Apply on elements in a selected package</span></span>
<span id="cb9-150"><a href="#cb9-150"></a><span class="co">// Usage: Select a package → run script. Uses dry-run by default.</span></span>
<span id="cb9-151"><a href="#cb9-151"></a><span class="co">// Assumptions:</span></span>
<span id="cb9-152"><a href="#cb9-152"></a><span class="co">// - ES3 only; EA collections require Count/GetAt(i)</span></span>
<span id="cb9-153"><a href="#cb9-153"></a><span class="co">// - No modern JS features</span></span>
<span id="cb9-154"><a href="#cb9-154"></a><span class="co">// Parameters: adjust TYPE_FILTER / NAME_PREFIX to your needs</span></span>
<span id="cb9-155"><a href="#cb9-155"></a><span class="co">// Dependencies: Helpers.js (browseForFolder, CsvWriter, logging)</span></span>
<span id="cb9-156"><a href="#cb9-156"></a><span class="co">// Update history: 1.0 initial</span></span>
<span id="cb9-157"><a href="#cb9-157"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb9-158"><a href="#cb9-158"></a></span>
<span id="cb9-159"><a href="#cb9-159"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb9-160"><a href="#cb9-160"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb9-161"><a href="#cb9-161"></a></span>
<span id="cb9-162"><a href="#cb9-162"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb9-163"><a href="#cb9-163"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"FindFilterApply"</span><span class="op">;</span></span>
<span id="cb9-164"><a href="#cb9-164"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb9-165"><a href="#cb9-165"></a></span>
<span id="cb9-166"><a href="#cb9-166"></a>    <span class="co">// ---- Config ----</span></span>
<span id="cb9-167"><a href="#cb9-167"></a>    <span class="kw">var</span> DRY_RUN <span class="op">=</span> <span class="kw">true</span><span class="op">;</span>                 <span class="co">// switch to false to commit</span></span>
<span id="cb9-168"><a href="#cb9-168"></a>    <span class="kw">var</span> TYPE_FILTER <span class="op">=</span> <span class="st">"Class"</span><span class="op">;</span>          <span class="co">// only operate on these element types (e.g., "Requirement", "Capability")</span></span>
<span id="cb9-169"><a href="#cb9-169"></a>    <span class="kw">var</span> NAME_PREFIX <span class="op">=</span> <span class="st">"ARCH_"</span><span class="op">;</span>          <span class="co">// example change: ensure name has this prefix</span></span>
<span id="cb9-170"><a href="#cb9-170"></a>    <span class="kw">var</span> WRITE_CSV <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb9-171"><a href="#cb9-171"></a></span>
<span id="cb9-172"><a href="#cb9-172"></a>    <span class="co">// ---- Context ----</span></span>
<span id="cb9-173"><a href="#cb9-173"></a>    <span class="kw">var</span> pkg <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span>()<span class="op">;</span></span>
<span id="cb9-174"><a href="#cb9-174"></a>    <span class="cf">if</span> (<span class="op">!</span>pkg) { Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Please select a package."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb9-175"><a href="#cb9-175"></a></span>
<span id="cb9-176"><a href="#cb9-176"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Selected package: "</span> <span class="op">+</span> pkg<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">" (ID "</span> <span class="op">+</span> pkg<span class="op">.</span><span class="at">PackageID</span> <span class="op">+</span> <span class="st">")"</span>)<span class="op">;</span></span>
<span id="cb9-177"><a href="#cb9-177"></a>    <span class="kw">var</span> t0 <span class="op">=</span> <span class="fu">nowMs</span>()<span class="op">;</span></span>
<span id="cb9-178"><a href="#cb9-178"></a></span>
<span id="cb9-179"><a href="#cb9-179"></a>    <span class="co">// ---- CSV setup (directory-only; no filename prompts) ----</span></span>
<span id="cb9-180"><a href="#cb9-180"></a>    <span class="kw">var</span> csv <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb9-181"><a href="#cb9-181"></a>    <span class="cf">if</span> (WRITE_CSV) {</span>
<span id="cb9-182"><a href="#cb9-182"></a>        <span class="kw">var</span> dir <span class="op">=</span> <span class="fu">browseForFolder</span>(<span class="st">"Select output folder for log CSV (directory only):"</span>)<span class="op">;</span></span>
<span id="cb9-183"><a href="#cb9-183"></a>        <span class="cf">if</span> (dir) {</span>
<span id="cb9-184"><a href="#cb9-184"></a>            <span class="kw">var</span> stamp <span class="op">=</span> (<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb9-185"><a href="#cb9-185"></a>            <span class="kw">var</span> outPath <span class="op">=</span> dir <span class="op">+</span> <span class="st">"</span><span class="sc">\\</span><span class="st">pattern1_find_filter_apply_"</span> <span class="op">+</span> stamp <span class="op">+</span> <span class="st">".csv"</span><span class="op">;</span></span>
<span id="cb9-186"><a href="#cb9-186"></a>            csv <span class="op">=</span> <span class="kw">new</span> <span class="fu">CsvWriter</span>(outPath)<span class="op">;</span></span>
<span id="cb9-187"><a href="#cb9-187"></a>            csv<span class="op">.</span><span class="fu">writeHeader</span>(<span class="st">"ElementID,GUID,OldName,NewName,Type,Action"</span>)<span class="op">;</span></span>
<span id="cb9-188"><a href="#cb9-188"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Logging to: "</span> <span class="op">+</span> outPath)<span class="op">;</span></span>
<span id="cb9-189"><a href="#cb9-189"></a>        } <span class="cf">else</span> {</span>
<span id="cb9-190"><a href="#cb9-190"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"No folder selected; CSV logging disabled."</span>)<span class="op">;</span></span>
<span id="cb9-191"><a href="#cb9-191"></a>        }</span>
<span id="cb9-192"><a href="#cb9-192"></a>    }</span>
<span id="cb9-193"><a href="#cb9-193"></a></span>
<span id="cb9-194"><a href="#cb9-194"></a>    <span class="co">// ---- Find &amp; filter ----</span></span>
<span id="cb9-195"><a href="#cb9-195"></a>    <span class="kw">var</span> targets <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb9-196"><a href="#cb9-196"></a>    <span class="kw">var</span> elements <span class="op">=</span> pkg<span class="op">.</span><span class="at">Elements</span><span class="op">;</span></span>
<span id="cb9-197"><a href="#cb9-197"></a>    <span class="kw">var</span> i<span class="op">;</span></span>
<span id="cb9-198"><a href="#cb9-198"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>elements<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb9-199"><a href="#cb9-199"></a>        <span class="kw">var</span> el <span class="op">=</span> elements<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb9-200"><a href="#cb9-200"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">equalsIgnoreCase</span>(el<span class="op">.</span><span class="at">Type</span><span class="op">,</span> TYPE_FILTER)) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb9-201"><a href="#cb9-201"></a></span>
<span id="cb9-202"><a href="#cb9-202"></a>        <span class="co">// Filter condition: name missing prefix</span></span>
<span id="cb9-203"><a href="#cb9-203"></a>        <span class="kw">var</span> hasPrefix <span class="op">=</span> <span class="fu">startsWith</span>(el<span class="op">.</span><span class="at">Name</span><span class="op">,</span> NAME_PREFIX)<span class="op">;</span></span>
<span id="cb9-204"><a href="#cb9-204"></a>        <span class="cf">if</span> (<span class="op">!</span>hasPrefix) targets<span class="op">.</span><span class="fu">push</span>(el)<span class="op">;</span></span>
<span id="cb9-205"><a href="#cb9-205"></a>    }</span>
<span id="cb9-206"><a href="#cb9-206"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Found "</span> <span class="op">+</span> targets<span class="op">.</span><span class="at">length</span> <span class="op">+</span> <span class="st">" target(s)."</span>)<span class="op">;</span></span>
<span id="cb9-207"><a href="#cb9-207"></a></span>
<span id="cb9-208"><a href="#cb9-208"></a>    <span class="co">// ---- Apply ----</span></span>
<span id="cb9-209"><a href="#cb9-209"></a>    <span class="kw">var</span> changed <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb9-210"><a href="#cb9-210"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>targets<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb9-211"><a href="#cb9-211"></a>        <span class="kw">var</span> e <span class="op">=</span> targets[i]<span class="op">;</span></span>
<span id="cb9-212"><a href="#cb9-212"></a>        <span class="kw">var</span> oldName <span class="op">=</span> e<span class="op">.</span><span class="at">Name</span><span class="op">;</span></span>
<span id="cb9-213"><a href="#cb9-213"></a>        <span class="kw">var</span> newName <span class="op">=</span> NAME_PREFIX <span class="op">+</span> oldName<span class="op">;</span></span>
<span id="cb9-214"><a href="#cb9-214"></a></span>
<span id="cb9-215"><a href="#cb9-215"></a>        <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">writeRow</span>([e<span class="op">.</span><span class="at">ElementID</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementGUID</span><span class="op">,</span> oldName<span class="op">,</span> newName<span class="op">,</span> e<span class="op">.</span><span class="at">Type</span><span class="op">,</span> (DRY_RUN<span class="op">?</span> <span class="st">"DRY-RUN"</span> <span class="op">:</span> <span class="st">"RENAME"</span>)])<span class="op">;</span></span>
<span id="cb9-216"><a href="#cb9-216"></a></span>
<span id="cb9-217"><a href="#cb9-217"></a>        <span class="cf">if</span> (<span class="op">!</span>DRY_RUN) {</span>
<span id="cb9-218"><a href="#cb9-218"></a>            e<span class="op">.</span><span class="at">Name</span> <span class="op">=</span> newName<span class="op">;</span></span>
<span id="cb9-219"><a href="#cb9-219"></a>            e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> <span class="co">// persist</span></span>
<span id="cb9-220"><a href="#cb9-220"></a>        }</span>
<span id="cb9-221"><a href="#cb9-221"></a>        changed<span class="op">++;</span></span>
<span id="cb9-222"><a href="#cb9-222"></a>    }</span>
<span id="cb9-223"><a href="#cb9-223"></a></span>
<span id="cb9-224"><a href="#cb9-224"></a>    <span class="co">// Refresh UI if we wrote changes</span></span>
<span id="cb9-225"><a href="#cb9-225"></a>    <span class="cf">if</span> (<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> changed<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(pkg<span class="op">.</span><span class="at">PackageID</span>)<span class="op">;</span></span>
<span id="cb9-226"><a href="#cb9-226"></a></span>
<span id="cb9-227"><a href="#cb9-227"></a>    <span class="kw">var</span> dt <span class="op">=</span> <span class="fu">nowMs</span>() <span class="op">-</span> t0<span class="op">;</span></span>
<span id="cb9-228"><a href="#cb9-228"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Changed "</span> <span class="op">+</span> changed <span class="op">+</span> <span class="st">" / "</span> <span class="op">+</span> targets<span class="op">.</span><span class="at">length</span> <span class="op">+</span> <span class="st">" target(s). Dry-run="</span> <span class="op">+</span> DRY_RUN <span class="op">+</span> <span class="st">". Time="</span> <span class="op">+</span> dt <span class="op">+</span> <span class="st">"ms"</span>)<span class="op">;</span></span>
<span id="cb9-229"><a href="#cb9-229"></a></span>
<span id="cb9-230"><a href="#cb9-230"></a>    <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb9-231"><a href="#cb9-231"></a>}</span>
<span id="cb9-232"><a href="#cb9-232"></a></span>
<span id="cb9-233"><a href="#cb9-233"></a><span class="fu">main</span>()<span class="op">;</span></span>
<span id="cb9-234"><a href="#cb9-234"></a><span class="in">```</span></span>
<span id="cb9-235"><a href="#cb9-235"></a></span>
<span id="cb9-236"><a href="#cb9-236"></a><span class="fu">### Pattern 2 – Curate-then-Write (2-Phase Updates)</span></span>
<span id="cb9-237"><a href="#cb9-237"></a></span>
<span id="cb9-238"><a href="#cb9-238"></a>Sometimes you cannot safely update as you go. Perhaps you want to check</span>
<span id="cb9-239"><a href="#cb9-239"></a>what will change before actually changing it. Perhaps you want to let a</span>
<span id="cb9-240"><a href="#cb9-240"></a>governance board review the list before updates are applied.</span>
<span id="cb9-241"><a href="#cb9-241"></a></span>
<span id="cb9-242"><a href="#cb9-242"></a>The **Curate-then-Write** pattern solves this by splitting the process</span>
<span id="cb9-243"><a href="#cb9-243"></a>into two phases:</span>
<span id="cb9-244"><a href="#cb9-244"></a></span>
<span id="cb9-245"><a href="#cb9-245"></a><span class="ss">1.  </span>**Curate** — gather and log the items that *would* be changed</span>
<span id="cb9-246"><a href="#cb9-246"></a>    (always with DRY_RUN).</span>
<span id="cb9-247"><a href="#cb9-247"></a></span>
<span id="cb9-248"><a href="#cb9-248"></a><span class="ss">2.  </span>**Write** — only later, with approval, run the script again with</span>
<span id="cb9-249"><a href="#cb9-249"></a>    changes applied.</span>
<span id="cb9-250"><a href="#cb9-250"></a></span>
<span id="cb9-251"><a href="#cb9-251"></a>This pattern reduces risk and increases confidence. It mirrors the</span>
<span id="cb9-252"><a href="#cb9-252"></a>dry-run principle, but formalises it into a workflow.</span>
<span id="cb9-253"><a href="#cb9-253"></a></span>
<span id="cb9-254"><a href="#cb9-254"></a>**When to use:** risky or large updates. First produce a **reviewable</span>
<span id="cb9-255"><a href="#cb9-255"></a>CSV**, then run again to apply.  </span>
<span id="cb9-256"><a href="#cb9-256"></a>**Why:** EA has no transactions; curate first to avoid irreversible bulk</span>
<span id="cb9-257"><a href="#cb9-257"></a>mistakes.</span>
<span id="cb9-258"><a href="#cb9-258"></a></span>
<span id="cb9-259"><a href="#cb9-259"></a><span class="in">```{.js filename="Example 7.3 - Pattern1_FindFilterApply.js – JScript (ES3)"}</span></span>
<span id="cb9-260"><a href="#cb9-260"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb9-261"><a href="#cb9-261"></a><span class="co">// Example 7.3 - Pattern2_CurateThenWrite.js – JScript (ES3)</span></span>
<span id="cb9-262"><a href="#cb9-262"></a><span class="co">// Purpose: Phase 1 = produce CSV for review; Phase 2 = read curated CSV and apply</span></span>
<span id="cb9-263"><a href="#cb9-263"></a><span class="co">// Usage:</span></span>
<span id="cb9-264"><a href="#cb9-264"></a><span class="co">//  - Phase 1: set MODE="export" → generates CSV with proposed changes</span></span>
<span id="cb9-265"><a href="#cb9-265"></a><span class="co">//  - Review/edit the CSV (approve rows by setting Apply=YES)</span></span>
<span id="cb9-266"><a href="#cb9-266"></a><span class="co">//  - Phase 2: set MODE="apply"  → reads CSV and applies only approved rows</span></span>
<span id="cb9-267"><a href="#cb9-267"></a><span class="co">// Assumptions:</span></span>
<span id="cb9-268"><a href="#cb9-268"></a><span class="co">//  - ES3 only; CSV written in ANSI for broad compatibility</span></span>
<span id="cb9-269"><a href="#cb9-269"></a><span class="co">//  - Directory chooser only (no filename prompts)</span></span>
<span id="cb9-270"><a href="#cb9-270"></a><span class="co">// Dependencies: Helpers.js</span></span>
<span id="cb9-271"><a href="#cb9-271"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb9-272"><a href="#cb9-272"></a></span>
<span id="cb9-273"><a href="#cb9-273"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb9-274"><a href="#cb9-274"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb9-275"><a href="#cb9-275"></a></span>
<span id="cb9-276"><a href="#cb9-276"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb9-277"><a href="#cb9-277"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"CurateThenWrite"</span><span class="op">;</span></span>
<span id="cb9-278"><a href="#cb9-278"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb9-279"><a href="#cb9-279"></a></span>
<span id="cb9-280"><a href="#cb9-280"></a>    <span class="co">// ---- Config ----</span></span>
<span id="cb9-281"><a href="#cb9-281"></a>    <span class="kw">var</span> MODE <span class="op">=</span> <span class="st">"export"</span><span class="op">;</span>          <span class="co">// "export" or "apply"</span></span>
<span id="cb9-282"><a href="#cb9-282"></a>    <span class="kw">var</span> TYPE_FILTER <span class="op">=</span> <span class="st">"Requirement"</span><span class="op">;</span></span>
<span id="cb9-283"><a href="#cb9-283"></a>    <span class="kw">var</span> PROPOSED_STATUS <span class="op">=</span> <span class="st">"Approved"</span><span class="op">;</span></span>
<span id="cb9-284"><a href="#cb9-284"></a></span>
<span id="cb9-285"><a href="#cb9-285"></a>    <span class="cf">if</span> (MODE <span class="op">==</span> <span class="st">"export"</span>) <span class="cf">return</span> <span class="fu">exportPhase</span>(TAB<span class="op">,</span> TYPE_FILTER<span class="op">,</span> PROPOSED_STATUS)<span class="op">;</span></span>
<span id="cb9-286"><a href="#cb9-286"></a>    <span class="cf">if</span> (MODE <span class="op">==</span> <span class="st">"apply"</span>)  <span class="cf">return</span> <span class="fu">applyPhase</span>(TAB)<span class="op">;</span></span>
<span id="cb9-287"><a href="#cb9-287"></a>    Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Unknown MODE. Use 'export' or 'apply'."</span><span class="op">,</span> promptOK)<span class="op">;</span></span>
<span id="cb9-288"><a href="#cb9-288"></a>}</span>
<span id="cb9-289"><a href="#cb9-289"></a></span>
<span id="cb9-290"><a href="#cb9-290"></a><span class="kw">function</span> <span class="fu">exportPhase</span>(TAB<span class="op">,</span> TYPE_FILTER<span class="op">,</span> PROPOSED_STATUS) {</span>
<span id="cb9-291"><a href="#cb9-291"></a>    <span class="kw">var</span> pkg <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span>()<span class="op">;</span></span>
<span id="cb9-292"><a href="#cb9-292"></a>    <span class="cf">if</span> (<span class="op">!</span>pkg) { Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Select a package."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb9-293"><a href="#cb9-293"></a></span>
<span id="cb9-294"><a href="#cb9-294"></a>    <span class="kw">var</span> dir <span class="op">=</span> <span class="fu">browseForFolder</span>(<span class="st">"Select output folder for curation CSV:"</span>)<span class="op">;</span></span>
<span id="cb9-295"><a href="#cb9-295"></a>    <span class="cf">if</span> (<span class="op">!</span>dir) { <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Cancelled."</span>)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb9-296"><a href="#cb9-296"></a></span>
<span id="cb9-297"><a href="#cb9-297"></a>    <span class="kw">var</span> stamp <span class="op">=</span> (<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb9-298"><a href="#cb9-298"></a>    <span class="kw">var</span> path <span class="op">=</span> dir <span class="op">+</span> <span class="st">"</span><span class="sc">\\</span><span class="st">pattern2_curate_export_"</span> <span class="op">+</span> stamp <span class="op">+</span> <span class="st">".csv"</span><span class="op">;</span></span>
<span id="cb9-299"><a href="#cb9-299"></a>    <span class="kw">var</span> csv <span class="op">=</span> <span class="kw">new</span> <span class="fu">CsvWriter</span>(path)<span class="op">;</span></span>
<span id="cb9-300"><a href="#cb9-300"></a>    csv<span class="op">.</span><span class="fu">writeHeader</span>(<span class="st">"Apply,ElementID,GUID,Name,Type,CurrentStatus,ProposedStatus,Notes"</span>)<span class="op">;</span></span>
<span id="cb9-301"><a href="#cb9-301"></a></span>
<span id="cb9-302"><a href="#cb9-302"></a>    <span class="kw">var</span> i<span class="op">,</span> elements <span class="op">=</span> pkg<span class="op">.</span><span class="at">Elements</span><span class="op">;</span></span>
<span id="cb9-303"><a href="#cb9-303"></a>    <span class="kw">var</span> exported <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb9-304"><a href="#cb9-304"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>elements<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb9-305"><a href="#cb9-305"></a>        <span class="kw">var</span> e <span class="op">=</span> elements<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb9-306"><a href="#cb9-306"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">equalsIgnoreCase</span>(e<span class="op">.</span><span class="at">Type</span><span class="op">,</span> TYPE_FILTER)) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb9-307"><a href="#cb9-307"></a>        <span class="co">// Propose: set Status to PROPOSED_STATUS</span></span>
<span id="cb9-308"><a href="#cb9-308"></a>        csv<span class="op">.</span><span class="fu">writeRow</span>([<span class="st">"NO"</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementID</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementGUID</span><span class="op">,</span> e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> e<span class="op">.</span><span class="at">Type</span><span class="op">,</span> e<span class="op">.</span><span class="at">Status</span><span class="op">,</span> PROPOSED_STATUS<span class="op">,</span> <span class="st">"Set to Approved if meets criteria X"</span>])<span class="op">;</span></span>
<span id="cb9-309"><a href="#cb9-309"></a>        exported<span class="op">++;</span></span>
<span id="cb9-310"><a href="#cb9-310"></a>    }</span>
<span id="cb9-311"><a href="#cb9-311"></a>    csv<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb9-312"><a href="#cb9-312"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Wrote "</span> <span class="op">+</span> exported <span class="op">+</span> <span class="st">" row(s) to "</span> <span class="op">+</span> path <span class="op">+</span> <span class="st">". Review and change 'Apply' to YES where appropriate."</span>)<span class="op">;</span></span>
<span id="cb9-313"><a href="#cb9-313"></a>}</span>
<span id="cb9-314"><a href="#cb9-314"></a></span>
<span id="cb9-315"><a href="#cb9-315"></a><span class="kw">function</span> <span class="fu">applyPhase</span>(TAB) {</span>
<span id="cb9-316"><a href="#cb9-316"></a>    <span class="co">// Directory-only input: we’ll look for a single CSV file in the chosen folder by pattern.</span></span>
<span id="cb9-317"><a href="#cb9-317"></a>    <span class="kw">var</span> dir <span class="op">=</span> <span class="fu">browseForFolder</span>(<span class="st">"Select folder that contains curated CSV (pattern2_curate_export_*.csv):"</span>)<span class="op">;</span></span>
<span id="cb9-318"><a href="#cb9-318"></a>    <span class="cf">if</span> (<span class="op">!</span>dir) { <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Cancelled."</span>)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb9-319"><a href="#cb9-319"></a></span>
<span id="cb9-320"><a href="#cb9-320"></a>    <span class="co">// Very simple scan for the newest curated CSV file</span></span>
<span id="cb9-321"><a href="#cb9-321"></a>    <span class="kw">var</span> fso <span class="op">=</span> <span class="kw">new</span> <span class="fu">ActiveXObject</span>(<span class="st">"Scripting.FileSystemObject"</span>)<span class="op">;</span></span>
<span id="cb9-322"><a href="#cb9-322"></a>    <span class="kw">var</span> folder <span class="op">=</span> fso<span class="op">.</span><span class="fu">GetFolder</span>(dir)<span class="op">;</span></span>
<span id="cb9-323"><a href="#cb9-323"></a>    <span class="kw">var</span> en <span class="op">=</span> <span class="kw">new</span> <span class="fu">Enumerator</span>(folder<span class="op">.</span><span class="at">Files</span>)<span class="op">;</span></span>
<span id="cb9-324"><a href="#cb9-324"></a>    <span class="kw">var</span> newest <span class="op">=</span> <span class="kw">null</span><span class="op">,</span> newestTime <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb9-325"><a href="#cb9-325"></a>    <span class="cf">for</span> (<span class="op">;</span> <span class="op">!</span>en<span class="op">.</span><span class="fu">atEnd</span>()<span class="op">;</span> en<span class="op">.</span><span class="fu">moveNext</span>()) {</span>
<span id="cb9-326"><a href="#cb9-326"></a>        <span class="kw">var</span> file <span class="op">=</span> en<span class="op">.</span><span class="fu">item</span>()<span class="op">;</span></span>
<span id="cb9-327"><a href="#cb9-327"></a>        <span class="cf">if</span> (<span class="fu">contains</span>(file<span class="op">.</span><span class="at">Name</span><span class="op">,</span> <span class="st">"pattern2_curate_export_"</span>) <span class="op">&amp;&amp;</span> <span class="fu">endsWith</span>(file<span class="op">.</span><span class="at">Name</span><span class="op">,</span> <span class="st">".csv"</span>)) {</span>
<span id="cb9-328"><a href="#cb9-328"></a>            <span class="cf">if</span> (file<span class="op">.</span><span class="at">DateLastModified</span><span class="op">.</span><span class="fu">getTime</span>() <span class="op">&gt;</span> newestTime) {</span>
<span id="cb9-329"><a href="#cb9-329"></a>                newest <span class="op">=</span> file<span class="op">;</span> newestTime <span class="op">=</span> file<span class="op">.</span><span class="at">DateLastModified</span><span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb9-330"><a href="#cb9-330"></a>            }</span>
<span id="cb9-331"><a href="#cb9-331"></a>        }</span>
<span id="cb9-332"><a href="#cb9-332"></a>    }</span>
<span id="cb9-333"><a href="#cb9-333"></a>    <span class="cf">if</span> (<span class="op">!</span>newest) { <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"No curated CSV found."</span>)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb9-334"><a href="#cb9-334"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Applying from: "</span> <span class="op">+</span> newest<span class="op">.</span><span class="at">Path</span>)<span class="op">;</span></span>
<span id="cb9-335"><a href="#cb9-335"></a></span>
<span id="cb9-336"><a href="#cb9-336"></a>    <span class="co">// Read CSV line by line (very simple parser; assumes no commas in unquoted cells)</span></span>
<span id="cb9-337"><a href="#cb9-337"></a>    <span class="kw">var</span> ts <span class="op">=</span> fso<span class="op">.</span><span class="fu">OpenTextFile</span>(newest<span class="op">.</span><span class="at">Path</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span> <span class="co">// ForReading</span></span>
<span id="cb9-338"><a href="#cb9-338"></a>    <span class="co">// Skip header</span></span>
<span id="cb9-339"><a href="#cb9-339"></a>    <span class="cf">if</span> (<span class="op">!</span>ts<span class="op">.</span><span class="at">AtEndOfStream</span>) ts<span class="op">.</span><span class="fu">ReadLine</span>()<span class="op">;</span></span>
<span id="cb9-340"><a href="#cb9-340"></a></span>
<span id="cb9-341"><a href="#cb9-341"></a>    <span class="kw">var</span> applied <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> considered <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb9-342"><a href="#cb9-342"></a>    <span class="cf">while</span> (<span class="op">!</span>ts<span class="op">.</span><span class="at">AtEndOfStream</span>) {</span>
<span id="cb9-343"><a href="#cb9-343"></a>        <span class="kw">var</span> line <span class="op">=</span> ts<span class="op">.</span><span class="fu">ReadLine</span>()<span class="op">;</span></span>
<span id="cb9-344"><a href="#cb9-344"></a>        <span class="kw">var</span> cells <span class="op">=</span> line<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">;</span></span>
<span id="cb9-345"><a href="#cb9-345"></a>        <span class="cf">if</span> (cells<span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> <span class="dv">8</span>) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb9-346"><a href="#cb9-346"></a>        <span class="kw">var</span> apply <span class="op">=</span> <span class="fu">trim</span>(cells[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb9-347"><a href="#cb9-347"></a>        <span class="kw">var</span> elementID <span class="op">=</span> <span class="pp">parseInt</span>(cells[<span class="dv">1</span>]<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb9-348"><a href="#cb9-348"></a>        <span class="kw">var</span> proposedStatus <span class="op">=</span> <span class="fu">trim</span>(cells[<span class="dv">6</span>])<span class="op">;</span></span>
<span id="cb9-349"><a href="#cb9-349"></a></span>
<span id="cb9-350"><a href="#cb9-350"></a>        considered<span class="op">++;</span></span>
<span id="cb9-351"><a href="#cb9-351"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">equalsIgnoreCase</span>(apply<span class="op">,</span> <span class="st">"YES"</span>)) <span class="cf">continue</span><span class="op">;</span> <span class="co">// only approved rows</span></span>
<span id="cb9-352"><a href="#cb9-352"></a></span>
<span id="cb9-353"><a href="#cb9-353"></a>        <span class="kw">var</span> e <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetElementByID</span>(elementID)<span class="op">;</span></span>
<span id="cb9-354"><a href="#cb9-354"></a>        <span class="cf">if</span> (<span class="op">!</span>e) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb9-355"><a href="#cb9-355"></a>        e<span class="op">.</span><span class="at">Status</span> <span class="op">=</span> proposedStatus<span class="op">;</span></span>
<span id="cb9-356"><a href="#cb9-356"></a>        e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span></span>
<span id="cb9-357"><a href="#cb9-357"></a>        applied<span class="op">++;</span></span>
<span id="cb9-358"><a href="#cb9-358"></a>    }</span>
<span id="cb9-359"><a href="#cb9-359"></a>    ts<span class="op">.</span><span class="fu">Close</span>()<span class="op">;</span></span>
<span id="cb9-360"><a href="#cb9-360"></a></span>
<span id="cb9-361"><a href="#cb9-361"></a>    <span class="cf">if</span> (applied<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb9-362"><a href="#cb9-362"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Applied "</span> <span class="op">+</span> applied <span class="op">+</span> <span class="st">" change(s) out of "</span> <span class="op">+</span> considered <span class="op">+</span> <span class="st">" curated row(s)."</span>)<span class="op">;</span></span>
<span id="cb9-363"><a href="#cb9-363"></a>}</span>
<span id="cb9-364"><a href="#cb9-364"></a></span>
<span id="cb9-365"><a href="#cb9-365"></a><span class="co">// ES3 helper – endsWith (not natively available)</span></span>
<span id="cb9-366"><a href="#cb9-366"></a><span class="kw">function</span> <span class="fu">endsWith</span>(s<span class="op">,</span> suffix) {</span>
<span id="cb9-367"><a href="#cb9-367"></a>    s <span class="op">=</span> <span class="bu">String</span>(s<span class="op">||</span><span class="st">""</span>)<span class="op">;</span></span>
<span id="cb9-368"><a href="#cb9-368"></a>    <span class="kw">var</span> idx <span class="op">=</span> s<span class="op">.</span><span class="fu">lastIndexOf</span>(suffix)<span class="op">;</span></span>
<span id="cb9-369"><a href="#cb9-369"></a>    <span class="cf">return</span> idx <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> (idx <span class="op">+</span> suffix<span class="op">.</span><span class="at">length</span> <span class="op">===</span> s<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb9-370"><a href="#cb9-370"></a>}</span>
<span id="cb9-371"><a href="#cb9-371"></a></span>
<span id="cb9-372"><a href="#cb9-372"></a><span class="fu">main</span>()<span class="op">;</span></span>
<span id="cb9-373"><a href="#cb9-373"></a><span class="in">```</span></span>
<span id="cb9-374"><a href="#cb9-374"></a></span>
<span id="cb9-375"><a href="#cb9-375"></a><span class="fu">### Pattern 3 – Tag Propagation (Parent → Children)</span></span>
<span id="cb9-376"><a href="#cb9-376"></a></span>
<span id="cb9-377"><a href="#cb9-377"></a>Another frequent need is to ensure that metadata flows correctly between</span>
<span id="cb9-378"><a href="#cb9-378"></a>related elements. For example, if a Capability has an Owner tag, then</span>
<span id="cb9-379"><a href="#cb9-379"></a>all its linked Requirements should inherit that Owner. Or if a System</span>
<span id="cb9-380"><a href="#cb9-380"></a>has a Criticality tag, then its Interfaces should carry the same.</span>
<span id="cb9-381"><a href="#cb9-381"></a></span>
<span id="cb9-382"><a href="#cb9-382"></a>The **Tag Propagation** pattern handles this: traverse a relationship,</span>
<span id="cb9-383"><a href="#cb9-383"></a>read a tag from one element, apply it to another, log the change. It</span>
<span id="cb9-384"><a href="#cb9-384"></a>enforces consistency and helps maintain traceability.</span>
<span id="cb9-385"><a href="#cb9-385"></a></span>
<span id="cb9-386"><a href="#cb9-386"></a>**When to use:** enforce a tagged value from a parent element or package</span>
<span id="cb9-387"><a href="#cb9-387"></a>onto all contained elements (e.g., Domain=Diabetes).  </span>
<span id="cb9-388"><a href="#cb9-388"></a>**Options:** set only if missing, or overwrite.</span>
<span id="cb9-389"><a href="#cb9-389"></a></span>
<span id="cb9-390"><a href="#cb9-390"></a><span class="in">```{.js filename="Example 7.4 - Pattern3_TagPropagation.js – JScript (ES3)"}</span></span>
<span id="cb9-391"><a href="#cb9-391"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb9-392"><a href="#cb9-392"></a><span class="co">// Example 7.4 - Pattern3_TagPropagation.js – JScript (ES3)</span></span>
<span id="cb9-393"><a href="#cb9-393"></a><span class="co">// Purpose: Copy a tagged value from a selected *source element*</span></span>
<span id="cb9-394"><a href="#cb9-394"></a><span class="co">//          to all elements in a selected *target package*</span></span>
<span id="cb9-395"><a href="#cb9-395"></a><span class="co">// Usage: Select source element → run; then select target package → run</span></span>
<span id="cb9-396"><a href="#cb9-396"></a><span class="co">// Assumptions: source has TagName present; target elements may or may not</span></span>
<span id="cb9-397"><a href="#cb9-397"></a><span class="co">// Safety: DRY_RUN = true by default</span></span>
<span id="cb9-398"><a href="#cb9-398"></a><span class="co">// Dependencies: Helpers.js</span></span>
<span id="cb9-399"><a href="#cb9-399"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb9-400"><a href="#cb9-400"></a></span>
<span id="cb9-401"><a href="#cb9-401"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb9-402"><a href="#cb9-402"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb9-403"><a href="#cb9-403"></a></span>
<span id="cb9-404"><a href="#cb9-404"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb9-405"><a href="#cb9-405"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"TagPropagation"</span><span class="op">;</span></span>
<span id="cb9-406"><a href="#cb9-406"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb9-407"><a href="#cb9-407"></a></span>
<span id="cb9-408"><a href="#cb9-408"></a>    <span class="co">// ---- Config ----</span></span>
<span id="cb9-409"><a href="#cb9-409"></a>    <span class="kw">var</span> DRY_RUN <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb9-410"><a href="#cb9-410"></a>    <span class="kw">var</span> TAG_NAME <span class="op">=</span> <span class="st">"Domain"</span><span class="op">;</span></span>
<span id="cb9-411"><a href="#cb9-411"></a>    <span class="kw">var</span> OVERWRITE <span class="op">=</span> <span class="kw">false</span><span class="op">;</span>  <span class="co">// false = set only if missing</span></span>
<span id="cb9-412"><a href="#cb9-412"></a></span>
<span id="cb9-413"><a href="#cb9-413"></a>    <span class="co">// ---- Step 1: obtain source tag from selected element ----</span></span>
<span id="cb9-414"><a href="#cb9-414"></a>    <span class="kw">var</span> src <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedObject</span>()<span class="op">;</span></span>
<span id="cb9-415"><a href="#cb9-415"></a>    <span class="cf">if</span> (<span class="op">!</span>src <span class="op">||</span> src<span class="op">.</span><span class="at">ObjectType</span> <span class="op">!=</span> otElement) {</span>
<span id="cb9-416"><a href="#cb9-416"></a>        Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Select the *source element* that contains the tag '"</span> <span class="op">+</span> TAG_NAME <span class="op">+</span> <span class="st">"'."</span><span class="op">,</span> promptOK)<span class="op">;</span></span>
<span id="cb9-417"><a href="#cb9-417"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb9-418"><a href="#cb9-418"></a>    }</span>
<span id="cb9-419"><a href="#cb9-419"></a>    <span class="kw">var</span> srcVal <span class="op">=</span> <span class="fu">readTag</span>(src<span class="op">,</span> TAG_NAME)<span class="op">;</span></span>
<span id="cb9-420"><a href="#cb9-420"></a>    <span class="cf">if</span> (<span class="fu">trim</span>(srcVal) <span class="op">===</span> <span class="st">""</span>) {</span>
<span id="cb9-421"><a href="#cb9-421"></a>        Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Source element does not have tag '"</span> <span class="op">+</span> TAG_NAME <span class="op">+</span> <span class="st">"'."</span><span class="op">,</span> promptOK)<span class="op">;</span></span>
<span id="cb9-422"><a href="#cb9-422"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb9-423"><a href="#cb9-423"></a>    }</span>
<span id="cb9-424"><a href="#cb9-424"></a></span>
<span id="cb9-425"><a href="#cb9-425"></a>    <span class="co">// ---- Step 2: ask user to select target *package* ----</span></span>
<span id="cb9-426"><a href="#cb9-426"></a>    Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Now select the *target package* and run the script again to apply propagation."</span><span class="op">,</span> promptOK)<span class="op">;</span></span>
<span id="cb9-427"><a href="#cb9-427"></a></span>
<span id="cb9-428"><a href="#cb9-428"></a>    <span class="co">// If you prefer one-run UX: comment out the prompt above and use GetTreeSelectedPackage()</span></span>
<span id="cb9-429"><a href="#cb9-429"></a>    <span class="co">// directly</span></span>
<span id="cb9-430"><a href="#cb9-430"></a>}</span>
<span id="cb9-431"><a href="#cb9-431"></a></span>
<span id="cb9-432"><a href="#cb9-432"></a><span class="kw">function</span> <span class="fu">applyToTarget</span>() {</span>
<span id="cb9-433"><a href="#cb9-433"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"TagPropagation"</span><span class="op">;</span></span>
<span id="cb9-434"><a href="#cb9-434"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb9-435"><a href="#cb9-435"></a></span>
<span id="cb9-436"><a href="#cb9-436"></a>    <span class="kw">var</span> DRY_RUN <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb9-437"><a href="#cb9-437"></a>    <span class="kw">var</span> TAG_NAME <span class="op">=</span> <span class="st">"Domain"</span><span class="op">;</span></span>
<span id="cb9-438"><a href="#cb9-438"></a>    <span class="kw">var</span> OVERWRITE <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb9-439"><a href="#cb9-439"></a></span>
<span id="cb9-440"><a href="#cb9-440"></a>    <span class="co">// Re-get source from memory? For simplicity here we re-read it from user:</span></span>
<span id="cb9-441"><a href="#cb9-441"></a>    <span class="co">// In practice you might stash it in a temp file or ask user for the value via InputBox.</span></span>
<span id="cb9-442"><a href="#cb9-442"></a>    <span class="kw">var</span> val <span class="op">=</span> Session<span class="op">.</span><span class="fu">Input</span>(<span class="st">"Enter value to propagate for tag '"</span> <span class="op">+</span> TAG_NAME <span class="op">+</span> <span class="st">"':"</span><span class="op">,</span> <span class="st">""</span>)<span class="op">;</span></span>
<span id="cb9-443"><a href="#cb9-443"></a>    <span class="cf">if</span> (<span class="fu">trim</span>(val) <span class="op">===</span> <span class="st">""</span>) { <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"No value provided; aborting."</span>)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb9-444"><a href="#cb9-444"></a></span>
<span id="cb9-445"><a href="#cb9-445"></a>    <span class="kw">var</span> pkg <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span>()<span class="op">;</span></span>
<span id="cb9-446"><a href="#cb9-446"></a>    <span class="cf">if</span> (<span class="op">!</span>pkg) { Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Select a *target package*."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb9-447"><a href="#cb9-447"></a></span>
<span id="cb9-448"><a href="#cb9-448"></a>    <span class="kw">var</span> i<span class="op">,</span> changed<span class="op">=</span><span class="dv">0</span><span class="op">,</span> elements <span class="op">=</span> pkg<span class="op">.</span><span class="at">Elements</span><span class="op">;</span></span>
<span id="cb9-449"><a href="#cb9-449"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>elements<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb9-450"><a href="#cb9-450"></a>        <span class="kw">var</span> e <span class="op">=</span> elements<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb9-451"><a href="#cb9-451"></a>        <span class="kw">var</span> cur <span class="op">=</span> <span class="fu">readTag</span>(e<span class="op">,</span> TAG_NAME)<span class="op">;</span></span>
<span id="cb9-452"><a href="#cb9-452"></a></span>
<span id="cb9-453"><a href="#cb9-453"></a>        <span class="cf">if</span> (<span class="fu">trim</span>(cur) <span class="op">===</span> <span class="st">""</span>) {</span>
<span id="cb9-454"><a href="#cb9-454"></a>            <span class="co">// tag missing → set</span></span>
<span id="cb9-455"><a href="#cb9-455"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Set "</span> <span class="op">+</span> TAG_NAME <span class="op">+</span> <span class="st">" on "</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">" → "</span> <span class="op">+</span> val)<span class="op">;</span></span>
<span id="cb9-456"><a href="#cb9-456"></a>            <span class="cf">if</span> (<span class="op">!</span>DRY_RUN) { <span class="fu">writeTag</span>(e<span class="op">,</span> TAG_NAME<span class="op">,</span> val)<span class="op">;</span> }</span>
<span id="cb9-457"><a href="#cb9-457"></a>            changed<span class="op">++;</span></span>
<span id="cb9-458"><a href="#cb9-458"></a>        } <span class="cf">else</span> <span class="cf">if</span> (OVERWRITE <span class="op">&amp;&amp;</span> cur <span class="op">!=</span> val) {</span>
<span id="cb9-459"><a href="#cb9-459"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Overwrite "</span> <span class="op">+</span> TAG_NAME <span class="op">+</span> <span class="st">" on "</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">" : "</span> <span class="op">+</span> cur <span class="op">+</span> <span class="st">" → "</span> <span class="op">+</span> val)<span class="op">;</span></span>
<span id="cb9-460"><a href="#cb9-460"></a>            <span class="cf">if</span> (<span class="op">!</span>DRY_RUN) { <span class="fu">writeTag</span>(e<span class="op">,</span> TAG_NAME<span class="op">,</span> val)<span class="op">;</span> }</span>
<span id="cb9-461"><a href="#cb9-461"></a>            changed<span class="op">++;</span></span>
<span id="cb9-462"><a href="#cb9-462"></a>        }</span>
<span id="cb9-463"><a href="#cb9-463"></a>    }</span>
<span id="cb9-464"><a href="#cb9-464"></a>    <span class="cf">if</span> (<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> changed<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(pkg<span class="op">.</span><span class="at">PackageID</span>)<span class="op">;</span></span>
<span id="cb9-465"><a href="#cb9-465"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Updated "</span> <span class="op">+</span> changed <span class="op">+</span> <span class="st">" element(s). Dry-run="</span> <span class="op">+</span> DRY_RUN)<span class="op">;</span></span>
<span id="cb9-466"><a href="#cb9-466"></a>}</span>
<span id="cb9-467"><a href="#cb9-467"></a></span>
<span id="cb9-468"><a href="#cb9-468"></a><span class="co">// ---- Tag helpers ----</span></span>
<span id="cb9-469"><a href="#cb9-469"></a><span class="kw">function</span> <span class="fu">readTag</span>(e<span class="op">,</span> name) {</span>
<span id="cb9-470"><a href="#cb9-470"></a>    <span class="kw">var</span> i<span class="op">,</span> tvs <span class="op">=</span> e<span class="op">.</span><span class="at">TaggedValues</span><span class="op">;</span></span>
<span id="cb9-471"><a href="#cb9-471"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>tvs<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb9-472"><a href="#cb9-472"></a>        <span class="kw">var</span> tv <span class="op">=</span> tvs<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb9-473"><a href="#cb9-473"></a>        <span class="cf">if</span> (<span class="fu">equalsIgnoreCase</span>(tv<span class="op">.</span><span class="at">Name</span><span class="op">,</span> name)) <span class="cf">return</span> <span class="bu">String</span>(tv<span class="op">.</span><span class="at">Value</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span></span>
<span id="cb9-474"><a href="#cb9-474"></a>    }</span>
<span id="cb9-475"><a href="#cb9-475"></a>    <span class="cf">return</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb9-476"><a href="#cb9-476"></a>}</span>
<span id="cb9-477"><a href="#cb9-477"></a><span class="kw">function</span> <span class="fu">writeTag</span>(e<span class="op">,</span> name<span class="op">,</span> value) {</span>
<span id="cb9-478"><a href="#cb9-478"></a>    <span class="kw">var</span> i<span class="op">,</span> tvs <span class="op">=</span> e<span class="op">.</span><span class="at">TaggedValues</span><span class="op">;</span></span>
<span id="cb9-479"><a href="#cb9-479"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>tvs<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb9-480"><a href="#cb9-480"></a>        <span class="kw">var</span> tv <span class="op">=</span> tvs<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb9-481"><a href="#cb9-481"></a>        <span class="cf">if</span> (<span class="fu">equalsIgnoreCase</span>(tv<span class="op">.</span><span class="at">Name</span><span class="op">,</span> name)) {</span>
<span id="cb9-482"><a href="#cb9-482"></a>            tv<span class="op">.</span><span class="at">Value</span> <span class="op">=</span> value<span class="op">;</span> tv<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb9-483"><a href="#cb9-483"></a>        }</span>
<span id="cb9-484"><a href="#cb9-484"></a>    }</span>
<span id="cb9-485"><a href="#cb9-485"></a>    <span class="co">// add new if not found</span></span>
<span id="cb9-486"><a href="#cb9-486"></a>    <span class="kw">var</span> ntv <span class="op">=</span> tvs<span class="op">.</span><span class="fu">AddNew</span>(name<span class="op">,</span> <span class="bu">String</span>(value))<span class="op">;</span></span>
<span id="cb9-487"><a href="#cb9-487"></a>    ntv<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span> e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span></span>
<span id="cb9-488"><a href="#cb9-488"></a>}</span>
<span id="cb9-489"><a href="#cb9-489"></a></span>
<span id="cb9-490"><a href="#cb9-490"></a><span class="co">// Choose which entry point to bind in EA’s Scripts window:</span></span>
<span id="cb9-491"><a href="#cb9-491"></a><span class="co">// main() for step-by-step or applyToTarget() for one-shot after prompting</span></span>
<span id="cb9-492"><a href="#cb9-492"></a><span class="co">// main();</span></span>
<span id="cb9-493"><a href="#cb9-493"></a><span class="fu">applyToTarget</span>()<span class="op">;</span></span>
<span id="cb9-494"><a href="#cb9-494"></a><span class="in">```</span></span>
<span id="cb9-495"><a href="#cb9-495"></a></span>
<span id="cb9-496"><a href="#cb9-496"></a></span>
<span id="cb9-497"><a href="#cb9-497"></a></span>
<span id="cb9-498"><a href="#cb9-498"></a><span class="fu">### Pattern 4 – Linting &amp; Quality Gates (Report-Only by Default)</span></span>
<span id="cb9-499"><a href="#cb9-499"></a></span>
<span id="cb9-500"><a href="#cb9-500"></a>Just as programmers use “linters” to check code quality, modellers can</span>
<span id="cb9-501"><a href="#cb9-501"></a>use scripts to check model quality. The **Linting** pattern is about</span>
<span id="cb9-502"><a href="#cb9-502"></a>scanning the repository for “smells”: missing notes, duplicate names,</span>
<span id="cb9-503"><a href="#cb9-503"></a>orphaned elements, inconsistent stereotypes.</span>
<span id="cb9-504"><a href="#cb9-504"></a></span>
<span id="cb9-505"><a href="#cb9-505"></a>The script doesn’t necessarily fix the issues. It logs them, creates a</span>
<span id="cb9-506"><a href="#cb9-506"></a>report, and highlights what needs attention. This is especially powerful</span>
<span id="cb9-507"><a href="#cb9-507"></a>in enterprise settings where governance requires objective evidence of</span>
<span id="cb9-508"><a href="#cb9-508"></a>model quality.</span>
<span id="cb9-509"><a href="#cb9-509"></a></span>
<span id="cb9-510"><a href="#cb9-510"></a>**When to use:** continuous hygiene checks (naming, required tags,</span>
<span id="cb9-511"><a href="#cb9-511"></a>required relationships).  </span>
<span id="cb9-512"><a href="#cb9-512"></a>**Why:** consistent, repeatable, fast feedback before governance</span>
<span id="cb9-513"><a href="#cb9-513"></a>reviews.</span>
<span id="cb9-514"><a href="#cb9-514"></a></span>
<span id="cb9-515"><a href="#cb9-515"></a><span class="in">```{.js filename="Example 7.5 - Pattern4_LintQuality.js – JScript (ES3)"}</span></span>
<span id="cb9-516"><a href="#cb9-516"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb9-517"><a href="#cb9-517"></a><span class="co">// Example 7.5 - Pattern4_LintQuality.js – JScript (ES3)</span></span>
<span id="cb9-518"><a href="#cb9-518"></a><span class="co">// Purpose: Report model "smells" in selected package (no writes by default)</span></span>
<span id="cb9-519"><a href="#cb9-519"></a><span class="co">// Checks:</span></span>
<span id="cb9-520"><a href="#cb9-520"></a><span class="co">//   - Name not empty</span></span>
<span id="cb9-521"><a href="#cb9-521"></a><span class="co">//   - Required tag exists (e.g., "Owner")</span></span>
<span id="cb9-522"><a href="#cb9-522"></a><span class="co">//   - Name matches regex prefix (e.g., "REQ_")</span></span>
<span id="cb9-523"><a href="#cb9-523"></a><span class="co">// Output: CSV + Output tab; dry-run concept not needed (read-only)</span></span>
<span id="cb9-524"><a href="#cb9-524"></a><span class="co">// Dependencies: Helpers.js</span></span>
<span id="cb9-525"><a href="#cb9-525"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb9-526"><a href="#cb9-526"></a></span>
<span id="cb9-527"><a href="#cb9-527"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb9-528"><a href="#cb9-528"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb9-529"><a href="#cb9-529"></a></span>
<span id="cb9-530"><a href="#cb9-530"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb9-531"><a href="#cb9-531"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"Lint"</span><span class="op">;</span></span>
<span id="cb9-532"><a href="#cb9-532"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb9-533"><a href="#cb9-533"></a></span>
<span id="cb9-534"><a href="#cb9-534"></a>    <span class="co">// ---- Config ----</span></span>
<span id="cb9-535"><a href="#cb9-535"></a>    <span class="kw">var</span> REQUIRED_TAG <span class="op">=</span> <span class="st">"Owner"</span><span class="op">;</span></span>
<span id="cb9-536"><a href="#cb9-536"></a>    <span class="kw">var</span> NAME_PREFIX   <span class="op">=</span> <span class="st">"REQ_"</span><span class="op">;</span></span>
<span id="cb9-537"><a href="#cb9-537"></a>    <span class="kw">var</span> WRITE_CSV     <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb9-538"><a href="#cb9-538"></a></span>
<span id="cb9-539"><a href="#cb9-539"></a>    <span class="kw">var</span> pkg <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span>()<span class="op">;</span></span>
<span id="cb9-540"><a href="#cb9-540"></a>    <span class="cf">if</span> (<span class="op">!</span>pkg) { Session<span class="op">.</span><span class="fu">Prompt</span>(<span class="st">"Select a package to lint."</span><span class="op">,</span> promptOK)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb9-541"><a href="#cb9-541"></a></span>
<span id="cb9-542"><a href="#cb9-542"></a>    <span class="kw">var</span> dir<span class="op">=</span><span class="kw">null</span><span class="op">,</span> csv<span class="op">=</span><span class="kw">null</span><span class="op">;</span></span>
<span id="cb9-543"><a href="#cb9-543"></a>    <span class="cf">if</span> (WRITE_CSV) {</span>
<span id="cb9-544"><a href="#cb9-544"></a>        dir <span class="op">=</span> <span class="fu">browseForFolder</span>(<span class="st">"Select output folder for lint report:"</span>)<span class="op">;</span></span>
<span id="cb9-545"><a href="#cb9-545"></a>        <span class="cf">if</span> (dir) {</span>
<span id="cb9-546"><a href="#cb9-546"></a>            <span class="kw">var</span> stamp <span class="op">=</span> (<span class="kw">new</span> <span class="bu">Date</span>())<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb9-547"><a href="#cb9-547"></a>            <span class="kw">var</span> path <span class="op">=</span> dir <span class="op">+</span> <span class="st">"</span><span class="sc">\\</span><span class="st">pattern4_lint_report_"</span> <span class="op">+</span> stamp <span class="op">+</span> <span class="st">".csv"</span><span class="op">;</span></span>
<span id="cb9-548"><a href="#cb9-548"></a>            csv <span class="op">=</span> <span class="kw">new</span> <span class="fu">CsvWriter</span>(path)<span class="op">;</span></span>
<span id="cb9-549"><a href="#cb9-549"></a>            csv<span class="op">.</span><span class="fu">writeHeader</span>(<span class="st">"ElementID,GUID,Name,Type,Issue,Details"</span>)<span class="op">;</span></span>
<span id="cb9-550"><a href="#cb9-550"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Logging to: "</span> <span class="op">+</span> path)<span class="op">;</span></span>
<span id="cb9-551"><a href="#cb9-551"></a>        }</span>
<span id="cb9-552"><a href="#cb9-552"></a>    }</span>
<span id="cb9-553"><a href="#cb9-553"></a></span>
<span id="cb9-554"><a href="#cb9-554"></a>    <span class="kw">var</span> i<span class="op">,</span> issues<span class="op">=</span><span class="dv">0</span><span class="op">,</span> elements <span class="op">=</span> pkg<span class="op">.</span><span class="at">Elements</span><span class="op">;</span></span>
<span id="cb9-555"><a href="#cb9-555"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>elements<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb9-556"><a href="#cb9-556"></a>        <span class="kw">var</span> e <span class="op">=</span> elements<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb9-557"><a href="#cb9-557"></a></span>
<span id="cb9-558"><a href="#cb9-558"></a>        <span class="co">// Check 1: name present</span></span>
<span id="cb9-559"><a href="#cb9-559"></a>        <span class="cf">if</span> (<span class="fu">trim</span>(e<span class="op">.</span><span class="at">Name</span>) <span class="op">===</span> <span class="st">""</span>) {</span>
<span id="cb9-560"><a href="#cb9-560"></a>            issues <span class="op">+=</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> <span class="st">"MissingName"</span><span class="op">,</span> <span class="st">"Element has no name"</span>)<span class="op">;</span></span>
<span id="cb9-561"><a href="#cb9-561"></a>        }</span>
<span id="cb9-562"><a href="#cb9-562"></a></span>
<span id="cb9-563"><a href="#cb9-563"></a>        <span class="co">// Check 2: required tag exists</span></span>
<span id="cb9-564"><a href="#cb9-564"></a>        <span class="cf">if</span> (<span class="fu">trim</span>(<span class="fu">readTag</span>(e<span class="op">,</span> REQUIRED_TAG)) <span class="op">===</span> <span class="st">""</span>) {</span>
<span id="cb9-565"><a href="#cb9-565"></a>            issues <span class="op">+=</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> <span class="st">"MissingTag"</span><span class="op">,</span> <span class="st">"Required tag '"</span><span class="op">+</span>REQUIRED_TAG<span class="op">+</span><span class="st">"' is missing or empty"</span>)<span class="op">;</span></span>
<span id="cb9-566"><a href="#cb9-566"></a>        }</span>
<span id="cb9-567"><a href="#cb9-567"></a></span>
<span id="cb9-568"><a href="#cb9-568"></a>        <span class="co">// Check 3: naming convention</span></span>
<span id="cb9-569"><a href="#cb9-569"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">startsWith</span>(e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> NAME_PREFIX)) {</span>
<span id="cb9-570"><a href="#cb9-570"></a>            issues <span class="op">+=</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> <span class="st">"NamePrefix"</span><span class="op">,</span> <span class="st">"Expected prefix '"</span> <span class="op">+</span> NAME_PREFIX <span class="op">+</span> <span class="st">"'"</span>)<span class="op">;</span></span>
<span id="cb9-571"><a href="#cb9-571"></a>        }</span>
<span id="cb9-572"><a href="#cb9-572"></a>    }</span>
<span id="cb9-573"><a href="#cb9-573"></a></span>
<span id="cb9-574"><a href="#cb9-574"></a>    <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb9-575"><a href="#cb9-575"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Lint finished. Issues found: "</span> <span class="op">+</span> issues)<span class="op">;</span></span>
<span id="cb9-576"><a href="#cb9-576"></a>}</span>
<span id="cb9-577"><a href="#cb9-577"></a></span>
<span id="cb9-578"><a href="#cb9-578"></a><span class="kw">function</span> <span class="fu">emit</span>(csv<span class="op">,</span> e<span class="op">,</span> issue<span class="op">,</span> details) {</span>
<span id="cb9-579"><a href="#cb9-579"></a>    <span class="kw">var</span> line <span class="op">=</span> e<span class="op">.</span><span class="at">ElementID</span> <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">" – "</span> <span class="op">+</span> issue <span class="op">+</span> <span class="st">" : "</span> <span class="op">+</span> details<span class="op">;</span></span>
<span id="cb9-580"><a href="#cb9-580"></a>    <span class="fu">log</span>(<span class="st">"Lint"</span><span class="op">,</span> line)<span class="op">;</span></span>
<span id="cb9-581"><a href="#cb9-581"></a>    <span class="cf">if</span> (csv) csv<span class="op">.</span><span class="fu">writeRow</span>([e<span class="op">.</span><span class="at">ElementID</span><span class="op">,</span> e<span class="op">.</span><span class="at">ElementGUID</span><span class="op">,</span> e<span class="op">.</span><span class="at">Name</span><span class="op">,</span> e<span class="op">.</span><span class="at">Type</span><span class="op">,</span> issue<span class="op">,</span> details])<span class="op">;</span></span>
<span id="cb9-582"><a href="#cb9-582"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb9-583"><a href="#cb9-583"></a>}</span>
<span id="cb9-584"><a href="#cb9-584"></a></span>
<span id="cb9-585"><a href="#cb9-585"></a><span class="kw">function</span> <span class="fu">readTag</span>(e<span class="op">,</span> name) {</span>
<span id="cb9-586"><a href="#cb9-586"></a>    <span class="kw">var</span> i<span class="op">,</span> tvs <span class="op">=</span> e<span class="op">.</span><span class="at">TaggedValues</span><span class="op">;</span></span>
<span id="cb9-587"><a href="#cb9-587"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>tvs<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb9-588"><a href="#cb9-588"></a>        <span class="kw">var</span> tv <span class="op">=</span> tvs<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb9-589"><a href="#cb9-589"></a>        <span class="cf">if</span> (<span class="fu">equalsIgnoreCase</span>(tv<span class="op">.</span><span class="at">Name</span><span class="op">,</span> name)) <span class="cf">return</span> <span class="bu">String</span>(tv<span class="op">.</span><span class="at">Value</span><span class="op">||</span><span class="st">""</span>)<span class="op">;</span></span>
<span id="cb9-590"><a href="#cb9-590"></a>    }</span>
<span id="cb9-591"><a href="#cb9-591"></a>    <span class="cf">return</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb9-592"><a href="#cb9-592"></a>}</span>
<span id="cb9-593"><a href="#cb9-593"></a></span>
<span id="cb9-594"><a href="#cb9-594"></a><span class="fu">main</span>()<span class="op">;</span></span>
<span id="cb9-595"><a href="#cb9-595"></a><span class="in">```</span></span>
<span id="cb9-596"><a href="#cb9-596"></a></span>
<span id="cb9-597"><a href="#cb9-597"></a><span class="fu">### Pattern 5 – SQL-Accelerated Find, API-Safe Write (Hybrid)</span></span>
<span id="cb9-598"><a href="#cb9-598"></a></span>
<span id="cb9-599"><a href="#cb9-599"></a>One of the most effective ways to balance speed with safety in EA</span>
<span id="cb9-600"><a href="#cb9-600"></a>scripting is the **hybrid pattern**: use SQL to locate candidates, but</span>
<span id="cb9-601"><a href="#cb9-601"></a>rely on the API to perform updates.</span>
<span id="cb9-602"><a href="#cb9-602"></a></span>
<span id="cb9-603"><a href="#cb9-603"></a><span class="ss">- </span>**When to use**: this approach shines when you need to identify</span>
<span id="cb9-604"><a href="#cb9-604"></a>  thousands of elements quickly — for example, all Requirements missing</span>
<span id="cb9-605"><a href="#cb9-605"></a>  an Owner tag, or all Components in a given layer. Traversing entire</span>
<span id="cb9-606"><a href="#cb9-606"></a>  package trees with .Count and .GetAt() can be slow; SQL queries are</span>
<span id="cb9-607"><a href="#cb9-607"></a>  much faster.</span>
<span id="cb9-608"><a href="#cb9-608"></a></span>
<span id="cb9-609"><a href="#cb9-609"></a><span class="ss">- </span>**Why not just update with SQL?** Because direct database updates</span>
<span id="cb9-610"><a href="#cb9-610"></a>  bypass EA’s business rules and can corrupt the repository. That’s why</span>
<span id="cb9-611"><a href="#cb9-611"></a>  writes must still go through the API.</span>
<span id="cb9-612"><a href="#cb9-612"></a></span>
<span id="cb9-613"><a href="#cb9-613"></a>**The idea** is simple:</span>
<span id="cb9-614"><a href="#cb9-614"></a></span>
<span id="cb9-615"><a href="#cb9-615"></a><span class="ss">1.  </span>Use Repository.SQLQuery() with a SELECT statement to pull back the</span>
<span id="cb9-616"><a href="#cb9-616"></a>    candidate IDs.</span>
<span id="cb9-617"><a href="#cb9-617"></a></span>
<span id="cb9-618"><a href="#cb9-618"></a><span class="ss">2.  </span>Parse the XML result to extract element IDs or GUIDs.</span>
<span id="cb9-619"><a href="#cb9-619"></a></span>
<span id="cb9-620"><a href="#cb9-620"></a><span class="ss">3.  </span>Loop over those IDs, load each object via the API, and apply updates</span>
<span id="cb9-621"><a href="#cb9-621"></a>    safely (Update() + RefreshModelView()).</span>
<span id="cb9-622"><a href="#cb9-622"></a></span>
<span id="cb9-623"><a href="#cb9-623"></a>This hybrid approach gives you the best of both worlds:</span>
<span id="cb9-624"><a href="#cb9-624"></a></span>
<span id="cb9-625"><a href="#cb9-625"></a><span class="ss">- </span>**Fast selection** (SQL can scan tens of thousands of rows in</span>
<span id="cb9-626"><a href="#cb9-626"></a>  seconds).</span>
<span id="cb9-627"><a href="#cb9-627"></a></span>
<span id="cb9-628"><a href="#cb9-628"></a><span class="ss">- </span>**Safe updates** (API ensures model integrity).</span>
<span id="cb9-629"><a href="#cb9-629"></a></span>
<span id="cb9-630"><a href="#cb9-630"></a>It is one of the most important performance patterns for large</span>
<span id="cb9-631"><a href="#cb9-631"></a>repositories.</span>
<span id="cb9-632"><a href="#cb9-632"></a></span>
<span id="cb9-633"><a href="#cb9-633"></a>**When to use:** you need to *find* thousands of items quickly, but</span>
<span id="cb9-634"><a href="#cb9-634"></a>still want **safe updates** via the API (not raw SQL writes).</span>
<span id="cb9-635"><a href="#cb9-635"></a></span>
<span id="cb9-636"><a href="#cb9-636"></a>**Idea:** use Repository.SQLQuery() to *select* candidates (fast), parse</span>
<span id="cb9-637"><a href="#cb9-637"></a>the XML result to get IDs, then loop via API for writes (safe).</span>
<span id="cb9-638"><a href="#cb9-638"></a></span>
<span id="cb9-639"><a href="#cb9-639"></a><span class="in">```{.js filename="Example 7.6 - Pattern5_SqlFind_ApiWrite.js – JScript (ES3)"}</span></span>
<span id="cb9-640"><a href="#cb9-640"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb9-641"><a href="#cb9-641"></a><span class="co">// Example 7.6. - Pattern5_SqlFind_ApiWrite.js – JScript (ES3)</span></span>
<span id="cb9-642"><a href="#cb9-642"></a><span class="co">// Purpose: Fast "find" via SQLQuery, then safe writes via API</span></span>
<span id="cb9-643"><a href="#cb9-643"></a><span class="co">// Usage: Select any package (context not required for SQL); DRY_RUN=true by default</span></span>
<span id="cb9-644"><a href="#cb9-644"></a><span class="co">// Dependencies: Helpers.js</span></span>
<span id="cb9-645"><a href="#cb9-645"></a><span class="co">// -------------------------------------------------------</span></span>
<span id="cb9-646"><a href="#cb9-646"></a><span class="op">!</span>INC Local Scripts<span class="op">.</span><span class="at">EAConstants</span><span class="op">-</span>JScript</span>
<span id="cb9-647"><a href="#cb9-647"></a><span class="op">!</span>INC _Common<span class="op">.</span><span class="at">Helpers</span></span>
<span id="cb9-648"><a href="#cb9-648"></a></span>
<span id="cb9-649"><a href="#cb9-649"></a><span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb9-650"><a href="#cb9-650"></a>    <span class="kw">var</span> TAB <span class="op">=</span> <span class="st">"SqlFindApiWrite"</span><span class="op">;</span></span>
<span id="cb9-651"><a href="#cb9-651"></a>    <span class="fu">ensureOutputTab</span>(TAB)<span class="op">;</span></span>
<span id="cb9-652"><a href="#cb9-652"></a></span>
<span id="cb9-653"><a href="#cb9-653"></a>    <span class="kw">var</span> DRY_RUN <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb9-654"><a href="#cb9-654"></a>    <span class="kw">var</span> TYPE_FILTER <span class="op">=</span> <span class="st">"Class"</span><span class="op">;</span></span>
<span id="cb9-655"><a href="#cb9-655"></a>    <span class="kw">var</span> STEREOTYPE_TO_SET <span class="op">=</span> <span class="st">"DomainObject"</span><span class="op">;</span></span>
<span id="cb9-656"><a href="#cb9-656"></a></span>
<span id="cb9-657"><a href="#cb9-657"></a>    <span class="co">// 1) SQL find (XML result)</span></span>
<span id="cb9-658"><a href="#cb9-658"></a>    <span class="kw">var</span> sql <span class="op">=</span> <span class="st">"SELECT Object_ID, ea_guid, Name FROM t_object WHERE Object_Type='"</span> <span class="op">+</span> TYPE_FILTER <span class="op">+</span> <span class="st">"' AND Stereotype IS NULL"</span><span class="op">;</span></span>
<span id="cb9-659"><a href="#cb9-659"></a>    <span class="kw">var</span> xml <span class="op">=</span> Repository<span class="op">.</span><span class="fu">SQLQuery</span>(sql)<span class="op">;</span></span>
<span id="cb9-660"><a href="#cb9-660"></a></span>
<span id="cb9-661"><a href="#cb9-661"></a>    <span class="co">// 2) Parse minimal XML (very simple string parsing; robust XML parser not available in ES3)</span></span>
<span id="cb9-662"><a href="#cb9-662"></a>    <span class="co">//    Expect rows like: &lt;Row&gt;&lt;Object_ID&gt;123&lt;/Object_ID&gt;&lt;ea_guid&gt;{...}&lt;/ea_guid&gt;&lt;Name&gt;Foo&lt;/Name&gt;&lt;/Row&gt;</span></span>
<span id="cb9-663"><a href="#cb9-663"></a>    <span class="kw">var</span> ids <span class="op">=</span> <span class="fu">extractAll</span>(xml<span class="op">,</span> <span class="st">"&lt;Object_ID&gt;"</span><span class="op">,</span> <span class="st">"&lt;/Object_ID&gt;"</span>)<span class="op">;</span></span>
<span id="cb9-664"><a href="#cb9-664"></a></span>
<span id="cb9-665"><a href="#cb9-665"></a>    <span class="kw">var</span> i<span class="op">,</span> changed<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb9-666"><a href="#cb9-666"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Candidates: "</span> <span class="op">+</span> ids<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb9-667"><a href="#cb9-667"></a></span>
<span id="cb9-668"><a href="#cb9-668"></a>    <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>ids<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb9-669"><a href="#cb9-669"></a>        <span class="kw">var</span> id <span class="op">=</span> <span class="pp">parseInt</span>(<span class="fu">trim</span>(ids[i])<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb9-670"><a href="#cb9-670"></a>        <span class="kw">var</span> e <span class="op">=</span> Repository<span class="op">.</span><span class="fu">GetElementByID</span>(id)<span class="op">;</span></span>
<span id="cb9-671"><a href="#cb9-671"></a>        <span class="cf">if</span> (<span class="op">!</span>e) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb9-672"><a href="#cb9-672"></a></span>
<span id="cb9-673"><a href="#cb9-673"></a>        <span class="co">// Only set stereotype if empty (defensive sanity)</span></span>
<span id="cb9-674"><a href="#cb9-674"></a>        <span class="cf">if</span> (<span class="fu">trim</span>(e<span class="op">.</span><span class="at">Stereotype</span>) <span class="op">===</span> <span class="st">""</span>) {</span>
<span id="cb9-675"><a href="#cb9-675"></a>            <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Set stereotype on "</span> <span class="op">+</span> e<span class="op">.</span><span class="at">Name</span> <span class="op">+</span> <span class="st">" → "</span> <span class="op">+</span> STEREOTYPE_TO_SET)<span class="op">;</span></span>
<span id="cb9-676"><a href="#cb9-676"></a>            <span class="cf">if</span> (<span class="op">!</span>DRY_RUN) {</span>
<span id="cb9-677"><a href="#cb9-677"></a>                e<span class="op">.</span><span class="at">Stereotype</span> <span class="op">=</span> STEREOTYPE_TO_SET<span class="op">;</span></span>
<span id="cb9-678"><a href="#cb9-678"></a>                e<span class="op">.</span><span class="fu">Update</span>()<span class="op">;</span></span>
<span id="cb9-679"><a href="#cb9-679"></a>            }</span>
<span id="cb9-680"><a href="#cb9-680"></a>            changed<span class="op">++;</span></span>
<span id="cb9-681"><a href="#cb9-681"></a>        }</span>
<span id="cb9-682"><a href="#cb9-682"></a>    }</span>
<span id="cb9-683"><a href="#cb9-683"></a>    <span class="cf">if</span> (<span class="op">!</span>DRY_RUN <span class="op">&amp;&amp;</span> changed<span class="op">&gt;</span><span class="dv">0</span>) Repository<span class="op">.</span><span class="fu">RefreshModelView</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb9-684"><a href="#cb9-684"></a>    <span class="fu">log</span>(TAB<span class="op">,</span> <span class="st">"Changed "</span> <span class="op">+</span> changed <span class="op">+</span> <span class="st">" element(s). Dry-run="</span> <span class="op">+</span> DRY_RUN)<span class="op">;</span></span>
<span id="cb9-685"><a href="#cb9-685"></a>}</span>
<span id="cb9-686"><a href="#cb9-686"></a></span>
<span id="cb9-687"><a href="#cb9-687"></a><span class="co">// Minimal XML extraction helpers (no DOM available in ES3)</span></span>
<span id="cb9-688"><a href="#cb9-688"></a><span class="kw">function</span> <span class="fu">extractAll</span>(hay<span class="op">,</span> openTag<span class="op">,</span> closeTag) {</span>
<span id="cb9-689"><a href="#cb9-689"></a>    <span class="kw">var</span> res <span class="op">=</span> []<span class="op">,</span> start<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb9-690"><a href="#cb9-690"></a>    <span class="cf">while</span> (<span class="kw">true</span>) {</span>
<span id="cb9-691"><a href="#cb9-691"></a>        <span class="kw">var</span> i <span class="op">=</span> hay<span class="op">.</span><span class="fu">indexOf</span>(openTag<span class="op">,</span> start)<span class="op">;</span></span>
<span id="cb9-692"><a href="#cb9-692"></a>        <span class="cf">if</span> (i <span class="op">&lt;</span> <span class="dv">0</span>) <span class="cf">break</span><span class="op">;</span></span>
<span id="cb9-693"><a href="#cb9-693"></a>        <span class="kw">var</span> j <span class="op">=</span> hay<span class="op">.</span><span class="fu">indexOf</span>(closeTag<span class="op">,</span> i <span class="op">+</span> openTag<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb9-694"><a href="#cb9-694"></a>        <span class="cf">if</span> (j <span class="op">&lt;</span> <span class="dv">0</span>) <span class="cf">break</span><span class="op">;</span></span>
<span id="cb9-695"><a href="#cb9-695"></a>        <span class="kw">var</span> val <span class="op">=</span> hay<span class="op">.</span><span class="fu">substring</span>(i <span class="op">+</span> openTag<span class="op">.</span><span class="at">length</span><span class="op">,</span> j)<span class="op">;</span></span>
<span id="cb9-696"><a href="#cb9-696"></a>        res<span class="op">.</span><span class="fu">push</span>(val)<span class="op">;</span></span>
<span id="cb9-697"><a href="#cb9-697"></a>        start <span class="op">=</span> j <span class="op">+</span> closeTag<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb9-698"><a href="#cb9-698"></a>    }</span>
<span id="cb9-699"><a href="#cb9-699"></a>    <span class="cf">return</span> res<span class="op">;</span></span>
<span id="cb9-700"><a href="#cb9-700"></a>}</span>
<span id="cb9-701"><a href="#cb9-701"></a></span>
<span id="cb9-702"><a href="#cb9-702"></a><span class="fu">main</span>()<span class="op">;</span></span>
<span id="cb9-703"><a href="#cb9-703"></a><span class="in">```</span></span>
<span id="cb9-704"><a href="#cb9-704"></a></span>
<span id="cb9-705"><a href="#cb9-705"></a><span class="fu">## Pattern Handling</span></span>
<span id="cb9-706"><a href="#cb9-706"></a></span>
<span id="cb9-707"><a href="#cb9-707"></a><span class="fu">### Patterns as a Library</span></span>
<span id="cb9-708"><a href="#cb9-708"></a></span>
<span id="cb9-709"><a href="#cb9-709"></a>The beauty of patterns is that they can be turned into a **script</span>
<span id="cb9-710"><a href="#cb9-710"></a>library**. Instead of writing bespoke code, you start from a template:</span>
<span id="cb9-711"><a href="#cb9-711"></a></span>
<span id="cb9-712"><a href="#cb9-712"></a><span class="in">```{.js filename="Example 7.7 - findFilteredApply"}</span></span>
<span id="cb9-713"><a href="#cb9-713"></a><span class="co">// -------------------------------------------------------------------------------------------</span></span>
<span id="cb9-714"><a href="#cb9-714"></a><span class="co">// Example 7.7 - findFilteredApply</span></span>
<span id="cb9-715"><a href="#cb9-715"></a><span class="co">// -------------------------------------------------------------------------------------------</span></span>
<span id="cb9-716"><a href="#cb9-716"></a><span class="kw">function</span> <span class="fu">findFilterApply</span>(pkg<span class="op">,</span> filterFn<span class="op">,</span> applyFn) {</span>
<span id="cb9-717"><a href="#cb9-717"></a>    <span class="kw">var</span> els <span class="op">=</span> pkg<span class="op">.</span><span class="at">Elements</span><span class="op">;</span></span>
<span id="cb9-718"><a href="#cb9-718"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> els<span class="op">.</span><span class="at">Count</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb9-719"><a href="#cb9-719"></a>        <span class="kw">var</span> e <span class="op">=</span> els<span class="op">.</span><span class="fu">GetAt</span>(i)<span class="op">;</span></span>
<span id="cb9-720"><a href="#cb9-720"></a>        <span class="cf">if</span> (<span class="fu">filterFn</span>(e)) {</span>
<span id="cb9-721"><a href="#cb9-721"></a>            <span class="fu">applyFn</span>(e)<span class="op">;</span></span>
<span id="cb9-722"><a href="#cb9-722"></a>        }</span>
<span id="cb9-723"><a href="#cb9-723"></a>    }</span>
<span id="cb9-724"><a href="#cb9-724"></a>}</span>
<span id="cb9-725"><a href="#cb9-725"></a><span class="in">```</span></span>
<span id="cb9-726"><a href="#cb9-726"></a></span>
<span id="cb9-727"><a href="#cb9-727"></a></span>
<span id="cb9-728"><a href="#cb9-728"></a>With such a template, your script becomes simply the filter and apply</span>
<span id="cb9-729"><a href="#cb9-729"></a>functions. The boilerplate is taken care of. Even within EA’s limited</span>
<span id="cb9-730"><a href="#cb9-730"></a>JScript environment, this approach saves effort and reduces bugs.</span>
<span id="cb9-731"><a href="#cb9-731"></a></span>
<span id="cb9-732"><a href="#cb9-732"></a><span class="fu">### Patterns and Governance</span></span>
<span id="cb9-733"><a href="#cb9-733"></a></span>
<span id="cb9-734"><a href="#cb9-734"></a>One of the most important applications of patterns is governance. Large</span>
<span id="cb9-735"><a href="#cb9-735"></a>organisations rely on consistent models for reporting, compliance, and</span>
<span id="cb9-736"><a href="#cb9-736"></a>decision-making. Manual governance is too slow. Patterns like</span>
<span id="cb9-737"><a href="#cb9-737"></a>Find/Filter/Apply and Linting turn governance into a repeatable,</span>
<span id="cb9-738"><a href="#cb9-738"></a>automated process.</span>
<span id="cb9-739"><a href="#cb9-739"></a></span>
<span id="cb9-740"><a href="#cb9-740"></a>For example, you can script a governance check that every Requirement</span>
<span id="cb9-741"><a href="#cb9-741"></a>must have an Owner tag. The script follows the Find/Filter/Apply</span>
<span id="cb9-742"><a href="#cb9-742"></a>pattern, filters Requirements, checks tags, and logs violations. By</span>
<span id="cb9-743"><a href="#cb9-743"></a>running it regularly, you maintain model hygiene.</span>
<span id="cb9-744"><a href="#cb9-744"></a></span>
<span id="cb9-745"><a href="#cb9-745"></a><span class="fu">### Patterns Across Languages</span></span>
<span id="cb9-746"><a href="#cb9-746"></a></span>
<span id="cb9-747"><a href="#cb9-747"></a>Although the examples in this chapter are in JScript, the patterns</span>
<span id="cb9-748"><a href="#cb9-748"></a>themselves are language-agnostic. If you later write external automation</span>
<span id="cb9-749"><a href="#cb9-749"></a>in Python or C#, the same patterns apply. A Find/Filter/Apply loop in</span>
<span id="cb9-750"><a href="#cb9-750"></a>Python looks slightly different, but the structure is identical. This</span>
<span id="cb9-751"><a href="#cb9-751"></a>makes patterns a great way to transfer knowledge across teams and</span>
<span id="cb9-752"><a href="#cb9-752"></a>technologies.</span>
<span id="cb9-753"><a href="#cb9-753"></a></span>
<span id="cb9-754"><a href="#cb9-754"></a><span class="fu">### The Safety Net of Patterns</span></span>
<span id="cb9-755"><a href="#cb9-755"></a></span>
<span id="cb9-756"><a href="#cb9-756"></a>Patterns also act as a safety net against AI hallucinations. As we saw</span>
<span id="cb9-757"><a href="#cb9-757"></a>earlier, AI can generate starter scripts but often introduces</span>
<span id="cb9-758"><a href="#cb9-758"></a>unsupported syntax. If you know the underlying pattern, you can spot and</span>
<span id="cb9-759"><a href="#cb9-759"></a>correct mistakes quickly. For example, if AI gives you a forEach, you</span>
<span id="cb9-760"><a href="#cb9-760"></a>know the pattern requires a .Count/.GetAt() loop, and you can adjust</span>
<span id="cb9-761"><a href="#cb9-761"></a>accordingly.</span>
<span id="cb9-762"><a href="#cb9-762"></a></span>
<span id="cb9-763"><a href="#cb9-763"></a><span class="fu">## Performance &amp; Safety Notes</span></span>
<span id="cb9-764"><a href="#cb9-764"></a></span>
<span id="cb9-765"><a href="#cb9-765"></a><span class="ss">- </span>Prefer **Find/Filter/Apply** for clarity; switch to **SQL-accelerated</span>
<span id="cb9-766"><a href="#cb9-766"></a>  find** when scale demands it.</span>
<span id="cb9-767"><a href="#cb9-767"></a></span>
<span id="cb9-768"><a href="#cb9-768"></a><span class="ss">- </span>Keep **DRY_RUN = true** until you’ve inspected CSV logs.</span>
<span id="cb9-769"><a href="#cb9-769"></a></span>
<span id="cb9-770"><a href="#cb9-770"></a><span class="ss">- </span>Call **Update()** after modifications, then **RefreshModelView()** for</span>
<span id="cb9-771"><a href="#cb9-771"></a>  UI.</span>
<span id="cb9-772"><a href="#cb9-772"></a></span>
<span id="cb9-773"><a href="#cb9-773"></a><span class="ss">- </span>For very large sets, consider chunking (operate in batches of, say,</span>
<span id="cb9-774"><a href="#cb9-774"></a>  250 items) and pausing UI updates:</span>
<span id="cb9-775"><a href="#cb9-775"></a></span>
<span id="cb9-776"><a href="#cb9-776"></a><span class="ss">- </span>// Pseudocode – EA may ignore UI flag in some contexts; rely on</span>
<span id="cb9-777"><a href="#cb9-777"></a>  batching regardless</span>
<span id="cb9-778"><a href="#cb9-778"></a></span>
<span id="cb9-779"><a href="#cb9-779"></a><span class="ss">- </span>// Repository.EnableUIUpdates = false; // not always honoured</span>
<span id="cb9-780"><a href="#cb9-780"></a></span>
<span id="cb9-781"><a href="#cb9-781"></a><span class="ss">- </span>// ...do batches...</span>
<span id="cb9-782"><a href="#cb9-782"></a></span>
<span id="cb9-783"><a href="#cb9-783"></a><span class="ss">- </span>// Repository.EnableUIUpdates = true;</span>
<span id="cb9-784"><a href="#cb9-784"></a></span>
<span id="cb9-785"><a href="#cb9-785"></a><span class="ss">- </span>// Repository.RefreshModelView(0);</span>
<span id="cb9-786"><a href="#cb9-786"></a></span>
<span id="cb9-787"><a href="#cb9-787"></a><span class="fu">## Bonus: Python “Curate → Apply” Pipeline</span></span>
<span id="cb9-788"><a href="#cb9-788"></a></span>
<span id="cb9-789"><a href="#cb9-789"></a>Use this when CSV shaping, validation or integration (e.g., SharePoint,</span>
<span id="cb9-790"><a href="#cb9-790"></a>Jira) is easier outside EA.</span>
<span id="cb9-791"><a href="#cb9-791"></a></span>
<span id="cb9-792"><a href="#cb9-792"></a><span class="in">```{.py filename="Example 7.8 - pattern6_curate_apply_external.py – Python 3 (pywin32)"}</span></span>
<span id="cb9-793"><a href="#cb9-793"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb9-794"><a href="#cb9-794"></a><span class="co"># Example 7.8 - pattern6_curate_apply_external.py – Python 3 (pywin32)</span></span>
<span id="cb9-795"><a href="#cb9-795"></a><span class="co"># Purpose: Read a curated CSV of element updates and apply via EA API</span></span>
<span id="cb9-796"><a href="#cb9-796"></a><span class="co"># Safety: Only rows with Apply=YES are executed</span></span>
<span id="cb9-797"><a href="#cb9-797"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb9-798"><a href="#cb9-798"></a><span class="im">import</span> csv, win32com.client</span>
<span id="cb9-799"><a href="#cb9-799"></a></span>
<span id="cb9-800"><a href="#cb9-800"></a><span class="kw">def</span> main(csv_path):</span>
<span id="cb9-801"><a href="#cb9-801"></a>    ea <span class="op">=</span> win32com.client.Dispatch(<span class="st">"EA.App"</span>)</span>
<span id="cb9-802"><a href="#cb9-802"></a>    repo <span class="op">=</span> ea.Repository</span>
<span id="cb9-803"><a href="#cb9-803"></a></span>
<span id="cb9-804"><a href="#cb9-804"></a>    changes <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-805"><a href="#cb9-805"></a>    <span class="cf">with</span> <span class="bu">open</span>(csv_path, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb9-806"><a href="#cb9-806"></a>        rdr <span class="op">=</span> csv.DictReader(f)</span>
<span id="cb9-807"><a href="#cb9-807"></a>        <span class="cf">for</span> row <span class="kw">in</span> rdr:</span>
<span id="cb9-808"><a href="#cb9-808"></a>            <span class="cf">if</span> <span class="bu">str</span>(row.get(<span class="st">"Apply"</span>,<span class="st">""</span>)).strip().lower() <span class="op">!=</span> <span class="st">"yes"</span>:</span>
<span id="cb9-809"><a href="#cb9-809"></a>                <span class="cf">continue</span></span>
<span id="cb9-810"><a href="#cb9-810"></a>            eid <span class="op">=</span> <span class="bu">int</span>(row[<span class="st">"ElementID"</span>])</span>
<span id="cb9-811"><a href="#cb9-811"></a>            new_status <span class="op">=</span> row[<span class="st">"ProposedStatus"</span>]</span>
<span id="cb9-812"><a href="#cb9-812"></a></span>
<span id="cb9-813"><a href="#cb9-813"></a>            e <span class="op">=</span> repo.GetElementByID(eid)</span>
<span id="cb9-814"><a href="#cb9-814"></a>            <span class="cf">if</span> e:</span>
<span id="cb9-815"><a href="#cb9-815"></a>                e.Status <span class="op">=</span> new_status</span>
<span id="cb9-816"><a href="#cb9-816"></a>                e.Update()</span>
<span id="cb9-817"><a href="#cb9-817"></a>                changes <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-818"><a href="#cb9-818"></a></span>
<span id="cb9-819"><a href="#cb9-819"></a>    <span class="cf">if</span> changes:</span>
<span id="cb9-820"><a href="#cb9-820"></a>        repo.RefreshModelView(<span class="dv">0</span>)</span>
<span id="cb9-821"><a href="#cb9-821"></a>    <span class="bu">print</span>(<span class="ss">f"Applied </span><span class="sc">{</span>changes<span class="sc">}</span><span class="ss"> curated change(s)."</span>)</span>
<span id="cb9-822"><a href="#cb9-822"></a></span>
<span id="cb9-823"><a href="#cb9-823"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb9-824"><a href="#cb9-824"></a>    main(<span class="vs">r"C:</span><span class="er">\</span><span class="vs">path</span><span class="ch">\t</span><span class="vs">o</span><span class="er">\</span><span class="vs">pattern2_curate_export_123</span><span class="dv">.</span><span class="vs">csv"</span>)</span>
<span id="cb9-825"><a href="#cb9-825"></a><span class="in">```</span></span>
<span id="cb9-826"><a href="#cb9-826"></a></span>
<span id="cb9-827"><a href="#cb9-827"></a><span class="fu">## What to Use When (cheat-sheet)</span></span>
<span id="cb9-828"><a href="#cb9-828"></a></span>
<span id="cb9-829"><a href="#cb9-829"></a><span class="ss">- </span>**Small, safe rename/retag** → Pattern 1 (Find/Filter/Apply).</span>
<span id="cb9-830"><a href="#cb9-830"></a></span>
<span id="cb9-831"><a href="#cb9-831"></a><span class="ss">- </span>**Risky/wide updates** → Pattern 2 (Curate-then-Write).</span>
<span id="cb9-832"><a href="#cb9-832"></a></span>
<span id="cb9-833"><a href="#cb9-833"></a><span class="ss">- </span>**Set common metadata** → Pattern 3 (Tag Propagation).</span>
<span id="cb9-834"><a href="#cb9-834"></a></span>
<span id="cb9-835"><a href="#cb9-835"></a><span class="ss">- </span>**Governance checks** → Pattern 4 (Linting &amp; Quality Gates).</span>
<span id="cb9-836"><a href="#cb9-836"></a></span>
<span id="cb9-837"><a href="#cb9-837"></a><span class="ss">- </span>**Huge models** → Pattern 5 (SQL-find, API-write).</span>
<span id="cb9-838"><a href="#cb9-838"></a></span>
<span id="cb9-839"><a href="#cb9-839"></a><span class="ss">- </span>**Pipelines &amp; integrations** → Python external bonus.</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>