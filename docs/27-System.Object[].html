<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Appendix E: External Automation Setup – Scripting Sparx Enterprise Architect: A Practical Handbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./26-System.Object[].html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-b4ddde2c4c77ed14ccfa95278770da4f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./27-System.Object[].html"><span class="chapter-title">Appendix E: External Automation Setup</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Scripting Sparx Enterprise Architect: A Practical Handbook</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Scripting Sparx Enterprise Architect</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 1: Why Script EA?</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 2: Automation Landscape</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 3: Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 4: API Essentials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 5: Inside EA with JScript</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 6: External Automation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 7: Script Design Patterns</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 8: Object Details</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 9: Imports &amp; Exports</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 10: MDG-Aware Scripting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 11: Governance Scripts</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 12: Cookbook of Examples</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 13: Why AI Helps</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 14: Prompt Engineering</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 15: AI Refactoring Partner</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 16: AI in Daily Workflow</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 17: Performance &amp; Scaling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 18: Integrating with Workflows</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 19: Add-ins vs Scripts</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 20: Troubleshooting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 21: Reference</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix A: Scripting Constraints</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix B: External Automation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix C: Glossary of Terms</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix D: Quick Reference</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27-System.Object[].html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Appendix E: External Automation Setup</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#e.1-purpose" id="toc-e.1-purpose" class="nav-link active" data-scroll-target="#e.1-purpose">E.1 Purpose</a></li>
  <li><a href="#e.2-usage" id="toc-e.2-usage" class="nav-link" data-scroll-target="#e.2-usage">E.2 Usage</a></li>
  <li><a href="#e.3-the-eaconnect-helper-class" id="toc-e.3-the-eaconnect-helper-class" class="nav-link" data-scroll-target="#e.3-the-eaconnect-helper-class">E.3 The EAConnect Helper Class</a></li>
  <li><a href="#e.4-configuration-setup" id="toc-e.4-configuration-setup" class="nav-link" data-scroll-target="#e.4-configuration-setup">E.4 Configuration &amp; Setup</a>
  <ul class="collapse">
  <li><a href="#bitness" id="toc-bitness" class="nav-link" data-scroll-target="#bitness">Bitness</a></li>
  <li><a href="#interop.ea.dll" id="toc-interop.ea.dll" class="nav-link" data-scroll-target="#interop.ea.dll">Interop.EA.dll</a></li>
  <li><a href="#stathread" id="toc-stathread" class="nav-link" data-scroll-target="#stathread">STAThread</a></li>
  <li><a href="#model-files" id="toc-model-files" class="nav-link" data-scroll-target="#model-files">Model Files</a></li>
  <li><a href="#dry-run-logging" id="toc-dry-run-logging" class="nav-link" data-scroll-target="#dry-run-logging">Dry Run &amp; Logging</a></li>
  <li><a href="#distribution" id="toc-distribution" class="nav-link" data-scroll-target="#distribution">Distribution</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-title">Appendix E: External Automation Setup</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This appendix provides the reusable EAConnect helper class plus the configuration details required to build external automation tools against Enterprise Architect (EA). It is intended as the “plumbing” layer behind the example in <strong>Chapter 6 – External Automation</strong>.</p>
<section id="e.1-purpose" class="level2">
<h2 class="anchored" data-anchor-id="e.1-purpose">E.1 Purpose</h2>
<p>The EAConnect helper abstracts the complexities of EA’s COM interface and standardises safety practices:</p>
<ul>
<li><p>Attaching to or launching EA consistently</p></li>
<li><p>Waiting for the Repository to become available</p></li>
<li><p>Opening models automatically if needed</p></li>
<li><p>Handling bitness and Interop.EA.dll</p></li>
<li><p>Providing safe wrappers for common tasks (find package, add element, add tagged value)</p></li>
<li><p>Enforcing <strong>dry-run by default</strong></p></li>
<li><p>Writing CSV audit logs with auto-derived filenames</p></li>
<li><p>Refreshing EA’s UI at sensible points</p></li>
</ul>
<p>With this helper, your utilities focus on intent rather than boilerplate.</p>
</section>
<section id="e.2-usage" class="level2">
<h2 class="anchored" data-anchor-id="e.2-usage">E.2 Usage</h2>
<p>A minimal program using the helper:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode numberSource csharp number-lines code-with-copy"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1"></a></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">using</span> EA<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">using</span> EA<span class="op">.</span><span class="fu">Automation</span><span class="op">;</span> <span class="co">// the helper namespace</span></span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="kw">class</span> Program</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="op">{</span></span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a>\<span class="op">[</span>STAThread\<span class="op">]</span></span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span><span class="op">(</span><span class="dt">string</span>\<span class="op">[</span>\<span class="op">]</span> args<span class="op">)</span></span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="op">{</span></span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="kw">using</span> <span class="dt">var</span> ea <span class="op">=</span> EAConnect<span class="op">.</span><span class="fu">AttachOrLaunch</span><span class="op">(</span><span class="kw">new</span> EAConnect<span class="op">.</span><span class="fu">Options</span> <span class="op">{</span> ShowUI <span class="op">=</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="kw">true</span> <span class="op">});</span></span>
<span id="cb1-20"><a href="#cb1-20"></a></span>
<span id="cb1-21"><a href="#cb1-21"></a>Package pkg <span class="op">=</span> ea<span class="op">.</span><span class="fu">GetSelectedPackageOrRoot</span><span class="op">();</span></span>
<span id="cb1-22"><a href="#cb1-22"></a></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="dt">var</span> result <span class="op">=</span> EAConnect<span class="op">.</span><span class="fu">AddElement</span><span class="op">(</span>ea<span class="op">.</span><span class="fu">Repo</span><span class="op">,</span> pkg<span class="op">,</span> <span class="st">"DemoClass"</span><span class="op">,</span> <span class="st">"Class"</span><span class="op">,</span></span>
<span id="cb1-24"><a href="#cb1-24"></a></span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="st">"Created by EAConnect."</span><span class="op">,</span> dryRun<span class="op">:</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb1-26"><a href="#cb1-26"></a></span>
<span id="cb1-27"><a href="#cb1-27"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>result<span class="op">.</span><span class="fu">Summary</span><span class="op">);</span></span>
<span id="cb1-28"><a href="#cb1-28"></a></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="op">}</span></span>
<span id="cb1-30"><a href="#cb1-30"></a></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This pattern keeps the Program.cs short and declarative. All detailed logic resides in the helper.</p>
</section>
<section id="e.3-the-eaconnect-helper-class" class="level2">
<h2 class="anchored" data-anchor-id="e.3-the-eaconnect-helper-class">E.3 The EAConnect Helper Class</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode numberSource csharp number-lines code-with-copy"><code class="sourceCode cs"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">//</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="op">=======================================================================</span></span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">// File: EAConnect.cs</span></span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">// Project: EA Automation Helper</span></span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">// Author: \&lt;Your Name\&gt;</span></span>
<span id="cb2-9"><a href="#cb2-9"></a></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">// Created: 2025-08-31</span></span>
<span id="cb2-11"><a href="#cb2-11"></a></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">// Last Update: 2025-08-31</span></span>
<span id="cb2-13"><a href="#cb2-13"></a></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">//</span></span>
<span id="cb2-15"><a href="#cb2-15"></a></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">// PURPOSE</span></span>
<span id="cb2-17"><a href="#cb2-17"></a></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co">// -------</span></span>
<span id="cb2-19"><a href="#cb2-19"></a></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co">// Provides a safe, reusable abstraction over EA’s COM automation API.</span></span>
<span id="cb2-21"><a href="#cb2-21"></a></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="co">// Handles: attach/launch, repository polling, model open, package</span></span>
<span id="cb2-23"><a href="#cb2-23"></a></span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="co">// resolution,</span></span>
<span id="cb2-25"><a href="#cb2-25"></a></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="co">// element creation, tagged value creation, CSV logging, and UI refresh.</span></span>
<span id="cb2-27"><a href="#cb2-27"></a></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="co">//</span></span>
<span id="cb2-29"><a href="#cb2-29"></a></span>
<span id="cb2-30"><a href="#cb2-30"></a><span class="co">// USAGE</span></span>
<span id="cb2-31"><a href="#cb2-31"></a></span>
<span id="cb2-32"><a href="#cb2-32"></a><span class="co">// -----</span></span>
<span id="cb2-33"><a href="#cb2-33"></a></span>
<span id="cb2-34"><a href="#cb2-34"></a><span class="co">// using var ea = EAConnect.AttachOrLaunch(new EAConnect.Options {</span></span>
<span id="cb2-35"><a href="#cb2-35"></a></span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="co">// ShowUI = true });</span></span>
<span id="cb2-37"><a href="#cb2-37"></a></span>
<span id="cb2-38"><a href="#cb2-38"></a><span class="co">// var pkg = ea.GetSelectedPackageOrRoot();</span></span>
<span id="cb2-39"><a href="#cb2-39"></a></span>
<span id="cb2-40"><a href="#cb2-40"></a><span class="co">// var result = EAConnect.AddElement(ea.Repo, pkg, "NewClass", "Class",</span></span>
<span id="cb2-41"><a href="#cb2-41"></a></span>
<span id="cb2-42"><a href="#cb2-42"></a><span class="co">// "Notes", true);</span></span>
<span id="cb2-43"><a href="#cb2-43"></a></span>
<span id="cb2-44"><a href="#cb2-44"></a><span class="co">// Console.WriteLine(result.Summary);</span></span>
<span id="cb2-45"><a href="#cb2-45"></a></span>
<span id="cb2-46"><a href="#cb2-46"></a><span class="co">//</span></span>
<span id="cb2-47"><a href="#cb2-47"></a></span>
<span id="cb2-48"><a href="#cb2-48"></a><span class="co">// ASSUMPTIONS</span></span>
<span id="cb2-49"><a href="#cb2-49"></a></span>
<span id="cb2-50"><a href="#cb2-50"></a><span class="co">// -----------</span></span>
<span id="cb2-51"><a href="#cb2-51"></a></span>
<span id="cb2-52"><a href="#cb2-52"></a><span class="co">// - EA is installed and COM-registered (ProgID = "EA.App").</span></span>
<span id="cb2-53"><a href="#cb2-53"></a></span>
<span id="cb2-54"><a href="#cb2-54"></a><span class="co">// - Interop.EA.dll referenced (from EA install folder).</span></span>
<span id="cb2-55"><a href="#cb2-55"></a></span>
<span id="cb2-56"><a href="#cb2-56"></a><span class="co">// - Bitness of project matches EA (x64 for EA 64-bit; x86 for 32-bit).</span></span>
<span id="cb2-57"><a href="#cb2-57"></a></span>
<span id="cb2-58"><a href="#cb2-58"></a><span class="co">// - .NET project marked \[STAThread\] on entry point.</span></span>
<span id="cb2-59"><a href="#cb2-59"></a></span>
<span id="cb2-60"><a href="#cb2-60"></a><span class="co">//</span></span>
<span id="cb2-61"><a href="#cb2-61"></a></span>
<span id="cb2-62"><a href="#cb2-62"></a><span class="co">// SAFETY</span></span>
<span id="cb2-63"><a href="#cb2-63"></a></span>
<span id="cb2-64"><a href="#cb2-64"></a><span class="co">// ------</span></span>
<span id="cb2-65"><a href="#cb2-65"></a></span>
<span id="cb2-66"><a href="#cb2-66"></a><span class="co">// - Dry-run enabled by default in sample programs.</span></span>
<span id="cb2-67"><a href="#cb2-67"></a></span>
<span id="cb2-68"><a href="#cb2-68"></a><span class="co">// - CSV audit logging for all writes.</span></span>
<span id="cb2-69"><a href="#cb2-69"></a></span>
<span id="cb2-70"><a href="#cb2-70"></a><span class="co">// - UI refresh at batch boundaries only.</span></span>
<span id="cb2-71"><a href="#cb2-71"></a></span>
<span id="cb2-72"><a href="#cb2-72"></a><span class="co">//</span></span>
<span id="cb2-73"><a href="#cb2-73"></a></span>
<span id="cb2-74"><a href="#cb2-74"></a><span class="co">// DEPENDENCIES</span></span>
<span id="cb2-75"><a href="#cb2-75"></a></span>
<span id="cb2-76"><a href="#cb2-76"></a><span class="co">// ------------</span></span>
<span id="cb2-77"><a href="#cb2-77"></a></span>
<span id="cb2-78"><a href="#cb2-78"></a><span class="co">// - System.Runtime.InteropServices (Marshal.GetActiveObject).</span></span>
<span id="cb2-79"><a href="#cb2-79"></a></span>
<span id="cb2-80"><a href="#cb2-80"></a><span class="co">// - Interop.EA.dll.</span></span>
<span id="cb2-81"><a href="#cb2-81"></a></span>
<span id="cb2-82"><a href="#cb2-82"></a><span class="co">//</span></span>
<span id="cb2-83"><a href="#cb2-83"></a></span>
<span id="cb2-84"><a href="#cb2-84"></a><span class="co">// UPDATE HISTORY</span></span>
<span id="cb2-85"><a href="#cb2-85"></a></span>
<span id="cb2-86"><a href="#cb2-86"></a><span class="co">// --------------</span></span>
<span id="cb2-87"><a href="#cb2-87"></a></span>
<span id="cb2-88"><a href="#cb2-88"></a><span class="co">// - 2025-08-31: Initial helper version.</span></span>
<span id="cb2-89"><a href="#cb2-89"></a></span>
<span id="cb2-90"><a href="#cb2-90"></a><span class="co">//</span></span>
<span id="cb2-91"><a href="#cb2-91"></a><span class="op">=======================================================================</span></span>
<span id="cb2-92"><a href="#cb2-92"></a></span>
<span id="cb2-93"><a href="#cb2-93"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb2-94"><a href="#cb2-94"></a></span>
<span id="cb2-95"><a href="#cb2-95"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">IO</span><span class="op">;</span></span>
<span id="cb2-96"><a href="#cb2-96"></a></span>
<span id="cb2-97"><a href="#cb2-97"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Runtime</span><span class="op">.</span><span class="fu">InteropServices</span><span class="op">;</span></span>
<span id="cb2-98"><a href="#cb2-98"></a></span>
<span id="cb2-99"><a href="#cb2-99"></a><span class="kw">using</span> EA<span class="op">;</span></span>
<span id="cb2-100"><a href="#cb2-100"></a></span>
<span id="cb2-101"><a href="#cb2-101"></a><span class="kw">namespace</span> EA<span class="op">.</span><span class="fu">Automation</span></span>
<span id="cb2-102"><a href="#cb2-102"></a></span>
<span id="cb2-103"><a href="#cb2-103"></a><span class="op">{</span></span>
<span id="cb2-104"><a href="#cb2-104"></a></span>
<span id="cb2-105"><a href="#cb2-105"></a><span class="kw">public</span> <span class="kw">static</span> <span class="kw">class</span> EAConnect</span>
<span id="cb2-106"><a href="#cb2-106"></a></span>
<span id="cb2-107"><a href="#cb2-107"></a><span class="op">{</span></span>
<span id="cb2-108"><a href="#cb2-108"></a></span>
<span id="cb2-109"><a href="#cb2-109"></a><span class="co">// Encapsulates a connected EA session</span></span>
<span id="cb2-110"><a href="#cb2-110"></a></span>
<span id="cb2-111"><a href="#cb2-111"></a><span class="kw">public</span> <span class="kw">sealed</span> <span class="kw">class</span> Session <span class="op">:</span> IDisposable</span>
<span id="cb2-112"><a href="#cb2-112"></a></span>
<span id="cb2-113"><a href="#cb2-113"></a><span class="op">{</span></span>
<span id="cb2-114"><a href="#cb2-114"></a></span>
<span id="cb2-115"><a href="#cb2-115"></a><span class="kw">public</span> EA<span class="op">.</span><span class="fu">App</span> App <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb2-116"><a href="#cb2-116"></a></span>
<span id="cb2-117"><a href="#cb2-117"></a><span class="kw">public</span> EA<span class="op">.</span><span class="fu">Repository</span> Repo <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb2-118"><a href="#cb2-118"></a></span>
<span id="cb2-119"><a href="#cb2-119"></a><span class="kw">internal</span> <span class="fu">Session</span><span class="op">(</span>EA<span class="op">.</span><span class="fu">App</span> app<span class="op">,</span> EA<span class="op">.</span><span class="fu">Repository</span> repo<span class="op">)</span></span>
<span id="cb2-120"><a href="#cb2-120"></a></span>
<span id="cb2-121"><a href="#cb2-121"></a><span class="op">{</span></span>
<span id="cb2-122"><a href="#cb2-122"></a></span>
<span id="cb2-123"><a href="#cb2-123"></a>App <span class="op">=</span> app<span class="op">;</span></span>
<span id="cb2-124"><a href="#cb2-124"></a></span>
<span id="cb2-125"><a href="#cb2-125"></a>Repo <span class="op">=</span> repo<span class="op">;</span></span>
<span id="cb2-126"><a href="#cb2-126"></a></span>
<span id="cb2-127"><a href="#cb2-127"></a><span class="op">}</span></span>
<span id="cb2-128"><a href="#cb2-128"></a></span>
<span id="cb2-129"><a href="#cb2-129"></a><span class="kw">public</span> Package <span class="fu">GetSelectedPackageOrRoot</span><span class="op">()</span></span>
<span id="cb2-130"><a href="#cb2-130"></a></span>
<span id="cb2-131"><a href="#cb2-131"></a><span class="op">{</span></span>
<span id="cb2-132"><a href="#cb2-132"></a></span>
<span id="cb2-133"><a href="#cb2-133"></a>Package<span class="op">?</span> pkg <span class="op">=</span> Repo<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span><span class="op">();</span></span>
<span id="cb2-134"><a href="#cb2-134"></a></span>
<span id="cb2-135"><a href="#cb2-135"></a><span class="kw">if</span> <span class="op">(</span>pkg <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="kw">return</span> pkg<span class="op">;</span></span>
<span id="cb2-136"><a href="#cb2-136"></a></span>
<span id="cb2-137"><a href="#cb2-137"></a><span class="kw">if</span> <span class="op">(</span>Repo<span class="op">.</span><span class="fu">Models</span><span class="op">.</span><span class="fu">Count</span> \<span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="kw">return</span></span>
<span id="cb2-138"><a href="#cb2-138"></a></span>
<span id="cb2-139"><a href="#cb2-139"></a><span class="op">&gt;</span> <span class="op">(</span>Package<span class="op">)</span>Repo<span class="op">.</span><span class="fu">Models</span><span class="op">.</span><span class="fu">GetAt</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb2-140"><a href="#cb2-140"></a></span>
<span id="cb2-141"><a href="#cb2-141"></a><span class="kw">throw</span> <span class="kw">new</span> <span class="fu">InvalidOperationException</span><span class="op">(</span></span>
<span id="cb2-142"><a href="#cb2-142"></a></span>
<span id="cb2-143"><a href="#cb2-143"></a><span class="op">&gt;</span> <span class="st">"No package available in repository."</span><span class="op">);</span></span>
<span id="cb2-144"><a href="#cb2-144"></a></span>
<span id="cb2-145"><a href="#cb2-145"></a><span class="op">}</span></span>
<span id="cb2-146"><a href="#cb2-146"></a></span>
<span id="cb2-147"><a href="#cb2-147"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">Dispose</span><span class="op">()</span></span>
<span id="cb2-148"><a href="#cb2-148"></a></span>
<span id="cb2-149"><a href="#cb2-149"></a><span class="op">{</span></span>
<span id="cb2-150"><a href="#cb2-150"></a></span>
<span id="cb2-151"><a href="#cb2-151"></a><span class="co">// Release COM references cleanly</span></span>
<span id="cb2-152"><a href="#cb2-152"></a></span>
<span id="cb2-153"><a href="#cb2-153"></a>Marshal<span class="op">.</span><span class="fu">ReleaseComObject</span><span class="op">(</span>Repo<span class="op">);</span></span>
<span id="cb2-154"><a href="#cb2-154"></a></span>
<span id="cb2-155"><a href="#cb2-155"></a>Marshal<span class="op">.</span><span class="fu">ReleaseComObject</span><span class="op">(</span>App<span class="op">);</span></span>
<span id="cb2-156"><a href="#cb2-156"></a></span>
<span id="cb2-157"><a href="#cb2-157"></a><span class="op">}</span></span>
<span id="cb2-158"><a href="#cb2-158"></a></span>
<span id="cb2-159"><a href="#cb2-159"></a><span class="op">}</span></span>
<span id="cb2-160"><a href="#cb2-160"></a></span>
<span id="cb2-161"><a href="#cb2-161"></a><span class="co">// Options for attaching or launching EA</span></span>
<span id="cb2-162"><a href="#cb2-162"></a></span>
<span id="cb2-163"><a href="#cb2-163"></a><span class="kw">public</span> <span class="kw">sealed</span> <span class="kw">class</span> Options</span>
<span id="cb2-164"><a href="#cb2-164"></a></span>
<span id="cb2-165"><a href="#cb2-165"></a><span class="op">{</span></span>
<span id="cb2-166"><a href="#cb2-166"></a></span>
<span id="cb2-167"><a href="#cb2-167"></a><span class="kw">public</span> <span class="dt">bool</span> PreferAttach <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb2-168"><a href="#cb2-168"></a></span>
<span id="cb2-169"><a href="#cb2-169"></a><span class="kw">public</span> <span class="dt">bool</span> LaunchIfNotRunning <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb2-170"><a href="#cb2-170"></a></span>
<span id="cb2-171"><a href="#cb2-171"></a><span class="kw">public</span> <span class="dt">string</span><span class="op">?</span> ModelPath <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb2-172"><a href="#cb2-172"></a></span>
<span id="cb2-173"><a href="#cb2-173"></a><span class="kw">public</span> <span class="dt">bool</span> ShowUI <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb2-174"><a href="#cb2-174"></a></span>
<span id="cb2-175"><a href="#cb2-175"></a><span class="kw">public</span> <span class="dt">int</span> StartupWaitMs <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="dv">1500</span><span class="op">;</span></span>
<span id="cb2-176"><a href="#cb2-176"></a></span>
<span id="cb2-177"><a href="#cb2-177"></a><span class="kw">public</span> <span class="dt">int</span> RepoPollMs <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb2-178"><a href="#cb2-178"></a></span>
<span id="cb2-179"><a href="#cb2-179"></a><span class="kw">public</span> <span class="dt">int</span> RepoPollMax <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></span>
<span id="cb2-180"><a href="#cb2-180"></a></span>
<span id="cb2-181"><a href="#cb2-181"></a><span class="op">}</span></span>
<span id="cb2-182"><a href="#cb2-182"></a></span>
<span id="cb2-183"><a href="#cb2-183"></a><span class="co">// Attach to EA or launch new instance</span></span>
<span id="cb2-184"><a href="#cb2-184"></a></span>
<span id="cb2-185"><a href="#cb2-185"></a><span class="kw">public</span> <span class="kw">static</span> Session <span class="fu">AttachOrLaunch</span><span class="op">(</span>Options<span class="op">?</span> options <span class="op">=</span> <span class="kw">null</span><span class="op">)</span></span>
<span id="cb2-186"><a href="#cb2-186"></a></span>
<span id="cb2-187"><a href="#cb2-187"></a><span class="op">{</span></span>
<span id="cb2-188"><a href="#cb2-188"></a></span>
<span id="cb2-189"><a href="#cb2-189"></a>options <span class="op">??=</span> <span class="kw">new</span> <span class="fu">Options</span><span class="op">();</span></span>
<span id="cb2-190"><a href="#cb2-190"></a></span>
<span id="cb2-191"><a href="#cb2-191"></a>EA<span class="op">.</span><span class="fu">App</span><span class="op">?</span> app <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb2-192"><a href="#cb2-192"></a></span>
<span id="cb2-193"><a href="#cb2-193"></a><span class="kw">if</span> <span class="op">(</span>options<span class="op">.</span><span class="fu">PreferAttach</span><span class="op">)</span></span>
<span id="cb2-194"><a href="#cb2-194"></a></span>
<span id="cb2-195"><a href="#cb2-195"></a><span class="op">{</span></span>
<span id="cb2-196"><a href="#cb2-196"></a></span>
<span id="cb2-197"><a href="#cb2-197"></a><span class="kw">try</span> <span class="op">{</span> app <span class="op">=</span> <span class="op">(</span>EA<span class="op">.</span><span class="fu">App</span><span class="op">)</span>Marshal<span class="op">.</span><span class="fu">GetActiveObject</span><span class="op">(</span><span class="st">"EA.App"</span><span class="op">);</span> <span class="op">}</span></span>
<span id="cb2-198"><a href="#cb2-198"></a></span>
<span id="cb2-199"><a href="#cb2-199"></a><span class="kw">catch</span> <span class="op">{</span> <span class="op">/</span>\<span class="op">*</span> none running \<span class="op">*/</span> <span class="op">}</span></span>
<span id="cb2-200"><a href="#cb2-200"></a></span>
<span id="cb2-201"><a href="#cb2-201"></a><span class="op">}</span></span>
<span id="cb2-202"><a href="#cb2-202"></a></span>
<span id="cb2-203"><a href="#cb2-203"></a><span class="kw">if</span> <span class="op">(</span>app <span class="op">==</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> options<span class="op">.</span><span class="fu">LaunchIfNotRunning</span><span class="op">)</span></span>
<span id="cb2-204"><a href="#cb2-204"></a></span>
<span id="cb2-205"><a href="#cb2-205"></a><span class="op">{</span></span>
<span id="cb2-206"><a href="#cb2-206"></a></span>
<span id="cb2-207"><a href="#cb2-207"></a><span class="op">&gt;</span> Type t <span class="op">=</span> Type<span class="op">.</span><span class="fu">GetTypeFromProgID</span><span class="op">(</span><span class="st">"EA.App"</span><span class="op">)</span> <span class="op">??</span> <span class="kw">throw</span> <span class="kw">new</span></span>
<span id="cb2-208"><a href="#cb2-208"></a><span class="op">&gt;</span></span>
<span id="cb2-209"><a href="#cb2-209"></a><span class="op">&gt;</span> <span class="fu">InvalidOperationException</span><span class="op">(</span><span class="st">"EA not installed."</span><span class="op">);</span></span>
<span id="cb2-210"><a href="#cb2-210"></a></span>
<span id="cb2-211"><a href="#cb2-211"></a>app <span class="op">=</span> <span class="op">(</span>EA<span class="op">.</span><span class="fu">App</span><span class="op">)</span>Activator<span class="op">.</span><span class="fu">CreateInstance</span><span class="op">(</span>t<span class="op">)!;</span></span>
<span id="cb2-212"><a href="#cb2-212"></a></span>
<span id="cb2-213"><a href="#cb2-213"></a><span class="kw">if</span> <span class="op">(!</span>options<span class="op">.</span><span class="fu">ShowUI</span><span class="op">)</span> app<span class="op">.</span><span class="fu">Visible</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb2-214"><a href="#cb2-214"></a></span>
<span id="cb2-215"><a href="#cb2-215"></a>System<span class="op">.</span><span class="fu">Threading</span><span class="op">.</span><span class="fu">Thread</span><span class="op">.</span><span class="fu">Sleep</span><span class="op">(</span>options<span class="op">.</span><span class="fu">StartupWaitMs</span><span class="op">);</span></span>
<span id="cb2-216"><a href="#cb2-216"></a></span>
<span id="cb2-217"><a href="#cb2-217"></a><span class="op">}</span></span>
<span id="cb2-218"><a href="#cb2-218"></a></span>
<span id="cb2-219"><a href="#cb2-219"></a><span class="kw">if</span> <span class="op">(</span>app <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">InvalidOperationException</span><span class="op">(</span></span>
<span id="cb2-220"><a href="#cb2-220"></a></span>
<span id="cb2-221"><a href="#cb2-221"></a><span class="op">&gt;</span> <span class="st">"Unable to connect to EA."</span><span class="op">);</span></span>
<span id="cb2-222"><a href="#cb2-222"></a></span>
<span id="cb2-223"><a href="#cb2-223"></a>EA<span class="op">.</span><span class="fu">Repository</span> repo <span class="op">=</span> app<span class="op">.</span><span class="fu">Repository</span><span class="op">;</span></span>
<span id="cb2-224"><a href="#cb2-224"></a></span>
<span id="cb2-225"><a href="#cb2-225"></a><span class="co">// Poll until repository becomes available</span></span>
<span id="cb2-226"><a href="#cb2-226"></a></span>
<span id="cb2-227"><a href="#cb2-227"></a><span class="dt">int</span> polls <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-228"><a href="#cb2-228"></a></span>
<span id="cb2-229"><a href="#cb2-229"></a><span class="kw">while</span> <span class="op">(</span>repo <span class="op">==</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> polls \<span class="op">&lt;</span> options<span class="op">.</span><span class="fu">RepoPollMax</span><span class="op">)</span></span>
<span id="cb2-230"><a href="#cb2-230"></a></span>
<span id="cb2-231"><a href="#cb2-231"></a><span class="op">{</span></span>
<span id="cb2-232"><a href="#cb2-232"></a></span>
<span id="cb2-233"><a href="#cb2-233"></a>System<span class="op">.</span><span class="fu">Threading</span><span class="op">.</span><span class="fu">Thread</span><span class="op">.</span><span class="fu">Sleep</span><span class="op">(</span>options<span class="op">.</span><span class="fu">RepoPollMs</span><span class="op">);</span></span>
<span id="cb2-234"><a href="#cb2-234"></a></span>
<span id="cb2-235"><a href="#cb2-235"></a>repo <span class="op">=</span> app<span class="op">.</span><span class="fu">Repository</span><span class="op">;</span></span>
<span id="cb2-236"><a href="#cb2-236"></a></span>
<span id="cb2-237"><a href="#cb2-237"></a>polls<span class="op">++;</span></span>
<span id="cb2-238"><a href="#cb2-238"></a></span>
<span id="cb2-239"><a href="#cb2-239"></a><span class="op">}</span></span>
<span id="cb2-240"><a href="#cb2-240"></a></span>
<span id="cb2-241"><a href="#cb2-241"></a><span class="kw">if</span> <span class="op">(</span>repo <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">InvalidOperationException</span><span class="op">(</span><span class="st">"</span></span>
<span id="cb2-242"><a href="#cb2-242"></a></span>
<span id="cb2-243"><a href="#cb2-243"></a><span class="op">&gt;</span> EA<span class="op">.</span><span class="fu">Repository</span> did not initialise<span class="op">.</span><span class="st">");</span></span>
<span id="cb2-244"><a href="#cb2-244"></a></span>
<span id="cb2-245"><a href="#cb2-245"></a><span class="kw">if</span> <span class="op">(!</span><span class="dt">string</span><span class="op">.</span><span class="fu">IsNullOrWhiteSpace</span><span class="op">(</span>options<span class="op">.</span><span class="fu">ModelPath</span><span class="op">)</span> <span class="op">&amp;&amp;</span></span>
<span id="cb2-246"><a href="#cb2-246"></a></span>
<span id="cb2-247"><a href="#cb2-247"></a><span class="op">&gt;</span> <span class="dt">string</span><span class="op">.</span><span class="fu">IsNullOrWhiteSpace</span><span class="op">(</span>repo<span class="op">.</span><span class="fu">ConnectionString</span><span class="op">))</span></span>
<span id="cb2-248"><a href="#cb2-248"></a></span>
<span id="cb2-249"><a href="#cb2-249"></a>repo<span class="op">.</span><span class="fu">OpenFile</span><span class="op">(</span>options<span class="op">.</span><span class="fu">ModelPath</span><span class="op">);</span></span>
<span id="cb2-250"><a href="#cb2-250"></a></span>
<span id="cb2-251"><a href="#cb2-251"></a><span class="kw">return</span> <span class="kw">new</span> <span class="fu">Session</span><span class="op">(</span>app<span class="op">,</span> repo<span class="op">);</span></span>
<span id="cb2-252"><a href="#cb2-252"></a></span>
<span id="cb2-253"><a href="#cb2-253"></a><span class="op">}</span></span>
<span id="cb2-254"><a href="#cb2-254"></a></span>
<span id="cb2-255"><a href="#cb2-255"></a><span class="co">// Result container</span></span>
<span id="cb2-256"><a href="#cb2-256"></a></span>
<span id="cb2-257"><a href="#cb2-257"></a><span class="kw">public</span> <span class="kw">sealed</span> <span class="kw">class</span> Result</span>
<span id="cb2-258"><a href="#cb2-258"></a></span>
<span id="cb2-259"><a href="#cb2-259"></a><span class="op">{</span></span>
<span id="cb2-260"><a href="#cb2-260"></a></span>
<span id="cb2-261"><a href="#cb2-261"></a><span class="kw">public</span> <span class="dt">int</span> UpdatedCount <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb2-262"><a href="#cb2-262"></a></span>
<span id="cb2-263"><a href="#cb2-263"></a><span class="kw">public</span> <span class="dt">string</span> Summary <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb2-264"><a href="#cb2-264"></a></span>
<span id="cb2-265"><a href="#cb2-265"></a><span class="kw">public</span> <span class="dt">string</span><span class="op">?</span> LogPath <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb2-266"><a href="#cb2-266"></a></span>
<span id="cb2-267"><a href="#cb2-267"></a><span class="kw">public</span> <span class="dt">string</span><span class="op">?</span> ElementGuid <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb2-268"><a href="#cb2-268"></a></span>
<span id="cb2-269"><a href="#cb2-269"></a><span class="op">}</span></span>
<span id="cb2-270"><a href="#cb2-270"></a></span>
<span id="cb2-271"><a href="#cb2-271"></a><span class="co">// Add a new element safely</span></span>
<span id="cb2-272"><a href="#cb2-272"></a></span>
<span id="cb2-273"><a href="#cb2-273"></a><span class="kw">public</span> <span class="kw">static</span> Result <span class="fu">AddElement</span><span class="op">(</span>Repository repo<span class="op">,</span></span>
<span id="cb2-274"><a href="#cb2-274"></a></span>
<span id="cb2-275"><a href="#cb2-275"></a><span class="op">&gt;</span> Package targetPackage<span class="op">,</span></span>
<span id="cb2-276"><a href="#cb2-276"></a><span class="op">&gt;</span></span>
<span id="cb2-277"><a href="#cb2-277"></a><span class="op">&gt;</span> <span class="dt">string</span> name<span class="op">,</span></span>
<span id="cb2-278"><a href="#cb2-278"></a><span class="op">&gt;</span></span>
<span id="cb2-279"><a href="#cb2-279"></a><span class="op">&gt;</span> <span class="dt">string</span> type<span class="op">,</span></span>
<span id="cb2-280"><a href="#cb2-280"></a><span class="op">&gt;</span></span>
<span id="cb2-281"><a href="#cb2-281"></a><span class="op">&gt;</span> <span class="dt">string</span><span class="op">?</span> notes<span class="op">,</span> <span class="dt">bool</span> dryRun <span class="op">=</span> <span class="kw">true</span><span class="op">,</span> CsvLogger<span class="op">?</span> logger <span class="op">=</span> <span class="kw">null</span><span class="op">)</span></span>
<span id="cb2-282"><a href="#cb2-282"></a></span>
<span id="cb2-283"><a href="#cb2-283"></a><span class="op">{</span></span>
<span id="cb2-284"><a href="#cb2-284"></a></span>
<span id="cb2-285"><a href="#cb2-285"></a><span class="dt">var</span> el <span class="op">=</span> <span class="op">(</span>Element<span class="op">)</span>targetPackage<span class="op">.</span><span class="fu">Elements</span><span class="op">.</span><span class="fu">AddNew</span><span class="op">(</span>name<span class="op">,</span> type<span class="op">);</span></span>
<span id="cb2-286"><a href="#cb2-286"></a></span>
<span id="cb2-287"><a href="#cb2-287"></a><span class="kw">if</span> <span class="op">(!</span><span class="dt">string</span><span class="op">.</span><span class="fu">IsNullOrWhiteSpace</span><span class="op">(</span>notes<span class="op">))</span> el<span class="op">.</span><span class="fu">Notes</span> <span class="op">=</span> notes<span class="op">;</span></span>
<span id="cb2-288"><a href="#cb2-288"></a></span>
<span id="cb2-289"><a href="#cb2-289"></a><span class="kw">if</span> <span class="op">(</span>dryRun<span class="op">)</span></span>
<span id="cb2-290"><a href="#cb2-290"></a></span>
<span id="cb2-291"><a href="#cb2-291"></a><span class="op">{</span></span>
<span id="cb2-292"><a href="#cb2-292"></a></span>
<span id="cb2-293"><a href="#cb2-293"></a>logger<span class="op">?.</span><span class="fu">WriteRow</span><span class="op">(</span>DateTime<span class="op">.</span><span class="fu">Now</span><span class="op">,</span> <span class="st">"DRYRUN"</span><span class="op">,</span></span>
<span id="cb2-294"><a href="#cb2-294"></a></span>
<span id="cb2-295"><a href="#cb2-295"></a><span class="op">&gt;</span> targetPackage<span class="op">.</span><span class="fu">PackageID</span><span class="op">,</span></span>
<span id="cb2-296"><a href="#cb2-296"></a><span class="op">&gt;</span></span>
<span id="cb2-297"><a href="#cb2-297"></a><span class="op">&gt;</span> <span class="st">""</span><span class="op">,</span> name<span class="op">,</span> type<span class="op">,</span> notes <span class="op">??</span> <span class="st">""</span><span class="op">);</span></span>
<span id="cb2-298"><a href="#cb2-298"></a></span>
<span id="cb2-299"><a href="#cb2-299"></a><span class="kw">return</span> <span class="kw">new</span> Result <span class="op">{</span> UpdatedCount <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb2-300"><a href="#cb2-300"></a></span>
<span id="cb2-301"><a href="#cb2-301"></a><span class="op">&gt;</span> Summary <span class="op">=</span> \$<span class="st">"\[DRYRUN\] Would create: {name} ({type})"</span> <span class="op">};</span></span>
<span id="cb2-302"><a href="#cb2-302"></a></span>
<span id="cb2-303"><a href="#cb2-303"></a><span class="op">}</span></span>
<span id="cb2-304"><a href="#cb2-304"></a></span>
<span id="cb2-305"><a href="#cb2-305"></a><span class="kw">if</span> <span class="op">(!</span>el<span class="op">.</span><span class="fu">Update</span><span class="op">())</span></span>
<span id="cb2-306"><a href="#cb2-306"></a></span>
<span id="cb2-307"><a href="#cb2-307"></a><span class="kw">throw</span> <span class="kw">new</span> <span class="fu">InvalidOperationException</span><span class="op">(</span></span>
<span id="cb2-308"><a href="#cb2-308"></a></span>
<span id="cb2-309"><a href="#cb2-309"></a><span class="op">&gt;</span> <span class="st">"Element.Update() failed."</span><span class="op">);</span></span>
<span id="cb2-310"><a href="#cb2-310"></a></span>
<span id="cb2-311"><a href="#cb2-311"></a>repo<span class="op">.</span><span class="fu">RefreshModelView</span><span class="op">(</span>targetPackage<span class="op">.</span><span class="fu">PackageID</span><span class="op">);</span></span>
<span id="cb2-312"><a href="#cb2-312"></a></span>
<span id="cb2-313"><a href="#cb2-313"></a>logger<span class="op">?.</span><span class="fu">WriteRow</span><span class="op">(</span>DateTime<span class="op">.</span><span class="fu">Now</span><span class="op">,</span> <span class="st">"CREATE"</span><span class="op">,</span></span>
<span id="cb2-314"><a href="#cb2-314"></a></span>
<span id="cb2-315"><a href="#cb2-315"></a><span class="op">&gt;</span> targetPackage<span class="op">.</span><span class="fu">PackageID</span><span class="op">,</span></span>
<span id="cb2-316"><a href="#cb2-316"></a><span class="op">&gt;</span></span>
<span id="cb2-317"><a href="#cb2-317"></a><span class="op">&gt;</span> el<span class="op">.</span><span class="fu">ElementGUID</span><span class="op">,</span> name<span class="op">,</span> type<span class="op">,</span> notes <span class="op">??</span> <span class="st">""</span><span class="op">);</span></span>
<span id="cb2-318"><a href="#cb2-318"></a></span>
<span id="cb2-319"><a href="#cb2-319"></a><span class="kw">return</span> <span class="kw">new</span> Result</span>
<span id="cb2-320"><a href="#cb2-320"></a></span>
<span id="cb2-321"><a href="#cb2-321"></a><span class="op">{</span></span>
<span id="cb2-322"><a href="#cb2-322"></a></span>
<span id="cb2-323"><a href="#cb2-323"></a>UpdatedCount <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb2-324"><a href="#cb2-324"></a></span>
<span id="cb2-325"><a href="#cb2-325"></a>Summary <span class="op">=</span> \$<span class="st">"Created element: {name} ({type})"</span><span class="op">,</span></span>
<span id="cb2-326"><a href="#cb2-326"></a></span>
<span id="cb2-327"><a href="#cb2-327"></a>ElementGuid <span class="op">=</span> el<span class="op">.</span><span class="fu">ElementGUID</span><span class="op">,</span></span>
<span id="cb2-328"><a href="#cb2-328"></a></span>
<span id="cb2-329"><a href="#cb2-329"></a>LogPath <span class="op">=</span> logger<span class="op">?.</span><span class="fu">Path</span></span>
<span id="cb2-330"><a href="#cb2-330"></a></span>
<span id="cb2-331"><a href="#cb2-331"></a><span class="op">};</span></span>
<span id="cb2-332"><a href="#cb2-332"></a></span>
<span id="cb2-333"><a href="#cb2-333"></a><span class="op">}</span></span>
<span id="cb2-334"><a href="#cb2-334"></a></span>
<span id="cb2-335"><a href="#cb2-335"></a><span class="co">// CSV logger</span></span>
<span id="cb2-336"><a href="#cb2-336"></a></span>
<span id="cb2-337"><a href="#cb2-337"></a><span class="kw">public</span> <span class="kw">sealed</span> <span class="kw">class</span> CsvLogger <span class="op">:</span> IDisposable</span>
<span id="cb2-338"><a href="#cb2-338"></a></span>
<span id="cb2-339"><a href="#cb2-339"></a><span class="op">{</span></span>
<span id="cb2-340"><a href="#cb2-340"></a></span>
<span id="cb2-341"><a href="#cb2-341"></a><span class="kw">private</span> <span class="kw">readonly</span> StreamWriter \_writer<span class="op">;</span></span>
<span id="cb2-342"><a href="#cb2-342"></a></span>
<span id="cb2-343"><a href="#cb2-343"></a><span class="kw">public</span> <span class="dt">string</span> Path <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb2-344"><a href="#cb2-344"></a></span>
<span id="cb2-345"><a href="#cb2-345"></a><span class="kw">private</span> <span class="fu">CsvLogger</span><span class="op">(</span><span class="dt">string</span> path<span class="op">)</span></span>
<span id="cb2-346"><a href="#cb2-346"></a></span>
<span id="cb2-347"><a href="#cb2-347"></a><span class="op">{</span></span>
<span id="cb2-348"><a href="#cb2-348"></a></span>
<span id="cb2-349"><a href="#cb2-349"></a>Path <span class="op">=</span> path<span class="op">;</span></span>
<span id="cb2-350"><a href="#cb2-350"></a></span>
<span id="cb2-351"><a href="#cb2-351"></a>\_writer <span class="op">=</span> <span class="kw">new</span> <span class="fu">StreamWriter</span><span class="op">(</span>path<span class="op">,</span> append<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb2-352"><a href="#cb2-352"></a></span>
<span id="cb2-353"><a href="#cb2-353"></a><span class="op">&gt;</span> System<span class="op">.</span><span class="fu">Text</span><span class="op">.</span><span class="fu">Encoding</span><span class="op">.</span><span class="fu">UTF8</span><span class="op">);</span></span>
<span id="cb2-354"><a href="#cb2-354"></a></span>
<span id="cb2-355"><a href="#cb2-355"></a><span class="op">}</span></span>
<span id="cb2-356"><a href="#cb2-356"></a></span>
<span id="cb2-357"><a href="#cb2-357"></a><span class="kw">public</span> <span class="kw">static</span> CsvLogger <span class="fu">Open</span><span class="op">(</span><span class="dt">string</span> path<span class="op">)</span> <span class="op">=</span>\<span class="op">&gt;</span></span>
<span id="cb2-358"><a href="#cb2-358"></a></span>
<span id="cb2-359"><a href="#cb2-359"></a><span class="op">&gt;</span> <span class="kw">new</span> <span class="fu">CsvLogger</span><span class="op">(</span>path<span class="op">);</span></span>
<span id="cb2-360"><a href="#cb2-360"></a></span>
<span id="cb2-361"><a href="#cb2-361"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">WriteHeader</span><span class="op">(</span><span class="dt">string</span> header<span class="op">)</span> <span class="op">=</span>\<span class="op">&gt;</span></span>
<span id="cb2-362"><a href="#cb2-362"></a></span>
<span id="cb2-363"><a href="#cb2-363"></a>\_writer<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>header<span class="op">);</span></span>
<span id="cb2-364"><a href="#cb2-364"></a></span>
<span id="cb2-365"><a href="#cb2-365"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">WriteRow</span><span class="op">(</span><span class="kw">params</span> <span class="dt">object</span><span class="op">?</span>\<span class="op">[</span>\<span class="op">]</span> cols<span class="op">)</span></span>
<span id="cb2-366"><a href="#cb2-366"></a></span>
<span id="cb2-367"><a href="#cb2-367"></a><span class="op">=</span>\<span class="op">&gt;</span> \_writer<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="dt">string</span><span class="op">.</span><span class="fu">Join</span><span class="op">(</span><span class="st">","</span><span class="op">,</span></span>
<span id="cb2-368"><a href="#cb2-368"></a></span>
<span id="cb2-369"><a href="#cb2-369"></a><span class="op">&gt;</span> Array<span class="op">.</span><span class="fu">ConvertAll</span><span class="op">(</span>cols<span class="op">,</span> c <span class="op">=</span>\<span class="op">&gt;</span> c<span class="op">?.</span><span class="fu">ToString</span><span class="op">()</span> <span class="op">??</span> <span class="st">""</span><span class="op">)));</span></span>
<span id="cb2-370"><a href="#cb2-370"></a></span>
<span id="cb2-371"><a href="#cb2-371"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">Close</span><span class="op">()</span> <span class="op">=</span>\<span class="op">&gt;</span> \_writer<span class="op">.</span><span class="fu">Flush</span><span class="op">();</span></span>
<span id="cb2-372"><a href="#cb2-372"></a></span>
<span id="cb2-373"><a href="#cb2-373"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">Dispose</span><span class="op">()</span> <span class="op">=</span>\<span class="op">&gt;</span> \_writer<span class="op">.</span><span class="fu">Dispose</span><span class="op">();</span></span>
<span id="cb2-374"><a href="#cb2-374"></a></span>
<span id="cb2-375"><a href="#cb2-375"></a><span class="op">}</span></span>
<span id="cb2-376"><a href="#cb2-376"></a></span>
<span id="cb2-377"><a href="#cb2-377"></a><span class="op">}</span></span>
<span id="cb2-378"><a href="#cb2-378"></a></span>
<span id="cb2-379"><a href="#cb2-379"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="e.4-configuration-setup" class="level2">
<h2 class="anchored" data-anchor-id="e.4-configuration-setup">E.4 Configuration &amp; Setup</h2>
<section id="bitness" class="level3">
<h3 class="anchored" data-anchor-id="bitness">Bitness</h3>
<ul>
<li><p>EA 16+ is usually <strong>64-bit</strong>.</p></li>
<li><p>Match your project’s &lt;PlatformTarget&gt; to EA’s bitness (x64 or x86).</p></li>
</ul>
</section>
<section id="interop.ea.dll" class="level3">
<h3 class="anchored" data-anchor-id="interop.ea.dll">Interop.EA.dll</h3>
<ul>
<li><p>Found in EA install folder.</p></li>
<li><p>Add as a reference in your .NET project.</p></li>
</ul>
</section>
<section id="stathread" class="level3">
<h3 class="anchored" data-anchor-id="stathread">STAThread</h3>
<ul>
<li>COM automation requires [STAThread] on your entry point.</li>
</ul>
</section>
<section id="model-files" class="level3">
<h3 class="anchored" data-anchor-id="model-files">Model Files</h3>
<ul>
<li><p>Use .qea / .qeax / .eapx.</p></li>
<li><p>Options.ModelPath can auto-open a file if none is open.</p></li>
</ul>
</section>
<section id="dry-run-logging" class="level3">
<h3 class="anchored" data-anchor-id="dry-run-logging">Dry Run &amp; Logging</h3>
<ul>
<li><p>Always start in dryRun = true.</p></li>
<li><p>Review the generated CSV log before committing real updates.</p></li>
</ul>
</section>
<section id="distribution" class="level3">
<h3 class="anchored" data-anchor-id="distribution">Distribution</h3>
<ul>
<li><p>Package as a console utility or integrate into CI/CD.</p></li>
<li><p>Keep EAConnect.cs in a shared library for consistency.</p></li>
</ul>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script>

document.addEventListener('DOMContentLoaded', function () {

  // Prefer the margin sidebar if it exists; otherwise try the TOC sidebar.

  const margin = document.querySelector('#quarto-margin-sidebar, .margin-sidebar, .column-margin');

  const toc    = document.querySelector('nav#TOC');

  const sidebar = margin || (toc && toc.closest('.sidebar, .quarto-sidebar, .margin-sidebar'));



  if (!sidebar) return; // no margin column on this layout



  const holder = document.createElement('div');

  holder.className = 'cover-above-toc';

  holder.innerHTML = `

    <a href="index.html">

      <img src="images/cover.png" alt="Book cover" class="cover-above-toc__img" width="140" />

    </a>

  `;

  sidebar.prepend(holder);

});

</script>



<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./26-System.Object[].html" class="pagination-link" aria-label="Appendix D: Quick Reference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Appendix D: Quick Reference</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu"># Appendix E: External Automation Setup</span></span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a>This appendix provides the reusable EAConnect helper class plus the</span>
<span id="cb3-4"><a href="#cb3-4"></a>configuration details required to build external automation tools</span>
<span id="cb3-5"><a href="#cb3-5"></a>against Enterprise Architect (EA). It is intended as the “plumbing”</span>
<span id="cb3-6"><a href="#cb3-6"></a>layer behind the example in **Chapter 6 – External Automation**.</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="fu">## E.1 Purpose</span></span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a>The EAConnect helper abstracts the complexities of EA’s COM interface</span>
<span id="cb3-11"><a href="#cb3-11"></a>and standardises safety practices:</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="ss">- </span>Attaching to or launching EA consistently</span>
<span id="cb3-14"><a href="#cb3-14"></a></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="ss">- </span>Waiting for the Repository to become available</span>
<span id="cb3-16"><a href="#cb3-16"></a></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="ss">- </span>Opening models automatically if needed</span>
<span id="cb3-18"><a href="#cb3-18"></a></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="ss">- </span>Handling bitness and Interop.EA.dll</span>
<span id="cb3-20"><a href="#cb3-20"></a></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="ss">- </span>Providing safe wrappers for common tasks (find package, add element,</span>
<span id="cb3-22"><a href="#cb3-22"></a>  add tagged value)</span>
<span id="cb3-23"><a href="#cb3-23"></a></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="ss">- </span>Enforcing **dry-run by default**</span>
<span id="cb3-25"><a href="#cb3-25"></a></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="ss">- </span>Writing CSV audit logs with auto-derived filenames</span>
<span id="cb3-27"><a href="#cb3-27"></a></span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="ss">- </span>Refreshing EA’s UI at sensible points</span>
<span id="cb3-29"><a href="#cb3-29"></a></span>
<span id="cb3-30"><a href="#cb3-30"></a>With this helper, your utilities focus on intent rather than</span>
<span id="cb3-31"><a href="#cb3-31"></a>boilerplate.</span>
<span id="cb3-32"><a href="#cb3-32"></a></span>
<span id="cb3-33"><a href="#cb3-33"></a><span class="fu">## E.2 Usage</span></span>
<span id="cb3-34"><a href="#cb3-34"></a></span>
<span id="cb3-35"><a href="#cb3-35"></a>A minimal program using the helper:</span>
<span id="cb3-36"><a href="#cb3-36"></a><span class="in">```csharp</span></span>
<span id="cb3-37"><a href="#cb3-37"></a></span>
<span id="cb3-38"><a href="#cb3-38"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb3-39"><a href="#cb3-39"></a></span>
<span id="cb3-40"><a href="#cb3-40"></a><span class="kw">using</span> EA<span class="op">;</span></span>
<span id="cb3-41"><a href="#cb3-41"></a></span>
<span id="cb3-42"><a href="#cb3-42"></a><span class="kw">using</span> EA<span class="op">.</span><span class="fu">Automation</span><span class="op">;</span> <span class="co">// the helper namespace</span></span>
<span id="cb3-43"><a href="#cb3-43"></a></span>
<span id="cb3-44"><a href="#cb3-44"></a><span class="kw">class</span> Program</span>
<span id="cb3-45"><a href="#cb3-45"></a></span>
<span id="cb3-46"><a href="#cb3-46"></a><span class="op">{</span></span>
<span id="cb3-47"><a href="#cb3-47"></a></span>
<span id="cb3-48"><a href="#cb3-48"></a>\<span class="op">[</span>STAThread\<span class="op">]</span></span>
<span id="cb3-49"><a href="#cb3-49"></a></span>
<span id="cb3-50"><a href="#cb3-50"></a><span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span><span class="op">(</span><span class="dt">string</span>\<span class="op">[</span>\<span class="op">]</span> args<span class="op">)</span></span>
<span id="cb3-51"><a href="#cb3-51"></a></span>
<span id="cb3-52"><a href="#cb3-52"></a><span class="op">{</span></span>
<span id="cb3-53"><a href="#cb3-53"></a></span>
<span id="cb3-54"><a href="#cb3-54"></a><span class="kw">using</span> <span class="dt">var</span> ea <span class="op">=</span> EAConnect<span class="op">.</span><span class="fu">AttachOrLaunch</span><span class="op">(</span><span class="kw">new</span> EAConnect<span class="op">.</span><span class="fu">Options</span> <span class="op">{</span> ShowUI <span class="op">=</span></span>
<span id="cb3-55"><a href="#cb3-55"></a><span class="kw">true</span> <span class="op">});</span></span>
<span id="cb3-56"><a href="#cb3-56"></a></span>
<span id="cb3-57"><a href="#cb3-57"></a>Package pkg <span class="op">=</span> ea<span class="op">.</span><span class="fu">GetSelectedPackageOrRoot</span><span class="op">();</span></span>
<span id="cb3-58"><a href="#cb3-58"></a></span>
<span id="cb3-59"><a href="#cb3-59"></a><span class="dt">var</span> result <span class="op">=</span> EAConnect<span class="op">.</span><span class="fu">AddElement</span><span class="op">(</span>ea<span class="op">.</span><span class="fu">Repo</span><span class="op">,</span> pkg<span class="op">,</span> <span class="st">"DemoClass"</span><span class="op">,</span> <span class="st">"Class"</span><span class="op">,</span></span>
<span id="cb3-60"><a href="#cb3-60"></a></span>
<span id="cb3-61"><a href="#cb3-61"></a><span class="st">"Created by EAConnect."</span><span class="op">,</span> dryRun<span class="op">:</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb3-62"><a href="#cb3-62"></a></span>
<span id="cb3-63"><a href="#cb3-63"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>result<span class="op">.</span><span class="fu">Summary</span><span class="op">);</span></span>
<span id="cb3-64"><a href="#cb3-64"></a></span>
<span id="cb3-65"><a href="#cb3-65"></a><span class="op">}</span></span>
<span id="cb3-66"><a href="#cb3-66"></a></span>
<span id="cb3-67"><a href="#cb3-67"></a><span class="op">}</span></span>
<span id="cb3-68"><a href="#cb3-68"></a><span class="in">```</span></span>
<span id="cb3-69"><a href="#cb3-69"></a></span>
<span id="cb3-70"><a href="#cb3-70"></a>This pattern keeps the Program.cs short and declarative. All detailed</span>
<span id="cb3-71"><a href="#cb3-71"></a>logic resides in the helper.</span>
<span id="cb3-72"><a href="#cb3-72"></a></span>
<span id="cb3-73"><a href="#cb3-73"></a><span class="fu">## E.3 The EAConnect Helper Class</span></span>
<span id="cb3-74"><a href="#cb3-74"></a><span class="in">```csharp</span></span>
<span id="cb3-75"><a href="#cb3-75"></a><span class="co">//</span></span>
<span id="cb3-76"><a href="#cb3-76"></a><span class="op">=======================================================================</span></span>
<span id="cb3-77"><a href="#cb3-77"></a></span>
<span id="cb3-78"><a href="#cb3-78"></a><span class="co">// File: EAConnect.cs</span></span>
<span id="cb3-79"><a href="#cb3-79"></a></span>
<span id="cb3-80"><a href="#cb3-80"></a><span class="co">// Project: EA Automation Helper</span></span>
<span id="cb3-81"><a href="#cb3-81"></a></span>
<span id="cb3-82"><a href="#cb3-82"></a><span class="co">// Author: \&lt;Your Name\&gt;</span></span>
<span id="cb3-83"><a href="#cb3-83"></a></span>
<span id="cb3-84"><a href="#cb3-84"></a><span class="co">// Created: 2025-08-31</span></span>
<span id="cb3-85"><a href="#cb3-85"></a></span>
<span id="cb3-86"><a href="#cb3-86"></a><span class="co">// Last Update: 2025-08-31</span></span>
<span id="cb3-87"><a href="#cb3-87"></a></span>
<span id="cb3-88"><a href="#cb3-88"></a><span class="co">//</span></span>
<span id="cb3-89"><a href="#cb3-89"></a></span>
<span id="cb3-90"><a href="#cb3-90"></a><span class="co">// PURPOSE</span></span>
<span id="cb3-91"><a href="#cb3-91"></a></span>
<span id="cb3-92"><a href="#cb3-92"></a><span class="co">// -------</span></span>
<span id="cb3-93"><a href="#cb3-93"></a></span>
<span id="cb3-94"><a href="#cb3-94"></a><span class="co">// Provides a safe, reusable abstraction over EA’s COM automation API.</span></span>
<span id="cb3-95"><a href="#cb3-95"></a></span>
<span id="cb3-96"><a href="#cb3-96"></a><span class="co">// Handles: attach/launch, repository polling, model open, package</span></span>
<span id="cb3-97"><a href="#cb3-97"></a></span>
<span id="cb3-98"><a href="#cb3-98"></a><span class="co">// resolution,</span></span>
<span id="cb3-99"><a href="#cb3-99"></a></span>
<span id="cb3-100"><a href="#cb3-100"></a><span class="co">// element creation, tagged value creation, CSV logging, and UI refresh.</span></span>
<span id="cb3-101"><a href="#cb3-101"></a></span>
<span id="cb3-102"><a href="#cb3-102"></a><span class="co">//</span></span>
<span id="cb3-103"><a href="#cb3-103"></a></span>
<span id="cb3-104"><a href="#cb3-104"></a><span class="co">// USAGE</span></span>
<span id="cb3-105"><a href="#cb3-105"></a></span>
<span id="cb3-106"><a href="#cb3-106"></a><span class="co">// -----</span></span>
<span id="cb3-107"><a href="#cb3-107"></a></span>
<span id="cb3-108"><a href="#cb3-108"></a><span class="co">// using var ea = EAConnect.AttachOrLaunch(new EAConnect.Options {</span></span>
<span id="cb3-109"><a href="#cb3-109"></a></span>
<span id="cb3-110"><a href="#cb3-110"></a><span class="co">// ShowUI = true });</span></span>
<span id="cb3-111"><a href="#cb3-111"></a></span>
<span id="cb3-112"><a href="#cb3-112"></a><span class="co">// var pkg = ea.GetSelectedPackageOrRoot();</span></span>
<span id="cb3-113"><a href="#cb3-113"></a></span>
<span id="cb3-114"><a href="#cb3-114"></a><span class="co">// var result = EAConnect.AddElement(ea.Repo, pkg, "NewClass", "Class",</span></span>
<span id="cb3-115"><a href="#cb3-115"></a></span>
<span id="cb3-116"><a href="#cb3-116"></a><span class="co">// "Notes", true);</span></span>
<span id="cb3-117"><a href="#cb3-117"></a></span>
<span id="cb3-118"><a href="#cb3-118"></a><span class="co">// Console.WriteLine(result.Summary);</span></span>
<span id="cb3-119"><a href="#cb3-119"></a></span>
<span id="cb3-120"><a href="#cb3-120"></a><span class="co">//</span></span>
<span id="cb3-121"><a href="#cb3-121"></a></span>
<span id="cb3-122"><a href="#cb3-122"></a><span class="co">// ASSUMPTIONS</span></span>
<span id="cb3-123"><a href="#cb3-123"></a></span>
<span id="cb3-124"><a href="#cb3-124"></a><span class="co">// -----------</span></span>
<span id="cb3-125"><a href="#cb3-125"></a></span>
<span id="cb3-126"><a href="#cb3-126"></a><span class="co">// - EA is installed and COM-registered (ProgID = "EA.App").</span></span>
<span id="cb3-127"><a href="#cb3-127"></a></span>
<span id="cb3-128"><a href="#cb3-128"></a><span class="co">// - Interop.EA.dll referenced (from EA install folder).</span></span>
<span id="cb3-129"><a href="#cb3-129"></a></span>
<span id="cb3-130"><a href="#cb3-130"></a><span class="co">// - Bitness of project matches EA (x64 for EA 64-bit; x86 for 32-bit).</span></span>
<span id="cb3-131"><a href="#cb3-131"></a></span>
<span id="cb3-132"><a href="#cb3-132"></a><span class="co">// - .NET project marked \[STAThread\] on entry point.</span></span>
<span id="cb3-133"><a href="#cb3-133"></a></span>
<span id="cb3-134"><a href="#cb3-134"></a><span class="co">//</span></span>
<span id="cb3-135"><a href="#cb3-135"></a></span>
<span id="cb3-136"><a href="#cb3-136"></a><span class="co">// SAFETY</span></span>
<span id="cb3-137"><a href="#cb3-137"></a></span>
<span id="cb3-138"><a href="#cb3-138"></a><span class="co">// ------</span></span>
<span id="cb3-139"><a href="#cb3-139"></a></span>
<span id="cb3-140"><a href="#cb3-140"></a><span class="co">// - Dry-run enabled by default in sample programs.</span></span>
<span id="cb3-141"><a href="#cb3-141"></a></span>
<span id="cb3-142"><a href="#cb3-142"></a><span class="co">// - CSV audit logging for all writes.</span></span>
<span id="cb3-143"><a href="#cb3-143"></a></span>
<span id="cb3-144"><a href="#cb3-144"></a><span class="co">// - UI refresh at batch boundaries only.</span></span>
<span id="cb3-145"><a href="#cb3-145"></a></span>
<span id="cb3-146"><a href="#cb3-146"></a><span class="co">//</span></span>
<span id="cb3-147"><a href="#cb3-147"></a></span>
<span id="cb3-148"><a href="#cb3-148"></a><span class="co">// DEPENDENCIES</span></span>
<span id="cb3-149"><a href="#cb3-149"></a></span>
<span id="cb3-150"><a href="#cb3-150"></a><span class="co">// ------------</span></span>
<span id="cb3-151"><a href="#cb3-151"></a></span>
<span id="cb3-152"><a href="#cb3-152"></a><span class="co">// - System.Runtime.InteropServices (Marshal.GetActiveObject).</span></span>
<span id="cb3-153"><a href="#cb3-153"></a></span>
<span id="cb3-154"><a href="#cb3-154"></a><span class="co">// - Interop.EA.dll.</span></span>
<span id="cb3-155"><a href="#cb3-155"></a></span>
<span id="cb3-156"><a href="#cb3-156"></a><span class="co">//</span></span>
<span id="cb3-157"><a href="#cb3-157"></a></span>
<span id="cb3-158"><a href="#cb3-158"></a><span class="co">// UPDATE HISTORY</span></span>
<span id="cb3-159"><a href="#cb3-159"></a></span>
<span id="cb3-160"><a href="#cb3-160"></a><span class="co">// --------------</span></span>
<span id="cb3-161"><a href="#cb3-161"></a></span>
<span id="cb3-162"><a href="#cb3-162"></a><span class="co">// - 2025-08-31: Initial helper version.</span></span>
<span id="cb3-163"><a href="#cb3-163"></a></span>
<span id="cb3-164"><a href="#cb3-164"></a><span class="co">//</span></span>
<span id="cb3-165"><a href="#cb3-165"></a><span class="op">=======================================================================</span></span>
<span id="cb3-166"><a href="#cb3-166"></a></span>
<span id="cb3-167"><a href="#cb3-167"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb3-168"><a href="#cb3-168"></a></span>
<span id="cb3-169"><a href="#cb3-169"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">IO</span><span class="op">;</span></span>
<span id="cb3-170"><a href="#cb3-170"></a></span>
<span id="cb3-171"><a href="#cb3-171"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Runtime</span><span class="op">.</span><span class="fu">InteropServices</span><span class="op">;</span></span>
<span id="cb3-172"><a href="#cb3-172"></a></span>
<span id="cb3-173"><a href="#cb3-173"></a><span class="kw">using</span> EA<span class="op">;</span></span>
<span id="cb3-174"><a href="#cb3-174"></a></span>
<span id="cb3-175"><a href="#cb3-175"></a><span class="kw">namespace</span> EA<span class="op">.</span><span class="fu">Automation</span></span>
<span id="cb3-176"><a href="#cb3-176"></a></span>
<span id="cb3-177"><a href="#cb3-177"></a><span class="op">{</span></span>
<span id="cb3-178"><a href="#cb3-178"></a></span>
<span id="cb3-179"><a href="#cb3-179"></a><span class="kw">public</span> <span class="kw">static</span> <span class="kw">class</span> EAConnect</span>
<span id="cb3-180"><a href="#cb3-180"></a></span>
<span id="cb3-181"><a href="#cb3-181"></a><span class="op">{</span></span>
<span id="cb3-182"><a href="#cb3-182"></a></span>
<span id="cb3-183"><a href="#cb3-183"></a><span class="co">// Encapsulates a connected EA session</span></span>
<span id="cb3-184"><a href="#cb3-184"></a></span>
<span id="cb3-185"><a href="#cb3-185"></a><span class="kw">public</span> <span class="kw">sealed</span> <span class="kw">class</span> Session <span class="op">:</span> IDisposable</span>
<span id="cb3-186"><a href="#cb3-186"></a></span>
<span id="cb3-187"><a href="#cb3-187"></a><span class="op">{</span></span>
<span id="cb3-188"><a href="#cb3-188"></a></span>
<span id="cb3-189"><a href="#cb3-189"></a><span class="kw">public</span> EA<span class="op">.</span><span class="fu">App</span> App <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb3-190"><a href="#cb3-190"></a></span>
<span id="cb3-191"><a href="#cb3-191"></a><span class="kw">public</span> EA<span class="op">.</span><span class="fu">Repository</span> Repo <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb3-192"><a href="#cb3-192"></a></span>
<span id="cb3-193"><a href="#cb3-193"></a><span class="kw">internal</span> <span class="fu">Session</span><span class="op">(</span>EA<span class="op">.</span><span class="fu">App</span> app<span class="op">,</span> EA<span class="op">.</span><span class="fu">Repository</span> repo<span class="op">)</span></span>
<span id="cb3-194"><a href="#cb3-194"></a></span>
<span id="cb3-195"><a href="#cb3-195"></a><span class="op">{</span></span>
<span id="cb3-196"><a href="#cb3-196"></a></span>
<span id="cb3-197"><a href="#cb3-197"></a>App <span class="op">=</span> app<span class="op">;</span></span>
<span id="cb3-198"><a href="#cb3-198"></a></span>
<span id="cb3-199"><a href="#cb3-199"></a>Repo <span class="op">=</span> repo<span class="op">;</span></span>
<span id="cb3-200"><a href="#cb3-200"></a></span>
<span id="cb3-201"><a href="#cb3-201"></a><span class="op">}</span></span>
<span id="cb3-202"><a href="#cb3-202"></a></span>
<span id="cb3-203"><a href="#cb3-203"></a><span class="kw">public</span> Package <span class="fu">GetSelectedPackageOrRoot</span><span class="op">()</span></span>
<span id="cb3-204"><a href="#cb3-204"></a></span>
<span id="cb3-205"><a href="#cb3-205"></a><span class="op">{</span></span>
<span id="cb3-206"><a href="#cb3-206"></a></span>
<span id="cb3-207"><a href="#cb3-207"></a>Package<span class="op">?</span> pkg <span class="op">=</span> Repo<span class="op">.</span><span class="fu">GetTreeSelectedPackage</span><span class="op">();</span></span>
<span id="cb3-208"><a href="#cb3-208"></a></span>
<span id="cb3-209"><a href="#cb3-209"></a><span class="kw">if</span> <span class="op">(</span>pkg <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="kw">return</span> pkg<span class="op">;</span></span>
<span id="cb3-210"><a href="#cb3-210"></a></span>
<span id="cb3-211"><a href="#cb3-211"></a><span class="kw">if</span> <span class="op">(</span>Repo<span class="op">.</span><span class="fu">Models</span><span class="op">.</span><span class="fu">Count</span> \<span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="kw">return</span></span>
<span id="cb3-212"><a href="#cb3-212"></a></span>
<span id="cb3-213"><a href="#cb3-213"></a><span class="op">&gt;</span> <span class="op">(</span>Package<span class="op">)</span>Repo<span class="op">.</span><span class="fu">Models</span><span class="op">.</span><span class="fu">GetAt</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb3-214"><a href="#cb3-214"></a></span>
<span id="cb3-215"><a href="#cb3-215"></a><span class="kw">throw</span> <span class="kw">new</span> <span class="fu">InvalidOperationException</span><span class="op">(</span></span>
<span id="cb3-216"><a href="#cb3-216"></a></span>
<span id="cb3-217"><a href="#cb3-217"></a><span class="op">&gt;</span> <span class="st">"No package available in repository."</span><span class="op">);</span></span>
<span id="cb3-218"><a href="#cb3-218"></a></span>
<span id="cb3-219"><a href="#cb3-219"></a><span class="op">}</span></span>
<span id="cb3-220"><a href="#cb3-220"></a></span>
<span id="cb3-221"><a href="#cb3-221"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">Dispose</span><span class="op">()</span></span>
<span id="cb3-222"><a href="#cb3-222"></a></span>
<span id="cb3-223"><a href="#cb3-223"></a><span class="op">{</span></span>
<span id="cb3-224"><a href="#cb3-224"></a></span>
<span id="cb3-225"><a href="#cb3-225"></a><span class="co">// Release COM references cleanly</span></span>
<span id="cb3-226"><a href="#cb3-226"></a></span>
<span id="cb3-227"><a href="#cb3-227"></a>Marshal<span class="op">.</span><span class="fu">ReleaseComObject</span><span class="op">(</span>Repo<span class="op">);</span></span>
<span id="cb3-228"><a href="#cb3-228"></a></span>
<span id="cb3-229"><a href="#cb3-229"></a>Marshal<span class="op">.</span><span class="fu">ReleaseComObject</span><span class="op">(</span>App<span class="op">);</span></span>
<span id="cb3-230"><a href="#cb3-230"></a></span>
<span id="cb3-231"><a href="#cb3-231"></a><span class="op">}</span></span>
<span id="cb3-232"><a href="#cb3-232"></a></span>
<span id="cb3-233"><a href="#cb3-233"></a><span class="op">}</span></span>
<span id="cb3-234"><a href="#cb3-234"></a></span>
<span id="cb3-235"><a href="#cb3-235"></a><span class="co">// Options for attaching or launching EA</span></span>
<span id="cb3-236"><a href="#cb3-236"></a></span>
<span id="cb3-237"><a href="#cb3-237"></a><span class="kw">public</span> <span class="kw">sealed</span> <span class="kw">class</span> Options</span>
<span id="cb3-238"><a href="#cb3-238"></a></span>
<span id="cb3-239"><a href="#cb3-239"></a><span class="op">{</span></span>
<span id="cb3-240"><a href="#cb3-240"></a></span>
<span id="cb3-241"><a href="#cb3-241"></a><span class="kw">public</span> <span class="dt">bool</span> PreferAttach <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb3-242"><a href="#cb3-242"></a></span>
<span id="cb3-243"><a href="#cb3-243"></a><span class="kw">public</span> <span class="dt">bool</span> LaunchIfNotRunning <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb3-244"><a href="#cb3-244"></a></span>
<span id="cb3-245"><a href="#cb3-245"></a><span class="kw">public</span> <span class="dt">string</span><span class="op">?</span> ModelPath <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb3-246"><a href="#cb3-246"></a></span>
<span id="cb3-247"><a href="#cb3-247"></a><span class="kw">public</span> <span class="dt">bool</span> ShowUI <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb3-248"><a href="#cb3-248"></a></span>
<span id="cb3-249"><a href="#cb3-249"></a><span class="kw">public</span> <span class="dt">int</span> StartupWaitMs <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="dv">1500</span><span class="op">;</span></span>
<span id="cb3-250"><a href="#cb3-250"></a></span>
<span id="cb3-251"><a href="#cb3-251"></a><span class="kw">public</span> <span class="dt">int</span> RepoPollMs <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb3-252"><a href="#cb3-252"></a></span>
<span id="cb3-253"><a href="#cb3-253"></a><span class="kw">public</span> <span class="dt">int</span> RepoPollMax <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></span>
<span id="cb3-254"><a href="#cb3-254"></a></span>
<span id="cb3-255"><a href="#cb3-255"></a><span class="op">}</span></span>
<span id="cb3-256"><a href="#cb3-256"></a></span>
<span id="cb3-257"><a href="#cb3-257"></a><span class="co">// Attach to EA or launch new instance</span></span>
<span id="cb3-258"><a href="#cb3-258"></a></span>
<span id="cb3-259"><a href="#cb3-259"></a><span class="kw">public</span> <span class="kw">static</span> Session <span class="fu">AttachOrLaunch</span><span class="op">(</span>Options<span class="op">?</span> options <span class="op">=</span> <span class="kw">null</span><span class="op">)</span></span>
<span id="cb3-260"><a href="#cb3-260"></a></span>
<span id="cb3-261"><a href="#cb3-261"></a><span class="op">{</span></span>
<span id="cb3-262"><a href="#cb3-262"></a></span>
<span id="cb3-263"><a href="#cb3-263"></a>options <span class="op">??=</span> <span class="kw">new</span> <span class="fu">Options</span><span class="op">();</span></span>
<span id="cb3-264"><a href="#cb3-264"></a></span>
<span id="cb3-265"><a href="#cb3-265"></a>EA<span class="op">.</span><span class="fu">App</span><span class="op">?</span> app <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb3-266"><a href="#cb3-266"></a></span>
<span id="cb3-267"><a href="#cb3-267"></a><span class="kw">if</span> <span class="op">(</span>options<span class="op">.</span><span class="fu">PreferAttach</span><span class="op">)</span></span>
<span id="cb3-268"><a href="#cb3-268"></a></span>
<span id="cb3-269"><a href="#cb3-269"></a><span class="op">{</span></span>
<span id="cb3-270"><a href="#cb3-270"></a></span>
<span id="cb3-271"><a href="#cb3-271"></a><span class="kw">try</span> <span class="op">{</span> app <span class="op">=</span> <span class="op">(</span>EA<span class="op">.</span><span class="fu">App</span><span class="op">)</span>Marshal<span class="op">.</span><span class="fu">GetActiveObject</span><span class="op">(</span><span class="st">"EA.App"</span><span class="op">);</span> <span class="op">}</span></span>
<span id="cb3-272"><a href="#cb3-272"></a></span>
<span id="cb3-273"><a href="#cb3-273"></a><span class="kw">catch</span> <span class="op">{</span> <span class="op">/</span>\<span class="op">*</span> none running \<span class="op">*/</span> <span class="op">}</span></span>
<span id="cb3-274"><a href="#cb3-274"></a></span>
<span id="cb3-275"><a href="#cb3-275"></a><span class="op">}</span></span>
<span id="cb3-276"><a href="#cb3-276"></a></span>
<span id="cb3-277"><a href="#cb3-277"></a><span class="kw">if</span> <span class="op">(</span>app <span class="op">==</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> options<span class="op">.</span><span class="fu">LaunchIfNotRunning</span><span class="op">)</span></span>
<span id="cb3-278"><a href="#cb3-278"></a></span>
<span id="cb3-279"><a href="#cb3-279"></a><span class="op">{</span></span>
<span id="cb3-280"><a href="#cb3-280"></a></span>
<span id="cb3-281"><a href="#cb3-281"></a><span class="op">&gt;</span> Type t <span class="op">=</span> Type<span class="op">.</span><span class="fu">GetTypeFromProgID</span><span class="op">(</span><span class="st">"EA.App"</span><span class="op">)</span> <span class="op">??</span> <span class="kw">throw</span> <span class="kw">new</span></span>
<span id="cb3-282"><a href="#cb3-282"></a><span class="op">&gt;</span></span>
<span id="cb3-283"><a href="#cb3-283"></a><span class="op">&gt;</span> <span class="fu">InvalidOperationException</span><span class="op">(</span><span class="st">"EA not installed."</span><span class="op">);</span></span>
<span id="cb3-284"><a href="#cb3-284"></a></span>
<span id="cb3-285"><a href="#cb3-285"></a>app <span class="op">=</span> <span class="op">(</span>EA<span class="op">.</span><span class="fu">App</span><span class="op">)</span>Activator<span class="op">.</span><span class="fu">CreateInstance</span><span class="op">(</span>t<span class="op">)!;</span></span>
<span id="cb3-286"><a href="#cb3-286"></a></span>
<span id="cb3-287"><a href="#cb3-287"></a><span class="kw">if</span> <span class="op">(!</span>options<span class="op">.</span><span class="fu">ShowUI</span><span class="op">)</span> app<span class="op">.</span><span class="fu">Visible</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb3-288"><a href="#cb3-288"></a></span>
<span id="cb3-289"><a href="#cb3-289"></a>System<span class="op">.</span><span class="fu">Threading</span><span class="op">.</span><span class="fu">Thread</span><span class="op">.</span><span class="fu">Sleep</span><span class="op">(</span>options<span class="op">.</span><span class="fu">StartupWaitMs</span><span class="op">);</span></span>
<span id="cb3-290"><a href="#cb3-290"></a></span>
<span id="cb3-291"><a href="#cb3-291"></a><span class="op">}</span></span>
<span id="cb3-292"><a href="#cb3-292"></a></span>
<span id="cb3-293"><a href="#cb3-293"></a><span class="kw">if</span> <span class="op">(</span>app <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">InvalidOperationException</span><span class="op">(</span></span>
<span id="cb3-294"><a href="#cb3-294"></a></span>
<span id="cb3-295"><a href="#cb3-295"></a><span class="op">&gt;</span> <span class="st">"Unable to connect to EA."</span><span class="op">);</span></span>
<span id="cb3-296"><a href="#cb3-296"></a></span>
<span id="cb3-297"><a href="#cb3-297"></a>EA<span class="op">.</span><span class="fu">Repository</span> repo <span class="op">=</span> app<span class="op">.</span><span class="fu">Repository</span><span class="op">;</span></span>
<span id="cb3-298"><a href="#cb3-298"></a></span>
<span id="cb3-299"><a href="#cb3-299"></a><span class="co">// Poll until repository becomes available</span></span>
<span id="cb3-300"><a href="#cb3-300"></a></span>
<span id="cb3-301"><a href="#cb3-301"></a><span class="dt">int</span> polls <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-302"><a href="#cb3-302"></a></span>
<span id="cb3-303"><a href="#cb3-303"></a><span class="kw">while</span> <span class="op">(</span>repo <span class="op">==</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> polls \<span class="op">&lt;</span> options<span class="op">.</span><span class="fu">RepoPollMax</span><span class="op">)</span></span>
<span id="cb3-304"><a href="#cb3-304"></a></span>
<span id="cb3-305"><a href="#cb3-305"></a><span class="op">{</span></span>
<span id="cb3-306"><a href="#cb3-306"></a></span>
<span id="cb3-307"><a href="#cb3-307"></a>System<span class="op">.</span><span class="fu">Threading</span><span class="op">.</span><span class="fu">Thread</span><span class="op">.</span><span class="fu">Sleep</span><span class="op">(</span>options<span class="op">.</span><span class="fu">RepoPollMs</span><span class="op">);</span></span>
<span id="cb3-308"><a href="#cb3-308"></a></span>
<span id="cb3-309"><a href="#cb3-309"></a>repo <span class="op">=</span> app<span class="op">.</span><span class="fu">Repository</span><span class="op">;</span></span>
<span id="cb3-310"><a href="#cb3-310"></a></span>
<span id="cb3-311"><a href="#cb3-311"></a>polls<span class="op">++;</span></span>
<span id="cb3-312"><a href="#cb3-312"></a></span>
<span id="cb3-313"><a href="#cb3-313"></a><span class="op">}</span></span>
<span id="cb3-314"><a href="#cb3-314"></a></span>
<span id="cb3-315"><a href="#cb3-315"></a><span class="kw">if</span> <span class="op">(</span>repo <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">InvalidOperationException</span><span class="op">(</span><span class="st">"</span></span>
<span id="cb3-316"><a href="#cb3-316"></a></span>
<span id="cb3-317"><a href="#cb3-317"></a><span class="op">&gt;</span> EA<span class="op">.</span><span class="fu">Repository</span> did not initialise<span class="op">.</span><span class="st">");</span></span>
<span id="cb3-318"><a href="#cb3-318"></a></span>
<span id="cb3-319"><a href="#cb3-319"></a><span class="kw">if</span> <span class="op">(!</span><span class="dt">string</span><span class="op">.</span><span class="fu">IsNullOrWhiteSpace</span><span class="op">(</span>options<span class="op">.</span><span class="fu">ModelPath</span><span class="op">)</span> <span class="op">&amp;&amp;</span></span>
<span id="cb3-320"><a href="#cb3-320"></a></span>
<span id="cb3-321"><a href="#cb3-321"></a><span class="op">&gt;</span> <span class="dt">string</span><span class="op">.</span><span class="fu">IsNullOrWhiteSpace</span><span class="op">(</span>repo<span class="op">.</span><span class="fu">ConnectionString</span><span class="op">))</span></span>
<span id="cb3-322"><a href="#cb3-322"></a></span>
<span id="cb3-323"><a href="#cb3-323"></a>repo<span class="op">.</span><span class="fu">OpenFile</span><span class="op">(</span>options<span class="op">.</span><span class="fu">ModelPath</span><span class="op">);</span></span>
<span id="cb3-324"><a href="#cb3-324"></a></span>
<span id="cb3-325"><a href="#cb3-325"></a><span class="kw">return</span> <span class="kw">new</span> <span class="fu">Session</span><span class="op">(</span>app<span class="op">,</span> repo<span class="op">);</span></span>
<span id="cb3-326"><a href="#cb3-326"></a></span>
<span id="cb3-327"><a href="#cb3-327"></a><span class="op">}</span></span>
<span id="cb3-328"><a href="#cb3-328"></a></span>
<span id="cb3-329"><a href="#cb3-329"></a><span class="co">// Result container</span></span>
<span id="cb3-330"><a href="#cb3-330"></a></span>
<span id="cb3-331"><a href="#cb3-331"></a><span class="kw">public</span> <span class="kw">sealed</span> <span class="kw">class</span> Result</span>
<span id="cb3-332"><a href="#cb3-332"></a></span>
<span id="cb3-333"><a href="#cb3-333"></a><span class="op">{</span></span>
<span id="cb3-334"><a href="#cb3-334"></a></span>
<span id="cb3-335"><a href="#cb3-335"></a><span class="kw">public</span> <span class="dt">int</span> UpdatedCount <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb3-336"><a href="#cb3-336"></a></span>
<span id="cb3-337"><a href="#cb3-337"></a><span class="kw">public</span> <span class="dt">string</span> Summary <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb3-338"><a href="#cb3-338"></a></span>
<span id="cb3-339"><a href="#cb3-339"></a><span class="kw">public</span> <span class="dt">string</span><span class="op">?</span> LogPath <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb3-340"><a href="#cb3-340"></a></span>
<span id="cb3-341"><a href="#cb3-341"></a><span class="kw">public</span> <span class="dt">string</span><span class="op">?</span> ElementGuid <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> init<span class="op">;</span> <span class="op">}</span></span>
<span id="cb3-342"><a href="#cb3-342"></a></span>
<span id="cb3-343"><a href="#cb3-343"></a><span class="op">}</span></span>
<span id="cb3-344"><a href="#cb3-344"></a></span>
<span id="cb3-345"><a href="#cb3-345"></a><span class="co">// Add a new element safely</span></span>
<span id="cb3-346"><a href="#cb3-346"></a></span>
<span id="cb3-347"><a href="#cb3-347"></a><span class="kw">public</span> <span class="kw">static</span> Result <span class="fu">AddElement</span><span class="op">(</span>Repository repo<span class="op">,</span></span>
<span id="cb3-348"><a href="#cb3-348"></a></span>
<span id="cb3-349"><a href="#cb3-349"></a><span class="op">&gt;</span> Package targetPackage<span class="op">,</span></span>
<span id="cb3-350"><a href="#cb3-350"></a><span class="op">&gt;</span></span>
<span id="cb3-351"><a href="#cb3-351"></a><span class="op">&gt;</span> <span class="dt">string</span> name<span class="op">,</span></span>
<span id="cb3-352"><a href="#cb3-352"></a><span class="op">&gt;</span></span>
<span id="cb3-353"><a href="#cb3-353"></a><span class="op">&gt;</span> <span class="dt">string</span> type<span class="op">,</span></span>
<span id="cb3-354"><a href="#cb3-354"></a><span class="op">&gt;</span></span>
<span id="cb3-355"><a href="#cb3-355"></a><span class="op">&gt;</span> <span class="dt">string</span><span class="op">?</span> notes<span class="op">,</span> <span class="dt">bool</span> dryRun <span class="op">=</span> <span class="kw">true</span><span class="op">,</span> CsvLogger<span class="op">?</span> logger <span class="op">=</span> <span class="kw">null</span><span class="op">)</span></span>
<span id="cb3-356"><a href="#cb3-356"></a></span>
<span id="cb3-357"><a href="#cb3-357"></a><span class="op">{</span></span>
<span id="cb3-358"><a href="#cb3-358"></a></span>
<span id="cb3-359"><a href="#cb3-359"></a><span class="dt">var</span> el <span class="op">=</span> <span class="op">(</span>Element<span class="op">)</span>targetPackage<span class="op">.</span><span class="fu">Elements</span><span class="op">.</span><span class="fu">AddNew</span><span class="op">(</span>name<span class="op">,</span> type<span class="op">);</span></span>
<span id="cb3-360"><a href="#cb3-360"></a></span>
<span id="cb3-361"><a href="#cb3-361"></a><span class="kw">if</span> <span class="op">(!</span><span class="dt">string</span><span class="op">.</span><span class="fu">IsNullOrWhiteSpace</span><span class="op">(</span>notes<span class="op">))</span> el<span class="op">.</span><span class="fu">Notes</span> <span class="op">=</span> notes<span class="op">;</span></span>
<span id="cb3-362"><a href="#cb3-362"></a></span>
<span id="cb3-363"><a href="#cb3-363"></a><span class="kw">if</span> <span class="op">(</span>dryRun<span class="op">)</span></span>
<span id="cb3-364"><a href="#cb3-364"></a></span>
<span id="cb3-365"><a href="#cb3-365"></a><span class="op">{</span></span>
<span id="cb3-366"><a href="#cb3-366"></a></span>
<span id="cb3-367"><a href="#cb3-367"></a>logger<span class="op">?.</span><span class="fu">WriteRow</span><span class="op">(</span>DateTime<span class="op">.</span><span class="fu">Now</span><span class="op">,</span> <span class="st">"DRYRUN"</span><span class="op">,</span></span>
<span id="cb3-368"><a href="#cb3-368"></a></span>
<span id="cb3-369"><a href="#cb3-369"></a><span class="op">&gt;</span> targetPackage<span class="op">.</span><span class="fu">PackageID</span><span class="op">,</span></span>
<span id="cb3-370"><a href="#cb3-370"></a><span class="op">&gt;</span></span>
<span id="cb3-371"><a href="#cb3-371"></a><span class="op">&gt;</span> <span class="st">""</span><span class="op">,</span> name<span class="op">,</span> type<span class="op">,</span> notes <span class="op">??</span> <span class="st">""</span><span class="op">);</span></span>
<span id="cb3-372"><a href="#cb3-372"></a></span>
<span id="cb3-373"><a href="#cb3-373"></a><span class="kw">return</span> <span class="kw">new</span> Result <span class="op">{</span> UpdatedCount <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb3-374"><a href="#cb3-374"></a></span>
<span id="cb3-375"><a href="#cb3-375"></a><span class="op">&gt;</span> Summary <span class="op">=</span> \$<span class="st">"\[DRYRUN\] Would create: {name} ({type})"</span> <span class="op">};</span></span>
<span id="cb3-376"><a href="#cb3-376"></a></span>
<span id="cb3-377"><a href="#cb3-377"></a><span class="op">}</span></span>
<span id="cb3-378"><a href="#cb3-378"></a></span>
<span id="cb3-379"><a href="#cb3-379"></a><span class="kw">if</span> <span class="op">(!</span>el<span class="op">.</span><span class="fu">Update</span><span class="op">())</span></span>
<span id="cb3-380"><a href="#cb3-380"></a></span>
<span id="cb3-381"><a href="#cb3-381"></a><span class="kw">throw</span> <span class="kw">new</span> <span class="fu">InvalidOperationException</span><span class="op">(</span></span>
<span id="cb3-382"><a href="#cb3-382"></a></span>
<span id="cb3-383"><a href="#cb3-383"></a><span class="op">&gt;</span> <span class="st">"Element.Update() failed."</span><span class="op">);</span></span>
<span id="cb3-384"><a href="#cb3-384"></a></span>
<span id="cb3-385"><a href="#cb3-385"></a>repo<span class="op">.</span><span class="fu">RefreshModelView</span><span class="op">(</span>targetPackage<span class="op">.</span><span class="fu">PackageID</span><span class="op">);</span></span>
<span id="cb3-386"><a href="#cb3-386"></a></span>
<span id="cb3-387"><a href="#cb3-387"></a>logger<span class="op">?.</span><span class="fu">WriteRow</span><span class="op">(</span>DateTime<span class="op">.</span><span class="fu">Now</span><span class="op">,</span> <span class="st">"CREATE"</span><span class="op">,</span></span>
<span id="cb3-388"><a href="#cb3-388"></a></span>
<span id="cb3-389"><a href="#cb3-389"></a><span class="op">&gt;</span> targetPackage<span class="op">.</span><span class="fu">PackageID</span><span class="op">,</span></span>
<span id="cb3-390"><a href="#cb3-390"></a><span class="op">&gt;</span></span>
<span id="cb3-391"><a href="#cb3-391"></a><span class="op">&gt;</span> el<span class="op">.</span><span class="fu">ElementGUID</span><span class="op">,</span> name<span class="op">,</span> type<span class="op">,</span> notes <span class="op">??</span> <span class="st">""</span><span class="op">);</span></span>
<span id="cb3-392"><a href="#cb3-392"></a></span>
<span id="cb3-393"><a href="#cb3-393"></a><span class="kw">return</span> <span class="kw">new</span> Result</span>
<span id="cb3-394"><a href="#cb3-394"></a></span>
<span id="cb3-395"><a href="#cb3-395"></a><span class="op">{</span></span>
<span id="cb3-396"><a href="#cb3-396"></a></span>
<span id="cb3-397"><a href="#cb3-397"></a>UpdatedCount <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb3-398"><a href="#cb3-398"></a></span>
<span id="cb3-399"><a href="#cb3-399"></a>Summary <span class="op">=</span> \$<span class="st">"Created element: {name} ({type})"</span><span class="op">,</span></span>
<span id="cb3-400"><a href="#cb3-400"></a></span>
<span id="cb3-401"><a href="#cb3-401"></a>ElementGuid <span class="op">=</span> el<span class="op">.</span><span class="fu">ElementGUID</span><span class="op">,</span></span>
<span id="cb3-402"><a href="#cb3-402"></a></span>
<span id="cb3-403"><a href="#cb3-403"></a>LogPath <span class="op">=</span> logger<span class="op">?.</span><span class="fu">Path</span></span>
<span id="cb3-404"><a href="#cb3-404"></a></span>
<span id="cb3-405"><a href="#cb3-405"></a><span class="op">};</span></span>
<span id="cb3-406"><a href="#cb3-406"></a></span>
<span id="cb3-407"><a href="#cb3-407"></a><span class="op">}</span></span>
<span id="cb3-408"><a href="#cb3-408"></a></span>
<span id="cb3-409"><a href="#cb3-409"></a><span class="co">// CSV logger</span></span>
<span id="cb3-410"><a href="#cb3-410"></a></span>
<span id="cb3-411"><a href="#cb3-411"></a><span class="kw">public</span> <span class="kw">sealed</span> <span class="kw">class</span> CsvLogger <span class="op">:</span> IDisposable</span>
<span id="cb3-412"><a href="#cb3-412"></a></span>
<span id="cb3-413"><a href="#cb3-413"></a><span class="op">{</span></span>
<span id="cb3-414"><a href="#cb3-414"></a></span>
<span id="cb3-415"><a href="#cb3-415"></a><span class="kw">private</span> <span class="kw">readonly</span> StreamWriter \_writer<span class="op">;</span></span>
<span id="cb3-416"><a href="#cb3-416"></a></span>
<span id="cb3-417"><a href="#cb3-417"></a><span class="kw">public</span> <span class="dt">string</span> Path <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb3-418"><a href="#cb3-418"></a></span>
<span id="cb3-419"><a href="#cb3-419"></a><span class="kw">private</span> <span class="fu">CsvLogger</span><span class="op">(</span><span class="dt">string</span> path<span class="op">)</span></span>
<span id="cb3-420"><a href="#cb3-420"></a></span>
<span id="cb3-421"><a href="#cb3-421"></a><span class="op">{</span></span>
<span id="cb3-422"><a href="#cb3-422"></a></span>
<span id="cb3-423"><a href="#cb3-423"></a>Path <span class="op">=</span> path<span class="op">;</span></span>
<span id="cb3-424"><a href="#cb3-424"></a></span>
<span id="cb3-425"><a href="#cb3-425"></a>\_writer <span class="op">=</span> <span class="kw">new</span> <span class="fu">StreamWriter</span><span class="op">(</span>path<span class="op">,</span> append<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb3-426"><a href="#cb3-426"></a></span>
<span id="cb3-427"><a href="#cb3-427"></a><span class="op">&gt;</span> System<span class="op">.</span><span class="fu">Text</span><span class="op">.</span><span class="fu">Encoding</span><span class="op">.</span><span class="fu">UTF8</span><span class="op">);</span></span>
<span id="cb3-428"><a href="#cb3-428"></a></span>
<span id="cb3-429"><a href="#cb3-429"></a><span class="op">}</span></span>
<span id="cb3-430"><a href="#cb3-430"></a></span>
<span id="cb3-431"><a href="#cb3-431"></a><span class="kw">public</span> <span class="kw">static</span> CsvLogger <span class="fu">Open</span><span class="op">(</span><span class="dt">string</span> path<span class="op">)</span> <span class="op">=</span>\<span class="op">&gt;</span></span>
<span id="cb3-432"><a href="#cb3-432"></a></span>
<span id="cb3-433"><a href="#cb3-433"></a><span class="op">&gt;</span> <span class="kw">new</span> <span class="fu">CsvLogger</span><span class="op">(</span>path<span class="op">);</span></span>
<span id="cb3-434"><a href="#cb3-434"></a></span>
<span id="cb3-435"><a href="#cb3-435"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">WriteHeader</span><span class="op">(</span><span class="dt">string</span> header<span class="op">)</span> <span class="op">=</span>\<span class="op">&gt;</span></span>
<span id="cb3-436"><a href="#cb3-436"></a></span>
<span id="cb3-437"><a href="#cb3-437"></a>\_writer<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>header<span class="op">);</span></span>
<span id="cb3-438"><a href="#cb3-438"></a></span>
<span id="cb3-439"><a href="#cb3-439"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">WriteRow</span><span class="op">(</span><span class="kw">params</span> <span class="dt">object</span><span class="op">?</span>\<span class="op">[</span>\<span class="op">]</span> cols<span class="op">)</span></span>
<span id="cb3-440"><a href="#cb3-440"></a></span>
<span id="cb3-441"><a href="#cb3-441"></a><span class="op">=</span>\<span class="op">&gt;</span> \_writer<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="dt">string</span><span class="op">.</span><span class="fu">Join</span><span class="op">(</span><span class="st">","</span><span class="op">,</span></span>
<span id="cb3-442"><a href="#cb3-442"></a></span>
<span id="cb3-443"><a href="#cb3-443"></a><span class="op">&gt;</span> Array<span class="op">.</span><span class="fu">ConvertAll</span><span class="op">(</span>cols<span class="op">,</span> c <span class="op">=</span>\<span class="op">&gt;</span> c<span class="op">?.</span><span class="fu">ToString</span><span class="op">()</span> <span class="op">??</span> <span class="st">""</span><span class="op">)));</span></span>
<span id="cb3-444"><a href="#cb3-444"></a></span>
<span id="cb3-445"><a href="#cb3-445"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">Close</span><span class="op">()</span> <span class="op">=</span>\<span class="op">&gt;</span> \_writer<span class="op">.</span><span class="fu">Flush</span><span class="op">();</span></span>
<span id="cb3-446"><a href="#cb3-446"></a></span>
<span id="cb3-447"><a href="#cb3-447"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">Dispose</span><span class="op">()</span> <span class="op">=</span>\<span class="op">&gt;</span> \_writer<span class="op">.</span><span class="fu">Dispose</span><span class="op">();</span></span>
<span id="cb3-448"><a href="#cb3-448"></a></span>
<span id="cb3-449"><a href="#cb3-449"></a><span class="op">}</span></span>
<span id="cb3-450"><a href="#cb3-450"></a></span>
<span id="cb3-451"><a href="#cb3-451"></a><span class="op">}</span></span>
<span id="cb3-452"><a href="#cb3-452"></a></span>
<span id="cb3-453"><a href="#cb3-453"></a><span class="op">}</span></span>
<span id="cb3-454"><a href="#cb3-454"></a>```</span>
<span id="cb3-455"><a href="#cb3-455"></a></span>
<span id="cb3-456"><a href="#cb3-456"></a>## E<span class="fl">.4</span> Configuration <span class="op">&amp;</span> Setup</span>
<span id="cb3-457"><a href="#cb3-457"></a></span>
<span id="cb3-458"><a href="#cb3-458"></a>### Bitness</span>
<span id="cb3-459"><a href="#cb3-459"></a></span>
<span id="cb3-460"><a href="#cb3-460"></a><span class="op">-</span> EA <span class="dv">16</span><span class="op">+</span> <span class="kw">is</span> usually <span class="op">**</span><span class="dv">64</span><span class="op">-</span>bit<span class="op">**.</span></span>
<span id="cb3-461"><a href="#cb3-461"></a></span>
<span id="cb3-462"><a href="#cb3-462"></a><span class="op">-</span> Match your project’s \<span class="op">&lt;</span>PlatformTarget\<span class="op">&gt;</span> to EA’s <span class="fu">bitness</span> <span class="op">(</span>x64 or x86<span class="op">).</span></span>
<span id="cb3-463"><a href="#cb3-463"></a></span>
<span id="cb3-464"><a href="#cb3-464"></a>### Interop<span class="op">.</span><span class="fu">EA</span><span class="op">.</span><span class="fu">dll</span></span>
<span id="cb3-465"><a href="#cb3-465"></a></span>
<span id="cb3-466"><a href="#cb3-466"></a><span class="op">-</span> Found <span class="kw">in</span> EA install folder<span class="op">.</span></span>
<span id="cb3-467"><a href="#cb3-467"></a></span>
<span id="cb3-468"><a href="#cb3-468"></a><span class="op">-</span> Add <span class="kw">as</span> a reference <span class="kw">in</span> your <span class="op">.</span><span class="fu">NET</span> project<span class="op">.</span></span>
<span id="cb3-469"><a href="#cb3-469"></a></span>
<span id="cb3-470"><a href="#cb3-470"></a>### STAThread</span>
<span id="cb3-471"><a href="#cb3-471"></a></span>
<span id="cb3-472"><a href="#cb3-472"></a><span class="op">-</span> COM automation requires \<span class="op">[</span>STAThread\<span class="op">]</span> on your entry point<span class="op">.</span></span>
<span id="cb3-473"><a href="#cb3-473"></a></span>
<span id="cb3-474"><a href="#cb3-474"></a>### Model Files</span>
<span id="cb3-475"><a href="#cb3-475"></a></span>
<span id="cb3-476"><a href="#cb3-476"></a><span class="op">-</span> Use <span class="op">.</span><span class="fu">qea</span> <span class="op">/</span> <span class="op">.</span><span class="fu">qeax</span> <span class="op">/</span> <span class="op">.</span><span class="fu">eapx</span><span class="op">.</span></span>
<span id="cb3-477"><a href="#cb3-477"></a></span>
<span id="cb3-478"><a href="#cb3-478"></a><span class="op">-</span> Options<span class="op">.</span><span class="fu">ModelPath</span> can auto<span class="op">-</span>open a file <span class="kw">if</span> none <span class="kw">is</span> open<span class="op">.</span></span>
<span id="cb3-479"><a href="#cb3-479"></a></span>
<span id="cb3-480"><a href="#cb3-480"></a>### Dry Run <span class="op">&amp;</span> Logging</span>
<span id="cb3-481"><a href="#cb3-481"></a></span>
<span id="cb3-482"><a href="#cb3-482"></a><span class="op">-</span> Always start <span class="kw">in</span> dryRun <span class="op">=</span> <span class="kw">true</span><span class="op">.</span></span>
<span id="cb3-483"><a href="#cb3-483"></a></span>
<span id="cb3-484"><a href="#cb3-484"></a><span class="op">-</span> Review the generated CSV log before committing real updates<span class="op">.</span></span>
<span id="cb3-485"><a href="#cb3-485"></a></span>
<span id="cb3-486"><a href="#cb3-486"></a>### Distribution</span>
<span id="cb3-487"><a href="#cb3-487"></a></span>
<span id="cb3-488"><a href="#cb3-488"></a><span class="op">-</span> Package <span class="kw">as</span> a console utility or integrate into CI<span class="op">/</span>CD<span class="op">.</span></span>
<span id="cb3-489"><a href="#cb3-489"></a></span>
<span id="cb3-490"><a href="#cb3-490"></a><span class="op">-</span> Keep EAConnect<span class="op">.</span><span class="fu">cs</span> <span class="kw">in</span> a shared library <span class="kw">for</span> consistency<span class="op">.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>