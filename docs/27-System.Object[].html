<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>27&nbsp; Appendix E: External Automation Setup – Scripting Sparx Enterprise Architect: A Practical Handbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./26-System.Object[].html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-b4ddde2c4c77ed14ccfa95278770da4f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./27-System.Object[].html"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Appendix E: External Automation Setup</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Scripting Sparx Enterprise Architect: A Practical Handbook</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Scripting Sparx Enterprise Architect</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Chapter 1: Why Script EA?</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Chapter 2: Automation Landscape</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Chapter 3: Getting Started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Chapter 4: API Essentials</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Chapter 5: Inside EA with JScript</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Chapter 6: External Automation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Chapter 7: Script Design Patterns</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Chapter 8: Object Details</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Chapter 9: Imports &amp; Exports</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Chapter 10: MDG-Aware Scripting</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Chapter 11: Governance Scripts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Chapter 12: Cookbook of Examples</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Chapter 13: Why AI Helps</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Chapter 14: Prompt Engineering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Chapter 15: AI Refactoring Partner</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Chapter 16: AI in Daily Workflow</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Chapter 17: Performance &amp; Scaling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Chapter 18: Integrating with Workflows</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Chapter 19: Add-ins vs Scripts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Chapter 20: Troubleshooting</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Chapter 21: Reference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Appendix A: Scripting Constraints</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Appendix B: External Automation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Appendix C: Glossary of Terms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26-System.Object[].html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Appendix D: Quick Reference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27-System.Object[].html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Appendix E: External Automation Setup</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#e.1-purpose" id="toc-e.1-purpose" class="nav-link active" data-scroll-target="#e.1-purpose"><span class="header-section-number">27.1</span> E.1 Purpose</a></li>
  <li><a href="#e.2-usage" id="toc-e.2-usage" class="nav-link" data-scroll-target="#e.2-usage"><span class="header-section-number">27.2</span> E.2 Usage</a></li>
  <li><a href="#e.3-the-eaconnect-helper-class" id="toc-e.3-the-eaconnect-helper-class" class="nav-link" data-scroll-target="#e.3-the-eaconnect-helper-class"><span class="header-section-number">27.3</span> E.3 The EAConnect Helper Class</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="header-section-number">28</span> //</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"><span class="header-section-number">29</span> //</a>
  <ul class="collapse">
  <li><a href="#e.4-configuration-setup" id="toc-e.4-configuration-setup" class="nav-link" data-scroll-target="#e.4-configuration-setup"><span class="header-section-number">29.1</span> E.4 Configuration &amp; Setup</a>
  <ul class="collapse">
  <li><a href="#bitness" id="toc-bitness" class="nav-link" data-scroll-target="#bitness"><span class="header-section-number">29.1.1</span> Bitness</a></li>
  <li><a href="#interop.ea.dll" id="toc-interop.ea.dll" class="nav-link" data-scroll-target="#interop.ea.dll"><span class="header-section-number">29.1.2</span> Interop.EA.dll</a></li>
  <li><a href="#stathread" id="toc-stathread" class="nav-link" data-scroll-target="#stathread"><span class="header-section-number">29.1.3</span> STAThread</a></li>
  <li><a href="#model-files" id="toc-model-files" class="nav-link" data-scroll-target="#model-files"><span class="header-section-number">29.1.4</span> Model Files</a></li>
  <li><a href="#dry-run-logging" id="toc-dry-run-logging" class="nav-link" data-scroll-target="#dry-run-logging"><span class="header-section-number">29.1.5</span> Dry Run &amp; Logging</a></li>
  <li><a href="#distribution" id="toc-distribution" class="nav-link" data-scroll-target="#distribution"><span class="header-section-number">29.1.6</span> Distribution</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Appendix E: External Automation Setup</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This appendix provides the reusable EAConnect helper class plus the configuration details required to build external automation tools against Enterprise Architect (EA). It is intended as the “plumbing” layer behind the example in <strong>Chapter 6 – External Automation</strong>.</p>
<section id="e.1-purpose" class="level2" data-number="27.1">
<h2 data-number="27.1" class="anchored" data-anchor-id="e.1-purpose"><span class="header-section-number">27.1</span> E.1 Purpose</h2>
<p>The EAConnect helper abstracts the complexities of EA’s COM interface and standardises safety practices:</p>
<ul>
<li><p>Attaching to or launching EA consistently</p></li>
<li><p>Waiting for the Repository to become available</p></li>
<li><p>Opening models automatically if needed</p></li>
<li><p>Handling bitness and Interop.EA.dll</p></li>
<li><p>Providing safe wrappers for common tasks (find package, add element, add tagged value)</p></li>
<li><p>Enforcing <strong>dry-run by default</strong></p></li>
<li><p>Writing CSV audit logs with auto-derived filenames</p></li>
<li><p>Refreshing EA’s UI at sensible points</p></li>
</ul>
<p>With this helper, your utilities focus on intent rather than boilerplate.</p>
</section>
<section id="e.2-usage" class="level2" data-number="27.2">
<h2 data-number="27.2" class="anchored" data-anchor-id="e.2-usage"><span class="header-section-number">27.2</span> E.2 Usage</h2>
<p>A minimal program using the helper:</p>
<p>using System;</p>
<p>using EA;</p>
<p>using EA.Automation; // the helper namespace</p>
<p>class Program</p>
<p>{</p>
<p>[STAThread]</p>
<p>static void Main(string[] args)</p>
<p>{</p>
<p>using var ea = EAConnect.AttachOrLaunch(new EAConnect.Options { ShowUI = true });</p>
<p>Package pkg = ea.GetSelectedPackageOrRoot();</p>
<p>var result = EAConnect.AddElement(ea.Repo, pkg, “DemoClass”, “Class”,</p>
<p>“Created by EAConnect.”, dryRun: true);</p>
<p>Console.WriteLine(result.Summary);</p>
<p>}</p>
<p>}</p>
<p>This pattern keeps the Program.cs short and declarative. All detailed logic resides in the helper.</p>
</section>
<section id="e.3-the-eaconnect-helper-class" class="level2" data-number="27.3">
<h2 data-number="27.3" class="anchored" data-anchor-id="e.3-the-eaconnect-helper-class"><span class="header-section-number">27.3</span> E.3 The EAConnect Helper Class</h2>
</section>
<section id="section" class="level1" data-number="28">
<h1 data-number="28"><span class="header-section-number">28</span> //</h1>
<p>// File: EAConnect.cs</p>
<p>// Project: EA Automation Helper</p>
<p>// Author: &lt;Your Name&gt;</p>
<p>// Created: 2025-08-31</p>
<p>// Last Update: 2025-08-31</p>
<p>//</p>
<p>// PURPOSE</p>
<p>// ——-</p>
<p>// Provides a safe, reusable abstraction over EA’s COM automation API.</p>
<p>// Handles: attach/launch, repository polling, model open, package</p>
<p>// resolution,</p>
<p>// element creation, tagged value creation, CSV logging, and UI refresh.</p>
<p>//</p>
<p>// USAGE</p>
<p>// —–</p>
<p>// using var ea = EAConnect.AttachOrLaunch(new EAConnect.Options {</p>
<p>// ShowUI = true });</p>
<p>// var pkg = ea.GetSelectedPackageOrRoot();</p>
<p>// var result = EAConnect.AddElement(ea.Repo, pkg, “NewClass”, “Class”,</p>
<p>// “Notes”, true);</p>
<p>// Console.WriteLine(result.Summary);</p>
<p>//</p>
<p>// ASSUMPTIONS</p>
<p>// ———–</p>
<p>// - EA is installed and COM-registered (ProgID = “EA.App”).</p>
<p>// - Interop.EA.dll referenced (from EA install folder).</p>
<p>// - Bitness of project matches EA (x64 for EA 64-bit; x86 for 32-bit).</p>
<p>// - .NET project marked [STAThread] on entry point.</p>
<p>//</p>
<p>// SAFETY</p>
<p>// ——</p>
<p>// - Dry-run enabled by default in sample programs.</p>
<p>// - CSV audit logging for all writes.</p>
<p>// - UI refresh at batch boundaries only.</p>
<p>//</p>
<p>// DEPENDENCIES</p>
<p>// ————</p>
<p>// - System.Runtime.InteropServices (Marshal.GetActiveObject).</p>
<p>// - Interop.EA.dll.</p>
<p>//</p>
<p>// UPDATE HISTORY</p>
<p>// ————–</p>
<p>// - 2025-08-31: Initial helper version.</p>
</section>
<section id="section-1" class="level1" data-number="29">
<h1 data-number="29"><span class="header-section-number">29</span> //</h1>
<p>using System;</p>
<p>using System.IO;</p>
<p>using System.Runtime.InteropServices;</p>
<p>using EA;</p>
<p>namespace EA.Automation</p>
<p>{</p>
<p>public static class EAConnect</p>
<p>{</p>
<p>// Encapsulates a connected EA session</p>
<p>public sealed class Session : IDisposable</p>
<p>{</p>
<p>public EA.App App { get; }</p>
<p>public EA.Repository Repo { get; }</p>
<p>internal Session(EA.App app, EA.Repository repo)</p>
<p>{</p>
<p>App = app;</p>
<p>Repo = repo;</p>
<p>}</p>
<p>public Package GetSelectedPackageOrRoot()</p>
<p>{</p>
<p>Package? pkg = Repo.GetTreeSelectedPackage();</p>
<p>if (pkg != null) return pkg;</p>
<p>if (Repo.Models.Count &gt; 0) return</p>
<blockquote class="blockquote">
<p>(Package)Repo.Models.GetAt(0);</p>
</blockquote>
<p>throw new InvalidOperationException(</p>
<blockquote class="blockquote">
<p>“No package available in repository.”);</p>
</blockquote>
<p>}</p>
<p>public void Dispose()</p>
<p>{</p>
<p>// Release COM references cleanly</p>
<p>Marshal.ReleaseComObject(Repo);</p>
<p>Marshal.ReleaseComObject(App);</p>
<p>}</p>
<p>}</p>
<p>// Options for attaching or launching EA</p>
<p>public sealed class Options</p>
<p>{</p>
<p>public bool PreferAttach { get; set; } = true;</p>
<p>public bool LaunchIfNotRunning { get; set; } = true;</p>
<p>public string? ModelPath { get; set; }</p>
<p>public bool ShowUI { get; set; } = true;</p>
<p>public int StartupWaitMs { get; set; } = 1500;</p>
<p>public int RepoPollMs { get; set; } = 100;</p>
<p>public int RepoPollMax { get; set; } = 50;</p>
<p>}</p>
<p>// Attach to EA or launch new instance</p>
<p>public static Session AttachOrLaunch(Options? options = null)</p>
<p>{</p>
<p>options ??= new Options();</p>
<p>EA.App? app = null;</p>
<p>if (options.PreferAttach)</p>
<p>{</p>
<p>try { app = (EA.App)Marshal.GetActiveObject(“EA.App”); }</p>
<p>catch { /* none running */ }</p>
<p>}</p>
<p>if (app == null &amp;&amp; options.LaunchIfNotRunning)</p>
<p>{</p>
<blockquote class="blockquote">
<p>Type t = Type.GetTypeFromProgID(“EA.App”) ?? throw new</p>
<p>InvalidOperationException(“EA not installed.”);</p>
</blockquote>
<p>app = (EA.App)Activator.CreateInstance(t)!;</p>
<p>if (!options.ShowUI) app.Visible = false;</p>
<p>System.Threading.Thread.Sleep(options.StartupWaitMs);</p>
<p>}</p>
<p>if (app == null) throw new InvalidOperationException(</p>
<blockquote class="blockquote">
<p>“Unable to connect to EA.”);</p>
</blockquote>
<p>EA.Repository repo = app.Repository;</p>
<p>// Poll until repository becomes available</p>
<p>int polls = 0;</p>
<p>while (repo == null &amp;&amp; polls &lt; options.RepoPollMax)</p>
<p>{</p>
<p>System.Threading.Thread.Sleep(options.RepoPollMs);</p>
<p>repo = app.Repository;</p>
<p>polls++;</p>
<p>}</p>
<p>if (repo == null) throw new InvalidOperationException(”</p>
<blockquote class="blockquote">
<p>EA.Repository did not initialise.”);</p>
</blockquote>
<p>if (!string.IsNullOrWhiteSpace(options.ModelPath) &amp;&amp;</p>
<blockquote class="blockquote">
<p>string.IsNullOrWhiteSpace(repo.ConnectionString))</p>
</blockquote>
<p>repo.OpenFile(options.ModelPath);</p>
<p>return new Session(app, repo);</p>
<p>}</p>
<p>// Result container</p>
<p>public sealed class Result</p>
<p>{</p>
<p>public int UpdatedCount { get; init; }</p>
<p>public string Summary { get; init; } = ““;</p>
<p>public string? LogPath { get; init; }</p>
<p>public string? ElementGuid { get; init; }</p>
<p>}</p>
<p>// Add a new element safely</p>
<p>public static Result AddElement(Repository repo,</p>
<blockquote class="blockquote">
<p>Package targetPackage,</p>
<p>string name,</p>
<p>string type,</p>
<p>string? notes, bool dryRun = true, CsvLogger? logger = null)</p>
</blockquote>
<p>{</p>
<p>var el = (Element)targetPackage.Elements.AddNew(name, type);</p>
<p>if (!string.IsNullOrWhiteSpace(notes)) el.Notes = notes;</p>
<p>if (dryRun)</p>
<p>{</p>
<p>logger?.WriteRow(DateTime.Now, “DRYRUN”,</p>
<blockquote class="blockquote">
<p>targetPackage.PackageID,</p>
<p>““, name, type, notes ??”“);</p>
</blockquote>
<p>return new Result { UpdatedCount = 0,</p>
<blockquote class="blockquote">
<p>Summary = $“[DRYRUN] Would create: {name} ({type})” };</p>
</blockquote>
<p>}</p>
<p>if (!el.Update())</p>
<p>throw new InvalidOperationException(</p>
<blockquote class="blockquote">
<p>“Element.Update() failed.”);</p>
</blockquote>
<p>repo.RefreshModelView(targetPackage.PackageID);</p>
<p>logger?.WriteRow(DateTime.Now, “CREATE”,</p>
<blockquote class="blockquote">
<p>targetPackage.PackageID,</p>
<p>el.ElementGUID, name, type, notes ?? ““);</p>
</blockquote>
<p>return new Result</p>
<p>{</p>
<p>UpdatedCount = 1,</p>
<p>Summary = $“Created element: {name} ({type})”,</p>
<p>ElementGuid = el.ElementGUID,</p>
<p>LogPath = logger?.Path</p>
<p>};</p>
<p>}</p>
<p>// CSV logger</p>
<p>public sealed class CsvLogger : IDisposable</p>
<p>{</p>
<p>private readonly StreamWriter _writer;</p>
<p>public string Path { get; }</p>
<p>private CsvLogger(string path)</p>
<p>{</p>
<p>Path = path;</p>
<p>_writer = new StreamWriter(path, append: false,</p>
<blockquote class="blockquote">
<p>System.Text.Encoding.UTF8);</p>
</blockquote>
<p>}</p>
<p>public static CsvLogger Open(string path) =&gt;</p>
<blockquote class="blockquote">
<p>new CsvLogger(path);</p>
</blockquote>
<p>public void WriteHeader(string header) =&gt;</p>
<p>_writer.WriteLine(header);</p>
<p>public void WriteRow(params object?[] cols)</p>
<p>=&gt; _writer.WriteLine(string.Join(“,”,</p>
<blockquote class="blockquote">
<p>Array.ConvertAll(cols, c =&gt; c?.ToString() ?? ““)));</p>
</blockquote>
<p>public void Close() =&gt; _writer.Flush();</p>
<p>public void Dispose() =&gt; _writer.Dispose();</p>
<p>}</p>
<p>}</p>
<p>}</p>
<section id="e.4-configuration-setup" class="level2" data-number="29.1">
<h2 data-number="29.1" class="anchored" data-anchor-id="e.4-configuration-setup"><span class="header-section-number">29.1</span> E.4 Configuration &amp; Setup</h2>
<section id="bitness" class="level3" data-number="29.1.1">
<h3 data-number="29.1.1" class="anchored" data-anchor-id="bitness"><span class="header-section-number">29.1.1</span> Bitness</h3>
<ul>
<li><p>EA 16+ is usually <strong>64-bit</strong>.</p></li>
<li><p>Match your project’s &lt;PlatformTarget&gt; to EA’s bitness (x64 or x86).</p></li>
</ul>
</section>
<section id="interop.ea.dll" class="level3" data-number="29.1.2">
<h3 data-number="29.1.2" class="anchored" data-anchor-id="interop.ea.dll"><span class="header-section-number">29.1.2</span> Interop.EA.dll</h3>
<ul>
<li><p>Found in EA install folder.</p></li>
<li><p>Add as a reference in your .NET project.</p></li>
</ul>
</section>
<section id="stathread" class="level3" data-number="29.1.3">
<h3 data-number="29.1.3" class="anchored" data-anchor-id="stathread"><span class="header-section-number">29.1.3</span> STAThread</h3>
<ul>
<li>COM automation requires [STAThread] on your entry point.</li>
</ul>
</section>
<section id="model-files" class="level3" data-number="29.1.4">
<h3 data-number="29.1.4" class="anchored" data-anchor-id="model-files"><span class="header-section-number">29.1.4</span> Model Files</h3>
<ul>
<li><p>Use .qea / .qeax / .eapx.</p></li>
<li><p>Options.ModelPath can auto-open a file if none is open.</p></li>
</ul>
</section>
<section id="dry-run-logging" class="level3" data-number="29.1.5">
<h3 data-number="29.1.5" class="anchored" data-anchor-id="dry-run-logging"><span class="header-section-number">29.1.5</span> Dry Run &amp; Logging</h3>
<ul>
<li><p>Always start in dryRun = true.</p></li>
<li><p>Review the generated CSV log before committing real updates.</p></li>
</ul>
</section>
<section id="distribution" class="level3" data-number="29.1.6">
<h3 data-number="29.1.6" class="anchored" data-anchor-id="distribution"><span class="header-section-number">29.1.6</span> Distribution</h3>
<ul>
<li><p>Package as a console utility or integrate into CI/CD.</p></li>
<li><p>Keep EAConnect.cs in a shared library for consistency.</p></li>
</ul>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script>

document.addEventListener('DOMContentLoaded', function () {

  // Prefer the margin sidebar if it exists; otherwise try the TOC sidebar.

  const margin = document.querySelector('#quarto-margin-sidebar, .margin-sidebar, .column-margin');

  const toc    = document.querySelector('nav#TOC');

  const sidebar = margin || (toc && toc.closest('.sidebar, .quarto-sidebar, .margin-sidebar'));



  if (!sidebar) return; // no margin column on this layout



  const holder = document.createElement('div');

  holder.className = 'cover-above-toc';

  holder.innerHTML = `

    <a href="index.html">

      <img src="images/cover.png" alt="Book cover" class="cover-above-toc__img" width="140" />

    </a>

  `;

  sidebar.prepend(holder);

});

</script>



<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./26-System.Object[].html" class="pagination-link" aria-label="Appendix D: Quick Reference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Appendix D: Quick Reference</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu"># Appendix E: External Automation Setup</span></span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a>This appendix provides the reusable EAConnect helper class plus the</span>
<span id="cb1-4"><a href="#cb1-4"></a>configuration details required to build external automation tools</span>
<span id="cb1-5"><a href="#cb1-5"></a>against Enterprise Architect (EA). It is intended as the “plumbing”</span>
<span id="cb1-6"><a href="#cb1-6"></a>layer behind the example in **Chapter 6 – External Automation**.</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">## E.1 Purpose</span></span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a>The EAConnect helper abstracts the complexities of EA’s COM interface</span>
<span id="cb1-11"><a href="#cb1-11"></a>and standardises safety practices:</span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="ss">- </span>Attaching to or launching EA consistently</span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="ss">- </span>Waiting for the Repository to become available</span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="ss">- </span>Opening models automatically if needed</span>
<span id="cb1-18"><a href="#cb1-18"></a></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="ss">- </span>Handling bitness and Interop.EA.dll</span>
<span id="cb1-20"><a href="#cb1-20"></a></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="ss">- </span>Providing safe wrappers for common tasks (find package, add element,</span>
<span id="cb1-22"><a href="#cb1-22"></a>  add tagged value)</span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="ss">- </span>Enforcing **dry-run by default**</span>
<span id="cb1-25"><a href="#cb1-25"></a></span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="ss">- </span>Writing CSV audit logs with auto-derived filenames</span>
<span id="cb1-27"><a href="#cb1-27"></a></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="ss">- </span>Refreshing EA’s UI at sensible points</span>
<span id="cb1-29"><a href="#cb1-29"></a></span>
<span id="cb1-30"><a href="#cb1-30"></a>With this helper, your utilities focus on intent rather than</span>
<span id="cb1-31"><a href="#cb1-31"></a>boilerplate.</span>
<span id="cb1-32"><a href="#cb1-32"></a></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="fu">## E.2 Usage</span></span>
<span id="cb1-34"><a href="#cb1-34"></a></span>
<span id="cb1-35"><a href="#cb1-35"></a>A minimal program using the helper:</span>
<span id="cb1-36"><a href="#cb1-36"></a></span>
<span id="cb1-37"><a href="#cb1-37"></a>using System;</span>
<span id="cb1-38"><a href="#cb1-38"></a></span>
<span id="cb1-39"><a href="#cb1-39"></a>using EA;</span>
<span id="cb1-40"><a href="#cb1-40"></a></span>
<span id="cb1-41"><a href="#cb1-41"></a>using EA.Automation; // the helper namespace</span>
<span id="cb1-42"><a href="#cb1-42"></a></span>
<span id="cb1-43"><a href="#cb1-43"></a>class Program</span>
<span id="cb1-44"><a href="#cb1-44"></a></span>
<span id="cb1-45"><a href="#cb1-45"></a>{</span>
<span id="cb1-46"><a href="#cb1-46"></a></span>
<span id="cb1-47"><a href="#cb1-47"></a><span class="sc">\[</span>STAThread<span class="sc">\]</span></span>
<span id="cb1-48"><a href="#cb1-48"></a></span>
<span id="cb1-49"><a href="#cb1-49"></a>static void Main(string<span class="sc">\[\]</span> args)</span>
<span id="cb1-50"><a href="#cb1-50"></a></span>
<span id="cb1-51"><a href="#cb1-51"></a>{</span>
<span id="cb1-52"><a href="#cb1-52"></a></span>
<span id="cb1-53"><a href="#cb1-53"></a>using var ea = EAConnect.AttachOrLaunch(new EAConnect.Options { ShowUI =</span>
<span id="cb1-54"><a href="#cb1-54"></a>true });</span>
<span id="cb1-55"><a href="#cb1-55"></a></span>
<span id="cb1-56"><a href="#cb1-56"></a>Package pkg = ea.GetSelectedPackageOrRoot();</span>
<span id="cb1-57"><a href="#cb1-57"></a></span>
<span id="cb1-58"><a href="#cb1-58"></a>var result = EAConnect.AddElement(ea.Repo, pkg, "DemoClass", "Class",</span>
<span id="cb1-59"><a href="#cb1-59"></a></span>
<span id="cb1-60"><a href="#cb1-60"></a>"Created by EAConnect.", dryRun: true);</span>
<span id="cb1-61"><a href="#cb1-61"></a></span>
<span id="cb1-62"><a href="#cb1-62"></a>Console.WriteLine(result.Summary);</span>
<span id="cb1-63"><a href="#cb1-63"></a></span>
<span id="cb1-64"><a href="#cb1-64"></a>}</span>
<span id="cb1-65"><a href="#cb1-65"></a></span>
<span id="cb1-66"><a href="#cb1-66"></a>}</span>
<span id="cb1-67"><a href="#cb1-67"></a></span>
<span id="cb1-68"><a href="#cb1-68"></a>This pattern keeps the Program.cs short and declarative. All detailed</span>
<span id="cb1-69"><a href="#cb1-69"></a>logic resides in the helper.</span>
<span id="cb1-70"><a href="#cb1-70"></a></span>
<span id="cb1-71"><a href="#cb1-71"></a><span class="fu">## E.3 The EAConnect Helper Class</span></span>
<span id="cb1-72"><a href="#cb1-72"></a></span>
<span id="cb1-73"><a href="#cb1-73"></a>//</span>
<span id="cb1-74"><a href="#cb1-74"></a><span class="fu">=======================================================================</span></span>
<span id="cb1-75"><a href="#cb1-75"></a></span>
<span id="cb1-76"><a href="#cb1-76"></a>// File: EAConnect.cs</span>
<span id="cb1-77"><a href="#cb1-77"></a></span>
<span id="cb1-78"><a href="#cb1-78"></a>// Project: EA Automation Helper</span>
<span id="cb1-79"><a href="#cb1-79"></a></span>
<span id="cb1-80"><a href="#cb1-80"></a>// Author: <span class="sc">\&lt;</span>Your Name<span class="sc">\&gt;</span></span>
<span id="cb1-81"><a href="#cb1-81"></a></span>
<span id="cb1-82"><a href="#cb1-82"></a>// Created: 2025-08-31</span>
<span id="cb1-83"><a href="#cb1-83"></a></span>
<span id="cb1-84"><a href="#cb1-84"></a>// Last Update: 2025-08-31</span>
<span id="cb1-85"><a href="#cb1-85"></a></span>
<span id="cb1-86"><a href="#cb1-86"></a>//</span>
<span id="cb1-87"><a href="#cb1-87"></a></span>
<span id="cb1-88"><a href="#cb1-88"></a>// PURPOSE</span>
<span id="cb1-89"><a href="#cb1-89"></a></span>
<span id="cb1-90"><a href="#cb1-90"></a>// -------</span>
<span id="cb1-91"><a href="#cb1-91"></a></span>
<span id="cb1-92"><a href="#cb1-92"></a>// Provides a safe, reusable abstraction over EA’s COM automation API.</span>
<span id="cb1-93"><a href="#cb1-93"></a></span>
<span id="cb1-94"><a href="#cb1-94"></a>// Handles: attach/launch, repository polling, model open, package</span>
<span id="cb1-95"><a href="#cb1-95"></a></span>
<span id="cb1-96"><a href="#cb1-96"></a>// resolution,</span>
<span id="cb1-97"><a href="#cb1-97"></a></span>
<span id="cb1-98"><a href="#cb1-98"></a>// element creation, tagged value creation, CSV logging, and UI refresh.</span>
<span id="cb1-99"><a href="#cb1-99"></a></span>
<span id="cb1-100"><a href="#cb1-100"></a>//</span>
<span id="cb1-101"><a href="#cb1-101"></a></span>
<span id="cb1-102"><a href="#cb1-102"></a>// USAGE</span>
<span id="cb1-103"><a href="#cb1-103"></a></span>
<span id="cb1-104"><a href="#cb1-104"></a>// -----</span>
<span id="cb1-105"><a href="#cb1-105"></a></span>
<span id="cb1-106"><a href="#cb1-106"></a>// using var ea = EAConnect.AttachOrLaunch(new EAConnect.Options {</span>
<span id="cb1-107"><a href="#cb1-107"></a></span>
<span id="cb1-108"><a href="#cb1-108"></a>// ShowUI = true });</span>
<span id="cb1-109"><a href="#cb1-109"></a></span>
<span id="cb1-110"><a href="#cb1-110"></a>// var pkg = ea.GetSelectedPackageOrRoot();</span>
<span id="cb1-111"><a href="#cb1-111"></a></span>
<span id="cb1-112"><a href="#cb1-112"></a>// var result = EAConnect.AddElement(ea.Repo, pkg, "NewClass", "Class",</span>
<span id="cb1-113"><a href="#cb1-113"></a></span>
<span id="cb1-114"><a href="#cb1-114"></a>// "Notes", true);</span>
<span id="cb1-115"><a href="#cb1-115"></a></span>
<span id="cb1-116"><a href="#cb1-116"></a>// Console.WriteLine(result.Summary);</span>
<span id="cb1-117"><a href="#cb1-117"></a></span>
<span id="cb1-118"><a href="#cb1-118"></a>//</span>
<span id="cb1-119"><a href="#cb1-119"></a></span>
<span id="cb1-120"><a href="#cb1-120"></a>// ASSUMPTIONS</span>
<span id="cb1-121"><a href="#cb1-121"></a></span>
<span id="cb1-122"><a href="#cb1-122"></a>// -----------</span>
<span id="cb1-123"><a href="#cb1-123"></a></span>
<span id="cb1-124"><a href="#cb1-124"></a>// - EA is installed and COM-registered (ProgID = "EA.App").</span>
<span id="cb1-125"><a href="#cb1-125"></a></span>
<span id="cb1-126"><a href="#cb1-126"></a>// - Interop.EA.dll referenced (from EA install folder).</span>
<span id="cb1-127"><a href="#cb1-127"></a></span>
<span id="cb1-128"><a href="#cb1-128"></a>// - Bitness of project matches EA (x64 for EA 64-bit; x86 for 32-bit).</span>
<span id="cb1-129"><a href="#cb1-129"></a></span>
<span id="cb1-130"><a href="#cb1-130"></a>// - .NET project marked <span class="sc">\[</span>STAThread<span class="sc">\]</span> on entry point.</span>
<span id="cb1-131"><a href="#cb1-131"></a></span>
<span id="cb1-132"><a href="#cb1-132"></a>//</span>
<span id="cb1-133"><a href="#cb1-133"></a></span>
<span id="cb1-134"><a href="#cb1-134"></a>// SAFETY</span>
<span id="cb1-135"><a href="#cb1-135"></a></span>
<span id="cb1-136"><a href="#cb1-136"></a>// ------</span>
<span id="cb1-137"><a href="#cb1-137"></a></span>
<span id="cb1-138"><a href="#cb1-138"></a>// - Dry-run enabled by default in sample programs.</span>
<span id="cb1-139"><a href="#cb1-139"></a></span>
<span id="cb1-140"><a href="#cb1-140"></a>// - CSV audit logging for all writes.</span>
<span id="cb1-141"><a href="#cb1-141"></a></span>
<span id="cb1-142"><a href="#cb1-142"></a>// - UI refresh at batch boundaries only.</span>
<span id="cb1-143"><a href="#cb1-143"></a></span>
<span id="cb1-144"><a href="#cb1-144"></a>//</span>
<span id="cb1-145"><a href="#cb1-145"></a></span>
<span id="cb1-146"><a href="#cb1-146"></a>// DEPENDENCIES</span>
<span id="cb1-147"><a href="#cb1-147"></a></span>
<span id="cb1-148"><a href="#cb1-148"></a>// ------------</span>
<span id="cb1-149"><a href="#cb1-149"></a></span>
<span id="cb1-150"><a href="#cb1-150"></a>// - System.Runtime.InteropServices (Marshal.GetActiveObject).</span>
<span id="cb1-151"><a href="#cb1-151"></a></span>
<span id="cb1-152"><a href="#cb1-152"></a>// - Interop.EA.dll.</span>
<span id="cb1-153"><a href="#cb1-153"></a></span>
<span id="cb1-154"><a href="#cb1-154"></a>//</span>
<span id="cb1-155"><a href="#cb1-155"></a></span>
<span id="cb1-156"><a href="#cb1-156"></a>// UPDATE HISTORY</span>
<span id="cb1-157"><a href="#cb1-157"></a></span>
<span id="cb1-158"><a href="#cb1-158"></a>// --------------</span>
<span id="cb1-159"><a href="#cb1-159"></a></span>
<span id="cb1-160"><a href="#cb1-160"></a>// - 2025-08-31: Initial helper version.</span>
<span id="cb1-161"><a href="#cb1-161"></a></span>
<span id="cb1-162"><a href="#cb1-162"></a>//</span>
<span id="cb1-163"><a href="#cb1-163"></a><span class="fu">=======================================================================</span></span>
<span id="cb1-164"><a href="#cb1-164"></a></span>
<span id="cb1-165"><a href="#cb1-165"></a>using System;</span>
<span id="cb1-166"><a href="#cb1-166"></a></span>
<span id="cb1-167"><a href="#cb1-167"></a>using System.IO;</span>
<span id="cb1-168"><a href="#cb1-168"></a></span>
<span id="cb1-169"><a href="#cb1-169"></a>using System.Runtime.InteropServices;</span>
<span id="cb1-170"><a href="#cb1-170"></a></span>
<span id="cb1-171"><a href="#cb1-171"></a>using EA;</span>
<span id="cb1-172"><a href="#cb1-172"></a></span>
<span id="cb1-173"><a href="#cb1-173"></a>namespace EA.Automation</span>
<span id="cb1-174"><a href="#cb1-174"></a></span>
<span id="cb1-175"><a href="#cb1-175"></a>{</span>
<span id="cb1-176"><a href="#cb1-176"></a></span>
<span id="cb1-177"><a href="#cb1-177"></a>public static class EAConnect</span>
<span id="cb1-178"><a href="#cb1-178"></a></span>
<span id="cb1-179"><a href="#cb1-179"></a>{</span>
<span id="cb1-180"><a href="#cb1-180"></a></span>
<span id="cb1-181"><a href="#cb1-181"></a>// Encapsulates a connected EA session</span>
<span id="cb1-182"><a href="#cb1-182"></a></span>
<span id="cb1-183"><a href="#cb1-183"></a>public sealed class Session : IDisposable</span>
<span id="cb1-184"><a href="#cb1-184"></a></span>
<span id="cb1-185"><a href="#cb1-185"></a>{</span>
<span id="cb1-186"><a href="#cb1-186"></a></span>
<span id="cb1-187"><a href="#cb1-187"></a>public EA.App App { get; }</span>
<span id="cb1-188"><a href="#cb1-188"></a></span>
<span id="cb1-189"><a href="#cb1-189"></a>public EA.Repository Repo { get; }</span>
<span id="cb1-190"><a href="#cb1-190"></a></span>
<span id="cb1-191"><a href="#cb1-191"></a>internal Session(EA.App app, EA.Repository repo)</span>
<span id="cb1-192"><a href="#cb1-192"></a></span>
<span id="cb1-193"><a href="#cb1-193"></a>{</span>
<span id="cb1-194"><a href="#cb1-194"></a></span>
<span id="cb1-195"><a href="#cb1-195"></a>App = app;</span>
<span id="cb1-196"><a href="#cb1-196"></a></span>
<span id="cb1-197"><a href="#cb1-197"></a>Repo = repo;</span>
<span id="cb1-198"><a href="#cb1-198"></a></span>
<span id="cb1-199"><a href="#cb1-199"></a>}</span>
<span id="cb1-200"><a href="#cb1-200"></a></span>
<span id="cb1-201"><a href="#cb1-201"></a>public Package GetSelectedPackageOrRoot()</span>
<span id="cb1-202"><a href="#cb1-202"></a></span>
<span id="cb1-203"><a href="#cb1-203"></a>{</span>
<span id="cb1-204"><a href="#cb1-204"></a></span>
<span id="cb1-205"><a href="#cb1-205"></a>Package? pkg = Repo.GetTreeSelectedPackage();</span>
<span id="cb1-206"><a href="#cb1-206"></a></span>
<span id="cb1-207"><a href="#cb1-207"></a>if (pkg != null) return pkg;</span>
<span id="cb1-208"><a href="#cb1-208"></a></span>
<span id="cb1-209"><a href="#cb1-209"></a>if (Repo.Models.Count <span class="sc">\&gt;</span> 0) return</span>
<span id="cb1-210"><a href="#cb1-210"></a></span>
<span id="cb1-211"><a href="#cb1-211"></a><span class="at">&gt; (Package)Repo.Models.GetAt(0);</span></span>
<span id="cb1-212"><a href="#cb1-212"></a></span>
<span id="cb1-213"><a href="#cb1-213"></a>throw new InvalidOperationException(</span>
<span id="cb1-214"><a href="#cb1-214"></a></span>
<span id="cb1-215"><a href="#cb1-215"></a><span class="at">&gt; "No package available in repository.");</span></span>
<span id="cb1-216"><a href="#cb1-216"></a></span>
<span id="cb1-217"><a href="#cb1-217"></a>}</span>
<span id="cb1-218"><a href="#cb1-218"></a></span>
<span id="cb1-219"><a href="#cb1-219"></a>public void Dispose()</span>
<span id="cb1-220"><a href="#cb1-220"></a></span>
<span id="cb1-221"><a href="#cb1-221"></a>{</span>
<span id="cb1-222"><a href="#cb1-222"></a></span>
<span id="cb1-223"><a href="#cb1-223"></a>// Release COM references cleanly</span>
<span id="cb1-224"><a href="#cb1-224"></a></span>
<span id="cb1-225"><a href="#cb1-225"></a>Marshal.ReleaseComObject(Repo);</span>
<span id="cb1-226"><a href="#cb1-226"></a></span>
<span id="cb1-227"><a href="#cb1-227"></a>Marshal.ReleaseComObject(App);</span>
<span id="cb1-228"><a href="#cb1-228"></a></span>
<span id="cb1-229"><a href="#cb1-229"></a>}</span>
<span id="cb1-230"><a href="#cb1-230"></a></span>
<span id="cb1-231"><a href="#cb1-231"></a>}</span>
<span id="cb1-232"><a href="#cb1-232"></a></span>
<span id="cb1-233"><a href="#cb1-233"></a>// Options for attaching or launching EA</span>
<span id="cb1-234"><a href="#cb1-234"></a></span>
<span id="cb1-235"><a href="#cb1-235"></a>public sealed class Options</span>
<span id="cb1-236"><a href="#cb1-236"></a></span>
<span id="cb1-237"><a href="#cb1-237"></a>{</span>
<span id="cb1-238"><a href="#cb1-238"></a></span>
<span id="cb1-239"><a href="#cb1-239"></a>public bool PreferAttach { get; set; } = true;</span>
<span id="cb1-240"><a href="#cb1-240"></a></span>
<span id="cb1-241"><a href="#cb1-241"></a>public bool LaunchIfNotRunning { get; set; } = true;</span>
<span id="cb1-242"><a href="#cb1-242"></a></span>
<span id="cb1-243"><a href="#cb1-243"></a>public string? ModelPath { get; set; }</span>
<span id="cb1-244"><a href="#cb1-244"></a></span>
<span id="cb1-245"><a href="#cb1-245"></a>public bool ShowUI { get; set; } = true;</span>
<span id="cb1-246"><a href="#cb1-246"></a></span>
<span id="cb1-247"><a href="#cb1-247"></a>public int StartupWaitMs { get; set; } = 1500;</span>
<span id="cb1-248"><a href="#cb1-248"></a></span>
<span id="cb1-249"><a href="#cb1-249"></a>public int RepoPollMs { get; set; } = 100;</span>
<span id="cb1-250"><a href="#cb1-250"></a></span>
<span id="cb1-251"><a href="#cb1-251"></a>public int RepoPollMax { get; set; } = 50;</span>
<span id="cb1-252"><a href="#cb1-252"></a></span>
<span id="cb1-253"><a href="#cb1-253"></a>}</span>
<span id="cb1-254"><a href="#cb1-254"></a></span>
<span id="cb1-255"><a href="#cb1-255"></a>// Attach to EA or launch new instance</span>
<span id="cb1-256"><a href="#cb1-256"></a></span>
<span id="cb1-257"><a href="#cb1-257"></a>public static Session AttachOrLaunch(Options? options = null)</span>
<span id="cb1-258"><a href="#cb1-258"></a></span>
<span id="cb1-259"><a href="#cb1-259"></a>{</span>
<span id="cb1-260"><a href="#cb1-260"></a></span>
<span id="cb1-261"><a href="#cb1-261"></a>options ??= new Options();</span>
<span id="cb1-262"><a href="#cb1-262"></a></span>
<span id="cb1-263"><a href="#cb1-263"></a>EA.App? app = null;</span>
<span id="cb1-264"><a href="#cb1-264"></a></span>
<span id="cb1-265"><a href="#cb1-265"></a>if (options.PreferAttach)</span>
<span id="cb1-266"><a href="#cb1-266"></a></span>
<span id="cb1-267"><a href="#cb1-267"></a>{</span>
<span id="cb1-268"><a href="#cb1-268"></a></span>
<span id="cb1-269"><a href="#cb1-269"></a>try { app = (EA.App)Marshal.GetActiveObject("EA.App"); }</span>
<span id="cb1-270"><a href="#cb1-270"></a></span>
<span id="cb1-271"><a href="#cb1-271"></a>catch { /<span class="sc">\*</span> none running <span class="sc">\*</span>/ }</span>
<span id="cb1-272"><a href="#cb1-272"></a></span>
<span id="cb1-273"><a href="#cb1-273"></a>}</span>
<span id="cb1-274"><a href="#cb1-274"></a></span>
<span id="cb1-275"><a href="#cb1-275"></a>if (app == null &amp;&amp; options.LaunchIfNotRunning)</span>
<span id="cb1-276"><a href="#cb1-276"></a></span>
<span id="cb1-277"><a href="#cb1-277"></a>{</span>
<span id="cb1-278"><a href="#cb1-278"></a></span>
<span id="cb1-279"><a href="#cb1-279"></a><span class="at">&gt; Type t = Type.GetTypeFromProgID("EA.App") ?? throw new</span></span>
<span id="cb1-280"><a href="#cb1-280"></a><span class="at">&gt;</span></span>
<span id="cb1-281"><a href="#cb1-281"></a><span class="at">&gt; InvalidOperationException("EA not installed.");</span></span>
<span id="cb1-282"><a href="#cb1-282"></a></span>
<span id="cb1-283"><a href="#cb1-283"></a>app = (EA.App)Activator.CreateInstance(t)!;</span>
<span id="cb1-284"><a href="#cb1-284"></a></span>
<span id="cb1-285"><a href="#cb1-285"></a>if (!options.ShowUI) app.Visible = false;</span>
<span id="cb1-286"><a href="#cb1-286"></a></span>
<span id="cb1-287"><a href="#cb1-287"></a>System.Threading.Thread.Sleep(options.StartupWaitMs);</span>
<span id="cb1-288"><a href="#cb1-288"></a></span>
<span id="cb1-289"><a href="#cb1-289"></a>}</span>
<span id="cb1-290"><a href="#cb1-290"></a></span>
<span id="cb1-291"><a href="#cb1-291"></a>if (app == null) throw new InvalidOperationException(</span>
<span id="cb1-292"><a href="#cb1-292"></a></span>
<span id="cb1-293"><a href="#cb1-293"></a><span class="at">&gt; "Unable to connect to EA.");</span></span>
<span id="cb1-294"><a href="#cb1-294"></a></span>
<span id="cb1-295"><a href="#cb1-295"></a>EA.Repository repo = app.Repository;</span>
<span id="cb1-296"><a href="#cb1-296"></a></span>
<span id="cb1-297"><a href="#cb1-297"></a>// Poll until repository becomes available</span>
<span id="cb1-298"><a href="#cb1-298"></a></span>
<span id="cb1-299"><a href="#cb1-299"></a>int polls = 0;</span>
<span id="cb1-300"><a href="#cb1-300"></a></span>
<span id="cb1-301"><a href="#cb1-301"></a>while (repo == null &amp;&amp; polls <span class="sc">\&lt;</span> options.RepoPollMax)</span>
<span id="cb1-302"><a href="#cb1-302"></a></span>
<span id="cb1-303"><a href="#cb1-303"></a>{</span>
<span id="cb1-304"><a href="#cb1-304"></a></span>
<span id="cb1-305"><a href="#cb1-305"></a>System.Threading.Thread.Sleep(options.RepoPollMs);</span>
<span id="cb1-306"><a href="#cb1-306"></a></span>
<span id="cb1-307"><a href="#cb1-307"></a>repo = app.Repository;</span>
<span id="cb1-308"><a href="#cb1-308"></a></span>
<span id="cb1-309"><a href="#cb1-309"></a>polls++;</span>
<span id="cb1-310"><a href="#cb1-310"></a></span>
<span id="cb1-311"><a href="#cb1-311"></a>}</span>
<span id="cb1-312"><a href="#cb1-312"></a></span>
<span id="cb1-313"><a href="#cb1-313"></a>if (repo == null) throw new InvalidOperationException("</span>
<span id="cb1-314"><a href="#cb1-314"></a></span>
<span id="cb1-315"><a href="#cb1-315"></a><span class="at">&gt; EA.Repository did not initialise.");</span></span>
<span id="cb1-316"><a href="#cb1-316"></a></span>
<span id="cb1-317"><a href="#cb1-317"></a>if (!string.IsNullOrWhiteSpace(options.ModelPath) &amp;&amp;</span>
<span id="cb1-318"><a href="#cb1-318"></a></span>
<span id="cb1-319"><a href="#cb1-319"></a><span class="at">&gt; string.IsNullOrWhiteSpace(repo.ConnectionString))</span></span>
<span id="cb1-320"><a href="#cb1-320"></a></span>
<span id="cb1-321"><a href="#cb1-321"></a>repo.OpenFile(options.ModelPath);</span>
<span id="cb1-322"><a href="#cb1-322"></a></span>
<span id="cb1-323"><a href="#cb1-323"></a>return new Session(app, repo);</span>
<span id="cb1-324"><a href="#cb1-324"></a></span>
<span id="cb1-325"><a href="#cb1-325"></a>}</span>
<span id="cb1-326"><a href="#cb1-326"></a></span>
<span id="cb1-327"><a href="#cb1-327"></a>// Result container</span>
<span id="cb1-328"><a href="#cb1-328"></a></span>
<span id="cb1-329"><a href="#cb1-329"></a>public sealed class Result</span>
<span id="cb1-330"><a href="#cb1-330"></a></span>
<span id="cb1-331"><a href="#cb1-331"></a>{</span>
<span id="cb1-332"><a href="#cb1-332"></a></span>
<span id="cb1-333"><a href="#cb1-333"></a>public int UpdatedCount { get; init; }</span>
<span id="cb1-334"><a href="#cb1-334"></a></span>
<span id="cb1-335"><a href="#cb1-335"></a>public string Summary { get; init; } = "";</span>
<span id="cb1-336"><a href="#cb1-336"></a></span>
<span id="cb1-337"><a href="#cb1-337"></a>public string? LogPath { get; init; }</span>
<span id="cb1-338"><a href="#cb1-338"></a></span>
<span id="cb1-339"><a href="#cb1-339"></a>public string? ElementGuid { get; init; }</span>
<span id="cb1-340"><a href="#cb1-340"></a></span>
<span id="cb1-341"><a href="#cb1-341"></a>}</span>
<span id="cb1-342"><a href="#cb1-342"></a></span>
<span id="cb1-343"><a href="#cb1-343"></a>// Add a new element safely</span>
<span id="cb1-344"><a href="#cb1-344"></a></span>
<span id="cb1-345"><a href="#cb1-345"></a>public static Result AddElement(Repository repo,</span>
<span id="cb1-346"><a href="#cb1-346"></a></span>
<span id="cb1-347"><a href="#cb1-347"></a><span class="at">&gt; Package targetPackage,</span></span>
<span id="cb1-348"><a href="#cb1-348"></a><span class="at">&gt;</span></span>
<span id="cb1-349"><a href="#cb1-349"></a><span class="at">&gt; string name,</span></span>
<span id="cb1-350"><a href="#cb1-350"></a><span class="at">&gt;</span></span>
<span id="cb1-351"><a href="#cb1-351"></a><span class="at">&gt; string type,</span></span>
<span id="cb1-352"><a href="#cb1-352"></a><span class="at">&gt;</span></span>
<span id="cb1-353"><a href="#cb1-353"></a><span class="at">&gt; string? notes, bool dryRun = true, CsvLogger? logger = null)</span></span>
<span id="cb1-354"><a href="#cb1-354"></a></span>
<span id="cb1-355"><a href="#cb1-355"></a>{</span>
<span id="cb1-356"><a href="#cb1-356"></a></span>
<span id="cb1-357"><a href="#cb1-357"></a>var el = (Element)targetPackage.Elements.AddNew(name, type);</span>
<span id="cb1-358"><a href="#cb1-358"></a></span>
<span id="cb1-359"><a href="#cb1-359"></a>if (!string.IsNullOrWhiteSpace(notes)) el.Notes = notes;</span>
<span id="cb1-360"><a href="#cb1-360"></a></span>
<span id="cb1-361"><a href="#cb1-361"></a>if (dryRun)</span>
<span id="cb1-362"><a href="#cb1-362"></a></span>
<span id="cb1-363"><a href="#cb1-363"></a>{</span>
<span id="cb1-364"><a href="#cb1-364"></a></span>
<span id="cb1-365"><a href="#cb1-365"></a>logger?.WriteRow(DateTime.Now, "DRYRUN",</span>
<span id="cb1-366"><a href="#cb1-366"></a></span>
<span id="cb1-367"><a href="#cb1-367"></a><span class="at">&gt; targetPackage.PackageID,</span></span>
<span id="cb1-368"><a href="#cb1-368"></a><span class="at">&gt;</span></span>
<span id="cb1-369"><a href="#cb1-369"></a><span class="at">&gt; "", name, type, notes ?? "");</span></span>
<span id="cb1-370"><a href="#cb1-370"></a></span>
<span id="cb1-371"><a href="#cb1-371"></a>return new Result { UpdatedCount = 0,</span>
<span id="cb1-372"><a href="#cb1-372"></a></span>
<span id="cb1-373"><a href="#cb1-373"></a><span class="at">&gt; Summary = \$"</span><span class="sc">\[</span><span class="at">DRYRUN</span><span class="sc">\]</span><span class="at"> Would create: {name} ({type})" };</span></span>
<span id="cb1-374"><a href="#cb1-374"></a></span>
<span id="cb1-375"><a href="#cb1-375"></a>}</span>
<span id="cb1-376"><a href="#cb1-376"></a></span>
<span id="cb1-377"><a href="#cb1-377"></a>if (!el.Update())</span>
<span id="cb1-378"><a href="#cb1-378"></a></span>
<span id="cb1-379"><a href="#cb1-379"></a>throw new InvalidOperationException(</span>
<span id="cb1-380"><a href="#cb1-380"></a></span>
<span id="cb1-381"><a href="#cb1-381"></a><span class="at">&gt; "Element.Update() failed.");</span></span>
<span id="cb1-382"><a href="#cb1-382"></a></span>
<span id="cb1-383"><a href="#cb1-383"></a>repo.RefreshModelView(targetPackage.PackageID);</span>
<span id="cb1-384"><a href="#cb1-384"></a></span>
<span id="cb1-385"><a href="#cb1-385"></a>logger?.WriteRow(DateTime.Now, "CREATE",</span>
<span id="cb1-386"><a href="#cb1-386"></a></span>
<span id="cb1-387"><a href="#cb1-387"></a><span class="at">&gt; targetPackage.PackageID,</span></span>
<span id="cb1-388"><a href="#cb1-388"></a><span class="at">&gt;</span></span>
<span id="cb1-389"><a href="#cb1-389"></a><span class="at">&gt; el.ElementGUID, name, type, notes ?? "");</span></span>
<span id="cb1-390"><a href="#cb1-390"></a></span>
<span id="cb1-391"><a href="#cb1-391"></a>return new Result</span>
<span id="cb1-392"><a href="#cb1-392"></a></span>
<span id="cb1-393"><a href="#cb1-393"></a>{</span>
<span id="cb1-394"><a href="#cb1-394"></a></span>
<span id="cb1-395"><a href="#cb1-395"></a>UpdatedCount = 1,</span>
<span id="cb1-396"><a href="#cb1-396"></a></span>
<span id="cb1-397"><a href="#cb1-397"></a>Summary = \$"Created element: {name} ({type})",</span>
<span id="cb1-398"><a href="#cb1-398"></a></span>
<span id="cb1-399"><a href="#cb1-399"></a>ElementGuid = el.ElementGUID,</span>
<span id="cb1-400"><a href="#cb1-400"></a></span>
<span id="cb1-401"><a href="#cb1-401"></a>LogPath = logger?.Path</span>
<span id="cb1-402"><a href="#cb1-402"></a></span>
<span id="cb1-403"><a href="#cb1-403"></a>};</span>
<span id="cb1-404"><a href="#cb1-404"></a></span>
<span id="cb1-405"><a href="#cb1-405"></a>}</span>
<span id="cb1-406"><a href="#cb1-406"></a></span>
<span id="cb1-407"><a href="#cb1-407"></a>// CSV logger</span>
<span id="cb1-408"><a href="#cb1-408"></a></span>
<span id="cb1-409"><a href="#cb1-409"></a>public sealed class CsvLogger : IDisposable</span>
<span id="cb1-410"><a href="#cb1-410"></a></span>
<span id="cb1-411"><a href="#cb1-411"></a>{</span>
<span id="cb1-412"><a href="#cb1-412"></a></span>
<span id="cb1-413"><a href="#cb1-413"></a>private readonly StreamWriter <span class="sc">\_</span>writer;</span>
<span id="cb1-414"><a href="#cb1-414"></a></span>
<span id="cb1-415"><a href="#cb1-415"></a>public string Path { get; }</span>
<span id="cb1-416"><a href="#cb1-416"></a></span>
<span id="cb1-417"><a href="#cb1-417"></a>private CsvLogger(string path)</span>
<span id="cb1-418"><a href="#cb1-418"></a></span>
<span id="cb1-419"><a href="#cb1-419"></a>{</span>
<span id="cb1-420"><a href="#cb1-420"></a></span>
<span id="cb1-421"><a href="#cb1-421"></a>Path = path;</span>
<span id="cb1-422"><a href="#cb1-422"></a></span>
<span id="cb1-423"><a href="#cb1-423"></a><span class="sc">\_</span>writer = new StreamWriter(path, append: false,</span>
<span id="cb1-424"><a href="#cb1-424"></a></span>
<span id="cb1-425"><a href="#cb1-425"></a><span class="at">&gt; System.Text.Encoding.UTF8);</span></span>
<span id="cb1-426"><a href="#cb1-426"></a></span>
<span id="cb1-427"><a href="#cb1-427"></a>}</span>
<span id="cb1-428"><a href="#cb1-428"></a></span>
<span id="cb1-429"><a href="#cb1-429"></a>public static CsvLogger Open(string path) =<span class="sc">\&gt;</span></span>
<span id="cb1-430"><a href="#cb1-430"></a></span>
<span id="cb1-431"><a href="#cb1-431"></a><span class="at">&gt; new CsvLogger(path);</span></span>
<span id="cb1-432"><a href="#cb1-432"></a></span>
<span id="cb1-433"><a href="#cb1-433"></a>public void WriteHeader(string header) =<span class="sc">\&gt;</span></span>
<span id="cb1-434"><a href="#cb1-434"></a></span>
<span id="cb1-435"><a href="#cb1-435"></a><span class="sc">\_</span>writer.WriteLine(header);</span>
<span id="cb1-436"><a href="#cb1-436"></a></span>
<span id="cb1-437"><a href="#cb1-437"></a>public void WriteRow(params object?<span class="sc">\[\]</span> cols)</span>
<span id="cb1-438"><a href="#cb1-438"></a></span>
<span id="cb1-439"><a href="#cb1-439"></a>=<span class="sc">\&gt;</span> <span class="sc">\_</span>writer.WriteLine(string.Join(",",</span>
<span id="cb1-440"><a href="#cb1-440"></a></span>
<span id="cb1-441"><a href="#cb1-441"></a><span class="at">&gt; Array.ConvertAll(cols, c =</span><span class="sc">\&gt;</span><span class="at"> c?.ToString() ?? "")));</span></span>
<span id="cb1-442"><a href="#cb1-442"></a></span>
<span id="cb1-443"><a href="#cb1-443"></a>public void Close() =<span class="sc">\&gt;</span> <span class="sc">\_</span>writer.Flush();</span>
<span id="cb1-444"><a href="#cb1-444"></a></span>
<span id="cb1-445"><a href="#cb1-445"></a>public void Dispose() =<span class="sc">\&gt;</span> <span class="sc">\_</span>writer.Dispose();</span>
<span id="cb1-446"><a href="#cb1-446"></a></span>
<span id="cb1-447"><a href="#cb1-447"></a>}</span>
<span id="cb1-448"><a href="#cb1-448"></a></span>
<span id="cb1-449"><a href="#cb1-449"></a>}</span>
<span id="cb1-450"><a href="#cb1-450"></a></span>
<span id="cb1-451"><a href="#cb1-451"></a>}</span>
<span id="cb1-452"><a href="#cb1-452"></a></span>
<span id="cb1-453"><a href="#cb1-453"></a><span class="fu">## E.4 Configuration &amp; Setup</span></span>
<span id="cb1-454"><a href="#cb1-454"></a></span>
<span id="cb1-455"><a href="#cb1-455"></a><span class="fu">### Bitness</span></span>
<span id="cb1-456"><a href="#cb1-456"></a></span>
<span id="cb1-457"><a href="#cb1-457"></a><span class="ss">- </span>EA 16+ is usually **64-bit**.</span>
<span id="cb1-458"><a href="#cb1-458"></a></span>
<span id="cb1-459"><a href="#cb1-459"></a><span class="ss">- </span>Match your project’s <span class="sc">\&lt;</span>PlatformTarget<span class="sc">\&gt;</span> to EA’s bitness (x64 or x86).</span>
<span id="cb1-460"><a href="#cb1-460"></a></span>
<span id="cb1-461"><a href="#cb1-461"></a><span class="fu">### Interop.EA.dll</span></span>
<span id="cb1-462"><a href="#cb1-462"></a></span>
<span id="cb1-463"><a href="#cb1-463"></a><span class="ss">- </span>Found in EA install folder.</span>
<span id="cb1-464"><a href="#cb1-464"></a></span>
<span id="cb1-465"><a href="#cb1-465"></a><span class="ss">- </span>Add as a reference in your .NET project.</span>
<span id="cb1-466"><a href="#cb1-466"></a></span>
<span id="cb1-467"><a href="#cb1-467"></a><span class="fu">### STAThread</span></span>
<span id="cb1-468"><a href="#cb1-468"></a></span>
<span id="cb1-469"><a href="#cb1-469"></a><span class="ss">- </span>COM automation requires <span class="sc">\[</span>STAThread<span class="sc">\]</span> on your entry point.</span>
<span id="cb1-470"><a href="#cb1-470"></a></span>
<span id="cb1-471"><a href="#cb1-471"></a><span class="fu">### Model Files</span></span>
<span id="cb1-472"><a href="#cb1-472"></a></span>
<span id="cb1-473"><a href="#cb1-473"></a><span class="ss">- </span>Use .qea / .qeax / .eapx.</span>
<span id="cb1-474"><a href="#cb1-474"></a></span>
<span id="cb1-475"><a href="#cb1-475"></a><span class="ss">- </span>Options.ModelPath can auto-open a file if none is open.</span>
<span id="cb1-476"><a href="#cb1-476"></a></span>
<span id="cb1-477"><a href="#cb1-477"></a><span class="fu">### Dry Run &amp; Logging</span></span>
<span id="cb1-478"><a href="#cb1-478"></a></span>
<span id="cb1-479"><a href="#cb1-479"></a><span class="ss">- </span>Always start in dryRun = true.</span>
<span id="cb1-480"><a href="#cb1-480"></a></span>
<span id="cb1-481"><a href="#cb1-481"></a><span class="ss">- </span>Review the generated CSV log before committing real updates.</span>
<span id="cb1-482"><a href="#cb1-482"></a></span>
<span id="cb1-483"><a href="#cb1-483"></a><span class="fu">### Distribution</span></span>
<span id="cb1-484"><a href="#cb1-484"></a></span>
<span id="cb1-485"><a href="#cb1-485"></a><span class="ss">- </span>Package as a console utility or integrate into CI/CD.</span>
<span id="cb1-486"><a href="#cb1-486"></a></span>
<span id="cb1-487"><a href="#cb1-487"></a><span class="ss">- </span>Keep EAConnect.cs in a shared library for consistency.</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>