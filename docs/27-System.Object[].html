<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Appendix E: External Automation Setup – Scripting Sparx Enterprise Architect: A Practical Handbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./26-System.Object[].html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-b4ddde2c4c77ed14ccfa95278770da4f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./27-System.Object[].html"><span class="chapter-title">Appendix E: External Automation Setup</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">
      Scripting Sparx Enterprise Architect: A Practical Handbook
      </a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Scripting Sparx Enterprise Architect</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-Preface.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 1: Why Script EA?</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 2: Automation Landscape</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 3: Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 4: API Essentials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 5: Inside EA with JScript</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 6: External Automation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 7: Script Design Patterns</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 8: Object Details</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 9: Imports &amp; Exports</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 10: MDG-Aware Scripting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 11: Governance Scripts</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 12: Cookbook of Examples</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 13: Why AI Helps</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 14: Prompt Engineering</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 15: AI Refactoring Partner</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 16: AI in Daily Workflow</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 17: Performance &amp; Scaling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 18: Integrating with Workflows</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 19: Add-ins vs Scripts</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 20: Troubleshooting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Chapter 21: Reference</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix A: Scripting Constraints</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix B: External Automation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix C: Glossary of Terms</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26-System.Object[].html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix D: Quick Reference</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27-System.Object[].html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Appendix E: External Automation Setup</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#e.1-purpose" id="toc-e.1-purpose" class="nav-link active" data-scroll-target="#e.1-purpose">E.1 Purpose</a></li>
  <li><a href="#e.2-usage" id="toc-e.2-usage" class="nav-link" data-scroll-target="#e.2-usage">E.2 Usage</a></li>
  <li><a href="#e.3-the-eaconnect-helper-class" id="toc-e.3-the-eaconnect-helper-class" class="nav-link" data-scroll-target="#e.3-the-eaconnect-helper-class">E.3 The EAConnect Helper Class</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section">//</a>
  <ul class="collapse">
  <li><a href="#e.3-the-eaconnect-helper-class-1" id="toc-e.3-the-eaconnect-helper-class-1" class="nav-link" data-scroll-target="#e.3-the-eaconnect-helper-class-1">E.3 The EAConnect Helper Class</a></li>
  </ul></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1">//</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-title">Appendix E: External Automation Setup</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This appendix provides the reusable EAConnect helper class plus the configuration details required to build external automation tools against Enterprise Architect (EA). It is intended as the “plumbing” layer behind the example in <strong>Chapter 6 – External Automation</strong>.</p>
<section id="e.1-purpose" class="level2">
<h2 class="anchored" data-anchor-id="e.1-purpose">E.1 Purpose</h2>
<p>The EAConnect helper abstracts the complexities of EA’s COM interface and standardises safety practices:</p>
<ul>
<li><p>Attaching to or launching EA consistently</p></li>
<li><p>Waiting for the Repository to become available</p></li>
<li><p>Opening models automatically if needed</p></li>
<li><p>Handling bitness and Interop.EA.dll</p></li>
<li><p>Providing safe wrappers for common tasks (find package, add element, add tagged value)</p></li>
<li><p>Enforcing <strong>dry-run by default</strong></p></li>
<li><p>Writing CSV audit logs with auto-derived filenames</p></li>
<li><p>Refreshing EA’s UI at sensible points</p></li>
</ul>
<p>With this helper, your utilities focus on intent rather than boilerplate.</p>
</section>
<section id="e.2-usage" class="level2">
<h2 class="anchored" data-anchor-id="e.2-usage">E.2 Usage</h2>
<p>A minimal program using the helper:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode numberSource csharp number-lines code-with-copy"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1"></a></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">using</span> EA<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">using</span> EA<span class="op">.</span><span class="fu">Automation</span><span class="op">;</span> <span class="co">// the helper namespace</span></span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="kw">class</span> Program</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="op">{</span></span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a>\<span class="op">[</span>STAThread\<span class="op">]</span></span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span><span class="op">(</span><span class="dt">string</span>\<span class="op">[</span>\<span class="op">]</span> args<span class="op">)</span></span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="op">{</span></span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="kw">using</span> <span class="dt">var</span> ea <span class="op">=</span> EAConnect<span class="op">.</span><span class="fu">AttachOrLaunch</span><span class="op">(</span><span class="kw">new</span> EAConnect<span class="op">.</span><span class="fu">Options</span> <span class="op">{</span> ShowUI <span class="op">=</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="kw">true</span> <span class="op">});</span></span>
<span id="cb1-20"><a href="#cb1-20"></a></span>
<span id="cb1-21"><a href="#cb1-21"></a>Package pkg <span class="op">=</span> ea<span class="op">.</span><span class="fu">GetSelectedPackageOrRoot</span><span class="op">();</span></span>
<span id="cb1-22"><a href="#cb1-22"></a></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="dt">var</span> result <span class="op">=</span> EAConnect<span class="op">.</span><span class="fu">AddElement</span><span class="op">(</span>ea<span class="op">.</span><span class="fu">Repo</span><span class="op">,</span> pkg<span class="op">,</span> <span class="st">"DemoClass"</span><span class="op">,</span> <span class="st">"Class"</span><span class="op">,</span></span>
<span id="cb1-24"><a href="#cb1-24"></a></span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="st">"Created by EAConnect."</span><span class="op">,</span> dryRun<span class="op">:</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb1-26"><a href="#cb1-26"></a></span>
<span id="cb1-27"><a href="#cb1-27"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>result<span class="op">.</span><span class="fu">Summary</span><span class="op">);</span></span>
<span id="cb1-28"><a href="#cb1-28"></a></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="op">}</span></span>
<span id="cb1-30"><a href="#cb1-30"></a></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This pattern keeps the Program.cs short and declarative. All detailed logic resides in the helper.</p>
</section>
<section id="e.3-the-eaconnect-helper-class" class="level2">
<h2 class="anchored" data-anchor-id="e.3-the-eaconnect-helper-class">E.3 The EAConnect Helper Class</h2>
<p>’’’csharp // =======================================================================</p>
<p>// File: EAConnect.cs</p>
<p>// Project: EA Automation Helper</p>
<p>// Author: &lt;Your Name&gt;</p>
<p>// Created: 2025-08-31</p>
<p>// Last Update: 2025-08-31</p>
<p>//</p>
<p>// PURPOSE</p>
<p>// ——-</p>
<p>// Provides a safe, reusable abstraction over EA’s COM automation API.</p>
<p>// Handles: attach/launch, repository polling, model open, package</p>
<p>// resolution,</p>
<p>// element creation, tagged value creation, CSV logging, and UI refresh.</p>
<p>//</p>
<p>// USAGE</p>
<p>// —–</p>
<p>// using var ea = EAConnect.AttachOrLaunch(new EAConnect.Options {</p>
<p>// ShowUI = true });</p>
<p>// var pkg = ea.GetSelectedPackageOrRoot();</p>
<p>// var result = EAConnect.AddElement(ea.Repo, pkg, “NewClass”, “Class”,</p>
<p>// “Notes”, true);</p>
<p>// Console.WriteLine(result.Summary);</p>
<p>//</p>
<p>// ASSUMPTIONS</p>
<p>// ———–</p>
<p>// - EA is installed and COM-registered (ProgID = “EA.App”).</p>
<p>// - Interop.EA.dll referenced (from EA install folder).</p>
<p>// - Bitness of project matches EA (x64 for EA 64-bit; x86 for 32-bit).</p>
<p>// - .NET project marked [STAThread] on entry point.</p>
<p>//</p>
<p>// SAFETY</p>
<p>// ——</p>
<p>// - Dry-run enabled by default in sample programs.</p>
<p>// - CSV audit logging for all writes.</p>
<p>// - UI refresh at batch boundaries only.</p>
<p>//</p>
<p>// DEPENDENCIES</p>
<p>// ————</p>
<p>// - System.Runtime.InteropServices (Marshal.GetActiveObject).</p>
<p>// - Interop.EA.dll.</p>
<p>//</p>
<p>// UPDATE HISTORY</p>
<p>// ————–</p>
<p>// - 2025-08-31: Initial helper version.</p>
</section>
<section id="section" class="level1">
<h1>//</h1>
<p>using System;</p>
<p>using System.IO;</p>
<p>using System.Runtime.InteropServices;</p>
<p>using EA;</p>
<p>namespace EA.Automation</p>
<p>{</p>
<p>public static class EAConnect</p>
<p>{</p>
<p>// Encapsulates a connected EA session</p>
<p>public sealed class Session : IDisposable</p>
<p>{</p>
<p>public EA.App App { get; }</p>
<p>public EA.Repository Repo { get; }</p>
<p>internal Session(EA.App app, EA.Repository repo)</p>
<p>{</p>
<p>App = app;</p>
<p>Repo = repo;</p>
<p>}</p>
<p>public Package GetSelectedPackageOrRoot()</p>
<p>{</p>
<p>Package? pkg = Repo.GetTreeSelectedPackage();</p>
<p>if (pkg != null) return pkg;</p>
<p>if (Repo.Models.Count &gt; 0) return</p>
<blockquote class="blockquote">
<p>(Package)Repo.Models.GetAt(0);</p>
</blockquote>
<p>throw new InvalidOperationException(</p>
<blockquote class="blockquote">
<p>“No package available in repository.”);</p>
</blockquote>
<p>}</p>
<p>public void Dispose()</p>
<p>{</p>
<p>// Release COM references cleanly</p>
<p>Marshal.ReleaseComObject(Repo);</p>
<p>Marshal.ReleaseComObject(App);</p>
<p>}</p>
<p>}</p>
<p>// Options for attaching or launching EA</p>
<p>public sealed class Options</p>
<p>{</p>
<p>public bool PreferAttach { get; set; } = true;</p>
<p>public bool LaunchIfNotRunning { get; set; } = true;</p>
<p>public string? ModelPath { get; set; }</p>
<p>public bool ShowUI { get; set; } = true;</p>
<p>public int StartupWaitMs { get; set; } = 1500;</p>
<p>public int RepoPollMs { get; set; } = 100;</p>
<p>public int RepoPollMax { get; set; } = 50;</p>
<p>}</p>
<p>// Attach to EA or launch new instance</p>
<p>public static Session AttachOrLaunch(Options? options = null)</p>
<p>{</p>
<p>options ??= new Options();</p>
<p>EA.App? app = null;</p>
<p>if (options.PreferAttach)</p>
<p>{</p>
<p>try { app = (EA.App)Marshal.GetActiveObject(“EA.App”); }</p>
<p>catch { /* none running */ }</p>
<p>}</p>
<p>if (app == null &amp;&amp; options.LaunchIfNotRunning)</p>
<p>{</p>
<blockquote class="blockquote">
<p>Type t = Type.GetTypeFromProgID(“EA.App”) ?? throw new</p>
<p>InvalidOperationException(“EA not installed.”);</p>
</blockquote>
<p>app = (EA.App)Activator.CreateInstance(t)!;</p>
<p>if (!options.ShowUI) app.Visible = false;</p>
<p>System.Threading.Thread.Sleep(options.StartupWaitMs);</p>
<p>}</p>
<p>if (app == null) throw new InvalidOperationException(</p>
<blockquote class="blockquote">
<p>“Unable to connect to EA.”);</p>
</blockquote>
<p>EA.Repository repo = app.Repository;</p>
<p>// Poll until repository becomes available</p>
<p>int polls = 0;</p>
<p>while (repo == null &amp;&amp; polls &lt; options.RepoPollMax)</p>
<p>{</p>
<p>System.Threading.Thread.Sleep(options.RepoPollMs);</p>
<p>repo = app.Repository;</p>
<p>polls++;</p>
<p>}</p>
<p>if (repo == null) throw new InvalidOperationException(”</p>
<blockquote class="blockquote">
<p>EA.Repository did not initialise.”);</p>
</blockquote>
<p>if (!string.IsNullOrWhiteSpace(options.ModelPath) &amp;&amp;</p>
<blockquote class="blockquote">
<p>string.IsNullOrWhiteSpace(repo.ConnectionString))</p>
</blockquote>
<p>repo.OpenFile(options.ModelPath);</p>
<p>return new Session(app, repo);</p>
<p>}</p>
<p>// Result container</p>
<p>public sealed class Result</p>
<p>{</p>
<p>public int UpdatedCount { get; init; }</p>
<p>public string Summary { get; init; } = ““;</p>
<p>public string? LogPath { get; init; }</p>
<p>public string? ElementGuid { get; init; }</p>
<p>}</p>
<p>// Add a new element safely</p>
<p>public static Result AddElement(Repository repo,</p>
<blockquote class="blockquote">
<p>Package targetPackage,</p>
<p>string name,</p>
<p>string type,</p>
<p>string? notes, bool dryRun = true, CsvLogger? logger = null)</p>
</blockquote>
<p>{</p>
<p>var el = (Element)targetPackage.Elements.AddNew(name, type);</p>
<p>if (!string.IsNullOrWhiteSpace(notes)) el.Notes = notes;</p>
<p>if (dryRun)</p>
<p>{</p>
<p>logger?.WriteRow(DateTime.Now, “DRYRUN”,</p>
<blockquote class="blockquote">
<p>targetPackage.PackageID,</p>
<p>““, name, type, notes ??”“);</p>
</blockquote>
<p>return new Result { UpdatedCount = 0,</p>
<blockquote class="blockquote">
<p>Summary = $“[DRYRUN] Would create: {name} ({type})” };</p>
</blockquote>
<p>}</p>
<p>if (!el.Update())</p>
<p>throw new InvalidOperationException(</p>
<blockquote class="blockquote">
<p>“Element.Update() failed.”);</p>
</blockquote>
<p>repo.RefreshModelView(targetPackage.PackageID);</p>
<p>logger?.WriteRow(DateTime.Now, “CREATE”,</p>
<blockquote class="blockquote">
<p>targetPackage.PackageID,</p>
<p>el.ElementGUID, name, type, notes ?? ““);</p>
</blockquote>
<p>return new Result</p>
<p>{</p>
<p>UpdatedCount = 1,</p>
<p>Summary = $“Created element: {name} ({type})”,</p>
<p>ElementGuid = el.ElementGUID,</p>
<p>LogPath = logger?.Path</p>
<p>};</p>
<p>}</p>
<p>// CSV logger</p>
<p>public sealed class CsvLogger : IDisposable</p>
<p>{</p>
<p>private readonly StreamWriter _writer;</p>
<p>public string Path { get; }</p>
<p>private CsvLogger(string path)</p>
<p>{</p>
<p>Path = path;</p>
<p>_writer = new StreamWriter(path, append: false,</p>
<blockquote class="blockquote">
<p>System.Text.Encoding.UTF8);</p>
</blockquote>
<p>}</p>
<p>public static CsvLogger Open(string path) =&gt;</p>
<blockquote class="blockquote">
<p>new CsvLogger(path);</p>
</blockquote>
<p>public void WriteHeader(string header) =&gt;</p>
<p>_writer.WriteLine(header);</p>
<p>public void WriteRow(params object?[] cols)</p>
<p>=&gt; _writer.WriteLine(string.Join(“,”,</p>
<blockquote class="blockquote">
<p>Array.ConvertAll(cols, c =&gt; c?.ToString() ?? ““)));</p>
</blockquote>
<p>public void Close() =&gt; _writer.Flush();</p>
<p>public void Dispose() =&gt; _writer.Dispose();</p>
<p>}</p>
<p>}</p>
<p>}</p>
<pre><code>
## E.4 Configuration &amp; Setup

### Bitness

- EA 16+ is usually **64-bit**.

- Match your project’s \&lt;PlatformTarget\&gt; to EA’s bitness (x64 or x86).

### Interop.EA.dll

- Found in EA install folder.

- Add as a reference in your .NET project.

### STAThread

- COM automation requires \[STAThread\] on your entry point.

### Model Files

- Use .qea / .qeax / .eapx.

- Options.ModelPath can auto-open a file if none is open.

### Dry Run &amp; Logging

- Always start in dryRun = true.

- Review the generated CSV log before committing real updates.

### Distribution

- Package as a console utility or integrate into CI/CD.

- Keep EAConnect.cs in a shared library for consistency.




:::{#quarto-navigation-envelope .hidden}
[Scripting Sparx Enterprise Architect: A Practical Handbook]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyLXRpdGxl"}
[Scripting Sparx Enterprise Architect: A Practical Handbook]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1uYXZiYXItdGl0bGU="}
[&lt;span class='chapter-number'&gt;27&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Appendix D: Quick Reference&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1wcmV2"}
[&lt;span class='chapter-number'&gt;1&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Scripting Sparx Enterprise Architect&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi9pbmRleC5odG1sPHNwYW4tY2xhc3M9J2NoYXB0ZXItbnVtYmVyJz4xPC9zcGFuPi0tPHNwYW4tY2xhc3M9J2NoYXB0ZXItdGl0bGUnPlNjcmlwdGluZy1TcGFyeC1FbnRlcnByaXNlLUFyY2hpdGVjdDwvc3Bhbj4="}
[&lt;span class='chapter-number'&gt;2&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Preface&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8wMS1QcmVmYWNlLmh0bWw8c3Bhbi1jbGFzcz0nY2hhcHRlci1udW1iZXInPjI8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+UHJlZmFjZTwvc3Bhbj4="}
[&lt;span class='chapter-number'&gt;3&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 1: Why Script EA?&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8wMi1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+Mzwvc3Bhbj4tLTxzcGFuLWNsYXNzPSdjaGFwdGVyLXRpdGxlJz5DaGFwdGVyLTE6LVdoeS1TY3JpcHQtRUE/PC9zcGFuPg=="}
[&lt;span class='chapter-number'&gt;4&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 2: Automation Landscape&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8wMy1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+NDwvc3Bhbj4tLTxzcGFuLWNsYXNzPSdjaGFwdGVyLXRpdGxlJz5DaGFwdGVyLTI6LUF1dG9tYXRpb24tTGFuZHNjYXBlPC9zcGFuPg=="}
[&lt;span class='chapter-number'&gt;5&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 3: Getting Started&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8wNC1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+NTwvc3Bhbj4tLTxzcGFuLWNsYXNzPSdjaGFwdGVyLXRpdGxlJz5DaGFwdGVyLTM6LUdldHRpbmctU3RhcnRlZDwvc3Bhbj4="}
[&lt;span class='chapter-number'&gt;6&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 4: API Essentials&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8wNS1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+Njwvc3Bhbj4tLTxzcGFuLWNsYXNzPSdjaGFwdGVyLXRpdGxlJz5DaGFwdGVyLTQ6LUFQSS1Fc3NlbnRpYWxzPC9zcGFuPg=="}
[&lt;span class='chapter-number'&gt;7&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 5: Inside EA with JScript&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8wNi1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+Nzwvc3Bhbj4tLTxzcGFuLWNsYXNzPSdjaGFwdGVyLXRpdGxlJz5DaGFwdGVyLTU6LUluc2lkZS1FQS13aXRoLUpTY3JpcHQ8L3NwYW4+"}
[&lt;span class='chapter-number'&gt;8&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 6: External Automation&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8wNy1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+ODwvc3Bhbj4tLTxzcGFuLWNsYXNzPSdjaGFwdGVyLXRpdGxlJz5DaGFwdGVyLTY6LUV4dGVybmFsLUF1dG9tYXRpb248L3NwYW4+"}
[&lt;span class='chapter-number'&gt;9&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 7: Script Design Patterns&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8wOC1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+OTwvc3Bhbj4tLTxzcGFuLWNsYXNzPSdjaGFwdGVyLXRpdGxlJz5DaGFwdGVyLTc6LVNjcmlwdC1EZXNpZ24tUGF0dGVybnM8L3NwYW4+"}
[&lt;span class='chapter-number'&gt;10&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 8: Object Details&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8wOS1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+MTA8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+Q2hhcHRlci04Oi1PYmplY3QtRGV0YWlsczwvc3Bhbj4="}
[&lt;span class='chapter-number'&gt;11&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 9: Imports &amp; Exports&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8xMC1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+MTE8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+Q2hhcHRlci05Oi1JbXBvcnRzLSYtRXhwb3J0czwvc3Bhbj4="}
[&lt;span class='chapter-number'&gt;12&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 10: MDG-Aware Scripting&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8xMS1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+MTI8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+Q2hhcHRlci0xMDotTURHLUF3YXJlLVNjcmlwdGluZzwvc3Bhbj4="}
[&lt;span class='chapter-number'&gt;13&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 11: Governance Scripts&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8xMi1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+MTM8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+Q2hhcHRlci0xMTotR292ZXJuYW5jZS1TY3JpcHRzPC9zcGFuPg=="}
[&lt;span class='chapter-number'&gt;14&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 12: Cookbook of Examples&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8xMy1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+MTQ8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+Q2hhcHRlci0xMjotQ29va2Jvb2stb2YtRXhhbXBsZXM8L3NwYW4+"}
[&lt;span class='chapter-number'&gt;15&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 13: Why AI Helps&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8xNC1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+MTU8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+Q2hhcHRlci0xMzotV2h5LUFJLUhlbHBzPC9zcGFuPg=="}
[&lt;span class='chapter-number'&gt;16&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 14: Prompt Engineering&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8xNS1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+MTY8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+Q2hhcHRlci0xNDotUHJvbXB0LUVuZ2luZWVyaW5nPC9zcGFuPg=="}
[&lt;span class='chapter-number'&gt;17&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 15: AI Refactoring Partner&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8xNi1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+MTc8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+Q2hhcHRlci0xNTotQUktUmVmYWN0b3JpbmctUGFydG5lcjwvc3Bhbj4="}
[&lt;span class='chapter-number'&gt;18&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 16: AI in Daily Workflow&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8xNy1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+MTg8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+Q2hhcHRlci0xNjotQUktaW4tRGFpbHktV29ya2Zsb3c8L3NwYW4+"}
[&lt;span class='chapter-number'&gt;19&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 17: Performance &amp; Scaling&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8xOC1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+MTk8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+Q2hhcHRlci0xNzotUGVyZm9ybWFuY2UtJi1TY2FsaW5nPC9zcGFuPg=="}
[&lt;span class='chapter-number'&gt;20&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 18: Integrating with Workflows&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8xOS1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+MjA8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+Q2hhcHRlci0xODotSW50ZWdyYXRpbmctd2l0aC1Xb3JrZmxvd3M8L3NwYW4+"}
[&lt;span class='chapter-number'&gt;21&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 19: Add-ins vs Scripts&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8yMC1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+MjE8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+Q2hhcHRlci0xOTotQWRkLWlucy12cy1TY3JpcHRzPC9zcGFuPg=="}
[&lt;span class='chapter-number'&gt;22&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 20: Troubleshooting&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8yMS1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+MjI8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+Q2hhcHRlci0yMDotVHJvdWJsZXNob290aW5nPC9zcGFuPg=="}
[&lt;span class='chapter-number'&gt;23&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Chapter 21: Reference&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8yMi1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+MjM8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+Q2hhcHRlci0yMTotUmVmZXJlbmNlPC9zcGFuPg=="}
[&lt;span class='chapter-number'&gt;24&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Appendix A: Scripting Constraints&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8yMy1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+MjQ8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+QXBwZW5kaXgtQTotU2NyaXB0aW5nLUNvbnN0cmFpbnRzPC9zcGFuPg=="}
[&lt;span class='chapter-number'&gt;25&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Appendix B: External Automation&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8yNC1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+MjU8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+QXBwZW5kaXgtQjotRXh0ZXJuYWwtQXV0b21hdGlvbjwvc3Bhbj4="}
[&lt;span class='chapter-number'&gt;26&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Appendix C: Glossary of Terms&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8yNS1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+MjY8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+QXBwZW5kaXgtQzotR2xvc3Nhcnktb2YtVGVybXM8L3NwYW4+"}
[&lt;span class='chapter-number'&gt;27&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Appendix D: Quick Reference&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8yNi1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+Mjc8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+QXBwZW5kaXgtRDotUXVpY2stUmVmZXJlbmNlPC9zcGFuPg=="}
[&lt;span class='chapter-number'&gt;28&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Appendix E: External Automation Setup&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWludC1zaWRlYmFyOi8yNy1TeXN0ZW0uT2JqZWN0W10uaHRtbDxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+Mjg8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+QXBwZW5kaXgtRTotRXh0ZXJuYWwtQXV0b21hdGlvbi1TZXR1cDwvc3Bhbj4="}
[&lt;span class='chapter-number'&gt;28&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Appendix E: External Automation Setup&lt;/span&gt;]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLWJyZWFkY3J1bWJzLTxzcGFuLWNsYXNzPSdjaGFwdGVyLW51bWJlcic+Mjg8L3NwYW4+LS08c3Bhbi1jbGFzcz0nY2hhcHRlci10aXRsZSc+QXBwZW5kaXgtRTotRXh0ZXJuYWwtQXV0b21hdGlvbi1TZXR1cDwvc3Bhbj4="}
:::



:::{#quarto-meta-markdown .hidden}
[[Appendix E: External Automation Setup]{.chapter-title} – Scripting Sparx Enterprise Architect: A Practical Handbook]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLW1ldGF0aXRsZQ=="}
[[Appendix E: External Automation Setup]{.chapter-title} – Scripting Sparx Enterprise Architect: A Practical Handbook]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLXR3aXR0ZXJjYXJkdGl0bGU="}
[[Appendix E: External Automation Setup]{.chapter-title} – Scripting Sparx Enterprise Architect: A Practical Handbook]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLW9nY2FyZHRpdGxl"}
[Scripting Sparx Enterprise Architect: A Practical Handbook]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLW1ldGFzaXRlbmFtZQ=="}
[]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLXR3aXR0ZXJjYXJkZGVzYw=="}
[]{.hidden .quarto-markdown-envelope-contents render-id="cXVhcnRvLW9nY2FyZGRkZXNj"}
:::




&lt;!-- --&gt;

::: {.quarto-embedded-source-code}
```````````````````{.markdown shortcodes="false"}
# Appendix E: External Automation Setup

This appendix provides the reusable EAConnect helper class plus the
configuration details required to build external automation tools
against Enterprise Architect (EA). It is intended as the “plumbing”
layer behind the example in **Chapter 6 – External Automation**.

## E.1 Purpose

The EAConnect helper abstracts the complexities of EA’s COM interface
and standardises safety practices:

- Attaching to or launching EA consistently

- Waiting for the Repository to become available

- Opening models automatically if needed

- Handling bitness and Interop.EA.dll

- Providing safe wrappers for common tasks (find package, add element,
  add tagged value)

- Enforcing **dry-run by default**

- Writing CSV audit logs with auto-derived filenames

- Refreshing EA’s UI at sensible points

With this helper, your utilities focus on intent rather than
boilerplate.

## E.2 Usage

A minimal program using the helper:
```csharp

using System;

using EA;

using EA.Automation; // the helper namespace

class Program

{

\[STAThread\]

static void Main(string\[\] args)

{

using var ea = EAConnect.AttachOrLaunch(new EAConnect.Options { ShowUI =
true });

Package pkg = ea.GetSelectedPackageOrRoot();

var result = EAConnect.AddElement(ea.Repo, pkg, "DemoClass", "Class",

"Created by EAConnect.", dryRun: true);

Console.WriteLine(result.Summary);

}

}</code></pre>
<p>This pattern keeps the Program.cs short and declarative. All detailed logic resides in the helper.</p>
<section id="e.3-the-eaconnect-helper-class-1" class="level2">
<h2 class="anchored" data-anchor-id="e.3-the-eaconnect-helper-class-1">E.3 The EAConnect Helper Class</h2>
<p>’’’csharp // =======================================================================</p>
<p>// File: EAConnect.cs</p>
<p>// Project: EA Automation Helper</p>
<p>// Author: &lt;Your Name&gt;</p>
<p>// Created: 2025-08-31</p>
<p>// Last Update: 2025-08-31</p>
<p>//</p>
<p>// PURPOSE</p>
<p>// ——-</p>
<p>// Provides a safe, reusable abstraction over EA’s COM automation API.</p>
<p>// Handles: attach/launch, repository polling, model open, package</p>
<p>// resolution,</p>
<p>// element creation, tagged value creation, CSV logging, and UI refresh.</p>
<p>//</p>
<p>// USAGE</p>
<p>// —–</p>
<p>// using var ea = EAConnect.AttachOrLaunch(new EAConnect.Options {</p>
<p>// ShowUI = true });</p>
<p>// var pkg = ea.GetSelectedPackageOrRoot();</p>
<p>// var result = EAConnect.AddElement(ea.Repo, pkg, “NewClass”, “Class”,</p>
<p>// “Notes”, true);</p>
<p>// Console.WriteLine(result.Summary);</p>
<p>//</p>
<p>// ASSUMPTIONS</p>
<p>// ———–</p>
<p>// - EA is installed and COM-registered (ProgID = “EA.App”).</p>
<p>// - Interop.EA.dll referenced (from EA install folder).</p>
<p>// - Bitness of project matches EA (x64 for EA 64-bit; x86 for 32-bit).</p>
<p>// - .NET project marked [STAThread] on entry point.</p>
<p>//</p>
<p>// SAFETY</p>
<p>// ——</p>
<p>// - Dry-run enabled by default in sample programs.</p>
<p>// - CSV audit logging for all writes.</p>
<p>// - UI refresh at batch boundaries only.</p>
<p>//</p>
<p>// DEPENDENCIES</p>
<p>// ————</p>
<p>// - System.Runtime.InteropServices (Marshal.GetActiveObject).</p>
<p>// - Interop.EA.dll.</p>
<p>//</p>
<p>// UPDATE HISTORY</p>
<p>// ————–</p>
<p>// - 2025-08-31: Initial helper version.</p>
</section>
</section>
<section id="section-1" class="level1">
<h1>//</h1>
<p>using System;</p>
<p>using System.IO;</p>
<p>using System.Runtime.InteropServices;</p>
<p>using EA;</p>
<p>namespace EA.Automation</p>
<p>{</p>
<p>public static class EAConnect</p>
<p>{</p>
<p>// Encapsulates a connected EA session</p>
<p>public sealed class Session : IDisposable</p>
<p>{</p>
<p>public EA.App App { get; }</p>
<p>public EA.Repository Repo { get; }</p>
<p>internal Session(EA.App app, EA.Repository repo)</p>
<p>{</p>
<p>App = app;</p>
<p>Repo = repo;</p>
<p>}</p>
<p>public Package GetSelectedPackageOrRoot()</p>
<p>{</p>
<p>Package? pkg = Repo.GetTreeSelectedPackage();</p>
<p>if (pkg != null) return pkg;</p>
<p>if (Repo.Models.Count &gt; 0) return</p>
<blockquote class="blockquote">
<p>(Package)Repo.Models.GetAt(0);</p>
</blockquote>
<p>throw new InvalidOperationException(</p>
<blockquote class="blockquote">
<p>“No package available in repository.”);</p>
</blockquote>
<p>}</p>
<p>public void Dispose()</p>
<p>{</p>
<p>// Release COM references cleanly</p>
<p>Marshal.ReleaseComObject(Repo);</p>
<p>Marshal.ReleaseComObject(App);</p>
<p>}</p>
<p>}</p>
<p>// Options for attaching or launching EA</p>
<p>public sealed class Options</p>
<p>{</p>
<p>public bool PreferAttach { get; set; } = true;</p>
<p>public bool LaunchIfNotRunning { get; set; } = true;</p>
<p>public string? ModelPath { get; set; }</p>
<p>public bool ShowUI { get; set; } = true;</p>
<p>public int StartupWaitMs { get; set; } = 1500;</p>
<p>public int RepoPollMs { get; set; } = 100;</p>
<p>public int RepoPollMax { get; set; } = 50;</p>
<p>}</p>
<p>// Attach to EA or launch new instance</p>
<p>public static Session AttachOrLaunch(Options? options = null)</p>
<p>{</p>
<p>options ??= new Options();</p>
<p>EA.App? app = null;</p>
<p>if (options.PreferAttach)</p>
<p>{</p>
<p>try { app = (EA.App)Marshal.GetActiveObject(“EA.App”); }</p>
<p>catch { /* none running */ }</p>
<p>}</p>
<p>if (app == null &amp;&amp; options.LaunchIfNotRunning)</p>
<p>{</p>
<blockquote class="blockquote">
<p>Type t = Type.GetTypeFromProgID(“EA.App”) ?? throw new</p>
<p>InvalidOperationException(“EA not installed.”);</p>
</blockquote>
<p>app = (EA.App)Activator.CreateInstance(t)!;</p>
<p>if (!options.ShowUI) app.Visible = false;</p>
<p>System.Threading.Thread.Sleep(options.StartupWaitMs);</p>
<p>}</p>
<p>if (app == null) throw new InvalidOperationException(</p>
<blockquote class="blockquote">
<p>“Unable to connect to EA.”);</p>
</blockquote>
<p>EA.Repository repo = app.Repository;</p>
<p>// Poll until repository becomes available</p>
<p>int polls = 0;</p>
<p>while (repo == null &amp;&amp; polls &lt; options.RepoPollMax)</p>
<p>{</p>
<p>System.Threading.Thread.Sleep(options.RepoPollMs);</p>
<p>repo = app.Repository;</p>
<p>polls++;</p>
<p>}</p>
<p>if (repo == null) throw new InvalidOperationException(”</p>
<blockquote class="blockquote">
<p>EA.Repository did not initialise.”);</p>
</blockquote>
<p>if (!string.IsNullOrWhiteSpace(options.ModelPath) &amp;&amp;</p>
<blockquote class="blockquote">
<p>string.IsNullOrWhiteSpace(repo.ConnectionString))</p>
</blockquote>
<p>repo.OpenFile(options.ModelPath);</p>
<p>return new Session(app, repo);</p>
<p>}</p>
<p>// Result container</p>
<p>public sealed class Result</p>
<p>{</p>
<p>public int UpdatedCount { get; init; }</p>
<p>public string Summary { get; init; } = ““;</p>
<p>public string? LogPath { get; init; }</p>
<p>public string? ElementGuid { get; init; }</p>
<p>}</p>
<p>// Add a new element safely</p>
<p>public static Result AddElement(Repository repo,</p>
<blockquote class="blockquote">
<p>Package targetPackage,</p>
<p>string name,</p>
<p>string type,</p>
<p>string? notes, bool dryRun = true, CsvLogger? logger = null)</p>
</blockquote>
<p>{</p>
<p>var el = (Element)targetPackage.Elements.AddNew(name, type);</p>
<p>if (!string.IsNullOrWhiteSpace(notes)) el.Notes = notes;</p>
<p>if (dryRun)</p>
<p>{</p>
<p>logger?.WriteRow(DateTime.Now, “DRYRUN”,</p>
<blockquote class="blockquote">
<p>targetPackage.PackageID,</p>
<p>““, name, type, notes ??”“);</p>
</blockquote>
<p>return new Result { UpdatedCount = 0,</p>
<blockquote class="blockquote">
<p>Summary = $“[DRYRUN] Would create: {name} ({type})” };</p>
</blockquote>
<p>}</p>
<p>if (!el.Update())</p>
<p>throw new InvalidOperationException(</p>
<blockquote class="blockquote">
<p>“Element.Update() failed.”);</p>
</blockquote>
<p>repo.RefreshModelView(targetPackage.PackageID);</p>
<p>logger?.WriteRow(DateTime.Now, “CREATE”,</p>
<blockquote class="blockquote">
<p>targetPackage.PackageID,</p>
<p>el.ElementGUID, name, type, notes ?? ““);</p>
</blockquote>
<p>return new Result</p>
<p>{</p>
<p>UpdatedCount = 1,</p>
<p>Summary = $“Created element: {name} ({type})”,</p>
<p>ElementGuid = el.ElementGUID,</p>
<p>LogPath = logger?.Path</p>
<p>};</p>
<p>}</p>
<p>// CSV logger</p>
<p>public sealed class CsvLogger : IDisposable</p>
<p>{</p>
<p>private readonly StreamWriter _writer;</p>
<p>public string Path { get; }</p>
<p>private CsvLogger(string path)</p>
<p>{</p>
<p>Path = path;</p>
<p>_writer = new StreamWriter(path, append: false,</p>
<blockquote class="blockquote">
<p>System.Text.Encoding.UTF8);</p>
</blockquote>
<p>}</p>
<p>public static CsvLogger Open(string path) =&gt;</p>
<blockquote class="blockquote">
<p>new CsvLogger(path);</p>
</blockquote>
<p>public void WriteHeader(string header) =&gt;</p>
<p>_writer.WriteLine(header);</p>
<p>public void WriteRow(params object?[] cols)</p>
<p>=&gt; _writer.WriteLine(string.Join(“,”,</p>
<blockquote class="blockquote">
<p>Array.ConvertAll(cols, c =&gt; c?.ToString() ?? ““)));</p>
</blockquote>
<p>public void Close() =&gt; _writer.Flush();</p>
<p>public void Dispose() =&gt; _writer.Dispose();</p>
<p>}</p>
<p>}</p>
<p>}</p>
<pre><code>
## E.4 Configuration &amp; Setup

### Bitness

- EA 16+ is usually **64-bit**.

- Match your project’s \&lt;PlatformTarget\&gt; to EA’s bitness (x64 or x86).

### Interop.EA.dll

- Found in EA install folder.

- Add as a reference in your .NET project.

### STAThread

- COM automation requires \[STAThread\] on your entry point.

### Model Files

- Use .qea / .qeax / .eapx.

- Options.ModelPath can auto-open a file if none is open.

### Dry Run &amp; Logging

- Always start in dryRun = true.

- Review the generated CSV log before committing real updates.

### Distribution

- Package as a console utility or integrate into CI/CD.

- Keep EAConnect.cs in a shared library for consistency.</code></pre>
<p>:::</p>
</section>

</main> <!-- /main -->
<script>

document.addEventListener('DOMContentLoaded', function () {

  // Prefer the margin sidebar if it exists; otherwise try the TOC sidebar.

  const margin = document.querySelector('#quarto-margin-sidebar, .margin-sidebar, .column-margin');

  const toc    = document.querySelector('nav#TOC');

  const sidebar = margin || (toc && toc.closest('.sidebar, .quarto-sidebar, .margin-sidebar'));



  if (!sidebar) return; // no margin column on this layout



  const holder = document.createElement('div');

  holder.className = 'cover-above-toc';

  holder.innerHTML = `

    <a href="index.html">

      <img src="images/cover.png" alt="Book cover" class="cover-above-toc__img" width="140" />

    </a>

  `;

  sidebar.prepend(holder);

});

</script>



<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./26-System.Object[].html" class="pagination-link" aria-label="Appendix D: Quick Reference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Appendix D: Quick Reference</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>